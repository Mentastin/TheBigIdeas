\chapter{Universal algebra}
TODO: forgetful functors.

\section{Algebras and terms}
\begin{definition}
A \udef{signature} or \udef{operational type} or \udef{operator domain} is a pair $(\Omega, \alpha)$ where $\Omega$ is a set whose elements are called \udef{operator symbols} or just operators and $\alpha: \Omega \to \N$ is a function. We call $\alpha(\omega)$ the \udef{arity} of the operator $\omega\in\Omega$. If the arity of $\omega\in\Omega$ is $n$, then we say $\omega$ is an \udef{$n$-ary} operator.
\end{definition}
We also say \udef{unary} instead of $1$-ary, \udef{binary} instead of $2$-ary and \udef{ternary} instead of $3$-ary.

\begin{definition}
A \udef{structure} of type $(\Omega,\alpha)$, also called an \udef{$\Omega$-structure} or \udef{$\Omega$-algebra}, is a set $A$, called the \udef{carrier}, equipped with a function
\[ \omega_A: A^{\alpha(\omega)}\to A \]
for each $\omega\in\Omega$. We call $\omega_A$ the \udef{interpretation} of $\omega$ in $A$.

If $\alpha(\omega) = 0$ we take $\omega_A$ to be a constant.
\end{definition}

\begin{definition}
Let $A$ be an $\Omega$-algebra. An \udef{$\Omega$-subalgebra} of $A$ is a subset that is closed under the operations of $\Omega$.
\end{definition}

\begin{lemma} \label{lemma:intersectionSubalgebra}
Let $A$ be an $\Omega$-algebra. Let $\mathcal{E}$ be a family of subalgebras. Then $\bigcap \mathcal{E}$ is also a subalgebra. 
\end{lemma}

\begin{definition}
Let $A$ be an $\Omega$-algebra and $X$ a subset of $A$. The subalgebra of $A$ \udef{generated} by $X$ is the intersection of all subalgebras containing $X$. We call $X$ the \udef{generating set} of this subalgebra.
\end{definition}
Every algebra has a (non-unique) generating set. For example the algebra itself.

\begin{definition}
The \udef{trivial} $\Omega$-algebra is the algebra generated by $\emptyset$.
\end{definition}

\subsection{Homomorphisms}
\begin{definition}
Let $A,B$ be $\Omega$-algebras. A \udef{homomorphism} of $\Omega$-algebras is a function $f:A\to B$ such that
\[ \forall \omega\in\Omega, \forall a_1,\ldots,a_{\alpha(\omega)}\in A: \quad f(\omega_A(a_1,\ldots, a_{\alpha(\omega)})) = \omega_B(f(a_1), \ldots, f(a_{\alpha(\omega)})). \]
\end{definition}

\begin{proposition}
Let $f,g:A\to B$ be two homomorphisms between $\Omega$-algebras $A,B$. If $f,g$ agree on a generating set of $A$, then they are equal.
\end{proposition}
\begin{proof}
The set $\setbuilder{x\in A}{f(x) = g(x)}$ is a subalgebra of $A$. By hypothesis it contains a generating set of $A$ and thus it is all of $A$.
\end{proof}

\begin{proposition}
Let $f:A\to B$ be a homomorphism. Then $\im f$ is a subalgebra of $B$.
\end{proposition}

\begin{proposition}
Let $(\Omega,\alpha)$ be a signature. Then the $\Omega$-algebras form a category with homomorphisms as arrows.
\end{proposition}
Consequently we have the concepts of isomorphism, endomorphism and automorphism.

\begin{proposition} \label{prop:bijectiveHomomorphism}
Let $f:A\to B$ be a bijective homomorphism. Then $f^{-1}$ is also a homomorphism and thus $f$ is an isomorphism.
\end{proposition}
\begin{proof}
Take arbitrary $\omega\in\Omega$ and $b_1,\ldots, b_{\alpha(\omega)}\in B$. We calculate
\begin{align*}
f^{-1}(\omega_B(b_1,\ldots, b_{\alpha(\omega)})) &= f^{-1}(\omega_B(ff^{-1}b_1,\ldots, ff^{-1}b_{\alpha(\omega)})) \\
&= f^{-1}f(\omega_A(f^{-1}b_1,\ldots, f^{-1}b_{\alpha(\omega)})) = \omega_A(f^{-1}b_1,\ldots, f^{-1}b_{\alpha(\omega)}).
\end{align*}
\end{proof}

\subsection{Congruences}
\subsubsection{Direct product}
\begin{definition}
Let $\{A_i\}_{i\in I}$ be a family of $\Omega$-algebras. The \udef{direct product} $\prod_{i\in I} A_i$ is the $\Omega$-algebra whose carrier is the Cartesian product of $\{A_i\}_{i\in I}$ and where operations are carried out componentwise and relations are verified pointwise.

Similarly a \udef{direct power} of $A$ is a Cartesian power of $A$ with operations and relations defined componentwise.
\end{definition}

The direct product of $\{A,B\}$ is simply written $A\times B$.

\subsubsection{Relations as algebras}
Let $A,B$ be $\Omega$-algebras. Then $A\times B$ is also an $\Omega$-algebra and subalgebras are too. Such subalgebras can be seen as a binary relation on $A,B$.

\begin{lemma}
Let $A,B,C$ be $\Omega$-algebras and $\Gamma, \Delta$ subalgebras of $A\times B$ and $B\times C$, respectively. Then
\begin{enumerate}
\item $\Gamma^{\transp} \subset B\times A$ is an $\Omega$-algebra;
\item $\Gamma;\Delta \subset A\times C$ is an $\Omega$-algebra;
\item for any subalgebra $A'$ of $A$, $A'\Gamma \subset B$ is an $\Omega$-algebra;
\item for any subalgebra $B'$ of $B$, $\Gamma B' \subset A$ is an $\Omega$-algebra.
\end{enumerate}
\end{lemma}

\subsubsection{Congruences}
\begin{definition}
Let $A$ be an $\Omega$-algebra. A \udef{congruence} $\mathfrak{q}$ on $A$ is an equivalence relation on $A$ that is a subalgebra of $A^2$.
\end{definition}

\begin{example}
Any algebra has the \udef{trivial congruences} $I_A$ and $A^2$.
\end{example}

An algebra is \udef{simple} if there are no congruences on it other than the trivial ones. We assume a simple algebra is non-trivial.

\begin{lemma} \label{lemma:basicCongruenceLemma}
Let $\mathfrak{q}$ be a congruence on an $\Omega$-algebra $A$ and $B$ an $\Omega$-subalgebra of $A$. Then
\begin{enumerate}
\item $\mathfrak{q}$ can be extended pointwise to a congruence on $A^2$, that is
\[ (a,b)\mathfrak{q}(c,d) \iff a\mathfrak{q}c \land b\mathfrak{q}d; \]
\item 
\item $\mathfrak{q}|_B^B$ is a congruence on $B$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) The extension of $\mathfrak{q}$ is an equivalence relation by \ref{lemma:relationPropertiesDirectProduct}.

We then need to prove that this extension is a subalgebra of $(A^2)^2$. This is easily verified using pointwise operations. (TODO develop easier machinery for this?)

(2) The restriction is an equivalence relation by \ref{lemma:relationPropertiesRestriction} and an $\Omega$-algebra by \ref{lemma:intersectionSubalgebra}.
\end{proof}
For simplicity we may write $B/\mathfrak{q}$ instead of $B/(\mathfrak{q}|_B^B)$.

\begin{proposition}
Let $f:A\to B$ be a homomorphism. Then $\ker f$ is a congruence on $A$.
\end{proposition}

\subsubsection{Quotient algebras}
\begin{proposition} \label{prop:quotientAlgebra}
Let $A$ be an $\Omega$-algebra and $\mathfrak{q}$ an equivalence relation. Then there exists an interpretation of $A/\mathfrak{q}$ such that the function
\[ A \to A/\mathfrak{q}: a\mapsto [a]_\mathfrak{q} \]
is a homomorphism if and only if $\mathfrak{q}$ is a congruence.

Explicitly, this interpretation is unique and given by
\[ \omega_{A/\mathfrak{q}}([a_1]_{\mathfrak{q}},\ldots,[a_{\alpha(\omega)}]_{\mathfrak{q}}) = [\omega_A(a_1,\ldots, a_{\alpha(\omega)})]_{\mathfrak{q}} \qquad \forall \omega\in\Omega. \]\end{proposition}
\begin{proof}
The requirement that $[\cdot]_\mathfrak{q}$ be a homomorphism forces the interpretation $\omega_{A/\mathfrak{q}}$ of $\omega$ to be the one given.

We just need to show that $\omega_{A/\mathfrak{q}}$ is well-defined if and only if $\mathfrak{q}$ is a congruence. To that end, choose arbitrary $a_1, \ldots, a_{\alpha(\omega)}$ and $a'_1, \ldots, a'_{\alpha(\omega)}$ such that $a_1'\in[a_1]_\mathfrak{q}, \ldots, a'_{\alpha(\omega)}\in [a_{\alpha(\omega)}]_\mathfrak{q}$. This is equivalent to choosing $(a_1,a'_1),\ldots, (a_{\alpha(\omega)},a'_{\alpha(\omega)}) \in \mathfrak{q}$. Then
\begin{align*}
[\omega_A(a_1,\ldots, a_{\alpha(\omega)})]_{\mathfrak{q}} = [\omega_A(a'_1,\ldots, a'_{\alpha(\omega)})]_{\mathfrak{q}} &\iff (\omega_A(a_1,\ldots, a_{\alpha(\omega)}),\omega_A(a'_1,\ldots, a'_{\alpha(\omega)})) \in \mathfrak{q} \\
&\iff \omega_{A^2}((a_1,a'_1),\ldots, (a_{\alpha(\omega)},a'_{\alpha(\omega)})) \in \mathfrak{q}
\end{align*}
where the first statement is the requirement of being well-defined and the last is the requirement for being a subalgebra of $A^2$.
\end{proof}
\begin{definition}
The $\Omega$-algebra $A/\mathfrak{q}$ is called the \udef{quotient algebra} of $A$ by $\mathfrak{q}$. The function $A \to A/\mathfrak{q}: a\mapsto [a]_\mathfrak{q}$ is known as the quotient map.
\end{definition}

\begin{proposition}[Factor theorem] \label{prop:factorTheorem}
Let $f:A\to B$ be a homomorphism of $\Omega$-algebras and $\mathfrak{q}$ a congruence on $A$ such that $\mathfrak{q}\subseteq \ker f$. Then
\[ f': A/\mathfrak{q} \to B: [a]_\mathfrak{q} \mapsto f'([a]_\mathfrak{q}) = f(a) \]
is a well-defined homomorphism. Further, $f'$ is injective \textup{if and only if} $\mathfrak{q} = \ker f$.
\end{proposition}
\begin{proof}
To show the function is well defined, take $a,a'\in A$ such that $[a]_\mathfrak{q} = [a']_\mathfrak{q}$, i.e. $(a,a')\in \mathfrak{q}$. This implies $(a,a')\in\ker f$, so $f(a) = f(a')$ and $f'$ is well-defined.

We see that $f'$ is a homomorphism by the calculation
\begin{align*}
f'(\omega_{A/\mathfrak{q}}([a_1], \ldots, [a_{\alpha(\omega)}])) &= f'([\omega_{A}(a_1, \ldots, a_{\alpha(\omega)})]) = f(\omega_{A}(a_1, \ldots, a_{\alpha(\omega)})) \\
&= \omega_B(f(a_1), \ldots f(a_{\alpha(\omega)})) = \omega_B(f'([a_1]), \ldots, f'([a_{\alpha(\omega)}])).
\end{align*}
Finally $f'$ is injective iff no two distinct $\mathfrak{q}$-classes are identified by $f'$, which is exactly the condition $\mathfrak{q} = \ker f$.
\end{proof}

\subsubsection{Isomorphism theorems}
\begin{theorem}[First isomorphism theorem] \label{theorem:firstIsomorphism}
Let $f:A\to B$ be a homomorphism of $\Omega$-algebras. Then we have the isomorphism
\[ A/\ker f \cong \im f. \]
\end{theorem}
\begin{proof}
From the factor theorem \ref{prop:factorTheorem} we get an injective homomorphism $f': A/\ker f \to B$ which is made surjective by restricting the codomain to $\im f$. By \ref{prop:bijectiveHomomorphism} this is an isomorphism.
\end{proof}

\begin{theorem}[Second isomorphism theorem]
Let $A$ be an $\Omega$-algebra, $B$ an $\Omega$-subalgebra of $A$ and $\mathfrak{q}$ a congruence on $A$. Then we have the isomorphism
\[ (\mathfrak{q}B)/\mathfrak{q} \cong B/(\mathfrak{q}\cap B^2). \]
\end{theorem}
Note that $\mathfrak{q}B = B\mathfrak{q}$ because $\mathfrak{q}$ is a congruence. Also $\mathfrak{q}\cap B^2 = \mathfrak{q}|_B^B$, so the quotient is well-defined by \ref{lemma:basicCongruenceLemma}. Further, $\mathfrak{q}$ should really be restricted in $(\mathfrak{q}B)/\mathfrak{q}$, as in \ref{lemma:basicCongruenceLemma}.
\begin{proof}
Take the homomorphism $[\cdot]_\mathfrak{q}:A \to A/\mathfrak{q}$ as defined in \ref{prop:quotientAlgebra} and restrict it to $B$. Applying the first isomorphism theorem \ref{theorem:firstIsomorphism} yields the required result.
\end{proof}

\begin{theorem}[Third isomorphism theorem]
Let $A$ be an $\Omega$-algebra and $\mathfrak{q},\mathfrak{r}$ congruences on $A$ such that $\mathfrak{q} \subseteq \mathfrak{r}$. Then we have the isomorphism
\[ (A/\mathfrak{q})/(\mathfrak{r}/\mathfrak{q}) \cong A/\mathfrak{r}. \]
\end{theorem}
In order to properly interpret $\mathfrak{r}/\mathfrak{q}$, we need to first extend $\mathfrak{q}$ to $A^2$ and then restrict to $\mathfrak{r}$, both as in \ref{lemma:basicCongruenceLemma}.
\begin{proof}
Applying the factor theorem \ref{prop:factorTheorem} to the homomorphism $A\to A/\mathfrak{r}$ from \ref{prop:quotientAlgebra}. We get a homomorphism $f: A/\mathfrak{q} \to A/\mathfrak{r}$. We apply the first isomorphism theorem \ref{theorem:firstIsomorphism} to this homomorphism. Then we just need to show that $\ker f = \mathfrak{r}/\mathfrak{q}$. TODO!
\end{proof}
In particular, we see that $A/\mathfrak{q}$ is simple if and only if $\mathfrak{q}$ is a maximal proper congruence on $A$.

\section{Free algebras and varieties}

\section{Algebraic theories}
\subsection{Properties of a single binary operator}
\begin{definition}
Let $(\Omega, \alpha)$ be a signature, $A$ an $\Omega$-structure and $\omega$ a binary operator. We call an interpretation $\omega_A$
\begin{itemize}
\item \udef{associative} if $\forall x,y,z\in A: \omega_A(\omega_A(x,y),z) = \omega_A(x,\omega_A(y,z))$;
\item \udef{commutative} if $\forall x,y\in A: \omega_A(x,y) = \omega_A(y,x)$;
\item \udef{idempotent} if $\forall x\in A: \omega_A(x,x) = x$.
\end{itemize}
We say
\begin{itemize}
\item $A$ has a \udef{left-identity} $e_L$ for $\omega_A$ if $\forall x\in A: \omega_A(e_L, x) = x$;
\item $A$ has a \udef{right-identity} $e_R$ for $\omega_A$ if $\forall x\in A: \omega_A(x, e_R) = x$;
\item $A$ has an \udef{identity} $e$ if $e$ is both a left- and a right-identity.
\end{itemize}
Let $A$ have an identity $e$ for $\omega_A$, then we say an element $x\in A$
\begin{itemize}
\item has a \udef{left-inverse} $y$ if $\omega_A(y,x) = e$;
\item has a \udef{right-inverse} $y$ if $\omega_A(x,y) = e$;
\item has an \udef{(two-sided) inverse} $y$ if $\omega_A(x,y) = e = \omega_A(y,x)$.
\end{itemize}
\end{definition}

\begin{lemma}
Let $(\Omega, \alpha)$ be a signature, $A$ an $\Omega$-structure and $\omega$ a binary operator. If $A$ has both a left-identity $e_L$ and a right-identity $e_R$, then $A$ has an identity $e$ and
\[ e= e_L = e_R. \]
\end{lemma}
\begin{proof}
Assume $A$ has a left- and a right-identity. Then $e_L = \omega_A(e_L, e_R) = e_R$.
\end{proof}
\begin{corollary}
A structure may have multiple left-identities or multiple right-identities, but if it has both, then the identity is unique.
\end{corollary}

\subsection{Properties of two binary operators}
\begin{definition}
Let $(\Omega, \alpha)$ be a signature, $A$ an $\Omega$-structure and $\omega, \chi$ binary operators. We say
\begin{itemize}
\item $\omega_A$ is \udef{left-distributive} over $\chi_A$ if
\[ \forall x,y,z\in A: \; \omega_A(x,\chi_A(y,z)) = \chi_A(\omega_A(x,y),\omega_A(x,z)); \]
\item $\omega_A$ is \udef{right-distributive} over $\chi_A$ if
\[ \forall x,y,z\in A: \; \omega_A(\chi_A(x,y), z) = \chi_A(\omega_A(x,z),\omega_A(y,z)); \]
\item $\omega_A$ is \udef{distributive} over $\chi_A$ if it is left- and right-distributive;
\item $\omega_A$ is \udef{self-distributive} if it is distributive over itself.
\end{itemize}
We say
\begin{itemize}
\item $\omega_A, \chi_A$ are linked by the \udef{absorption law} if
\[ \forall x,y\in A:\; \omega_A(x,\chi_A(x,y)) = x = \chi_A(x,\omega_A(x,y)) \]
\end{itemize}
\end{definition}

\begin{lemma} \label{lemma:absorptionIdempotency}
Let $(\Omega, \alpha)$ be a signature, $A$ an $\Omega$-structure and $\omega, \chi$ binary operators. If $\omega_A, \chi_A$ are linked by the absorption law, then they are both idempotent.
\end{lemma}
\begin{proof}
For all $x\in A$ we have $\omega_A(x,x) = \omega_A(x,\chi_A(x,\omega_A(x,x))) = x$.
\end{proof}

\subsection{Notation for binary operators}
Prefix, infix, postfix, Polish, necessity of brackets.