\url{file:///C:/Users/user/Downloads/0-8176-4442-3.pdf}
\url{https://link.springer.com/content/pdf/10.1007%2F978-0-387-84895-2.pdf}
\url{https://zr9558.files.wordpress.com/2014/08/a-guide-to-distribution-theory-and-fourier-transforms.pdf}
\url{file:///C:/Users/user/Downloads/978-0-8176-4675-2.pdf}


\chapter{Measure theory}
TODO (bounded) finitely additive signed measures form Riesz spaces.

\section{Measurable spaces and measurable functions}
\begin{definition}
Let $\Omega$ be a non-empty set and $\mathcal{A}$ a $\sigma$-algebra on $\Omega$.

The pair $(\Omega, \mathcal{A})$ is called a \udef{measurable space}.

The elements of $\mathcal{A}$ are called \udef{events}.
\end{definition}


\subsection{Properties of measure spaces}
\subsubsection{Separated measure spaces}
\begin{definition}
Let $\sSet{\Omega,\mathcal{A}}$ be a measurable space and $x,y\in \Omega$. Then $x,y$ are called \udef{separated} or \udef{distinguishable} if there exists $A\in \mathcal{A}$ such that $x\in A$ and $y\notin A$.

The measurable space $\sSet{\Omega,\mathcal{A}}$ is called \udef{separated} if all distinct $x,y\in \Omega$ are separated.
\end{definition}

\begin{lemma}
The relation that relates indistinguishable points is an equivalence relation.

This relation is the identity relation \textup{if and only if} the measurable space is separated.
\end{lemma}

\subsection{Measurable functions}
\begin{definition}
Let $(\Omega_1, \mathcal{A}_1)$ and $(\Omega_2, \mathcal{A}_2)$ be measurable spaces.

A function $f:\Omega_1 \to \Omega_2$ is called \udef{measurable} if
\[ \forall E\in\mathcal{A}_2: f^{\preimf}(E) \in\mathcal{A}_1. \]
We may also say $f$ is \udef{$\mathcal{A}_1/\mathcal{A}_2$-measurable} to emphasise which $\sigma$-algebras are being used.

We denote the set of $\mathcal{A}_1/\mathcal{A}_2$-measurable functions by $\meas(\mathcal{A}_1, \mathcal{A}_2)$, or by $\meas(\Omega_1, \Omega_2)$ if the $\sigma$-algebras are clear from context.
\end{definition}
Suppose we are moving around in $\Omega_1$ and tracking the output of the function in $\Omega_2$. We would like to be able to explore the contents of an event in $\Omega_2$ from within an event in $\Omega_1$.

\begin{lemma} \label{measurableFromGeneratingSet}
Let $(\Omega_1, \mathcal{A}_1)$ and $(\Omega_2, \mathcal{A}_2)$ be measurable spaces and $\mathcal{A}_2$ is generated by $\mathcal{S}$.

Then $f: \Omega_1\to \Omega_2$ is measurable \textup{if and only if} $\forall S\in\mathcal{S}: f^{-1}[S] \in \mathcal{A}_1$.
\end{lemma}

\begin{lemma} \label{constantFunctionsMeasurable}
Any constant function $\underline{a}: \sSet{\Omega_1,\mathcal{A}_1} \to \sSet{\Omega_2,\mathcal{A}_2}: x\mapsto a$ is measurable.
\end{lemma}
\begin{proof}
For any $A\in\mathcal{A}_2$ we have
\[ \underline{a}^{\preimf}(A) = \begin{cases}
\emptyset & (a\notin A) \\
\Omega_1 & (a\in A).
\end{cases} \]
In both cases $\underline{a}^{\preimf}(A)\in\mathcal{A}_1$.
\end{proof}

\begin{lemma} \label{measurabilityCodomainPartition}
Let $(\Omega_1, \mathcal{A}_1)$, $(\Omega_2, \mathcal{A}_2)$ be measurable spaces, $f: \Omega_1 \to \Omega_2$ a function and $B\in \mathcal{A}_2$.

Then $f$ is measurable \textup{if and only if} both $f|^B$ and $f|^{B^c}$ are measurable.
\end{lemma}
\begin{proof}
For the direction $\Rightarrow$, let $\iota_1: f^\preimf(B)\to \Omega_2$ and $\iota_2: f^\preimf(B)^c\to \Omega_2$ be the inclusion functions, which are measurable by definition of sub-measurable space. Then $f|^B = f\circ \iota_1$ and $f|^{B^c} = f\circ \iota_2$ are measurable.

For the other direction, take $A\in \mathcal{A}_2$. Then
\[ f^{\preimf}(A) = f^\preimf(A\cap B) \cup f^\preimf(A\cap B^c) = (f|^B)^\preimf(A\cap B) \cup (f|^{B^c})^\preimf(A\cap B^c) \in \mathcal{A}_1, \]
so $f$ is measurable.
\end{proof}

\subsubsection{$\sigma$-algebras generated by functions}
\begin{definition}
Let $\Omega_1$ be a set and $\sSet{\Omega_2, \mathcal{A}}$ a measurable space. Let $f: \Omega_1\to \Omega_2$ be a function. The \udef{pull-back $\sigma$-algebra} or the $\sigma$-algebra \udef{generated} by $f$ is
\[ \sigma(f) \defeq \setbuilder{f^{-1}[A]}{A\in \mathcal{A}}. \]
\end{definition}

The pull-back $\sigma$-algebra is a $\sigma$-algebra.

\begin{lemma}
Let $(\Omega_1, \mathcal{A}_1)$ and $(\Omega_2, \mathcal{A}_2)$ be measurable spaces and $f: \Omega_1\to \Omega_2$ a function. Then $f$ is $\mathcal{A}_1/\mathcal{A}_2$-measurable \textup{if and only if} $\sigma(f) \subseteq \mathcal{A}_1$.
\end{lemma}

\begin{lemma}
Let $\Omega_1$ be a set, $\sSet{\Omega_2, \mathcal{A}}$ a measurable space and $f: \Omega_1\to \Omega_2$ a function. Then $x,y\in \sSet{\Omega_1,\sigma(f)}$ are indistinguishable \textup{if and only if} $f(x), f(y) \in \sSet{\Omega_2,\mathcal{A}}$ are indistinguishable.
\end{lemma}
\begin{proof}
TODO For all $A\in\mathcal{A}$, we have $f(x)\in A \iff x\in f^{-1}[A]$ and $y\in f^{-1}[A]\iff f(y)\in A$. The indistinguishability of $x,y$ means the left-hand sides are equivalent. The indistinguishability of $f(x),f(y)$ means the right-hand sides are equivalent.
\end{proof}
\begin{corollary}
Let $\Omega_1$ be a set, $\sSet{\Omega_2, \mathcal{A}}$ a measurable space and $f: \Omega_1\to \Omega_2$ a function. Then
\begin{enumerate}
\item $\ker(f)$ is a subset of the indistinguishability relation of $\sigma(f)$;
\item if $\sSet{\Omega_2, \mathcal{A}}$ is separated, then $ker(f)$ equals the indistinguishability relation of $\sigma(f)$.
\end{enumerate}
\end{corollary}


\subsubsection{The Doob-Dynkin property}
\begin{definition}
A measurable set $\sSet{\Omega,\mathcal{A}}$ is said to have the \udef{Doob-Dynkin property} if for any set $\Omega_1$, measurable space $\sSet{\Omega_2,\mathcal{A}_2}$ and function $f: \Omega_1 \to \Omega_2$, a function $g: \Omega_1\to \Omega$ is $\sigma\{f\}/\mathcal{A}$-measurable \textup{if and only if} it factors through $f$, i.e.
\[\exists h\in \meas(\mathcal{A}_2\to \mathcal{A}):\quad g = h\circ f. \]
\end{definition}

\begin{example}
The measurable space $\sSet{\Omega, \mathcal{A}} = \sSet{\{0,1\}, \{\emptyset,\Omega\}}$ does not have the Doob-Dynkin property. 

Take, for example, any sets $\Omega_1, \Omega_2$ and equip $\Omega_2$ with the $\sigma$-algebra $\{\emptyset, \Omega_2\}$. Then for any function $f:\Omega_1 \to \Omega_2$, we have $\sigma(f) = \{\emptyset, \Omega_1\}$ and thus any function $g: \Omega_1 \to \Omega$ is measurable. Clearly it is not true that any function between arbitrary sets factors through any other function.
\end{example}


\begin{proposition}
A measurable set $\sSet{\Omega,\mathcal{A}}$ has the Doob-Dynkin property \textup{if and only if} $\mathcal{A}$ is
\begin{itemize}
\item separated; and
\item for any measurable space $\sSet{\Omega_1,\mathcal{A}_1}$, subset $D\subseteq \Omega_1$ and measurable function $f: \sSet{D,\mathcal{A}_1|_D} \to \sSet{\Omega,\mathcal{A}}$, $f$ can be extended to a measurable function on $\sSet{\Omega_1,\mathcal{A}_1}$.
\end{itemize}
\end{proposition}
\begin{proof}
TODO {functionsLeftRightRelations}

\url{http://www.numdam.org/article/SPS_1990__24__46_0.pdf}
\url{https://mathoverflow.net/questions/263863/does-the-doob-dynkin-lemma-hold-for-any-measurable-space-that-separates-points}

\url{https://math.stackexchange.com/questions/2193181/proof-of-doob-dynkin-lemma-when-x-isnt-assumed-surjective}
\end{proof}


\subsection{Borel $\sigma$-algebras}
\begin{definition}
Let $(X,\mathcal{T})$ be a topological space. The $\sigma$-algebra on $X$ generated by $\mathcal{T}$ is called the \udef{Borel $\sigma$-algebra} of $(X,\mathcal{T})$. The measurable space consisting of $X$ equipped with the Borel $\sigma$-algebra is called the \udef{Borel-measurable space}.
\end{definition}
Clearly the Borel $\sigma$-algebra is also generated by the closed sets.

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. If $\mathcal{T}$ has a countable basis $\mathcal{B}$, then the Borel $\sigma$-algebra is generated by the basis $\mathcal{B}$.
\end{lemma}

TODO:
\begin{align*}
\mu(B) &= \sup\setbuilder{\mu(C)}{C\subseteq B, \; \text{$C$ compact}} \\
&= \inf\setbuilder{\mu(O)}{B\subseteq O, \; \text{$O$ open}}.
\end{align*}
cfr compact open topology??

\begin{lemma}
Every continuous function between topological spaces is a measurable function between Borel-measurable spaces.
\end{lemma}

\begin{proposition} \label{pointWiseConvergenceMeasurable}
Let $(\Omega,\mathcal{A})$ be a measurable space and $\sSet{X,\xi}$ a $T_1$ and $C_2$ topological space. We equip $X$ with its Borel $\sigma$-algebra $\mathcal{B}$.

Suppose that a sequence of measurable functions $f_n : \Omega \to Y$ converges pointwise to a function $f:\Omega\to X$. Then $f$ is measurable.
\end{proposition}
\begin{proof}
Pick arbitrary $B\in \mathcal{B}$. By \ref{AnySetCountableIntersectionOfOpenSets} we can write $B = \bigcap_{k\in\N}O_k$ for some sequence $\seq{O_k}$ of open sets. Then we have, using the fact that $\sSet{X,\xi}$ is a sequntial space (TODO ref),
\begin{align*}
x\in f^{\preimf}[B] &\iff f(x)\in B \\
&\iff \forall k\in\N: f(x)\in O_k\\
&\iff \forall k\in\N: \exists n_0\in\N: \forall n\geq n_0: f_n(x)\in O_k \\
&\iff \forall k\in\N: \exists n_0\in\N: \forall n\geq n_0: x\in f^{\preimf}_n[O_k] \\
&\iff x\in \bigcap_{k\in\N}\bigcup_{n_0\in\N}\bigcap_{n\geq n_0}f^{\preimf}_n[O_k].
\end{align*}
So $f^{\preimf}[B] = \bigcap_{k\in\N}\bigcup_{n_0\in\N}\bigcap_{n\geq n_0}f^{\preimf}_n[O_k]$, which is an element of $\mathcal{A}$ because all $f^{\preimf}_n[O_k]$ are in $\mathcal{A}$.
\end{proof}

\url{https://math.stackexchange.com/questions/1343860/limit-of-measurable-functions-is-measurable}


\subsubsection{Measurable real-valued functions}
Unless stated otherwise we always consider the real numbers equipped with the Borel $\sigma$-algebra.

\begin{proposition}[Doob-Dynkin lemma]
TODO: $[0,1]$ and $[-\infty,\infty]$ have the Doob-Dynkin property.
\end{proposition}

\begin{proposition}
Let $\mathcal{B}$ be the Borel $\sigma$-algebra on $\overline{\R}$. Then the following equalities hold for any $b\in\overline{\R}$:
\begin{align*}
\mathcal{B} &= \sigma\setbuilder{\interval[c]{a,b}}{a\in \overline{\R}}\\
&= \sigma\setbuilder{\interval[o]{a,b}}{a\in \overline{\R}} \\
&= \sigma\setbuilder{\interval[oc]{a,b}}{a\in \overline{\R}} \\
&= \sigma\setbuilder{\interval[co]{a,b}}{a\in \overline{\R}}.
\end{align*}
\end{proposition}
\begin{proof}
TODO
\end{proof}
\begin{corollary} \label{measurablesSetsRealMeasurableFunction}
Let $\sSet{\Omega, \mathcal{A}}$ be a measurable space and $f: \Omega \to \overline{\R}$ a function. Then the following are equivalent:
\begin{enumerate}
\item $f$ is measurable;
\item $\setbuilder{\{f\geq a\}\big.}{a\in\R} \subseteq \mathcal{A}$;
\item $\setbuilder{\{f > a\}\big.}{a\in\R} \subseteq \mathcal{A}$;
\item $\setbuilder{\{f \leq a\}\big.}{a\in\R} \subseteq \mathcal{A}$;
\item $\setbuilder{\{f < a\}\big.}{a\in\R} \subseteq \mathcal{A}$.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{measurablesSetsTwoRealMeasurableFunctions}
Let $\sSet{\Omega, \mathcal{A}}$ be a measurable space and $f,g: \Omega \to \overline{\R}$ measurable functions. Then
\begin{enumerate}
\item $\{f < g\} \in \mathcal{A}$;
\item $\{f \leq g\} \in \mathcal{A}$;
\item $\{f = g\} \in \mathcal{A}$;
\item $\{f \neq g\} \in \mathcal{A}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) This follows from \ref{measurablesSetsRealMeasurableFunction} and
\[ \{f < g \} = \bigcup_{r\in\Q}\{f<r\}\cap \{r < g\}. \]

(2) Complement of (1).

(3) From $\{f = g\} = \{f \leq g\}\cap \{g \leq f\}$.

(4) Complement of (3).
\end{proof}

\begin{proposition} \label{operationsOnRealMeasurableFunctions}
Let $\sSet{\Omega, \mathcal{A}}$ be a measurable space and $f,g: \Omega \to \overline{\R}$ measurable functions and $a,b\in \overline{\R}$. Then
\begin{enumerate}
\item $f+g$ is measurable;
\item $f\cdot g$ is measurable.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) For all $a\in\R$, we have $\{f + g \geq a\} = \{f \geq a - g\}$. The right-hand side is in $\mathcal{A}$ for all $a\in R$ by \ref{measurablesSetsTwoRealMeasurableFunctions}. The inclusion of the left-hand side in $\mathcal{A}$ proves the measurability of $f+g$ by \ref{measurablesSetsRealMeasurableFunction}.

(2) We use \ref{measurabilityCodomainPartition} to show measurability by partitioning the codomain of $f\cdot g$ into $\{-\infty, 0, +\infty\}$ and $\R\setminus\{0\}$.
For the former restriction, we have
\begin{align*}
(f\cdot g)^\preimf(\{+\infty\}) = \big(\{f = +\infty\}\cap \{g > 0\}\big) &\cup \big(\{f > 0\} \cap \{g = +\infty\}\big) \\ &\cup \big(\{f = -\infty\}\cap \{g < 0\}\big) \\ &\cup \big(\{f < 0\} \cap \{g = -\infty\}\big),
\end{align*}
so $(f\cdot g)^\preimf(\{+\infty\})\in\mathcal{A}$. Similarly $(f\cdot g)^\preimf(\{-\infty\})\in\mathcal{A}$ and $(f\cdot g)^\preimf(\{0\})\in\mathcal{A}$.

Now consider the latter restriction. We can write $(f\cdot g)|^{\R\setminus\{0\}}$ as $f'\cdot g'$, where $f'$ and $g'$ take only finite and non-zero values.

From point (1) and the equality
\[ f'\cdot g' = \frac{1}{4}(f'+g')^2 - \frac{1}{4}(f'-g')^2, \]
the measurability of $f'\times g'$ follows if we can show the measurability of $h^2$ and $-h$, given a measurable $h:\Omega \to \R$.

To show measurability of $h^2$, take arbitrary $a\in\R$. Then
\[ \{h^2 \geq a\} = \begin{cases}
\Omega & (a < 0) \\
\{h \geq \sqrt{a}\} \cup \{h \leq -\sqrt{a}\} & (a \geq 0)
\end{cases}, \]
so $\{h^2 \geq a\} \in \mathcal{A}$ and $h^2$ is measurable by \ref{measurablesSetsRealMeasurableFunction}.

To show measurability of $-h$, take arbitrary $a\in\R$. Then
\[ \{ -g \geq a \} = \{g \leq -a\} \in \mathcal{A}, \]
so $-g$ is measurable by \ref{measurablesSetsRealMeasurableFunction}.
\end{proof}
\begin{corollary}
The function $af+bg$ is measurable for all $a,b\in\overline{\R}$.
\end{corollary}
\begin{proof}
Constant functions are always measurable, by \ref{constantFunctionsMeasurable}, and $af + bg = \underline{a}f + \underline{b}g$, which is measurable by the proposition.
\end{proof}

\begin{proposition} \label{limitOperationsOnRealMeasurableFunctions}
Let $\sSet{\Omega, \mathcal{A}}$ be a measurable space and $\seq{f_n: \Omega \to \overline{\R}}_{n\in\N}$ a sequence measurable functions. Then
\begin{enumerate}
\item $\inf_{n\in\N}f_n$ is measurable;
\item $\sup_{n\in\N}f_n$ is measurable;
\item $\liminf_{n\in\N}f_n$ is measurable;
\item $\limsup_{n\in\N}f_n$ is measurable.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Take arbitrary $a\in\R$. Then
\[ \{\inf_{n\in\N}f_n \geq a\} = \bigcap_{n\in\N}\{f_n \geq a\}, \]
so $\{\inf_{n\in\N}f_n \geq a\} \in \mathcal{A}$ and thus $\inf_{n\in\N}f_n$ is measurable by \ref{measurablesSetsRealMeasurableFunction}.

(2) We have $\sup_{n\in\N}f_n = -\inf_{n\in\N}(-f_n)$, so the result follows from \ref{operationsOnRealMeasurableFunctions} and point (1).

(3) We have $\liminf_{n\in\N}f_n = \sup_{n\in\N} \inf_{m\geq n}f_m$.

(4) We have $\limsup_{n\in\N}f_n = \inf_{n\in\N} \sup_{m\geq n}f_m$.
\end{proof}
\begin{corollary} \label{pointwiseLimitMeasurable}
If $\seq{f_n}\to f$ pointwise, then $f$ is measurable.
\end{corollary}
\begin{proof}
We have $\lim_{n\in\N}f_n = \limsup_{n\in\N}f_n$.
\end{proof}
This corollary is a special case of \ref{pointWiseConvergenceMeasurable}.
\begin{corollary} \label{infiniteSumMeasurable}
Let $\sSet{\Omega, \mathcal{A}}$ be a measurable space and $\seq{f_n: \Omega \to \overline{\R}}_{n\in\N}$ a sequence measurable functions such that $\sum_{n\in\N}f_n$ converges everywhere. Then $\sum_{n\in\N}f_n$ is measurable.
\end{corollary}

\subsubsection{Measurable complex-valued functions}

\begin{lemma} \label{modulusMeasurable}
We have $|\cdot| \in \meas(\C,\R)$.
\end{lemma}

\begin{proposition}
Let $\sSet{\Omega,\mathcal{A}}$ be a measurable space and $f: \Omega \to \C$. Then $f$ is measurable \textup{if and only if} both $\Re\circ f$ and $\Im\circ f$ are measurable.
\end{proposition}
\begin{proof}
TODO
\end{proof}


\begin{proposition}
Let $\sSet{\Omega,\mathcal{A}}$ be a measurable space. Then $\meas(\Omega, \C)$ is a complex vector space.
\end{proposition}
\begin{proof}
TODO. Cfr. \ref{operationsOnRealMeasurableFunctions}.
\end{proof}


\section{Measures and generalisations}
\subsection{Contents}
\begin{definition}
Let $\mathcal{S}$ be a semi-ring on a set $\Omega$ and $\sSet{M,+,0}$ a commutative monoid. An $M$-valued \udef{content} on $\mathcal{S}$ is a map $\mu: \mathcal{S} \to M$ satisfying
\begin{itemize}
\item $\mu(\emptyset) = 0$;
\item $\mu$ is \udef{(finitely) additive}: let $\seq{A_n}_{n=0}^k\in \mathcal{S}^*$ be a string of pairwise disjoint sets such that $A_0 \uplus \ldots \uplus A_{k} \in \mathcal{S}$, then
\[ \mu(A_0 \uplus \ldots \uplus A_{k}) = \mu(A_0) + \ldots + \mu(A_{k}). \]
\end{itemize}
If $M = \overline{\R^+}$, then we call the content \udef{positive}. A positive measure is called \udef{finite} if $\im(\mu) \subseteq \R^+$.
\end{definition}
Note that $\emptyset\in \mathcal{S}$ by \ref{emptysetElementSemiring}.

\begin{lemma} \label{ringContentAdditivityFromBinaryAdditivity}
If $\mathcal{S}$ is a ring and $\mu$ a content on $\mathcal{S}$, then finite additivity is implied by binary additivity,
\[ \forall A\perp B\in \mathcal{S}:\qquad \mu(A\uplus B) = \mu(A) + \mu(B). \]
\end{lemma}

\begin{example}
For semirings finite additivity is not implied by binary additivity. Take the semiring
\[ \mathcal{S} = \big\{\emptyset,\; \{1\},\; \{2\},\; \{3\},\; \{1,2,3\}\big\} \]
and consider the content
\[ \mu(\emptyset) = 0,\quad \mu\{1\} = 1, \quad \mu\{2\} = 1, \quad \mu\{3\} = 1, \quad \mu\{1,2,3\} = 0. \]
This satisfies binary additivity, but not finite additivity.
\end{example}

\begin{lemma} \label{contentsOnSemiRingToRing}
Let $\mathcal{S}$ be a semi-ring on $\Omega$. Every content $\mu_\mathcal{S}$ on $\mathcal{S}$ extends uniquely to a content $\mu$ on $\mathfrak{R}\{\mathcal{S}\}$, the ring generated by $\mathcal{S}$.
\end{lemma}
\begin{proof}
The extension of $\mathcal{S}$ to $\mathfrak{R}\{\mathcal{S}\}$ is exactly the closure under finite (pairwise) disjoint unions, see \ref{ringFromSemiRing}. We extend $\mu$ to this closure by defining
\[ \mu(A_0\uplus \ldots \uplus A_n) = \mu_\mathcal{S}(A_0) + \ldots + \mu_\mathcal{S}(A_n) \]
for all disjoint $A_0, \ldots, A_n\in \mathcal{S}$. 

Clearly every content $\mu$ on $\mathfrak{R}\{\mathcal{S}\}$ that extends $\mu_\mathcal{S}$ must satsify this equality, so the extension is unique, if it exists.

We need to show that $\mu$ is well-defined and is finitely additive.

To show that $\mu$ is well-defined, take $A_0\uplus \ldots \uplus A_n = A_0'\uplus \ldots \uplus A_m' = A \in \mathfrak{R}\{\mathcal{S}\}$. Now define $A_{i,j} \defeq A_{i} \cap A_j' \in \mathcal{S}$. All $A_{i,j}$ are pairwise disjoint. We have
\begin{align*}
\mu(A_0\uplus \ldots \uplus A_n) &= \sum_{i=0}^n\mu_\mathcal{S}(A_i) \\
&= \sum_{i=0}^n\mu_\mathcal{S}\Big(\biguplus_{j=0}^m A_{i,j}\Big) \\
&= \sum_{i=0}^n \sum_{j=0}^m\mu_\mathcal{S}(A_{i,j}) \\
&= \sum_{j=0}^m\sum_{i=0}^n\mu_\mathcal{S}(A_{i,j}) \\
&= \sum_{j=0}^m\mu_\mathcal{S}\Big(\biguplus_{i=0}^n A_{i,j}\Big) \\
&= \sum_{j=0}^m\mu_\mathcal{S}(A_j') \\
&= \mu(A'_0\uplus \ldots \uplus A'_m).
\end{align*}

For finite additivity, it is enough to verify binary additivity, \ref{ringContentAdditivityFromBinaryAdditivity}. Take $A, B \in \mathfrak{R}\{\mathcal{S}\}$. Then we can write $A = A_0\uplus \ldots \uplus A_n$ and $B = B_0\uplus \ldots \uplus B_m$ for some $A_0,\ldots, A_n, B_0, \ldots, B_m \in \mathcal{S}$. We have
\begin{align*}
\mu(A\uplus B) &= \mu(A_0 \uplus \ldots \uplus A_n \uplus B_0 \uplus \ldots \uplus B_m) \\
&= \mu_\mathcal{S}(A_0) + \ldots + \mu_\mathcal{S}(A_n) + \mu_\mathcal{S}(B_0) + \ldots + \mu_\mathcal{S}(B_m) \\
&= \mu(A_0 \uplus \ldots \uplus A_n) + \mu(B_0 \uplus \ldots \uplus B_m) = \mu(A) + \mu(B). 
\end{align*}
\end{proof}

\begin{lemma} \label{emptysetNullset}
If there exists an $A\in \mathcal{S}$ such that $\mu(A)$ is cancellative, then the requirement $\mu(\emptyset) = 0$ is redundant.
\end{lemma}
\begin{proof}
We calculate $\mu(A) = \mu(A \uplus \emptyset) = \mu(A) + \mu(\emptyset)$, so $\mu(\emptyset) = 0$.
\end{proof}
For positive contents this requirement is $\mu(A) < \infty$.

\begin{proposition} \label{semiringPositiveContent}
Let $\mathcal{S}$ be a semi-ring on a set $\Omega$, $\mu$ a positive content and $A,B\in \mathcal{S}$. Then
\begin{enumerate}
\item $A\subseteq B$ implies $\mu(A) \leq \mu(B)$;
\item $A\cup B\in\mathcal{S}$ implies $\mu(A \cup B) \leq \mu(A) + \mu(B)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Because $\mathcal{S}$ is a semi-ring, we can write $B = A \uplus (B\setminus A) = A \uplus (C_0 \uplus \ldots \uplus C_k)$ for some $C_0,\ldots, C_k\in\mathcal{S}$. By finite additivity, we have
\[ \mu(B) = \mu(A) + \mu(C_0) + \ldots + \mu(C_k). \]
As $\mu(C_0) + \ldots + \mu(C_k)$ is positive, we have $\mu(A) \leq \mu(B)$.

(2) We can write $A\cup B = (A\setminus B) \uplus (A\cap B) \uplus (B\setminus A)$. Because $\mathcal{S}$ is a semi-ring, we can write $A\setminus B = C_0 \uplus \ldots \uplus C_k$ and $B\setminus A = D_0 \uplus \ldots \uplus D_l$ for some $C_0,\ldots, C_k, D_0,\ldots, D_l\in\mathcal{S}$. By finite additivity, we have
\begin{align*}
\mu(A\cup B) &= & \hspace{-5em} \mu(C_0) + \ldots + \mu(C_k) + &\mu(A\cap B) + \mu(D_0) + \ldots + \mu(D_l) \\
\mu(A) &= & \hspace{-5em} \mu(C_0) + \ldots + \mu(C_k) + &\mu(A\cap B) \\
\mu(B) &= & &\mu(A\cap B) + \mu(D_0) + \ldots + \mu(D_l).
\end{align*}
Thus
\[ \mu(A)+\mu(B) = \mu(C_0) + \ldots + \mu(C_k) + 2\mu(A\cap B) + \mu(D_0) + \ldots + \mu(D_l). \]
As $\mu(A\cap B)$ is positive, we have $\mu(A\cup B) \leq \mu(A)+\mu(B)$.
\end{proof}

\begin{proposition} \label{ringPositiveContent}
Let $\mathcal{S}$ be a \emph{ring} on a set $\Omega$, $\mu$ a positive content and $A,B\in \mathcal{S}$. Then
\begin{enumerate}
\item $A\subseteq B$ and $\mu(A)<\infty$ implies $\mu(B\setminus A) = \mu(B) - \mu(A)$;
\item $\mu(A \cup B) + \mu(A\cap B) = \mu(A) + \mu(B)$;
\item let $\{A_n\}_{i\in I}$ be a set of pairwise disjoint sets in $\mathcal{S}$ such that $\biguplus_{i\in I}A_i \in \mathcal{S}$, then
\[ \mu\Big(\biguplus_{i\in I}A_n\Big) \geq \sum_{i\in I}\mu(A_n). \]
\end{enumerate}
\end{proposition}
\begin{proof}
(1) As $\mathcal{S}$ is a ring, we have $B\setminus A\in\mathcal{S}$. The result follows from rearranging $\mu(B) = \mu\big((B\setminus A) \uplus A\big) = \mu(B\setminus A) + \mu(A)$.

(2) We calculate
\begin{align*}
\mu(A \cup B) + \mu(A\cap B) &= \mu\big((A\setminus B)\uplus (A\cap B) \uplus (B\setminus A)\big) + \mu(A\cap B) \\
&= \mu(A\setminus B) + \mu(A\cap B) + \mu(B\setminus A) + \mu(A\cap B) \\
&= \mu\big((A\setminus B) \uplus (A\cap B)\big) + \mu\big((B\setminus A) \uplus \mu(A\cap B)\big) \\
&= \mu(A) + \mu(B).
\end{align*}

(3) We have
\[ \biguplus_{i\in I} A_i = \bigcup_{\substack{F\subseteq I \\ \text{finite}}}\biguplus_{i\in F}A_i. \]
Because the content is monotone (by \ref{semiringPositiveContent}), we have
\[ \sum_{i\in I}\mu(A_i) = \sup_{\substack{F\subseteq I \\ \text{finite}}}\sum_{i\in F}\mu(A_i) = \sup_{\substack{F\subseteq I \\ \text{finite}}}\mu\Big(\biguplus_{i\in F}A_i\Big) \leq \mu\Big(\bigcup_{\substack{F\subseteq I \\ \text{finite}}}\biguplus_{i\in F}A_i\Big) = \mu\Big(\biguplus_{i\in I} A_i\Big), \]
by \ref{orderPreservingFunctionLatticeOperations}.
\end{proof}

\subsubsection{Null sets}
\begin{definition}
Let $\mathcal{S}$ be a semi-ring on a set $\Omega$ and $\mu$ a positive content. A set $A\subseteq \Omega$ is called a \udef{null set} if there exists $B\in \mathcal{S}$ such that $A\subseteq B$ and $\mu(B) = 0$.

The content is called \udef{complete} if all null sets are elements of $\mathcal{S}$.
\end{definition}
If $A\in\mathcal{S}$ is a null set, then $\mu(A) \leq \mu(B) = 0$, so $\mu(A) = 0$.

\begin{lemma} \label{measureNullSet}
Let $\mu$ be a positive content on a semi-ring $\mathcal{S}$. If $A\in \mathcal{S}$ is a null set, then $\mu(A) = 0$.
\end{lemma}
\begin{proof}
By definition there exists $B\in\mathcal{S}$ such that $A\subseteq B$ and $\mu(B) = 0$. By monotonicity $0 = \mu(B)\geq \mu(A) \geq 0$, so $\mu(A) = 0$.
\end{proof}

\begin{definition}
Let $\mu$ be a positive content on a semi-ring with universe $\Omega$.

A proposition $P(x)$ referencing some $x\in\Omega$ is said to be true \udef{almost everywhere} (or a.e.) if $\setbuilder{x\in\Omega}{\text{$P(x)$ is false}}$ is a null set.
\end{definition}

\subsection{Pre-measures}
\begin{definition}
A \udef{pre-measure} is a content $\mu:\mathcal{S} \to M$ that is \udef{countably additive} or \udef{$\sigma$-additive}: let $\seq{A_n}$ be a sequence of pair-wise disjoint sets in $\mathcal{S}$ such that $\biguplus_{n\in \N}A_n \in \mathcal{S}$, then
\[ \mu\left(\biguplus_{n\in\N}A_n\right) = \sum_{n\in\N}\mu(A_n). \]
\end{definition}

\begin{example}
\begin{itemize}
\item For any non-empty set $\Omega$ define
\[ \mu: \powerset(\Omega)\to [0,\infty]: E\mapsto \begin{cases}
\#(E) & \text{($E$ is finite)} \\
\infty & \text{($E$ is infinite)}
\end{cases}. \]
Then $(\Omega, \powerset(\Omega),\mu)$ is a measure space and $\mu$ is called the \udef{counting measure}.
\item Let $(\Omega,\mathcal{A})$ be a measurable space and $x\in\Omega$ and define
\[ \delta_x: \mathcal{A}\to [0,\infty]: E\mapsto \begin{cases}
1 & (x\in E) \\ 0 & (x\notin E)
\end{cases}. \]
Then $(\Omega,\mathcal{A},\delta_x)$ is a measure space and $\delta_x$ is called a \udef{Dirac measure}.
\end{itemize}
\end{example}

\begin{lemma} \label{countingMeasureCriterion}
Let $\Omega$ be a set. A measure on $\powerset(\Omega)$ is the counting measure \textup{if and only if} $\mu(\{\omega\}) = 1$ for all $\omega\in\Omega$.
\end{lemma}
\begin{proof}
For any finite $A\subseteq \Omega$ we have $A = \biguplus_{a\in A}\{a\}$ and thus $\mu(A) = \#(A)$ be $\sigma$-additivity.

If $A\subseteq \Omega$ is infinite, take $k\in \N$. We can find a subset $B\subseteq A$ of cardinality $k$ and thus we can write $\mu(A) = \mu(B) + \mu(A\setminus B) \geq \mu(B) = k$. Thus $\mu(A) \geq k$ for all $k\in \N$, meaning $\mu(A)$ is infinite.
\end{proof}

\begin{proposition} \label{premeasureSubadditive}
Let $\mathcal{S}$ be a semi-ring and $\mu: \mathcal{S} \to \overline{\R^+}$ a pre-measure. Then for any sequence $\seq{A_n}_{n\in \N}$ of sets in $\mathcal{S}$ such that $\bigcup_{n\in\N}A_n \in \mathcal{S}$, we have
\[ \mu\Big(\bigcup_{n\in\N}A_n\Big) \leq \sum_{n\in\N}\mu(A_n). \]
\end{proposition}
\begin{proof}
Take a sequence $\seq{A_n}$ in $\mathcal{S}$ such that $\bigcup_{n\in\N}A_n\in\mathcal{S}$ and define
\[ A_n' \defeq A_n \setminus\bigg(\bigcup_{k=0}^{n-1}E_k\bigg), \]
which is a finite disjoint union of sets in $\mathcal{S}$. Consider the sequence $\seq{A^{\prime\prime}_n}_{n\in\N}$ which contains the disjoint components of each $A'_n$ in order. This is a disjoint sequence in $\mathcal{S}$ and $\bigcup_{n\in \N}A_n = \biguplus_{n\in \N}A_n^{\prime\prime}$.
Then
\[ \mu\Big(\bigcup_{n\in\N}A_n\Big) \;=\; \mu\Big(\biguplus_{n\in\N}A_n^{\prime\prime}\Big) \;=\; \sum_{n\in\N}\mu(A_n^{\prime\prime}) \;\leq\; \sum_{n\in\N}\mu(A_n). \]
The last inequality follows from \ref{semiringPositiveContent}.
\end{proof}

\begin{lemma} \label{premeasureSubadditivityEquivalences}
Let $\mathcal{S}$ be a ring and $\mu: \mathcal{S} \to \overline{\R^+}$ a content. Then the following are equivalent:
\begin{enumerate}
\item $\mu$ is a pre-measure;
\item for any sequence $\seq{A_n}_{n\in \N}$ of disjoint sets in $\mathcal{S}$ such that $\biguplus_{n\in\N}A_n \in \mathcal{S}$, we have
\[ \mu\Big(\biguplus_{n\in\N}A_n\Big) \leq \sum_{n\in\N}\mu(A_n); \]
\item for any sequence $\seq{A_n}_{n\in \N}$ of sets in $\mathcal{S}$ such that $\bigcup_{n\in\N}A_n \in \mathcal{S}$, we have
\[ \mu\Big(\bigcup_{n\in\N}A_n\Big) \leq \sum_{n\in\N}\mu(A_n). \]
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Leftrightarrow (2)$ Immediate from \ref{ringPositiveContent}.

$(2) \Leftrightarrow (3)$ The direction $\Leftarrow$ is immediate. The other direction follows from \ref{premeasureSubadditive}.
\end{proof}

\begin{proposition} \label{premeasureChainContinuous}
Let $\mathcal{S}$ be a ring and $\mu$ a positive content. The following are equivalent:
\begin{enumerate}
\item $\mu$ is a pre-measure;
\item $\mu$ is $\sigma$-chain-continuous;
\end{enumerate}
and imply
\begin{enumerate} \setcounter{enumi}{2}
\item $\lim_{n\to\infty}\mu(A_n) = \mu(A)$ for all monotonically decreasing sequences $\seq{A_n}_{n\in\N}$ of sets in $\mathcal{S}$ such that $A = \bigcap_{n\in\N} A_n \in\mathcal{A}$ and $\mu(A_0) < \infty$.
\end{enumerate}
If $\mu$ is finite, then all statements are equivalent.
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Let $\{A_n\}_{n\in\N}$ be a countable chain. Then $\{B_n\}_{n\in \N}$, where $B_n \defeq A_{n}\setminus A_{n-1}$ (and $B_0 = A_0$) is a pairwise disjoint sequence. Also $\bigcup_{n\in \N}A_n = \biguplus_{n\in \N} B_n$ and $A_n = \biguplus_{k=0}^n B_k$. Then
\begin{multline*}
\mu\Big(\bigcup_{n\in \N}A_n\Big) = \mu\Big(\biguplus_{n\in \N} B_n\Big) = \sum_{n\in\N}\mu(B_n) = \lim_{n\to\infty}\sum_{k=0}^n\mu(B_k) \\ = \lim_{n\to\infty}\mu\Big(\biguplus_{k=0}^n B_k\Big) = \lim_{n\to\infty}\mu(A_n) = \sup_{n\in\N}\mu(A_n).
\end{multline*}

$(1) \Leftarrow (2)$ Let $\{B_n\}_{n\in\N}$ be a countable pairwise disjoint set of subsets. Set $A_n = \biguplus_{k=0}^nB_k$. Then $\{A_n\}_{n\in\N}$ is a countable chain, $\biguplus_{n\in \N} B_n = \bigcup_{n\in \N}A_n$, so
\begin{multline*}
\mu\Big(\biguplus_{n\in\N}B_n\Big) = \mu\Big(\bigcup_{n\in\N}A_n\Big) = \sup_{n\in\N}\mu(A_n) = \lim_{n\in\N}\mu(A_n) \\ = \lim_{n\in\N}\mu(\biguplus_{k=0}^nB_n) = \lim_{n\to\infty}\sum_{k=0}^n\mu(B_n) = \sum_{n\in\N}\mu(B_n).
\end{multline*}

$(2) \Rightarrow (3)$ Let $\{C_n\}_{n\in\N}$ be a monotonically decreasing sequence with $\mu(C_0) < \infty$. Then $D_n \defeq C_0\setminus C_n$ is an increasing sequence. The result follows by \ref{ringPositiveContent} and continuity of the subtraction.

The equivalence in the case that $\mu$ is finite is also clear.
\end{proof}

\begin{example}
Let $\mu$ be a content on the finite-cofinite algebra of $\N$ such that
\[ \mu(A) = \begin{cases}
0 & (\text{$A$ is finite}) \\ \infty & (\text{$A$ is cofinite})
\end{cases}. \]
This is clearly not a premeasure, but does satisfy point (3) of the proposition.
\end{example}

\subsection{Measures}
\begin{definition}
A \udef{measure} is a pre-measure that is defined on a $\sigma$-algebra.

If $\mu$ is a measure on a $\sigma$-algebra $\mathcal{A}$with universe $\Omega$, then we call $\sSet{\Omega, \mathcal{A}, \mu}$ a \udef{measure space}. The measure space is called
\begin{itemize}
\item \udef{finite} if $\mu(\Omega) < \infty$;
\item \udef{$\sigma$-finite} if there exists a sequence $\seq{A_n}\in \mathcal{A}^\N$ such that $\Omega = \bigcup_{n\in\N}A_n$ and $\mu(A_n)<\infty$ for all $n\in\N$;
\item \udef{semi-finite} if for all $A\in \mathcal{A}$ such that $\mu(A) \neq 0$, there exists $B\in \mathcal{A}$ such that $B\subseteq A$ and $0< \mu(B) \subseteq \infty$.
\end{itemize}
\end{definition}

\begin{lemma} \label{sigmaFiniteSequences}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space. Then the following are equivalent:
\begin{enumerate}
\item $\mu$ is $\sigma$-finite;
\item there exists a monotone sequence $\seq{B_n}_{n\in \N}\in\mathcal{A}^\N$ such that $\bigcup_{n\in\N}B_n = \Omega$ and $\mu(B_n) < \infty$ for all $n\in\N$;
\item there exists a disjoint sequence $\seq{C_n}_{n\in \N}\in\mathcal{A}^\N$ such that $\biguplus_{n\in\N}C_n = \Omega$ and $\mu(C_n) < \infty$ for all $n\in\N$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ By $\sigma$-finiteness, there exists a sequence $\seq{A_n}\in \mathcal{A}^\N$ such that $\Omega = \bigcup_{n\in\N}A_n$ and $\mu(A_n)<\infty$ for all $n\in\N$.

We set $B_n \defeq \bigcup_{k\leq n} A_k$, which is a sequence in $\mathcal{A}$ that satisfies the requirements.

$(2) \Rightarrow (3)$ We set $C_n \defeq B_n\setminus B_{n-1}$, (with $C_0 = B_0$). This is a sequence in $\mathcal{A}$ that satisfies the requirements.

$(3) \Rightarrow (1)$ Immediate.
\end{proof}

\begin{lemma}
Every $\sigma$-finite measure is semi-finite.
\end{lemma}
\begin{proof}
Let $\mu$ be a $\sigma$-finite measure on a measurable space $\sSet{\Omega,\mathcal{A}}$. Let $A\in\mathcal{A}$ be such that $\mu(A) \neq 0$. We need to find a $B\in \mathcal{A}$ such that $B\subseteq A$ and $0<\mu(B)<\infty$.

By \ref{sigmaFiniteSequences}, there exists a disjoint sequence $\seq{C_n}_{n\in \N}\in\mathcal{A}^\N$ such that $\biguplus_{n\in\N}C_n = \Omega$ and $\mu(C_n) < \infty$ for all $n\in\N$. Then $A = A\cap \biguplus_{n\in\N}C_n = \biguplus_{n\in \N}A\cap C_n$. Since
\[ 0\neq \mu(A) = \mu\Big(\biguplus_{n\in \N}A\cap C_n\Big) = \sum_{n\in\N}\mu(A\cap C_n), \]
and $\mu(A\cap C_n) \geq 0$ for all $n\in \N$, there must exist some $k\in \N$ such that $0< \mu(A\cap C_k)$. We also have $\mu(A\cap C_k) \subseteq \mu(C_k) < \infty$. Thus we can take $B = A\cap C_k$. 
\end{proof}

\begin{lemma}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a semi-finite measure space and $A\in\mathcal{A}$ such that $\mu(A) = \infty$. Then
\begin{enumerate}
\item $\sup\setbuilder{\mu(B)}{B\in \mathcal{A}, B\subseteq A, \mu(B)<\infty} = \infty$;
\item for all $C\geq 0$ there exists $B\in \mathcal{A}$ such that $B\subseteq A$ and $\mu(B) \geq C$.
\end{enumerate} 
\end{lemma}
\begin{proof}
(1) Set $\mathcal{B} \defeq \setbuilder{B\in \mathcal{A}}{B\subseteq A, \mu(B)<\infty}$ and $s \defeq \sup\setbuilder{\mu(B)}{B\in \mathcal{B}}$. Then there exists a sequence $\seq{B_n}$ in $\mathcal{B}$ such that $\mu(B_n) \to s$. Now $\seq{\bigcup_{k=0}^n B_k}$ is a monotonically increasing sequence in $\mathcal{B}$ and
\[ s = \lim_n \mu(B_n) \leq \lim_n \mu\Big(\bigcup_{k=0}^n B_k\Big) \leq s. \]
Now suppose, towards a contradiction, that $s < \infty$. Then
\[ \mu\Big(\bigcup_{k=0}^\infty B_k\Big) = \lim_n \mu\Big(\bigcup_{k=0}^n B_k\Big) = s <\infty, \]
so $\bigcup_{k=0}^\infty B_k\in \mathcal{B}$. Since
\[ \infty = \mu(A) = \mu\bigg(\Big(\bigcup_{k=0}^\infty B_k\Big)\uplus \Big(A\setminus \bigcup_{k=0}^\infty B_k\Big)\bigg) = s + \mu\Big(A\setminus\bigcup_{k=0}^\infty B_k\Big), \]
we need to have that $\mu\Big(A\setminus\bigcup_{k=0}^\infty B_k\Big) = \infty$. Then we can find $C \subseteq A\setminus\bigcup_{k=0}^\infty B_k$ such that $C\in\mathcal{A}$ and $0<\mu(C)\subseteq \infty$. Thus $C\uplus \bigcup_{k=0}^\infty B_k \in \mathcal{B}$ and
\[ \mu\Big(C\uplus \bigcup_{k=0}^\infty B_k\Big) = \mu(C) + \mu\Big(\bigcup_{k=0}^\infty B_k\Big) = \mu(C) + s > s, \]
which is a contradiction.

(2) Immediate from (1).
\end{proof}


\subsubsection{Restrictions of measures}
\begin{lemma} \label{submeasurespace}
Let $\sSet{\Omega,\mathcal{A},\mu}$ be a measure space and let $E\in\mathcal{A}$ be an event. Then $\mathcal{A}' = \powerset(E)\cap\mathcal{A}$ is a $\sigma$-algebra on $E$ and $\sSet{E,\mathcal{A}',\mu|_{\mathcal{A}'}}$ is a measure space.
\end{lemma}
We will often write $\mu|_E$ to mean $\mu|_{\mathcal{A}'}$.
\begin{proof}
First we show that $\mathcal{A}'$ is a $\sigma$-algebra on $E$, using \ref{setAlgebraCriteria}.
\begin{itemize}
\item Clearly $E\in \mathcal{A}$ and $E\in\powerset(E)$, so $E\in\mathcal{A}\cap \powerset(E) = \mathcal{A}'$.
\item Complements are taken w.r.t. $E$. Take $A\in \mathcal{A}'$. Then $E\setminus A$ is a subset of $E$ and thus in $\powerset(E)$. Also $E\setminus A\in \mathcal{A}$, because it is a measure-theoretic ring (see \ref{setAlgebraCoincidence}). Thus $A^c = E\setminus A \in \mathcal{A}\cap \powerset(E) = \mathcal{A}'$.
\item Let $\seq{A_n}_{n\in \N}$ be a sequence of sets in $\mathcal{A}'$. Then $\bigcup_{n\in \N}A_n$ is a subset of $E$ and thus in $\powerset(E)$. Also $\bigcup_{n\in \N}A_n\in\mathcal{A}$ because $\mathcal{A}$ is a $\sigma$-algebra. Thus $\bigcup_{n\in \N}A_n\in\mathcal{A}'$.
\end{itemize}
\end{proof}

\subsubsection{Extensions to measures}
\begin{proposition}
Let $\mathcal{F}\subseteq \powerset(\Omega)$ be a $\pi$-system and $\mu_1, \mu_2: \sigma(\mathcal{F}) \to \overline{\R^+}$ two measures with $\mu_1(\Omega) = \mu_2(\Omega) < \infty$, then $\mu_1 = \mu_2$.
\end{proposition}
\begin{proof}
Define
\[ \mathcal{D} \defeq \setbuilder{A\in \sigma(\mathcal{F})}{\mu_1(A) = \mu_2}. \]
Clearly $\mathcal{F} \subseteq \mathcal{D}$, so if $\mathcal{D}$ is a Dynkin system, then $\sigma(\mathcal{F}) \subseteq \mathcal{D}$ by the $\pi-\lambda$ theorem \ref{piLambdaTheorem}. Then $\sigma(\mathcal{F}) = \mathcal{D}$ by construction and thus $\mu_1 = \mu_2$.

We just need to verify the definition of Dynkin system:
\begin{itemize}
\item $\Omega\in\mathcal{D}$ by assumption;
\item if $A\in\mathcal{D}$, then, by \ref{ringPositiveContent}, $\mu_1(A^c) = \mu_1(\Omega) - \mu_1(A) = \mu_2(\Omega) - \mu_2(A) = \mu_2(A^c)$, so $A^c\in \mathcal{D}$;
\item if $\seq{A_n}_{n\in\N}$ is a disjoint sequence of sets in $\mathcal{D}$, then
\[ \mu_1\Big(\biguplus_{n\in\N}A_n\Big) = \sum_{n\in\N}\mu_1(A_n) = \sum_{n\in\N}\mu_2(A_n) = \mu_2\Big(\biguplus_{n\in\N}A_n\Big), \]
so $\biguplus_{n\in\N}A_n\in\mathcal{D}$.
\end{itemize}
\end{proof}
\begin{corollary} \label{sigmaFiniteUniqueExtension}
Let $\mathcal{F}\subseteq \powerset(\Omega)$ be a $\pi$-system and $\mu_1, \mu_2: \sigma(\mathcal{F}) \to \overline{\R^+}$ two measures. Suppose
\begin{itemize}
\item $\mu_1$ and $\mu_2$ agree on $\mathcal{F}$, i.e.\ $\mu_1(E) = \mu_2(E)$ for all $E\in\mathcal{F}$; and
\item there exists a sequence $\seq{E_n}\subseteq \mathcal{F}$ such that
\begin{itemize}
\item $\mu_1(E_n) = \mu_2(E_n) < \infty$ for all $n\in\N$; and
\item $\bigcup_{n\in\N} E_n = \Omega$.
\end{itemize}
\end{itemize}
Then $\mu_1 = \mu_2$.
\end{corollary}
\begin{proof}
For all $E\in \mathcal{F}$, we have $\mu_1|_{E_n} = \mu_2|_{E_n}$ by the proposition. Pick some $A\in \sigma(\mathcal{F})$. Then we can construct a disjoint sequence
\[ A_n \defeq (A\cap E_n)\setminus \bigg(\bigcup_{k=0}^{n-1}E_k\bigg) \]
and calculate
\[ \mu_1(A) = \sum_{n\in \N}\mu_1(A_n) = \sum_{n\in \N}\mu_1|_{E_n}(A_n) = \sum_{n\in \N}\mu_2|_{E_n}(A_n) = \sum_{n\in \N}\mu_1(A_n) = \mu_2(A). \]
\end{proof}

\subsubsection{New measures from old ones}
\begin{lemma} \label{measuresPositiveLinear}
Let $(\Omega,\mathcal{A})$ be a measurable space. Positive linear combinations of measures are measures: let $\mu_1,\mu_2$ be measures on $(\Omega,\mathcal{A})$ and $0 \leq c \in \R$. Then $c\mu_1 + \mu_2$ is a measure on $(\Omega,\mathcal{A})$.
\end{lemma}

\begin{proposition}[Pushforward measure] \label{pushforwardMeasure}
Let $\sSet{\Omega_1, \mathcal{A}, \mu}$ be a measure space and $\sSet{\Omega_2, \mathcal{B}}$ a measurable space. Let $f: \Omega_1 \to \Omega_2$ be a measurable function. Then
\[ \nu = \mu\circ f^{-1}|_{\mathcal{B}}: \mathcal{B}\to [0,\infty]: B \mapsto \mu(f^{-1}[B]) \]
is a measure on $\sSet{\Omega_2, \mathcal{B}}$.
\end{proposition}
\begin{proof}
Clearly this is well-defined due to $f$ being measurable. We have
\[ \nu(\emptyset) = \mu(f^{-1}[\emptyset])  = \mu(\emptyset) = 0 \]
for every sequence $(E_n)$ in $\mathcal{B}$ of pairwise disjoint sets, we have
\[ \nu\left(\biguplus_{n\in\N}E_n\right) = \mu\left(f^{-1}\left[\biguplus_{n\in\N}E_n\right]\right) = \mu\biguplus_{n\in\N} f^{-1}[E_n]  = \sum_{n\in\N}\mu(f^{-1}[E_n]) = \sum_{n\in\N}\nu(E_n). \]
\end{proof}

\subsection{Outer measures}
\begin{definition}
Let $\Omega$ be a non-empty set. An \udef{outer measure} on $\Omega$ is a map $\nu: \powerset(\Omega)\to \overline{\R^+}$ satisfying
\begin{itemize}
\item $\nu(\emptyset) = 0$;
\item if $E\subseteq F\subseteq \Omega$, then $\nu(E)\leq \nu(F)$;
\item $\nu$ is \udef{$\sigma$-subadditive}: for every sequence $\seq{E_n}$ in $\powerset(\Omega)$, we have
\[ \nu\left(\bigcup_{n\in\N}E_n\right) \leq \sum_{n\in\N}\nu(E_n). \]
\end{itemize}
\end{definition}
A countably additive outer measure is a premeasure, but in general an outer measure is neither a premeasure nor a measure.

\begin{lemma}
In the definition we can replace $\sigma$-subadditivity by subadditivity of countable, pairwise disjoint sequences.
\end{lemma}
Cfr. \ref{premeasureSubadditive}.
\begin{proof}
Clearly $\sigma$-subadditivity implies the subadditivity of countable, pairwise disjoint sequences.

Now assume the subadditivity of countable, pairwise disjoint sequences and take a sequence $\seq{E_n}$ in $\powerset(\Omega)$. Then define
\[ E_n' \defeq E_n \setminus\bigg(\bigcup_{k=0}^{n-1}E_k\bigg), \]
which forms a disjoint sequence such that $\bigcup_{n\in \N}E_n = \biguplus_{n\in \N}E_n'$. We have
\[ \nu\Big(\bigcup_{n\in\N}E_n\Big) \;=\; \nu\Big(\biguplus_{n\in\N}E_n'\Big) \;\leq\; \sum_{n\in\N}\nu(E_n') \;\leq\; \sum_{n\in\N}\nu(E_n). \]
The last inequality follows from the monotonicity of the outer measure.
\end{proof}


\subsubsection{Carathéodory measurability}
\begin{definition}
Let $\Omega$ be a set and $\rho: \powerset(\Omega)\to \overline{\R^+}$ a function. Then $A\subseteq \Omega$ is called \udef{(Carathéodory) measurable} w.r.t.\ $\rho$ if
\[ \forall B\subseteq \Omega: \; \rho(B) = \rho(B\cap A) + \rho(B\cap A^c). \]
\end{definition}
Note that $A\subseteq \Omega$ is measurable if and only if $A^c$ is measurable.

\begin{lemma}
Let $\Omega$ be a set and $\rho: \powerset(\Omega)\to \overline{\R^+}$ a function. If $\rho(\emptyset) \neq 0$, then there exist no Carathéodory measurable sets.
\end{lemma}
\begin{proof}
We prove by contraposition, so assume that there exists a Carathéodory meaurable $A\subseteq \Omega$.
Then
\begin{align*}
\rho(A) &= \rho(A\cap A) + \rho(A\cap A^c) \\
&= \rho(A) + \rho(\emptyset),
\end{align*}
which implies that $\rho(\emptyset) = 0$.
\end{proof}

\begin{lemma} \label{CaratheodoryMeasurableInequality}
Let $\Omega$ be a set and $\nu: \powerset(\Omega)\to \overline{\R^+}$ an outer measure on $\Omega$. A subset $A\subseteq \Omega$ is Carathéodory measurable \textup{if and only if}
\[ \forall B\subseteq \Omega: \; \nu(B) \geq \nu(B\cap A) + \nu(B\cap A^c). \]
\end{lemma}
\begin{proof}
The other inequality follows from subadditivity.
\end{proof}

\begin{lemma} \label{nullSetsCaratheodoryMeasurable}
Let $\Omega$ be a set, $\nu: \powerset(\Omega)\to \overline{\R^+}$ an outer measure on $\Omega$ and $A\subseteq \Omega$ such that $\nu(A) = 0$ or $\nu(A^c) = 0$, then $A$ is Carathéodory measurable.
\end{lemma}
\begin{proof}
First assume $\nu(A) = 0$. Take arbitrary $B\subseteq \Omega$. Then $\nu(B\cap A) = 0$ by monotonicity. Also by monotonicity, we have
\[ \nu(B) \geq \nu(B\cap A^c) = \nu(B\cap A) + \nu(B\cap A^c) \]
and so $A$ is Carathéodory measurable by \ref{CaratheodoryMeasurableInequality}.

The case of $\nu(A^c) = 0$ is similar.
\end{proof}

\begin{lemma} \label{caratheodoryExtensionLemma}
Let $\Omega$ be a set, $\rho: \powerset(\Omega) \to \overline{\R^+}$ a function and $\seq{A_i}_{i\in\N}$ a pairwise disjoint sequence of subsets of $\Omega$ that are Carathéodory measurable w.r.t.\ $\rho$. Then
\[ \rho(B) = \sum_{i=0}^n \rho(B\cap A_i) + \rho\big(B\cap (\bigcap_{i=0}^nA_i^c)\big) \]
for all $B\in \powerset(\Omega)$.
\end{lemma}
\begin{proof}
The proof is by induction on $n$. The base case $n=0$ is just the Carathéodory measurability of $A_0$.

For the induction step, we calculate
\begin{align*}
\rho(B) &= \sum_{i=0}^n \rho(B\cap A_i) + \rho\big(B\cap (\bigcap_{i=0}^nA_i^c)\big) \\
&= \sum_{i=0}^n \rho(B\cap A_i) + \rho\big(B\cap (\bigcap_{i=0}^nA_i^c)\cap A_{n+1}\big) + \rho\big(B\cap (\bigcap_{i=0}^nA_i^c)\cap A_{n+1}^c\big) \\
&= \sum_{i=0}^n \rho(B\cap A_i) + \rho\big(B\cap A_{n+1}\big) + \rho\big(B\cap (\bigcap_{i=0}^{n+1}A_i^c)\big) \\
&= \sum_{i=0}^{n+1}\rho(B\cap A_i) + \rho\big(B\cap (\bigcap_{i=0}^{n+1}A_i^c)\big).
\end{align*}
We conclude by induction.
\end{proof}

\begin{proposition} \label{caratheodoryMeasurableAlgebra}
Let $\Omega$ be a set and $\rho: \powerset(\Omega) \to \overline{\R^+}$ a function such that $\rho(\emptyset) = 0$. Let $\mathcal{A}$ be the set of Carathéodory measurable subsets of $\Omega$. Then
\begin{enumerate}
\item $\mathcal{A}$ is an algebra;
\item if $\rho$ is an outer measure, then $\mathcal{A}$ is a $\sigma$-algebra.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We use \ref{setAlgebraCriteria} the check that $\mathcal{A}$ is an algebra.
\begin{itemize}
\item For all $B\in \powerset(\Omega)$, we have
\[ \rho(B) = \rho(B\cap \Omega) + 0 = \rho(B\cap \Omega) + \rho(\emptyset) = \rho(B\cap \Omega) + \rho(B\cap \Omega^c), \]
so $\Omega\in \mathcal{A}$.
\item Closure under complementation is clear as the definition of Carathéodory measurability is symmetric w.r.t.\ complementation.
\item Assume $A_1,A_2 \in \mathcal{A}$. Take arbitrary $B\in\powerset(\Omega)$. Then
\begin{align*}
\rho(B) &= \rho(B\cap A_1) + \rho(B\cap A_1^c) \\
&= \rho(B\cap A_1) + \rho(B\cap A_1^c\cap A_2) + \rho(B\cap A_1^c\cap A_2^c) \\
&= \rho(B\cap A_1) + \rho(B\cap A_1^c\cap A_2) + m\big(B\cap (A_1\cup A_2)^c\big) \\
&= \rho\big(B\cap (A_1\cup A_2)\cap A_1\big) + \rho\big(B\cap (A_1\cup A_2)\cap A_1^c\big) + \rho\big(B\cap (A_1\cup A_2)^c\big) \\
&= \rho\big(B\cap (A_1\cup A_2)\big) + \rho\big(B\cap (A_1\cup A_2)^c\big),
\end{align*}
so $A_1\cup A_2\in \mathcal{A}$.
\end{itemize}

(2) To show $\mathcal{A}$ is a $\sigma$-algebra, it is enough to show closure under countable disjoint unions by \ref{conditionAlgebraIsSigmaAlgebra}. Let $\seq{A_n}$ be a sequence of pairwise disjoint sets in $\mathcal{A}$. 

By \ref{caratheodoryExtensionLemma} and monotonicity, we have
\[ \rho(B) \geq \sum_{i=0}^n \rho(B\cap A_i) + \rho\big(B\cap (\bigcap_{i=0}^\infty A_i^c)\big) \]
for all $n\in \N$. Thus, taking the limit $n\to\infty$,
\[ \rho(B) \geq \sum_{i=0}^\infty \rho(B\cap A_i) + \rho\Big(B\cap \big(\biguplus_{i=0}^\infty A_i\big)^c\Big) \geq \rho\Big(B\cap \big(\biguplus_{i=0}^\infty A_i\big)\Big) + \rho\Big(B\cap \big(\biguplus_{i=0}^\infty A_i\big)^c\Big), \]
which is enough to prove the  Carathéodory measurability of $\biguplus_{i=0}^\infty A_i$ by \ref{CaratheodoryMeasurableInequality}.
\end{proof}


\subsubsection{Construction of outer measures}
\begin{proposition} \label{outerMeasureConstruction}
Let $\mathcal{X}$ be a family of subsets of $\Omega$ such that $\emptyset\in \mathcal{X}$ and let $\rho: \mathcal{X}\to \overline{\R^+}$ be a function such that $\rho(\emptyset) = 0$. Then
\[ \rho^*: \powerset(\Omega) \to \overline{R^+}:\quad X\mapsto  \inf\setbuilder{\sum_{n\in\N}\rho(A_n)}{\big(\seq{A_n}_{n\in\N}\subseteq \mathcal{X}\big) \land \big(X\subseteq \bigcup_{n\in\N}A_n\big)} \]
is an outer measure on $\Omega$.
\begin{enumerate}
\item If $\rho$ is a pre-measure, then $\rho(A) = \rho^*(A)$ for all $A\in\mathcal{X}$.
\item If $\rho$ is a measure, then $\rho^*(X) = \inf\setbuilder{\rho(A)}{(A\in \mathcal{X}) \land (X\subseteq A)}$.
\end{enumerate}
\end{proposition}
\begin{proof}
We first verify that $\rho^*$ is an outer measure.
\begin{itemize}
\item We have $\rho(\emptyset) = 0$, so $\rho^*(\emptyset)\leq 0$, but there is no element of $\overline{\R^+}$ smaller than $0$.
\item Take $E\subseteq F\subseteq \Omega$. Then every cover of $F$ is a cover of $E$. So the least cover of $E$ is smaller than the least cover of $F$.
\item Fix a sequence $\seq{E_n}$ in $\powerset(\Omega)$. Take some arbitrary $\epsilon > 0$. For each $E_n$, we can find some sequence $\seq{A_{n,k}}\subseteq \mathcal{X}$ such that $E_n\subseteq \bigcup_{k\in\N}A_{n,k}$ and $\sum_{k\in\N}\rho(A_{n,k}) \leq \rho^*(E_n) + \frac{\epsilon}{2^n}$.
Now the countable set $\seq{A_{n,k}}_{n,k\in \N}$ is a cover of $\bigcup_{n\in\N}E_n$, so
\[ \rho^*\Big(\bigcup_{n\in\N}E_n\Big) \leq \sum_{n,k\in\N}\rho(A_{n,k}) = \sum_{n\in\N}\sum_{k\in\N}\rho(A_{n,k}) \leq \sum_{n\in\N}\big(\rho^*(E_n)+ \frac{\epsilon}{2^n}\big) = 2\epsilon + \sum_{n\in\N}\rho^*(E_n), \]
where we have used \ref{joinMeetUnion} and the fact that the infinite sums are suprema over finite sums.

As the $\epsilon> 0$ was arbitrary, we have that
\[ \rho^*\Big(\bigcup_{n\in\N}E_n\Big) \leq \sum_{n\in\N}\rho^*(E_n). \]
\end{itemize}


(1) Assume $\rho$ is a pre-measure and take $A\in\mathcal{X}$. By construction, $\rho^*(A) \leq \rho(A)$. 

For the other inequality, take an arbitrary sequence $\seq{A_n}_{n\in\N}$ in $\mathcal{X}$ such that $A \subseteq \bigcup_{n\in\N}A_n$. Then
\[ \sum_{n\in\N}\rho(A_n) \geq \sum_{n\in\N}\rho(A_n\cap A) \geq \rho\Big(\bigcup_{n\in\N}(A_n\cap A)\Big) = \rho(A), \]
using monotonicity \ref{semiringPositiveContent} and subadditivity \ref{premeasureSubadditive}.

(2) We calculate
\begin{align*}
\inf\setbuilder{\rho(A)}{(A\in \mathcal{X}) \land (X\subseteq A)} &\geq \inf\setbuilder{\sum_{n\in\N}\rho(A_n)}{\big(\seq{A_n}_{n\in\N}\subseteq \mathcal{X}\big) \land \big(X\subseteq \bigcup_{n\in\N}A_n\big)} \\
&\geq \inf\setbuilder{\rho\Big(\bigcup_{n\in\N}A_n\Big)}{\big(\seq{A_n}_{n\in\N}\subseteq \mathcal{X}\big) \land \big(X\subseteq \bigcup_{n\in\N}A_n\big)} \\
&\geq \inf\setbuilder{\rho(A)}{(A\in \mathcal{X}) \land (X\subseteq A)},
\end{align*}
where we have used first that $\rho(A)$ is a special case of the sum with just one term, next subadditivity of $\rho$ and finally the fact that $\mathcal{X}$ is a $\sigma$-algebra in this case, so $\bigcup_{n\in \N}A_n\in \mathcal{X}$ for all sequences $\seq{A_n}\in \mathcal{X}^\N$.
\end{proof}

\subsubsection{The extension theorem}
\begin{proposition} \label{caratheodoryLemma}
Let $\Omega$ be a set and $\rho: \powerset(\Omega) \to \overline{\R^+}$ a function such that $\rho(\emptyset) = 0$. Let $\mathcal{A}$ be the set of Carathéodory measurable subsets of $\Omega$. Then
\begin{enumerate}
\item $\rho|_{\mathcal{A}}$ is a complete content on the algebra $\mathcal{A}$;
\item if $\rho$ is an outer measure, then $\rho|_{\mathcal{A}}$ is a complete measure.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have that $\mathcal{A}$ is an algebra by \ref{caratheodoryMeasurableAlgebra}. We just need to prove additivity. Take disjoint $A,B\in\mathcal{A}$. Then
\begin{align*}
\rho(A\uplus B) &= \rho\big((A\uplus B)\cap A\big) + \rho\big((A\uplus B)\cap A^c\big) \\
&= \rho(A) + \rho(B).
\end{align*}
Completeness follows from \ref{nullSetsCaratheodoryMeasurable}.

(2) In this case we have that $\mathcal{A}$ is a $\sigma$-algebra by \ref{caratheodoryMeasurableAlgebra}. The result follows straight from (1) and \ref{premeasureSubadditivityEquivalences}, because outer measures are $\sigma$-subadditive. 
\end{proof}

\begin{theorem}[Carathéodory-Fréchet-Hahn-Kolmogorov-Hopf extension theorem] \label{premeasureExtensionTheorem}
Let $\mathcal{S}$ be a semi-ring on a set $\Omega$ and $\mu: \mathcal{S}\to \overline{\R^+}$ a pre-measure, then $\mu$ can be extended to a complete measure on $\sigma(\mathcal{S})$.
\end{theorem}
\begin{proof}
We first construct the outer measure $\mu^*$ as in \ref{outerMeasureConstruction} and then restrict this to a complete measure as in \ref{caratheodoryLemma}. If we can prove that each $A\in \mathcal{S}$ is Carathéodory measurable, then the $\sigma$-algebra on which the measure is defined must contain $\sigma(\mathcal{S})$. In this case \ref{outerMeasureConstruction} gives $\mu^*(A) = \mu(A)$. Thus restricting the measure to $\sigma(\mathcal{S})$ gives the first result.

We prove that each set in $\mathcal{S}$ is Carathéodory measurable. Take $A\in \mathcal{S}$. Pick an arbitrary $B\subseteq \Omega$ and fix some $\epsilon > 0$. Then we can find a sequence $\seq{B_n}_{n\in\N}$ in $\mathcal{S}$, that covers $B$, such that
\[ \sum_{n\in\N}\mu(B_n) \leq \mu^*(B) + \epsilon. \]
The sets $B_n\cap A$ are all in $\mathcal{S}$ and cover $B\cap A$. The sets $B_n\setminus A$ can be written as $B_n\setminus A = \biguplus_{k\in\N}D_{n,k}$, where $D_{n,k}\subseteq\mathcal{S}$ and only finitely many are non-empty.
We have
\begin{align*}
\mu^*(B\cap A) &\leq \sum_{n\in\N}\mu(B_n\cap A) \\
\mu^*(B\setminus A) &\leq \sum_{n,k\in\N} \mu(D_{n,k}).
\end{align*}
Then
\[ \mu(B_n) = \mu\Big((B_n\cap A) \uplus \biguplus_{k\in\N}D_{n,k}\Big) = \mu(B_n\cap A) + \sum_{k\in \N}\mu(D_{n,k}),  \]
by finite additivity (as there are only finitely many non-zero terms of the sum), and we get
\begin{align*}
\mu^*(B\cap A) + \mu^*(B\setminus A) &\leq \sum_{n\in\N}\mu(B_n\cap A) + \sum_{n,k\in\N} \mu(D_{n,k}) \\
&= \sum_{n\in\N}\Big(\mu(B_n\cap A) + \sum_{k\in\N}\mu(D_{n,k})\Big) \\
&= \sum_{n\in\N}\mu(B_n) \leq \mu^*(B) + \epsilon.
\end{align*}
As $\epsilon >0$ is arbitrary, we have $\mu^*(B) \geq \mu^*(B\cap A) + \mu^*(B\setminus A)$. By \ref{CaratheodoryMeasurableInequality}, this is enough to show the Carathéodory measurability of $A$.
\end{proof}

\subsubsection{Regular outer measures}
\begin{definition}
Let $\Omega$ be a non-empty set. An outer measure $\nu: \powerset(\Omega)\to \overline{\R^+}$ is called \udef{regular} if for every set $A\subseteq \Omega$ there exists a Carathéodory measurable set $B\supseteq A$ such that $\nu(A) = \nu(B)$.
\end{definition}

\begin{proposition}
Let $\nu$ be a regular outer measure on $\Omega$ with $\nu(\Omega) < \infty$. Then a set $A\subseteq \Omega$ is Carathéodory measurable \textup{if and only if}
\[ \nu(A) + \nu(A^c) = \nu(\Omega). \]
\end{proposition}
\begin{proof}
The direction $\Rightarrow$ is immediate.

For the direction, pick some arbitrary $B\subseteq\Omega$. Then, by regularity, $B$ is contained in some Carathéodory measurable $C\subseteq \Omega$ such that $\nu(B) = \nu(C)$.

Consider the following:
\begin{alignat*}{5}
\nu(&A) & &= \quad & \nu(A&\cap C) & &+ & \nu(A&\cap C^c) \\
&+ &&& & &&& &+ \\
\nu(&A^c) & \quad &= & \nu(A^c&\cap C) & \quad&+\quad & \nu(A^c&\cap C^c) \\
&\rotatebox[origin=c]{90}{$=$} &&& & &&& &\rotatebox[origin=c]{90}{$\leq$} \\
\nu(&\Omega) & &= & \nu(&C) & &+ & \nu(&C^c)
\end{alignat*}
The three equations in the rows are instances of the measurability of $C$. The left column is the assumption on $A$ and the right column follows by subadditivity from $C^c = (A\cap C^c) \cup (A^c\cap C^c)$. By consistencey of the square, we can extract the following inequality from the center column:
\[ \nu(C) \geq \nu(A\cap C) + \nu(A^c\cap C). \]
For $B$ we then have
\begin{align*}
\nu(B) = \nu(C) &\geq \nu(A\cap C) + \nu(A^c\cap C) \\
&\geq \nu(A\cap B) + \nu(A^c\cap B),
\end{align*}
by monotonicity. By \ref{CaratheodoryMeasurableInequality}, this is enough to prove measurability of $A$. 
\end{proof}

\begin{proposition}
Let $\Omega$ be a set, $\mathcal{S}$ a semi-ring on $\Omega$ and $\rho: \mathcal{S}\to\overline{\R^+}$ a premeasure. Let $\rho^*:\powerset(\Omega)\to \overline{\R^+}$ be the outer measure constructed in \ref{outerMeasureConstruction}. Then
\begin{enumerate}
\item $\rho^*(X) = \inf\setbuilder{\rho^*(B)}{\text{$B\supseteq X$ is $\rho^*$-measurable}}$;
\item $\rho^*$ is regular.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have $\rho^*(X) \leq \rho^*(B)$ for all $\rho^*$-measurable superset $B$ of $X$. Taking the infimum over the $B$s preserves the inequality, so $\rho^*(X) \leq \inf\setbuilder{\rho^*(B)}{\text{$B\supseteq X$ is $\rho^*$-measurable}}$. For the other inequality we calculate
\begin{align*}
\rho^*(X) &= \inf\setbuilder{\sum_{n\in\N}\rho(A_n)}{\big(\seq{A_n}_{n\in\N}\subseteq \mathcal{S}\big) \land \big(X\subseteq \bigcup_{n\in\N}A_n\big)} \\
&\geq \inf\setbuilder{\rho\Big(\bigcup_{n\in \N}A_n\Big)}{\big(\seq{A_n}_{n\in\N}\subseteq \mathcal{S}\big) \land \big(X\subseteq \bigcup_{n\in\N}A_n\big)} \\
&\geq \inf\setbuilder{\rho\Big(B\Big)}{\text{$B\supseteq X$ is $\rho^*$-measurable}},
\end{align*}
where we have used $\sigma$-subadditivity of the outer measure and the fact that all $A_n\in \mathcal{S}$ are $\rho^*$-measurable by \ref{premeasureExtensionTheorem}, so $\bigcup_{n\in \N}A_n$ is $\rho^*$-measurable by \ref{caratheodoryMeasurableAlgebra}.

(2) Take an arbitrary $A\subseteq \Omega$. For all $n\in \N$, we can find $x_n\in \setbuilder{\rho^*(B)}{\text{$B\supseteq A$ is $\rho^*$-measurable}}$ such that $x_n \leq \rho^*(A) + \frac{1}{n}$. 

Then we can find some sequence $\seq{B_n}$ of $\rho^*$-measurable supersets of $A$ such that $x_n = \rho^*(B_n)$.

We have that $\bigcap_{n\in\N}B_n$ is measurable by \ref{caratheodoryMeasurableAlgebra}. We claim that $\rho^*\Big(\bigcap_{n\in\N}B_n\Big) = \rho^*(A)$. Indeed $A \subseteq \bigcap_{n\in\N}B_n$ and \ref{orderPreservingFunctionLatticeOperations} imply
\[ \rho^*\Big(\bigcap_{n\in\N}B_n\Big) \leq \inf_{n\in\N}\rho^*(B_n) = \inf_{n\in\N}\Big(\rho^*(A)+ \frac{1}{n}\Big) = \rho^*(A) \leq \rho^*\Big(\bigcap_{n\in\N}B_n\Big). \] 
\end{proof}
\begin{corollary}
Let $\nu$ be an outer measure on $\Omega$. Then
\[ \nu': \powerset(\Omega) \to \overline{R^+}:\quad X\mapsto  \inf\setbuilder{\nu(B)}{\text{$B\supseteq A$ is $\nu$-measurable}} \]
is a regular outer measure.
\end{corollary}
This outer measure is called the \udef{regular outer measure associated to $\nu$}.
\begin{proof}
Let $\mathcal{A}$ be the $\sigma$-algebra (by \ref{caratheodoryMeasurableAlgebra}) of $\nu$-measurable sets. Then, because $\mathcal{A}$ is a $\sigma$-algebra, the function $\nu'$ is a the outer measure of \ref{outerMeasureConstruction} generated by the measure $\nu|_\mathcal{A}$.
\end{proof}

\begin{proposition}
Regular outer measures preserve joins of countable chains.
\end{proposition}
\begin{proof}
Let $\nu$ be a regular outer measure and $\seq{A_n}_{n\in\N}$ a monotonically growing sequence of sets. Then we can find a sequence $\seq{B_n}$ of measurable sets such that $\nu(A_n) = \nu(B_n)$ for all $n\in\N$. Now set $C_n = \bigcap_{k \geq n}B_k$. It is clear that $\seq{C_n}$ is monotonic and each $C_n$ is measurable by \ref{caratheodoryMeasurableAlgebra}. As $A_n\subseteq B_k$ for all $k\geq n$, we have $A_n\subseteq C_n$ and thus $\nu(A_n) \leq \nu(C_n) \leq \nu(B_n) = \nu(A_n)$, so $\nu(A_n) = \nu(C_n)$. 

Now, by \ref{orderPreservingFunctionLatticeOperations} and \ref{premeasureChainContinuous} (which we may apply due to \ref{caratheodoryLemma}), we have
\[ \nu\Big(\bigcup_{n\in\N}A_n\Big) \geq \sup_{n\in \N}\nu(A_n) = \sup_{n\in \N}\nu(C_n) = \nu\Big(\bigcup_{n\in\N}C_n\Big) \geq \nu\Big(\bigcup_{n\in\N}A_n\Big), \]
so $\nu\Big(\bigcup_{n\in\N}A_n\Big) = \sup_{n\in \N}\nu(A_n)$.
\end{proof}

\subsection{Constructions}
\subsubsection{Product measures}

\begin{proposition} \label{productMeasure}
Let $\sSet{\Omega_1, \mathcal{A}_1,\mu_1}$, $\sSet{\Omega_2, \mathcal{A}_2, }$ be measure spaces. Then there exists a $\mu$ on $\mathcal{A}_1\otimes\mathcal{A}_2$ that satisfies
\[ \mu(A_1\times A_2) = \mu_1(A_1)\cdot\mu_2(A_2) \qquad \forall A_1\in\mathcal{A}_1, A_2\in\mathcal{A}_2. \]
If $\mu_1$ and $\mu_2$ are $\sigma$-finite, then this measure is unique and $\sigma$-finite.
\end{proposition}
\begin{proof}
The set $\mathcal{B} \defeq \setbuilder{A_1\times A_2}{A_1\in \mathcal{A}_1, A_2\in \mathcal{A}_2}$ is a semi-ring by \ref{productSemiring}. 

If $\mu$ is a pre-measure, then, by \ref{premeasureExtensionTheorem}, it extends to a measure on $\sigma(\mathcal{B}) = \mathcal{A}_1\otimes\mathcal{A}_2$.

We verify that $\mu$ is a pre-measure:
\begin{itemize}
\item $\mu(\emptyset) = \mu(\emptyset \times\emptyset) = \mu_1(\emptyset)\cdot \mu_2(\emptyset) = 0\cdot 0 = 0$.
\item Take $\seq{B_k\times C_k} \in \mathcal{B}^\N$ pairwise disjoint such that $\biguplus_{k\in\N}B_k\times C_k = B\times C\in \mathcal{B}$. Now consider the equivalence relation on $B$ which relates $x$ and $y$ if $\forall k\in\N: x\in B_k \iff y\in B_k$. Now partition $B = \biguplus_{i\in\N} B'_{i}$ according to this equivalence relation. 

Every $B_k$ is a disjoint union of $B_i'$s and we write $B_k = \biguplus_{i\in I_k}B_i'$ (indeed, if $x$ and $y$ are in the same equivalence class $B_i'$ and $x\in B_k$, then $y\in B_k$). 

We partition $C = \biguplus_{j\in\N}C'_j$ and define $J_k$ similarly. We calculate
\begin{align*}
\mu\Big(\biguplus_{k\in\N} B_k\times C_k \Big) &= \mu(B\times C) \\
&= \mu_1(B)\cdot\mu_2(C) \\
&= \mu_1\Big(\biguplus_{i\in\N}B'_{i}\Big)\cdot\mu_2\Big(\biguplus_{j\in\N}C'_{j}\Big) \\
&= \sum_{i,j\in\N}\mu_1(B'_{i})\cdot\mu_2(C'_{j}) \\
&= \sum_{k\in\N} \Big(\sum_{i\in I_k}\mu_1(B'_{i})\Big)\cdot\Big(\sum_{j\in J_k}\mu_2(C'_{j})\Big) \\
&= \sum_{k\in\N} \mu_1\Big(\biguplus_{i\in I_k}B'_{i}\Big)\cdot\mu_2\Big(\biguplus_{j\in J_k}C'_{j}\Big) \\
&= \sum_{k\in\N} \mu_1(B_k)\cdot\mu_2(C_{k}) \\
&= \sum_{k\in\N} \mu(B_k\times C_{k}).
\end{align*}
\end{itemize}
Now assume $\mu_1$ and $\mu_2$ are $\sigma$-finite, so there exist sequences $\seq{D_n}_{n\in\N}\in \mathcal{A}_1^\N$ and $\seq{E_n}_{n\in\N}\in \mathcal{A}_2^\N$ of finite measure whose unions are, resp., $\Omega_1$ and $\Omega_2$. Then $\seq{D_n\times E_n}_{n\in \N}$ is a sequence of finite measure whose union is $\Omega_1\times\Omega_2$. This shows $\sigma$-finiteness.

Uniqueness then follows from \ref{sigmaFiniteUniqueExtension}.
\end{proof}

\begin{definition}
The unique measure from \ref{productMeasure} is called the \udef{product measure} and is denoted $\mu_1\otimes \mu_2$.
\end{definition}

\begin{proposition} \label{setSectionMeasurable}
Let $\sSet{\Omega_1, \mathcal{A}_1,\mu_1}$, $\sSet{\Omega_2, \mathcal{A}_2, }$ be measure spaces and $Q\in \mathcal{A}_1\otimes\mathcal{A}_2$. Then
\begin{enumerate}
\item $\setbuilder{\omega\in\Omega_2}{(x,\omega)\in Q} = xQ \in\mathcal{A}_2$ for all $x\in\Omega_1$;
\item $\setbuilder{\omega\in\Omega_1}{(\omega, y)\in Q} = Qy \in\mathcal{A}_1$ for all $y\in\Omega_2$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Fix arbitrary $x\in\Omega_1$.

If $Q = A_1\times A_2$ for some $A_1\in\mathcal{A}_1$ and $A_2\in\mathcal{A}_2$, then
\[ xQ = \setbuilder{\omega\in\Omega_2}{(x,\omega) \in A_1\times A_2} = \begin{cases}
\emptyset & (x\notin A_1) \\
A_2 & (x\in A_1)
\end{cases}, \]
which is an element of $\mathcal{A}_2$, so the result follows.

In order to extend the result to the rest of $\mathcal{A}_1\otimes \mathcal{A}_2$, it is enough to prove that the set $\mathcal{B}$ of all $P\subseteq \Omega_1\times \Omega_2$ such that $xP\in\mathcal{A}_2$ is a $\sigma$-algebra

We verify that $\mathcal{B}$ is a $\sigma$-algebra using \ref{setAlgebraCriteria}:
\begin{itemize}
\item We have $\setbuilder{\omega\in\Omega_2}{(x,\omega)\in \Omega_1\times \Omega_2} = \Omega_2 \in\mathcal{A}_2$, so $\Omega_1\times\Omega_2\in\mathcal{B}$.
\item Take $P\in\mathcal{B}$. Then $xP^c = (xP)^c \in \mathcal{A}_2$, so $P^c\in \mathcal{B}$.
\item Take $\seq{P_n}_{n\in\N}\in \mathcal{B}^\N$, then $x\Big(\bigcup_{n\in\N}P_n\Big) = \bigcup_{n\in\N}xP_n \in \mathcal{A}_2$. So $\bigcup_{n\in\N}P_n\in \mathcal{B}$.
\end{itemize}
\end{proof}
\begin{corollary} \label{partialApplicationMeasurable}
Let $\sSet{\Omega_1, \mathcal{A}_1}$, $\sSet{\Omega_2, \mathcal{A}_2}$, $\sSet{\Omega_3, \mathcal{A}_3}$ be measurable sets and $f: \Omega_1\times\Omega_2 \to \Omega_3$ a measurable function. For all $x\in\Omega_1, y\in\Omega_2$,
\begin{enumerate}
\item $f(x,-)$ is $\mathcal{A}_2/\mathcal{A}_3$-measurable;
\item $f(-,y)$ is $\mathcal{A}_1/\mathcal{A}_3$-measurable.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) Take $B\in \mathcal{A}_3$. Then $\big(f(x,-)\big)^{\preimf}(B) = x\big(f^\preimf(B)\big)$. This is an element of $\mathcal{A}_2$ by the proposition and the measurability of $f$.

(2) Similar.
\end{proof}

\section{Measures on topological spaces}
\begin{definition}
Let $\sSet{X, \xi}$ be a topological space. A measure or outer measure such that all sets in the Borel-$\sigma$-algebra are measurable is called a \udef{Borel} measure.
\end{definition}


\begin{definition}
Let $\sSet{X, \xi}$ be a topological space with Borel $\sigma$-algebra $\mathcal{B}$. A measure $\mu: \mathcal{B} \to [0,\infty]$ is called \udef{locally finite} if every $x\in X$ has a neighbourhood $U_x$ such that $\mu(U_x)$ is finite.
\end{definition}

\subsection{Borel regular measures}
\begin{definition}
Let $\sSet{X, \xi}$ be a topological space. A measure or outer measure is \udef{Borel regular} or \udef{outer regular} if
\end{definition}

\subsubsection{Radon measures}
\begin{definition}
Let $\sSet{X, \topology_X}$ be a topological space with associated Borel $\sigma$-algebra $\mathcal{B}$. A \udef{(outer) Radon measure} is a measure $\mu: \mathcal{B}\to [0,\infty]$ such that
\begin{itemize}
\item $\mu$ is locally finite;
\item $\mu(A) = \inf\setbuilder{\mu(U)}{\text{$U\supseteq A$ is open}}$ for all $A\in \mathcal{B}$;
\item $\mu(A) = \sup\setbuilder{\mu(K)}{\text{$K\subseteq A$ is compact}}$ for all \emph{open} $A\in \mathcal{B}$.
\end{itemize}
We say $\mu$ is \udef{outer regular} and \udef{weakly inner regular}.
\end{definition}

TODO: need each compact set has finite measure? (Equivalent to locally finite for locally compact spaces)

TODO: Borel regular measure that gives finite mass to each compact set.


\subsection{Contents and measures on the real line}
\begin{definition}
A subset $I\subseteq \R$ is called an \udef{interval} if it is of one of the following forms:
\begin{itemize}
\item $\interval[c]{a,b}$ for some $a,b\in \overline{\R}$;
\item $\interval[o]{a,b}$ for some $a,b\in \overline{\R}$;
\item $\interval[co]{a,b}$ for some $a,b\in \overline{\R}$;
\item $\interval[oc]{a,b}$ for some $a,b\in \overline{\R}$.
\end{itemize}
We define the \udef{interval pre-measure} $\lambda$ on the intervals by $\lambda(I) = |b-a|$ and $\lambda(\R) = \infty$.

We will call a family of subsets of the real line \udef{admissible} if it contains all intervals. We will call a content or measure $\mu$ on the real line \udef{admissible} if it is defined on an admissible family of sets and satisfies $\mu(I) = \lambda(I)$ for all intervals $I$.
\end{definition}

\begin{lemma}
The set of intervals on the real line is a semi-algebra and the interval pre-measure $\lambda$ is a positive pre-measure on the set of intervals.
\end{lemma}
\begin{proof}
Let $\mathcal{E}$ be the family of intervals on the real line. We verify \ref{setAlgebraCriteria}. Take $A,B\in \mathcal{E}$. Let $a_A,b_A$ be the bounds of $A$ and $a_B, b_B$ the bounds of $B$.

Then $A\cap B$ is an interval between $\max\{a_A, a_B\}$ and $\min\{b_A, b_B\}$.

And $A^c$ consists of the disjoint union of the interval from $-\infty$ to $a_A$ and the interval from $b_A$ to $\infty$.

Now we verify that $\lambda$ is a content. Firstly,
\[ \lambda(\emptyset) = \lambda\big(\interval[o]{1,1}\big) = |1-1| = 0. \]
Next suppose $I = I_0\uplus \ldots \uplus I_{k-1}$, where $I,I_0,\ldots, I_{k-1}$ are intervals sets. If $I$ is an interval from $a_0$ to $a_k$, then we can order the other intervals such that $I_m$ is an interval from $a_m$ to $a_{m+1}$ and $a_0 \leq \ldots \leq a_k$.

Then we have
\[ \mu(I) = a_k - a_0 = (a_k - a_{k-1}) + \ldots (a_1 - a_0) = \mu(I_{k-1}) + \ldots + \mu(I_0). \]
\end{proof}

\begin{definition}
The \udef{elementary sets} on the real line are the sets in the ring generated by the set of intervals. The \udef{elementary pre-measure} $\lambda$ is the extension of the interval pre-measure to this ring.
\end{definition}

We will be extending this content to much larger algebra's and $\sigma$-algebras in different ways.

\subsubsection{Translation invariance and uniqueness}
TODO

\subsubsection{The Peano-Jordan content}
\begin{definition}
A subset $A\subseteq \R$ is called \udef{Peano-Jordan measurable} if for all $\epsilon > 0$, there exists a pair of sets elementary $B_\epsilon, C_\epsilon \subseteq \R$ such that
\begin{itemize}
\item $B_\epsilon \subseteq A\subseteq C_\epsilon$;
\item $\lambda(C_\epsilon \setminus B_\epsilon) \leq \epsilon$.
\end{itemize}
The Peano-Jordan content of a Peano-Jordan measurable set $A$ is equal to
\[ \lambda_J(A) \defeq \lim_{\epsilon\to 0}\lambda(B_\epsilon) = \lim_{\epsilon\to 0}\lambda(C_\epsilon). \]
\end{definition}
Notice that $\lambda(C_\epsilon \setminus B_\epsilon)$ is well-defined because $\lambda$ is defined on the whole \emph{algebra} of elementary sets.

\begin{lemma}
Let $A\subseteq \R$ be a Peano-Jordan measurable set. Then the Peano-Jordan content is well-defined, i.e.\ $\lim_{\epsilon\to 0}\lambda(B_\epsilon) = \lim_{\epsilon\to 0}\lambda(C_\epsilon)$.
\end{lemma}
\begin{proof}
If there exists some $\epsilon' >0$ such that $B_{\epsilon'}$ is infinite, then $C_\epsilon$ must be infinite for all $\epsilon >0$. We then need to show that $\lim_{\epsilon\to 0}\lambda(B_\epsilon) = \infty$.

Suppose, towards a contradiction, that $\lambda(B_\epsilon)$ does not tend to infinity. Then there exists a constant $K\geq 0$ such that $\lambda(B_\epsilon) \leq K$ for all $\epsilon >0$. Then we calculate, using \ref{ringPositiveContent},
\[ \lambda(C_\epsilon \setminus B_\epsilon) = \lambda(C_\epsilon) - \lambda(B_\epsilon) \geq \infty - K = \infty > \epsilon. \]
This is a contradiction.

Now assume $\lambda(B_\epsilon)$ is finite for all $\epsilon >0$. Then we can use \ref{ringPositiveContent} to obtain
\[ \lambda(C_\epsilon \setminus B_\epsilon) = \lambda(C_\epsilon) - \lambda(B_\epsilon) \leq \epsilon. \]
We conclude $\lim_{\epsilon\to 0}\lambda(B_\epsilon) = \lim_{\epsilon\to 0}\lambda(C_\epsilon)$ by continuity of subtraction.
\end{proof}

\begin{proposition} \label{supInfPeanoJordanContent}
Take $A\subseteq \R$.
\begin{enumerate}
\item If $A$ is Peano-Jordan measurable, then
\[ \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B) \quad = \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C) = \lambda_J(A). \]
\item If
\[ \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B) \quad = \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C) \]
and this quantity is finite, then $A$ is Peano-Jordan measurable.
\end{enumerate}
\end{proposition}
The condition
\[ \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B) \quad = \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C) \]
is sometimes taken as the (inequivalent) definition of Peano-Jordan measurable. One problem with this is that the Peano-Jordan measurable sets would not form an algebra (see example).
\begin{proof}
(1) By construction it is clear that
\[ \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B) \quad \leq \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C). \]
Also
\[ \{B_\epsilon\}_{\epsilon > 0} \subseteq \setbuilder{B}{\text{$B\subseteq A$ and $B$ is elementary}} \quad\text{and}\quad \{C_\epsilon\}_{\epsilon > 0} \subseteq \setbuilder{C}{\text{$A\subseteq C$ and $C$ is elementary}}. \]
By compatibility of the order with the convergence, we have
\[ \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C) \quad \leq \quad \lim_{\epsilon\to 0}\lambda(C_\epsilon) = \lambda_J(A) = \lim_{\epsilon\to 0}\lambda(B_\epsilon) \quad \leq \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B), \]
which proves the assertions.

(2) Set
\[ x = \sup_{\substack{B\subseteq A \\ \text{$B$ is elementary}}} \hspace{-1.5em}\lambda(B) \quad = \inf_{\substack{A\subseteq C \\ \text{$C$ is elementary}}} \hspace{-1.5em}\lambda(C) \]
and take $\epsilon >0$ arbitrary.

We can find an elementary $B_\epsilon \subseteq A$ such that $\lambda(B_\epsilon) \geq x-\epsilon/2$ and $C_\epsilon \supseteq A$ such that $\lambda(C_\epsilon) \leq x+\epsilon/2$. These sets satisfy the definition.
\end{proof}

\begin{example}
\begin{itemize}
\item There are Jordan measurable sets that are not elementary. For example, $\setbuilder{n^{-1}}{n\in (1:)} \cup \{0\}$ is Jordan measurable with Jordan content $0$.

Indeed, take $B_\epsilon = \{0\}$ for all $\epsilon$ and $C_\epsilon = \interval{0,\epsilon} \cup\bigcup_{n=1}^{\floor{\epsilon^{-1}}} \{n^{-1}\}$.
\item The rationals $\Q$ is not Jordan measurable. Indeed all elementary subsets of $\Q$ have zero content and all elementary supersets of $\Q$ have content $\infty$.
\item Point two of \ref{supInfPeanoJordanContent} does not hold if the quantity is infinite. For example, take $A = \Q \cup \interval{0,+\infty}$. This also shows that if we took the condition in \ref{supInfPeanoJordanContent} to be the definition of Peano-Jordan measurability, then the Peano-Jordan measurable sets would not form an algebra.
\end{itemize}
\end{example}

\begin{lemma} \label{PeanoJordanAlgebra}
The set of Peano-Jordan measurable sets is an algebra, which is admissible. The Peano-Jordan content is a content. It is also admissible.
\end{lemma}
\begin{proof}
Admissibility is clear. We need to show that the set of Jordan measurable sets forms an algebra.

We prove this from the fact that elementary sets form an algebra, using \ref{setAlgebraCriteria}.

\begin{itemize}
\item Clearly $\R\in\mathcal{A}$.
\item Let $A$ be Jordan measurable. Then there exist families $B_\epsilon^A$ and $C_\epsilon^{A}$ of elementary sets such that $B_\epsilon^A \subseteq A \subseteq C_\epsilon^{A}$. Then $(B_\epsilon^A)^c$ and $(C_\epsilon^{A})^c$ are also families of elementary sets and $(B_\epsilon^A)^c \subseteq A^c \subseteq (C_\epsilon^{A})^c$. By \ref{setDifferenceComplement}, we have $(B_\epsilon^A)^c \setminus (C_\epsilon^{A})^c = B_\epsilon^A \setminus C_\epsilon^{A}$. This shows that $A^c$ is Jordan measurable.
\item Let $B$ be Jordan measurable. Then there exist families $B_\epsilon^B$ and $C_\epsilon^{B}$ of elementary sets such that $B_\epsilon^B \subseteq B \subseteq C_\epsilon^{B}$. We have
\[ B_{\epsilon/2}^A \cup B_{\epsilon/2}^B \subseteq A\cup B \subseteq C_{\epsilon/2}^A \cup C_{\epsilon/2}^B. \]
Then $\big(C_{\epsilon/2}^A \cup C_{\epsilon/2}^B\big) \setminus \big(B_{\epsilon/2}^A \cup B_{\epsilon/2}^B\big) \subseteq \big(C_{\epsilon/2}^A \setminus B_{\epsilon/2}^A\big) \cup \big(C_{\epsilon/2}^B \setminus B_{\epsilon/2}^B\big)$, so
\begin{align*}
\lambda\Big(\big(C_{\epsilon/2}^A \cup C_{\epsilon/2}^B\big) \setminus \big(B_{\epsilon/2}^A \cup B_{\epsilon/2}^B\big)\Big) &\leq \lambda\big(C_{\epsilon/2}^A \setminus B_{\epsilon/2}^A\big) + \lambda\big(C_{\epsilon/2}^B \setminus B_{\epsilon/2}^B\big) \\
&= \frac{\epsilon}{2} + \frac{\epsilon}{2} = \epsilon,
\end{align*}
by \ref{semiringPositiveContent}.
\end{itemize}

Finally we show that the Peano-Jordan content is a content.
\begin{itemize}
\item The Peano-Jordan content of $\emptyset$ is $0$ by admissibility and the fact that the elementary pre-measure is a pre-measure.
\item Now take disjoint Peano-Jordan measurable sets $A,B$ and families $B_\epsilon^A, C_\epsilon^A, B_\epsilon^B, C_\epsilon^B$ of elementary sets that witness the Peano-Jordan measurability. Clearly $B_\epsilon^A$ and $B_\epsilon^B$ are disjoint.

As before, we may take $B_\epsilon^A\uplus B_\epsilon^B$ and $C_\epsilon^A \cup C_\epsilon^B$ to witness the Peano-Jordan measurability of $A\uplus B$. We can then calculate the Peano-Jordan content as
\begin{align*}
\lambda_J(A\uplus B) &= \lim_{\epsilon \to 0}\lambda(B_\epsilon^A\uplus B_\epsilon^B) \\
&= \lim_{\epsilon \to 0}\lambda(B_\epsilon^A) + \lambda(B_\epsilon^B) \\
&= \lim_{\epsilon \to 0}\lambda(B_\epsilon^A) + \lim_{\epsilon \to 0}\lambda(B_\epsilon^B) \\
&= \lambda_J(A) + \lambda_J(B).
\end{align*}
\end{itemize}
\end{proof}

\begin{proposition}
Let $\seq{A_n}_{n\in \N}$ be a sequence of disjoint Peano-Jordan measurable sets such that $\biguplus_{n\in\N}A_n$ is Peano-Jordan measurable. Then
\[ \mu\Big(\biguplus_{n\in\N}A_n\Big) = \sum_{n\in\N}\mu(A_n). \]
\end{proposition}
\begin{proof}
Given \ref{ringPositiveContent}, we only need to show
\[ \mu\Big(\biguplus_{n\in\N}A_n\Big) \leq \sum_{n\in\N}\mu(A_n). \]

TODO Tannery
\end{proof}

\subsubsection{The Lebesgue measure}
\begin{definition}
Define $\mathfrak{I} \defeq \setbuilder{\seq{(a_n, b_n)} \in (\R \times \R)^\N}{\forall n\in \N: \; a_n \leq b_n}$. Let $A\subseteq \R$. We say $\seq{(a_n, b_n)} \in \mathfrak{I}$ \udef{covers} $A$ if $A \subseteq \bigcup_{n\in\N} \interval[o]{a_n, b_n}$.

The \udef{Lebesgue outer measure} on $\R$, denoted by $\lambda^*$ is defined by
\[ \lambda^*(A) = \inf\setbuilder{\sum_{n\in \N}(b_n-a_n)}{\text{$\seq{(a_n, b_n)} \in \mathfrak{I}$ covers $A$}}. \]


The set of $\lambda^*$-measurable sets is called the \udef{Lebesgue $\sigma$-algebra} and the associated measure $\lambda$ is called the \udef{Lebegue measure}.
\end{definition}

\begin{lemma} \label{LebesgueOuterMeasureOuterMeasure}
The Lebesgue outer measure on $\R$ is an outer measure on $\R$.
\end{lemma}
\begin{proof}
We verify the three points in the definition of an outer measure:
\begin{itemize}
\item We have that $\emptyset \subseteq \interval[o]{0,\epsilon}$ for all $\epsilon > 0$, so  $0 = \inf\setbuilder{\epsilon}{\epsilon > 0} \geq \lambda^*(\emptyset) \geq 0$.
\item If $A\subseteq B$, then any cover of $B$ is a cover of $A$.
\item Let $\seq{A_n}$ be an arbitrary sequence in $\powerset(\Omega)$. If $\sum_{n\in\N}\lambda^*(A_n) = +\infty$, then subadditivity is necessarily satisfied. Now assume $\sum_{n\in\N}\lambda^*(A_n)$ is finite, then each $\lambda^*(A_n)$ is finite. Fix an arbitrary constant $\epsilon > 0$. We can find a $\seq{(a_{n,k},b_{n,k})}_{k\in\N}\in \mathfrak{I}$ that covers $A_n$ and is such that
\[ \sum_{k=0}^\infty(b_{n,k} - a_{n,k}) < \lambda^*(A_n) + \epsilon/2^n. \]
Now $\bigcup_{n\in \N}A_n$ is covered by $\seq{(a_{n,k},b_{n,k})}_{n,k\in\N}$ and
\[ \sum_{n,k \in\N} (b_{n,k} - a_{n,k}) < \sum_{n\in \N}(\lambda^*(A_n) + \epsilon/2^n) = \sum_{n\in \N}\lambda^*(A_n) + \epsilon. \]
Thus $\lambda^*\left(\bigcup_{n\in \N}A_n\right) \leq \sum_{n,k \in\N} (b_{n,k} - a_{n,k}) < \sum_{n\in \N}\lambda^*(A_n) + \epsilon$. Since $\epsilon > 0$ was taken arbitrarily, we have  $\lambda^*\left(\bigcup_{n\in \N}A_n\right) \leq \sum_{n\in \N}\lambda^*(A_n)$.
\end{itemize}
\end{proof}
\begin{corollary} \label{LebesgueMesaureIsMeasure}
The Lebesgue measure is a measure.
\end{corollary}

\begin{lemma}
Let $A\subseteq \R$ and $\seq{(a_n, b_n)}\in \mathfrak{I}$ such that $\seq{(a_n, b_n)}$ covers $A$. Then there exists $\seq{(a'_n, b'_n)}\in \mathfrak{I}$ such that
\begin{itemize}
\item for all $n\in \N$ there exists at most one $a_k$ such that $a_n < a_k < b_n$ and at most one $b_l$ such that $a_n < b_l < b_n$;
\item $\sum_{n\in \N}b'_n - a'_n \leq \sum_{n\in \N}b_n - a_n$;
\item $\seq{(a'_n, b'_n)}$ covers $A$.
\end{itemize}
\end{lemma}
TODO: improve tooling for this.
\begin{proof}
By induction first on the size of $\setbuilder{k\in \N}{a_n < a_k < b_n}$ and then on $n\in\N$. This can then be repeated for the $b_l$.

Sketch: suppose $a_n < a_{k_1}, a_{k_2} < b_n$. If $b_{k_1} \leq b_{n}$, then discard $(a_{k_1}, b_{k_1})$. If $b_n < b_{k_1}$, then replace $a_{k_2}$ by some point
\end{proof}

\begin{lemma} \label{intervalsLebesgueMeasurable}
Take $a\leq b\in \R$. Then the intervals
\begin{enumerate}
\item $\interval[c]{a,b}, \interval[o]{a,b}, \interval[co]{a,b}, \interval[oc]{a,b}$;
\item $\interval[co]{a,+\infty}, \interval[o]{a,+\infty}$;
\item $\interval[oc]{-\infty,b}, \interval[o]{-\infty,b}$
\end{enumerate}
are all Lebesgue measurable.
\end{lemma}
\begin{proof}
Since the set of Lebesgue measurable sets is a $\sigma$-algebra, by \ref{caratheodoryMeasurableAlgebra} and \ref{LebesgueOuterMeasureOuterMeasure}, it is enough to prove that $\interval[o]{a,+\infty}$ and $\interval[o]{-\infty,b}$ are Lebesgue measurable. We prove the first. The second is analogous.

Take arbitrary $A\subseteq \R$. By \ref{CaratheodoryMeasurableInequality}, it is enough to show that $\lambda^*(A) \geq \lambda^*\big(A \cap \interval[o]{a,+\infty}\big) + \lambda^*\big(A \cap \interval[oc]{-\infty, a}\big)$. If $\lambda^*(A) = \infty$, then we are done.

Now suppose $\lambda^*(A) < \infty$ and take arbitrary $\epsilon > 0$. We can find $\seq{(a_n,b_n)}\in\mathfrak{I}$ that covers $A$ and is such that $\sum_{n\in\N}b_n-a_n \leq \lambda^*(A)+ \epsilon$.

Now consider
\begin{align*}
C_1 &\defeq \setbuilder{(a_n, b_n)}{b_n \leq a}, \\
C_2 &\defeq \setbuilder{(a_n, b_n)}{a \leq a_n}, \\
C_3 &\defeq \setbuilder{(a_n, a+ \frac{\epsilon}{2^{n+1}})}{a_n < a < b_n} \\
C_4 &\defeq \setbuilder{(a, b_n)}{a_n < a < b_n}
\end{align*}
The $C_1\cup C_2\cup C_3\cup C_4$ is still countable and covers $A$. Also $C_1\cup C_3$ covers $A \cap \interval[o]{a,+\infty}^c$ and $C_2\cup C_4$ covers $A\cap \interval[o]{a,+\infty}$. So
\begin{align*}
\lambda^*\big(A \cap \interval[o]{a,+\infty}\big) + \lambda^*\big(A \cap \interval[oc]{-\infty, a}\big) &\leq \Big(\sum_{b_n\leq a}b_n - a_n + \sum_{a_n < a < b_n} a+ \frac{\epsilon}{2^{n+1}} - a_n\Big) + \Big(\sum_{a\leq a_n}b_n-a_n + \sum_{a_n < a < b_n}b_n - a\Big) \\
&= \sum_{n\in \N}b_n - a_n + \sum_{a_n < a < b_n} \frac{\epsilon}{2^{n+1}} \\
&\leq \sum_{n\in \N}b_n - a_n + \sum_{n\in \N} \frac{\epsilon}{2^{n+1}} \\
&= \sum_{n\in \N}b_n - a_n + \epsilon \\
&\leq \lambda^*(A) +2\epsilon.
\end{align*}
Since $\epsilon>0$ was taken arbitrarily, we have the necessary inequality.
\end{proof}

\begin{lemma}
Take $a\leq b\in \R$. Then
\[ \lambda^*\big(\interval[c]{a,b}\big) = \lambda^*\big(\interval[co]{a,b}\big) = \lambda^*\big(\interval[oc]{a,b}\big) = \lambda^*\big(\interval[o]{a,b}\big) = b-a. \]
The Lebesgue outer measure of any unbounded interval is $+\infty$.
\end{lemma}
\begin{proof}
For all $\epsilon > 0$, we have $\interval{a,b} \subseteq \interval[o]{a-\epsilon, b+\epsilon}$, so $\lambda^*\big(\interval{a,b}\big)\leq b-a + 2\epsilon$. Since $\epsilon > 0$ was taken arbitrarly, we have $\lambda^*\big(\interval[c]{a,b}\big) \leq b-a$.

Since $\lambda^*$ is an outer measure, \ref{LebesgueOuterMeasureOuterMeasure}, we have
\[ \lambda^*\big(\interval[o]{a,b}\big) \leq \lambda^*\big(\interval[co]{a,b}\big) \leq \lambda^*\big(\interval[c]{a,b}\big) \leq b-a. \]
To conclude, we need to prove $b-a \leq \lambda^*\big(\interval[o]{a,b}\big)$. This follows from the following lemma.
\begin{lemma*}
Let $\seq{(a_n, b_n)}\in \mathfrak{I}$. If $a\leq b \in \R$ are such that $\seq{(a_n, b_n)}$ covers $\interval[o]{a,b}$. Then $b-a \leq \sum_{n\in\N}b_n - a_n$.
\end{lemma*}
\begin{proof}\renewcommand{\qedsymbol}{$\vdash$}
We prove this by induction on the number $k$ of $n\in\N$ such that $b_n > a_n$.

For the base case, suppose $k=1$. Then the unique pair $(a_n, b_n)$ such that $a_n\neq b_n$ must be such that $a_n \leq a$ and $b_n \geq b$. Thus $b-a \leq \sum_{n\in\N}b_n - a_n$.

Now suppose the lemma holds for $k$ and $\seq{(a_n, b_n)}\in \mathfrak{I}$ has $k+1$ distinct pairs. There exists $(a_m, b_m)$ among the distinct pairs such that $a_m\leq a$. Now the other $k$ distinct pairs cover $\interval[o]{b_m, b}$, so, using the induction hypothesis, we have
\begin{align*}
\sum_{n\in\N}b_n - a_n &= b_m - a_n + \sum_{n\in\N\setminus\{m\}}b_n - a_n \\
&\geq b_m - a + \sum_{n\in\N\setminus\{m\}}b_n - a_n \\
&\geq b_m - a + b - b_m = b-a.
\end{align*}
\end{proof}
In the previous, we can replace $\lambda^*\big(\interval[co]{a,b}\big)$ by $\lambda^*\big(\interval[oc]{a,b}\big)$, which also proves the equality for $\lambda^*\big(\interval[oc]{a,b}\big)$.

For the unbounded intervals, we can consider them as monotonic limits of bounded intergrals (which are measurable sets by \ref{intervalsLebesgueMeasurable}) and use \ref{premeasureChainContinuous}.
\end{proof}

\begin{proposition}
Let $\mathcal{B}$ be the Borel $\sigma$-algebra on $\R$ and $\mathcal{A}_{\lambda^*}$ the Lebesgue $\sigma$-algebra.

Then $\sSet{\R, \mathcal{A}_{\lambda^*}, \lambda}$ is the completion of $\sSet{\R, \mathcal{B}, \lambda}$.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\begin{example}
Cantor set: $\sSet{\R, \mathcal{B}, \lambda}$ is not complete.
\end{example}

\begin{proposition}
The Lebesgue measure (restricted to the Borel $\sigma$-algebra) is the only measure $\mu$ on the Borel $\sigma$-algebra such that $\mu([a,b]) = b-a$.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\begin{proposition}
The Lebesgue measure is regular.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\subsection{Pointwise algebras}
\begin{lemma} \label{equalAECongruence}
Let $\sSet{X, \mathcal{X}, \mu}$ be a measure space and $Y$ an $\Omega$-structure. Then the relation $\overset{\text{a.e.}}{=}$ on $(X\to Y)$ is a congruence on the pointwise algebra $(X\to Y)$.
\end{lemma}
\begin{proof}
Take $\omega\in\Omega$ and $x = \seq{(f_i,g_i)}_{i\in(0:\alpha(\omega))}$ a sequence in $(X\to Y)^2$ such that $f_i\mathrel{\overset{\text{a.e.}}{=}} g_i$ for all $i\in \big(0:\alpha(\omega)\big)$. Set $N_i \defeq \setbuilder{x\in X}{f_i(x)\neq g_i(x)}$. This is a null set for all $i\in\big(0:\alpha(\omega)\big)$.

We need to show that $\omega_{X\to Y}(\seq{f_i}_{i\in(0:\alpha(\omega))})\mathrel{\overset{\text{a.e.}}{=}}\omega_{X\to Y}(\seq{f_i}_{i\in(0:\alpha(\omega))})$. Let $N$ be the set $\setbuilder{x\in X}{\omega_{X\to Y}(\seq{f_i(x)}_{i\in(0:\alpha(\omega))}) \neq \omega_{X\to Y}(\seq{g_i(x)}_{i\in(0:\alpha(\omega))})}$.

Clearly $N\subseteq \bigcup_{i\in(0:\alpha(\omega))}N_i$. So $N$ is a null set by subadditivity.
\end{proof}

\section{Lebesgue integration}
\url{https://math.stackexchange.com/questions/2218114/theoretical-advantages-of-lebesgue-integration}
\url{https://math.stackexchange.com/questions/3202630/what-are-the-advantages-of-the-riemann-vs-lebesgue-integral}

We want to define an integral functional $I(f)$.

Riemann: $I(f) = \lim_n I_n(f)$

Lebesgue $I(f) = \lim_n I(f_n)$.


\subsection{Simple functions}
TODO order on function spaces

\begin{definition}
Let $\Omega$ be a set. A \udef{simple function} (or \udef{step function}) on $\Omega$ is a function with a range of finite cardinality.

Let $B$ be a set. We denote the subset of simple functions in $(\Omega\to B)$ by $\SF(\Omega,B)$
\end{definition}

TODO: should $\SF(\Omega, B)$ mean measurable simple function??

\begin{lemma}
Let $s:\Omega\to Y$ be a simple function into a vector space. Then $s$ can be written as
\[ s(x) = \sum_{\lambda \in s[\Omega]}\lambda\cdot \chi_{s^{-1}[\lambda]}(x). \]
Additionally for some $k\in\N$ we can write $s[\Omega] = \bigcup_{i=1}^k\{\lambda_i\}$ and $A_i = s^{-1}[\lambda_i]$. Then the $A_i$ form a partition of $\Omega$ and
\[ s(x) = \sum_{i=1}^k\lambda_i\cdot \chi_{A_i}(x). \]
This is known as the \udef{canonical form} of $s$. Conversely every function of this form is a simple function.
\end{lemma}

\begin{lemma}
Let $(\Omega, \mathcal{A})$ and $(Y, \mathcal{B})$ be measurable spaces such that $\mathcal{B}$ contains all singleton sets. Let $s:\Omega\to Y$ be a simple function.

Then $s$ is measurable \textup{if and only if} $s^{-1}[\lambda]\in\mathcal{A}$ for all $\lambda\in s[\Omega]$.

This is equivalent to saying the partition $\{A_i\}_{i=1}^k$ is a subset of $\mathcal{A}$.
\end{lemma}
\begin{proof}
The direction $\boxed{\Rightarrow}$ is clear, since $\mathcal{B}$ is assumed to contain all singleton sets.

For the $\boxed{\Leftarrow}$ direction, let $B\in \mathcal{B}$. Then
\[ s^{-1}[B] = \bigcup_{\lambda\in s[\Omega]}s^{-1}[B\cap \{\lambda\}], \]
which is a finite union of measurable sets.
\end{proof}

\begin{lemma}
Let $\Omega$ be a set, $G$ an abelian group and $s,t\in\SF(\Omega,G)$. If $s$ and $t$ have canonical forms
\[ s = \sum_{i=1}^k a_i\cdot\chi_{A_i} \qquad\text{and}\qquad t = \sum_{j=1}^l b_j\cdot\chi_{B_j}, \]
then $s+t$ has canonical form
\[ s+t = \sum_{i=1}^k\sum_{j=1}^l (a_i+b_j)\chi_{A_i}\chi_{B_j} = \sum_{i,j \in (1:k)\times(1:l)}(a_i+b_j)\chi_{A_i\cap B_j}. \]
\end{lemma}


\begin{proposition} \label{measurableFunctionPointwiseLimitSimpleFunctions}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and let $f:\Omega\to[0,+\infty]$ be a positive function. Then
\begin{enumerate}
\item there exists an increasing sequence of positive step functions $\seq{s_n}$ that converges point-wise to $f$;
\item if $f$ is measurable, then $\seq{s_n}$ can be taken to be a sequence of measurable simple functions.
\end{enumerate}
\end{proposition}
The converse is also true and is given by \ref{pointWiseConvergenceMeasurable}.
\begin{proof}
(1) If we can find an increasing sequence of positive step functions $\seq{t_n}$ that converges point-wise to $\id:[0,+\infty]\to[0,+\infty]$, then
\[ f = \id\circ f = \lim_{n\to\infty} t_n\circ f = \sup_{n\in\N}(t_n\circ f) \]
and so $s_n = t_n\circ f$ gives the sequence we are looking for. And we can find such a sequence $(t_n)$. For example
\[ t_n = n\charFunc{\interval[co]{n,+\infty}}+\sum_{k=1}^{n2^n}\frac{k-1}{2^n}\charFunc{\interval[co]{\frac{k-1}{2^n},\frac{k}{2^n}}}. \]

(2) We note that each $t_n$ is measureable, so $s_n = t_n \circ f$ is measurable if $f$ is measurable.
\end{proof}


\subsubsection{Integration of simple functions}
\begin{definition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and $Y$ a vector space. Let
\[ s:\Omega \to Y: x\mapsto \sum_{\lambda \in \im(s)}\lambda\cdot \chi_{s^{-1}[\lambda]}(x) = \sum_{i=1}^k\lambda_i\cdot\chi_{A_i}(x)  \]
be a measurable simple function. We define the \udef{integral} of $s$ over $\Omega$ w.r.t. $\mu$ as
\[ \int_\Omega s\diff{\mu} \defeq \sum_{\lambda \in \im(s)}\lambda\cdot \mu(s^{-1}[\lambda]) = \sum_{i=1}^k\mu(A_i)\cdot\lambda_j. \]
Using the convention that $0\times \infty = 0$. (TODO: clarify)

We call $s$ \udef{integrable} if the integral is finite (TODO clarify + below).

For any $E\in\mathcal{A}$ we also define the integral some measurable simple function $s:\Omega\to Y$ over $E$ by
\[ \int_E s \diff{\mu} \defeq \int_E s|_E \diff{\mu|_E}, \]
where the last integral is taken over the measure space $(E,\mathcal{A}',\mu|_{\mathcal{A}'})$ as defined in \ref{submeasurespace}.
\end{definition}

The integral can be seen as a map $\SF(\Omega,Y)\to \overline{Y}$, where $\overline{Y}$ is the Dedekind-MacNeille completion (TODO!).

\begin{lemma} \label{measureFromIntegralCharacteristicFunctions}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and $E\in\mathcal{A}$. Then
\[ \mu(E) = \int_\Omega \chi_E \diff{\mu}. \]
\end{lemma}

\begin{lemma} \label{simpleIntegralOverSubset}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $Y$ a vector space over $\F$, $E\in\mathcal{A}$ and $s:\Omega\to Y$ a measurable simple function. Then
\[ \int_E s \diff{\mu} = \int_\Omega s\cdot\chi_{E} \diff{\mu}. \]
\end{lemma}
\begin{proof}
We have
\begin{align*}
\int_E s \diff{\mu} &= \int_E s|_E \diff{\mu|_E}\\
&= \sum_{\lambda \in \im(s|_E)}\lambda\cdot \mu|_E\big(s|_E^{\preimf}(\lambda)\big) \\
&= \sum_{\lambda \in \im(s|_E)}\lambda\cdot \mu\big(s^{\preimf}(\lambda)\cap E\big) \\
&= 0 + \sum_{\lambda \in \im(s|_E)\setminus\{0\}}\lambda\cdot \mu\big(s^{\preimf}(\lambda)\cap E\big) \\
&= 0 + \sum_{\lambda \in \im(s\cdot \chi_E)\setminus\{0\}}\lambda\cdot \mu\big((s\cdot \chi_E)^{\preimf}(\lambda)\big) \\
&= 0\cdot \mu\big((s\cdot \chi_E)^{\preimf}(0)\big) + \sum_{\lambda \in \im(s\cdot \chi_E)\setminus\{0\}}\lambda\cdot \mu\big((s\cdot \chi_E)^{\preimf}(\lambda)\big) \\
&= \sum_{\lambda \in \im(s\cdot \chi_E)}\lambda\cdot \mu\big((s\cdot \chi_E)^{\preimf}(\lambda)\big) \\
&= \int_\Omega s\cdot\chi_E \diff{\mu}.
\end{align*}
\end{proof}


\begin{proposition} \label{integrationLinear} \label{integrationOrderPreserving}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and $Y$ a vector space over $\F$. Then
\begin{enumerate}
\item the integral is linear: $\forall c\in \F$ and $\forall s,t\in\SF(\Omega, Y)$:
\[ \int_\Omega (c\cdot s + t)\diff{\mu} = c\cdot \int_\Omega s\diff{\mu} + \int_\Omega t\diff{\mu}. \]
\end{enumerate}
If $Y$ is a normed space, then
\begin{enumerate} \setcounter{enumi}{1}
\item for all $s\in\SF(\Omega, Y)$:
\[ \int_\Omega \norm{s}\diff{\mu} \leq \norm{\int_\Omega s \diff{\mu}}; \]
\item if $E_1\subseteq E_2$ are events in $\mathcal{A}$, then
\[ \int_{E_1}\norm{s}\diff{\mu} \leq \int_{E_2}\norm{s}\diff{\mu}. \]
\end{enumerate} \setcounter{enumi}{3}
If $Y$ is an ordered space, then
\begin{enumerate}
\item if $s(x)\leq t(x)$ for all $x\in\Omega$, then
\[ \int_\Omega s\diff{\mu} \leq \int_\Omega t\diff{\mu}. \]
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $s,t$ have canonical forms
\[ s = \sum_{i=1}^k a_i\cdot\chi_{A_i} \qquad\text{and}\qquad t = \sum_{i=1}^k b_i\cdot\chi_{B_i}. \]
Then we calculate
\begin{align*}
\int_\Omega (c\cdot s + t)\diff{\mu} &= \sum_{i=1}^k\sum_{j=1}^l\mu(A_i\cap B_j)\cdot(c a_i + b_j) \\
&= c\sum_{i=1}^k\sum_{j=1}^l\mu(A_i\cap B_j)\cdot a_i +  \sum_{i=1}^k\sum_{j=1}^l\mu(A_i\cap B_j) \cdot b_j \\
&= c\sum_{i=1}^k\mu(A_i)\cdot a_i +  \sum_{j=1}^l\mu(B_j) \cdot b_j \\
&= c\int_\Omega s\diff{\mu} + \int_\Omega t\diff{\mu}.
\end{align*}

The property (2) is just the triangle inequality. The other properties can be proven in a similar fashion to (1).
\end{proof}

\begin{proposition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and $s:\Omega\to [0,+\infty[$ a measurable simple function. The map
\[ \nu:\mathcal{A}\to [0,+\infty]: E\mapsto \int_E s\diff{\mu} = \int_\Omega s\cdot \chi_E\diff{\mu} \]
defines a measure.
\end{proposition}
\begin{proof}
From the positive linearity of both measures and integration (\ref{measuresPositiveLinear}, \ref{integrationLinear}) it is enough to consider $s = \chi_A$ for some $A\in\mathcal{A}$. In this case
\[ \nu(E) = \int_\Omega\chi_A\chi_B \diff{\mu} = \int_\Omega\chi_{A\cap B} \diff{\mu} = \mu(A\cap E). \]
It is clear that $\nu(\emptyset) = 0$. For $\sigma$-additivity, let $(E_n)$ be a sequence of disjoint sets in $\mathcal{A}$ and calculate
\[ \nu\left(\biguplus_{n\in\N}E_n\right) = \mu\left(A\cap \biguplus_{n\in\N}E_n\right) = \mu\left(\biguplus_{n\in\N}(A\cap E_n)\right) = \sum_{n\in\N}\mu(A\cap E_n) = \sum_{n\in\N}\nu(E_n). \]
\end{proof}
\begin{corollary} \label{integralContinuousInDomain}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $s:\Omega\to[0,+\infty]$a measurable simple function and $(E_n)$ a converging sequence in $\mathcal{A}$. Then
\[ \lim_{n\to\infty}\int_{E_n}s\diff{\mu} = \int_{\lim_{n\to\infty} E_n}s\diff{\mu}. \]
\end{corollary}
\begin{proof}
Define the measure $\nu: E\mapsto \int_E s\diff{\mu}$. Then by TODO ref
\[ \lim_{n\to\infty}\int_{E_n}s\diff{\mu} = \lim_{n\to\infty}\nu(E_n) = \nu(\lim_{n\to\infty}E_n) =\int_{\lim_{n\to\infty}E_n}s\diff{\mu}. \]
\end{proof}

\subsection{Positive real functions}
\begin{definition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and let $f:\Omega\to[0,+\infty]$ be a positive measurable function. Define

We define the \udef{Lebesgue integral} of $f$ on $\Omega$ w.r.t. $\mu$ as
\[ \int_\Omega f \diff{\mu} \defeq \sup\setbuilder{\int_\Omega s \diff{\mu}}{s\in\SF(\Omega, \interval[co]{0,+\infty})\;\land\; s\leq f}. \]
We call $f$ \udef{integrable} when $\int_\Omega f \diff{\mu} < \infty$.
\end{definition}
For simple functions this definition corresponds to the previous one by \ref{integrationOrderPreserving}.

This definition a priori makes sense even when $f$ is not assumed to be measurable. However the integral has undesirable properties in this case, such as not being additive.

\begin{example}
If $\delta_x$ is the Dirac measure associated to a point $x\in\Omega$ in a measurable space, then
\[ \int_\Omega f \diff{\delta_x} = f(x). \]
\end{example}

\begin{lemma} \label{integralOverSubset}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $E\in\mathcal{A}$ and $f:\Omega\to \R^+$ a measurable function. Then
\[ \int_E f \diff{\mu} = \int_\Omega f\cdot\chi_{E} \diff{\mu}. \]
\end{lemma}
\begin{proof}
TODO follows from \ref{simpleIntegralOverSubset}
\end{proof}
\begin{corollary}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $E\in\mathcal{A}$ and $f:\Omega\to \R^+$ a measurable function. Then
\begin{enumerate}
\item $\int_\Omega f\diff{\mu} = \int_{\Omega\setminus E} f\diff{\mu}+\int_E f\diff{\mu}$.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{propertiesIntegralPositiveFunctions}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and let $f,g:\Omega\to[0,+\infty]$ be positive measurable functions. Then
\begin{enumerate}
\item if $f\leq g$, then $\int_\Omega f\diff{\mu} \leq \int_\Omega g\diff{\mu}$;
\item if $E_1\subseteq E_2$ are events in $\mathcal{A}$, then $\int_{E_1}f\diff{\mu} \leq \int_{E_2}f\diff{\mu}$;
\item \textup{(Beppo Levi's lemma)} if $(f_n)$  is an increasing sequence of positive functions that converges to $f$ point-wise, then $(\int_\Omega f_n\diff{\mu})_n$ is an increasing sequence and
\[ \lim_{n\to\infty}\int_\Omega f_n\diff{\mu} = \int_\Omega \lim_{n\to\infty}f_n\diff{\mu} = \int_\Omega f\diff{\mu}; \]
\item the integral is positive linear: $\forall c\geq 0$:
\[ \int_\Omega(cf+g)\diff{\mu} = c\int_\Omega f\diff{\mu} + \int_\Omega g\diff{\mu}; \]
\item if $\seq{E_n}_{n\in \N}$ is a sequence of pairwise disjoint events in $\mathcal{A}$, then
\[ \int_{\biguplus_{n\in \N}E_n}f\diff{\mu} = \sum_{n\in \N}\int_{E_n}f\diff{\mu}. \]
\end{enumerate}
\end{proposition}
\begin{proof}
(1) For all $s\in \SF(\Omega, \interval[co]{0,+\infty})$ we have that $s\leq f$ implies $s\leq g$.

(2) This follows from $f\cdot\chi_{E_1}\leq f\cdot\chi_{E_2}$ and \ref{simpleIntegralOverSubset}.

(3) That the sequence $(\int_\Omega f_n\diff{\mu})_n$ is increasing follows from point 1. For increasing sequences the limits are suprema, by monotone convergence \ref{sequenceMonotoneConvergence}. Also, for all $m\in\N$, we have $f_m\leq\sup_{n\in\N}f_n$, which implies, by point 1., that $\int_\Omega f_m\diff{\mu}\leq \int_\Omega \sup_{n\in\N}f_n\diff{\mu}$. So
\[ \lim_{n\to\infty}\int_\Omega f_n\diff{\mu} = \sup_{n\in\N}\int_\Omega f_n\diff{\mu} \leq \int_\Omega \sup_{n\in\N}f_n\diff{\mu} = \int_\Omega \lim_{n\to\infty}f_n\diff{\mu}. \]
For the other inequality, it is enough to prove that $c\int_\Omega s\diff{\mu} \leq \lim_{n\to\infty}\int_\Omega f_n\diff{\mu}$ for all $0<c<1$ and $s\in\SF(\Omega,[0,+\infty[)$ such that $s\leq f$. Fix such a $c$ and $s = \sum_{i=1}^k\lambda_i\chi_{A_i}$. Consider the sets
\[ E_n = \setbuilder{x\in\Omega}{cs(x)\leq f_n(x)} = \bigcup_{i=1}^k \left(f^{-1}_n[\,[c\lambda_i, +\infty]\,]\cap A_i\right). \]
Then $(E_n)$ is an increasing sequence in $\mathcal{A}$ with $\Omega= \bigcup_{n\in\N}E_n$ and
\[ c\int_\Omega s\diff{\mu} = \int_{\bigcup_n E_n} cs\diff{\mu} = \lim_{n\to\infty}\int_{E_n} cs\diff{\mu} \]
by \ref{integralContinuousInDomain}. Also 
\[ \int_{E_n} cs\diff{\mu} \leq \int_{E_n} f_n\diff{\mu} \leq \int_{\Omega} f_n\diff{\mu} \]
by the previous points and so the result follows from the fact that limits preserve inequalities, \ref{limitPreservesInequality}.

(4) Take sequences $(s_n)$ and $(t_n)$ of positive measurable step functions
that increase pointwise to $f$ and $g$, respectively. Then $cs_n+t_n$ converges pointwise to $cf+g$ by the linearity of the limit and
\begin{align*}
\int_\Omega(cf+g)\diff{\mu} &= \lim_{n\to\infty}\int_\Omega(cs_n+t_n)\diff{\mu} \\
&= \lim_{n\to\infty}\left(c\int_\Omega s_n\diff{\mu}+\int_\Omega t_n\diff{\mu}\right) \\
&= c\lim_{n\to\infty}\int_\Omega s_n\diff{\mu}+\lim_{n\to\infty}\int_\Omega t_n\diff{\mu} \\
&= c\int_\Omega f\diff{\mu} + \int_\Omega g\diff{\mu}.
\end{align*}

(5) We calculate
\begin{align*}
\sum_{n\in \N}\int_{E_n}f\diff{\mu} &= \lim_{n\to \infty} \sum_{i=0}^n \int_{E_i}f \diff{\mu} \\
&= \lim_{n\to \infty} \sum_{i=0}^n \int_{\Omega}f\cdot\charFunc{E_i} \diff{\mu} \\
&= \lim_{n\to \infty} \int_{\Omega}f\cdot \sum_{i=0}^n\charFunc{E_i} \diff{\mu} \\
&= \lim_{n\to \infty} \int_{\Omega}f\cdot \charFunc{\biguplus_{i=0}^nE_i} \diff{\mu} \\
&= \int_{\Omega}f\cdot \lim_{n\to \infty}\charFunc{\biguplus_{i=0}^nE_i} \diff{\mu} \\
&= \int_{\Omega}f\cdot \charFunc{\biguplus_{n\in \N}E_n} \diff{\mu} \\
&= \int_{\biguplus_{n\in \N}E_n}f \diff{\mu},
\end{align*}
using \ref{integralOverSubset}, the previous parts of this proposition and \ref{indicatorFunctionHomeomorphism}.
\end{proof}

\begin{proposition}[Fatou's lemma] \label{FatouLemma}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $\seq{h_n}$ any sequence of positive measurable functions in $(\Omega\to[0,+\infty])$. Then
\[ f: \Omega\to[0,+\infty]: x\mapsto \liminf_{n\to\infty}h_n(x) \]
is measurable and
\[ \int_\Omega \liminf_{n\to\infty}h_n\diff{\mu} \leq \liminf_{n\to\infty}\int_\Omega h_n\diff{\mu}. \]
\end{proposition}
\begin{proof}
Consider the sequence $\seq{f_n}$ defined by $f_n(x) = \inf_{k\geq n}h_k(x)$. This is an increasing sequence of positive functions and $f_n \leq h_n$ for all $n\in\N$. Each $f_n$ is measurable because
\[ f_n^{-1}[\,[t,+\infty]\,] = \bigcap_{k=n}^\infty h_k^{-1}[\,[t,+\infty]\,]. \]
This shows that $f$ is measurable by \ref{pointWiseConvergenceMeasurable}. Then we can use Beppo Levi's lemma \ref{propertiesIntegralPositiveFunctions} to obtain
\[ \int_\Omega\liminf_{n\to\infty}h_n\diff{\mu} = \lim_{n\to\infty}\int_\Omega f_n\diff{\mu} = \liminf_{n\to\infty}\int_\Omega f_n\diff{\mu} \leq \liminf_{n\to\infty}\int_\Omega h_n\diff{\mu} \]
using monotonicity of the integral \ref{propertiesIntegralPositiveFunctions} and liminf \ref{propertiesIntegralPositiveFunctions} for the last inequality.
\end{proof}

\begin{proposition} \label{functionPropertiesFromIntegral}
Let $\seq{\Omega, \mathcal{A}, \mu}$ be a measure space and $f:\Omega\to[0,+\infty]$ a positive measurable function. Then
\begin{enumerate}
\item $\int_\Omega f\diff{\mu} = 0$ \textup{if and only if} $f(x) = 0$ a.e.;
\item if $f$ is integrable, then $f(x)< +\infty$ a.e.\
\end{enumerate}
\end{proposition}
\begin{proof}(1) Set $E = \setbuilder{x\in\R}{f(x) \neq 0}$. Then $f(x) = 0$ a.e.\ is equivalent to $\mu(E) = 0$.

Assume $\mu(E) = 0$, then 
\[ \int_\Omega f\diff{\mu} = \int_{\Omega\setminus E} f\diff{\mu} + \int_E f\diff{\mu} = 0+\int_E f\diff{\mu} \leq \sup_{x\in E}(f(x)). \]
Now for all $s\in\SF(\Omega\to \interval[co]{0,+\infty})\cap \downset f$ we have
\[ 0\leq \int_E s \diff{\mu}\leq \max_x(s(x))\mu(E) = 0  \]
and so the supremum $\int_E f\diff{\mu}$ is zero as well.

Now assume $\int_\Omega f\diff{\mu} = 0$. Consider the sets $E_n = f^{-1}[\,]\frac{1}{n},+\infty]\,]$. Then $\frac{1}{n}\chi_{E_n}\in \downset f$ is simple. Hence $\frac{1}{n}\mu(E_n)\leq \int_\Omega f\diff{\mu} = 0$, meaning $\mu(E_n) = 0$ for all $n$. So $\mu(E) = \sup_{n\in\N}\mu(E_n) = 0$.

(2) Towards contraposition, assume the set $E = \setbuilder{x\in\R}{f(x) = +\infty}$ has non-zero measure. Then $a/\mu(E)\chi_E\in\SF(\Omega, \interval[co]{0,+\infty})\cap \downset f$ for all real $a>0$ and
\[  \int_\Omega f\diff{\mu} \geq \int_\Omega \frac{a\chi_E}{\mu(E)}\diff{\mu} = a  \]
so $f$ is not integrable.
\end{proof}

\subsubsection{Tonelli's theorem}

\begin{lemma} \label{tonelliLemma}
Let $\sSet{\Omega_1, \mathcal{A}_1,\mu_1}$, $\sSet{\Omega_2, \mathcal{A}_2, }$ be $\sigma$-finite measure spaces and $Q\in \mathcal{A}_1\otimes\mathcal{A}_2$. Then the section functions
\[ s_1^Q: \Omega_1 \to \overline{\R^+} :x \mapsto \mu_2(xQ) \qquad\text{and}\qquad s_2^Q: \Omega_2 \to \overline{\R^+} :y \mapsto \mu_1(Qy) \]
are measurable. Additionally, we have
\[ (\mu_1\otimes \mu_2)(Q) = \int_{\Omega_1}s_1^Q\diff{\mu_1} = \int_{\Omega_2}s_2^Q\diff{\mu_2}. \]
\end{lemma}
\begin{proof}
The functions are well-defined by \ref{setSectionMeasurable}.

We restrict our attention to $s_1^Q$. The case for $s_2^Q$ is similar. Fix arbitrary $x\in\Omega_1$.

If $Q = A_1\times A_2$ for some $A_1\in\mathcal{A}_1$ and $A_2\in\mathcal{A}_2$, then
\[ s_1^Q(x) = \mu_2\setbuilder{\omega\in\Omega_2}{(x,\omega)\in A_1\times A_2} = \left(\begin{cases}
\mu_2(\emptyset) & (x\notin A_1) \\
\mu_2(A_2) & (x\in A_1)
\end{cases}\right) = \mu_2(A_2)\cdot \chi_{A_1}(x), \]
so $s_1^Q$ is measurable and
\[ \int_{\Omega_1}s_1^Q\diff{\mu_1} = \int_{\Omega_1}\mu_2(A_2)\cdot \chi_{A_1}\diff{\mu_1} = \mu_1(A_1)\cdot\mu_2(A_2), \]
by \ref{measureFromIntegralCharacteristicFunctions}.

Set $\mathcal{C} = \setbuilder{A_1\times A_2}{A_1\in\mathcal{A}_1, A_2\in\mathcal{A}_2}$ let $\mathcal{D}$ be the set of $P\in\Omega_1\times\Omega_2$ such that $s_1^P$ is measurable and $(\mu_1\otimes \mu_2)(Q) = \int_{\Omega_1}s_1^Q\diff{\mu_1}$. We want to prove $\sigma(\mathcal{C}) \subseteq \mathcal{D}$. As $\mathcal{C}$ is a $\pi$-system, it is enough to show that $\mathcal{D}$ is a Dynkin system by the $\pi$-$\lambda$ theorem \ref{piLambdaTheorem}.
We verify:
\begin{itemize}
\item $\Omega_1\times\Omega_2\in\mathcal{D}$, because $\Omega_1\times\Omega_2 \in \mathcal{C}\subseteq \mathcal{D}$;
\item Take $P\in\mathcal{D}$. Fix some monotone sequence $\seq{B_n}_{n\in\N}$ in $\mathcal{A}_2$ of finite measure whose union is $\Omega_2$, as in \ref{sigmaFiniteSequences}. 

We calculate (TODO: fix calculation)
\begin{align*}
s_1^{P^c}(x) &= \mu_2(xP^c) = \mu_2\big((xP)^c\big) = \mu_2\bigg(\Big(\bigcup_{n\in\N} B_n\Big)\setminus xP\bigg) \\
&= \sup_{n\in\N}\mu_2\big(B_n\setminus xP\big) = \sup_{n\in\N}\Big(\mu_2(B_n) - \mu_2(B_n\cap xP)\Big) = \sup_{n\in\N}\Big(\mu_2(B_n) - s_1^P(x)\Big).
\end{align*}
As $s_1^P$ is measurable, $s_1^{P^c}$ is measurable by \ref{operationsOnRealMeasurableFunctions} and \ref{limitOperationsOnRealMeasurableFunctions}.

Now similarly fix some monotone sequence $\seq{C_n}_{n\in\N}$ in $\mathcal{A}_1$ of finite measure whose union is $\Omega_1$. TODO finish proof!!

\item If $\seq{P}_{n\in\N}\in\mathcal{D}^\N$ is a sequence of pairwise disjoint sets, then, by a calculation similar to the one in the proof of \ref{setSectionMeasurable}, we have
\[ s_1^{\biguplus_{n\in\N}P_n}(x) = \mu_2\Big(\biguplus_{n\in\N}xP_n\Big) = \sum_{n\in\N}s_1^{P_n}(x). \]
Thus $s_1^{\biguplus_{n\in\N}P_n}$ is measurable by \ref{infiniteSumMeasurable} and $\biguplus_{n\in\N}P_n\in\mathcal{D}$.
\end{itemize}
\end{proof}

\begin{theorem}[Tonelli's theorem] \label{tonellisTheorem}
Let $\sSet{\Omega_1, \mathcal{A}_1, \mu_1}$, $\sSet{\Omega_2, \mathcal{A}_2, \mu_2}$ be $\sigma$-finite measure spaces and $f: \Omega_1\times\Omega_2 \to \overline{\R^+}$ a measurable function. Then the functions
\[ x\mapsto \int_{\Omega_2}f(x,y)\diff{\mu_2(y)} \qquad\text{and}\qquad y\mapsto \int_{\Omega_1}f(x,y)\diff{\mu_1(x)} \]
are measurable. Also
\[ \int_{\Omega_1\times\Omega_2}f\diff{(\mu_1\otimes\mu_2)} = \int_{\Omega_2}\Big(\int_{\Omega_1}f(x,y)\diff{\mu_1(x)}\Big)\diff{\mu_2(y)} = \int_{\Omega_1}\Big(\int_{\Omega_2}f(x,y)\diff{\mu_2(y)}\Big)\diff{\mu_1(x)}. \]
\end{theorem}
\begin{proof}
Let $s: \Omega_1\times\Omega_2 \to \overline{\R^+}$ be a measurable simple function. Then $s(x,-)$ is a measurable (by \ref{partialApplicationMeasurable}) simple function and we have
\[ \int_{\Omega_2}s(x,y)\diff{\mu_2(y)}  = \sum_{\lambda\in\im\big(s(x,-)\big)}\lambda\cdot\mu_2(xs^{-1}(\lambda)). \]
Thus $x\mapsto \int_{\Omega_2}s(x,y)\diff{\mu_2(y)}$ is, by \ref{tonelliLemma}, a linear combination of measurable functions and thus measurable by \ref{operationsOnRealMeasurableFunctions}.

By \ref{measurableFunctionPointwiseLimitSimpleFunctions} we can approximate $f$ by an increasing sequence $\seq{s_n}$ of simple functions that converges to $f$ pointwise.

By Beppo Levi's lemma \ref{propertiesIntegralPositiveFunctions}, we have
\[ \int_{\Omega_2}f(x,y)\diff{\mu_2(y)} = \lim_{n\to\infty}\int_{\Omega_2}s_n(x,y)\diff{\mu_2(y)}, \]
which is a limit of measurable positive functions and thus measurable by \ref{limitOperationsOnRealMeasurableFunctions}.

Now we calculate, using \ref{tonelliLemma},
\begin{align*}
\int_{\Omega_2}\Big(\int_{\Omega_2}s(x,y)\diff{\mu_2(y)}\Big)\diff{\mu_1(x)} &= \sum_{\lambda\in\im\big(s(x,-)\big)}\lambda\cdot \int_{\Omega_2} \mu_2(xs^{-1}(\lambda)) \diff{\mu_1(x)} \\
&= \sum_{\lambda\in\im(s)}\lambda\cdot (\mu_1\otimes\mu_2)\big(s^{-1}(\lambda)\big) \\
&= \int_{\Omega_1\times\Omega_2}s \diff{(\mu_1\otimes
\mu_2)}.
\end{align*}
For the general case, we again argue using Beppo Levi's lemma \ref{propertiesIntegralPositiveFunctions}.
\end{proof}

\subsection{Complex functions}
Let $\Omega$ be a set and $f:\Omega \to \C$ a function.  Then we can uniquely decompose $f$ into $f= u+iv$ where $u,v: \Omega\to \R$. We can further decompose
\[ \begin{cases}
u = u^+ - u^- & \text{such that $u^+u^- = 0$} \\
v = v^+ - v^- & \text{such that $v^+v^- = 0$.}
\end{cases} \]

\begin{lemma}
If $\Omega $ carries a $\sigma$-algebra such that $f$ is measurable, then
\begin{enumerate}
\item $u^+,u^-,v^+,v^-$ are measurable;
\item $|f| = \sqrt{(u^+)^2+ (u^-)^2 + (v^+)^2 + (v^-)^2}$.
\end{enumerate}
\end{lemma}

\begin{definition}
Let $\sSet{\Omega, \mathcal{A},\mu}$ be a measure space. We say a measurable function $f: \Omega \to \C$ is \udef{integrable}, if $|f|:\Omega\to [0,\infty[$ is integrable. In this case we define the \udef{integral} of $f$ as
\[ \int_\Omega f\diff{\mu} = \int_\Omega u^+\diff{\mu} - \int_\Omega u^-\diff{\mu} + i\int_\Omega v^+\diff{\mu} - i\int_\Omega v^-\diff{\mu}. \]
The set of all integrable functions in $(\Omega \to \C)$ is denoted $\mathcal{L} ^1(\Omega,\mathcal{A},\mu)$ or $\mathcal{L} ^1(\mu)$.
\end{definition}

\begin{lemma}
Let $\sSet{\Omega, \mathcal{A},\mu}$ be a measure space and $f: \Omega \to \C$ a measurable function with decomposition $f = u^+ - u^- + i(v^+ -v^-)$. If $f$ is integrable, then $u^+, u^-, v^+$ and $v^-$ are integrable.
\end{lemma}
\begin{proof}
We have by \ref{propertiesIntegralPositiveFunctions}
\[ \int_\Omega u^+ \diff{\mu} = \int_\Omega \sqrt{(u^+)^2} \diff{\mu} \leq \int_\Omega \sqrt{(u^+)^2+ (u^-)^2 + (v^+)^2 + (v^-)^2} \diff{\mu} = \int_\Omega|f|\diff{\mu} < \infty. \]
The argument for $u^-,v^+$ and $v^-$ is similar.
\end{proof}

\begin{lemma}[Triangle inequality for integrals] \label{integralTriangleInequality}
Let  $\sSet{\Omega, \mathcal{A},\mu}$ be a measure space and $f: \Omega \to \C$ a integrable function. Then
\[ \Big| \int_\Omega f\diff{\mu} \Big| \leq \int_\Omega |f|\diff{\mu}. \]
\end{lemma}
\begin{proof}
We calculate
\begin{align*}
\Big| \int_\Omega f\diff{\mu} \Big| &= \Big| \int_\Omega f^+ - f^- \diff{\mu} \Big| \\
&= \Big| \int_\Omega f^+\diff{\mu} - \int_\Omega f^-\diff{\mu} \Big| \\
&\leq \Big| \int_\Omega f^+\diff{\mu}\Big| + \Big|\int_\Omega f^-\diff{\mu} \Big| \\
&= \int_\Omega f^+\diff{\mu} + \int_\Omega f^-\diff{\mu} \\
&= \int_\Omega |f|\diff{\mu}.
\end{align*}
\end{proof}

\begin{lemma} \label{finiteMeasureBoundedFunctionMeasurable}
Let $\sSet{\Omega, \mathcal{A},\mu}$ be a finite measure space and $f: \Omega \to \C$ a function such that $\sup_{x\in \Omega}|f(x)|<\infty$, then $f$ is integrable.
\end{lemma}
\begin{proof}
Set $\sup_{x\in \Omega}|f(x)| = k$. Then
\[ \int_\Omega |f|\diff{\mu} \leq \int_\Omega \underline{k}\diff{\mu} = k\mu(\Omega) < \infty, \]
by \ref{propertiesIntegralPositiveFunctions}.
\end{proof}


\begin{proposition}[Reverse Fatou lemma]
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space and $(h_n)$ any sequence of measurable functions that is dominated by a positive integrable function $g$ (i.e.\ $h_n\leq g$ for all $n\in\N$). Then
\[ f: \Omega\to[0,+\infty]: x\mapsto \limsup_{n\to\infty}h_n(x) \]
is measurable and
\[ \int_\Omega f\diff{\mu} \geq \limsup_{n\to\infty}\int_\Omega h_n\diff{\mu}. \]
\end{proposition}
\begin{proof}
By the corollary $g(x)<+\infty$ a.e.\ and so also $g-h_n<+\infty$ a.e. Applying Fatou's lemma \ref{FatouLemma} gives
\[ \int\liminf g-h_n \leq \liminf\int g-h_n\]
\end{proof}

\begin{theorem}[Dominated convergence] \label{dominatedConvergence}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $\seq{f_n}$ any sequence of real measurable functions in $(\Omega\to\R)$ that converges pointwise to a function $f$.

If there exists a positive integrable function $g$ such that $|f_n| \leq g$ for all $n\in \N$, then $f$ is integrable and
\[ \lim_{n\to \infty}\int_\Omega f_n \diff{\mu} = \int_\Omega f\diff{\mu}. \]
\end{theorem}
TODO: sufficiency of uniform continuity.
\begin{proof}
TODO
\end{proof}
\begin{corollary}[Bounded convergence theorem] \label{boundedConvergenceTheorem}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a finite measure space and $\seq{f_n}$ any sequence of real measurable functions that converges pointwise to a function $f$.
\end{corollary}
TODO: \url{http://mathonline.wikidot.com/summary-of-convergence-theorems-for-lebesgue-integration}


\begin{lemma} \label{continuityIntegralTwoParameterFunction}
$\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space, $\sSet{X,\xi}$ a sequential convergence space and $f: \Omega\times X \to \R$ a measurable function.

Suppose
\begin{itemize}
\item there exists an integrable $g\in\meas(\Omega, \overline{\R^+})$ such that $|f(\omega,t)| \leq g(\omega)$ for all $t$ and all $\omega\in \Omega$;
\item $f(\omega, -)$ is continuous for all $\omega\in\Omega$.
\end{itemize}
Then $x\mapsto \int_\Omega f(\omega, x)\diff{\mu}(\omega)$ is continuous.
\end{lemma}
\begin{proof}
Since $X$ is sequential, it is enough to show that $x\mapsto \int_\Omega f(\omega, x)\diff{\mu}(\omega)$ is sequentially continuous, by \ref{sequentialSpaceSequentialContinuity}. To that end, take a convergent sequence $\seq{x_n}\to x\in X$. Then $f(-, x_n)$ converges pointwise to $f(-,x)$ by assumption. Thus
\[ \lim_{n\to \infty} \int_\Omega f(\omega, x_n)\diff{\mu}(\omega) = \int_\Omega f(\omega, x)\diff{\mu}(\omega) \]
by the dominated convergence theorem \ref{dominatedConvergence}. This shows the sequential continuity of $x\mapsto \int_\Omega f(\omega, x)\diff{\mu}(\omega)$.
\end{proof}

\subsubsection{Fubini's theorem}
\begin{theorem}[Fubini's theorem]
Let $\sSet{\Omega_1, \mathcal{A}_1, \mu_1}$, $\sSet{\Omega_2, \mathcal{A}_2, \mu_2}$ be $\sigma$-finite measure spaces and $f: \Omega_1\times\Omega_2 \to \overline{\R}$ a measurable and integrable function. Then the functions
\[ x\mapsto \int_{\Omega_2}f(x,y)\diff{\mu_2(y)} \qquad\text{and}\qquad y\mapsto \int_{\Omega_1}f(x,y)\diff{\mu_1(x)} \]
are measurable and a.e. integrable. Also
\[ \int_{\Omega_1\times\Omega_2}f\diff{(\mu_1\otimes\mu_2)} = \int_{\Omega_2}\Big(\int_{\Omega_1}f(x,y)\diff{\mu_1(x)}\Big)\diff{\mu_2(y)} = \int_{\Omega_1}\Big(\int_{\Omega_2}f(x,y)\diff{\mu_2(y)}\Big)\diff{\mu_1(x)}. \]
\end{theorem}
Note that we require that $f: \Omega_1\times\Omega_2 \to \overline{\R}$ is measurable. For Tonelli's theorem, \ref{tonellisTheorem}, this is not necessary.
\begin{proof}
TODO!
\end{proof}

TODO Fubini for complex- (and vector-)valued functions.

\subsection{Bochner integration}
TODO: define Pettis-Gelfand integration by
\[ \inner{u, \int T(t)\diff{t} v} \defeq \int\inner{u,T(t)v}\diff{t} \]
??
This case Riemann?? Or only finite dim??



TODO: the Bochner integral is the unique extension of the integral of simple functions to the set of Bochner measurable functions???? (i.e.\ simple functions dense in Bochner space, with $L^1$ metric)
\begin{definition}
Let $(\Omega, \mathcal{A},\mu)$ be a measure space and $Y$ a normed vector space. Then a Bochner measurable function $f:\Omega\to Y$ is called \udef{Bochner integrable} if there exists a sequence of integrable simple functions $\seq{s_n}\subset\SF(\Omega,Y)$ such that
\[ \lim_{n\to\infty}\int_\Omega \norm{f-s_n}\diff{\mu} = 0. \]
Take such a sequence $\seq{s_n}$. The \udef{Bochner integral} of $f$ on $\Omega$ w.r.t. $\mu$ is defined as
\[ \int_\Omega f\diff{\mu} \defeq \lim_{n\to\infty}\int_\Omega s_n\diff{\mu}. \]
\end{definition}

TODO: show Riemann implies Bochner with same integral.

\begin{lemma}
The Bochner integral is well-defined: let $\seq{s_n},\seq{t_n}\in \prescript{\N}{}{\SF(\Omega,Y)}$ be sequences such that
\[ \lim_{n\to\infty}\int_\Omega \norm{f-s_n}\diff{\mu} = 0 = \lim_{n\to\infty}\int_\Omega \norm{f-t_n}\diff{\mu}.  \]
Then
\begin{enumerate}
\item the limits $\lim_{n\to\infty}\int_\Omega s_n\diff{\mu}$ and $\lim_{n\to\infty}\int_\Omega t_n\diff{\mu}$ exist;
\item $\lim_{n\to\infty}\int_\Omega s_n\diff{\mu} = \lim_{n\to\infty}\int_\Omega t_n\diff{\mu}$.
\end{enumerate}
\end{lemma}
\begin{proof}
TODO
\end{proof}

\begin{proposition}[Bochner integrability criterion] \label{BochnerIntegrabilityCondition}
Let $(\Omega, \mathcal{A},\mu)$ be a measure space and $Y$ a normed vector space.

A Bochner measurable function $f$ is Bochner integrable \textup{if and only if}
\[ \int_\Omega \norm{f} \diff{\mu} < \infty. \]
\end{proposition}
TODO: Bochner integrable iff strongly measurable and $\int_\Omega \norm{f} \diff{\mu} < \infty$.
\begin{proof}
TODO
\end{proof}

\begin{proposition}
Linearity and monotonicity.
\end{proposition}

\begin{theorem}[Hille's theorem] \label{HilleTheorem}
Let $(\Omega, \mathcal{A},\mu)$ be a measure space, $X,Y$ normed vector spaces and $T: X\not\to Y$ a closed operator. If $T\circ f$ is integrable, then
\[ \int_\Omega (T\circ f)\diff{\mu} = T\left(\int_\Omega f\diff{\mu}\right). \]
\end{theorem}
\begin{proof}
TODO
\end{proof}
\begin{corollary} \label{boundedOperatorUnderIntegral}
If $T$ is bounded, then $T\circ f$ is integrable and
\[ \int_\Omega (T\circ f)\diff{\mu} = T\left(\int_\Omega f\diff{\mu}\right). \]
\end{corollary}
\begin{proof}
TODO: show that $T\circ f$ is integrable!
\end{proof}

TODO Dominated convergence.

\begin{lemma} \label{pathIntegralContinuousOperator}
Let $X$ be a Banach space and $\Gamma$ a bounded Jordan curve in $\C$. Then $\oint_\Gamma\diff{z}: \Bounded(X)^\Gamma \to \Bounded(X)$ is a continuous linear operator (when $\Bounded(X)^\Gamma$ is equipped with the pointwise convergence).
\end{lemma}
\begin{proof}
TODO Bounded convergence theorem.
\end{proof}

\subsubsection{Weak and strong measurability}
TODO is Bochner measurable measurable with $Y$ given Borel $\sigma$-algebra?

A function $f:X\to B$ is called Bochner-measurable if it is equal $\mu$-almost everywhere to a function $g$ taking values in a separable subspace $B_{0}$ of $B$, and such that the inverse image $g^{-1}[U]$ of every open set $U$ in $B$ belongs to $\Sigma$. Equivalently, $f$ is limit $\mu$-almost everywhere of a sequence of simple functions. 

\begin{theorem}[Pettis measurability theorem]
Let $(\Omega, \mathcal{A},\mu)$ be a measure space and $Y$ a normed vector space. Then $f$ is strongly measurable \textup{if and only if} $f$ is weakly measurable and almost surely separably valued.
\end{theorem}

\subsubsection{Integration of bounded operators}
\begin{lemma} \label{integralBoundedOperator}
Let $X$ be a normed space and $(\Omega, \mathcal{A},\mu)$ a measure space. Let $T: \Omega \to \Bounded(X)$ be a function. If $T$ is integrable, then for all $x\in X$, $Tx$ is integrable and
\[ \left(\int_\Omega T\diff{\mu}\right)x = \int_\Omega Tx\diff{\mu}. \]
\end{lemma}
\begin{proof}
The evaluation map $\evalMap_x$ is linear and bounded by $\norm{x}$ for all $x\in X$, so we can use \ref{boundedOperatorUnderIntegral}.
\end{proof}



\section{Further topics}
TODO rename!

\subsection{Absolute continuity and mutual singularity}
\begin{definition}
Let $\mu,\nu$ be measures on the measurable space $(\Omega,\mathcal{A})$. We say
\begin{itemize}
\item $\nu$ is \udef{absolutely continuous} w.r.t. $\mu$ if $\mu(A)=0\implies \nu(A) = 0$ for all $A\in\mathcal{A}$;
\item $\mu$ and $\nu$ are \udef{mutually singular} if there exists a set $A\in\mathcal{A}$ with $\mu(A) = 0$ and $\nu(A^c) = 0$.
\end{itemize}
\end{definition}

\begin{theorem}[Radon-Nikodym]
Let $\mu,\nu$ be measures on the measurable space $(\Omega,\mathcal{A})$. Then $\nu$ is absolutely continuous w.r.t. $\mu$ \textup{if and only if} there exists a measurable function $f:\Omega\to\R$ (or $\C$?) such that
\[ \nu(A) = \int_\Omega f\cdot \chi_A \diff{\mu} \qquad \forall A\in\mathcal{A}. \]
The function $f$ is uniquely determined a.e.\ (w.r.t. $\mu$).
\end{theorem}

\subsection{Lebesgue decomposition}
\begin{theorem}[Lebesgue decomposition theorem]
Let $\mu, \nu$ be two measures on a measurable space $(\Omega, \mathcal{A})$. Then $\nu$ can be written uniquely as
\[ \nu = \nu_\text{ac} + \nu_\text{sing} \]
where $\mu$ and $\nu_\text{sing}$ are mutually singular and $\nu_\text{ac}$ is absolutely continuous w.r.t. $\mu$. 

\end{theorem}

\subsection{Convolution}
TODO Young's convolution inequality

\section{Duality in integration}
Distributions with kernels will be example.

\chapter{Integration}



\section{Real integrals}
\subsection{Riemann integrals}
\begin{definition}
Let
\end{definition}


\begin{definition}
Let consider the set
\[ \mathcal{E} \defeq \setbuilder{f: \interval{a,b}\to \R}{\text{$\im(f)$ is finite and, for all $r\in \R$, the set $f^\preimf(\{r\})$ is a finite union of intervals}} \]
and the funcional
\[ I : \mathcal{E} \to \R:  \]
\end{definition}






\chapter{Real Analysis}
Dual numbers

\section{Limits and convergence}
\subsection{Sequences and limits}
\begin{example}
Let $p\in\R$. Then
\[ \lim_{n\to\infty} n^p = \begin{cases}
+\infty & (p>0) \\
1 & (p=0) \\
0 & (p<0).
\end{cases} \]
Let $r\in\R$. Then
\[ \lim_{n\to\infty} r^n = \begin{cases}
+\infty & (r>1) \\
1 & (r=1) \\
0 & (-1<r<1) \\
\text{does not exist} & (r\leq -1).
\end{cases} \]
\end{example}

\begin{lemma} \label{sequenceWellFoundedIffNoDecreasingSubsequence}
Let $\seq{x_n}$ be a sequence in $\R$. Then $\im\seq{x_n}$ is well-founded \textup{if and only if} $\seq{x_n}$ does not have a strictly decreasing subsequence.
\end{lemma}
\begin{proof}
First assume $\seq{x_n}$ has a strictly decreasing subsequence $\seq{y_n}$. Clearly $\im\seq{y_n}$ cannot have a minimum and thus $\im\seq{x_n}$ is not well-founded.

Now assume $\im\seq{x_n}$ is not well-founded. Then there exists a subset $A\subseteq \im\seq{x_n}$ that does not have a minimum. Thus we can find a strictly decreasing sequence $\seq{x_{n_k}}$ in $A$.

Since $\seq{x_{n_k}}$ is strictly decreasing, each $n_k$ is distinct and we can find a monotone subsequence $\seq{n'_k}$ by \ref{injectiveSequenceNaturalNumbersMonotoneSubsequence}. Now $\seq{x_{n'_k}}$ is a strictly decreasing subsequence of $\seq{x_n}$.
\end{proof}

\begin{proposition} \label{monotoneSubsequenceRealSequence}
Every sequence in $\R$ has a monotone subsequence.
\end{proposition}
TODO: replace by \ref{existenceMonotoneSubsequenceConnexRelation}.
\begin{proof}
Let $\seq{x_n}$ be a sequence in $\R$. We need to show that $\seq{x_n}$ has either a monotonically inceasing or monotonically decreasing subsequence.

Assume $\seq{x_n}$ does not have a monotonically decreasing subsequence. Then it also does not have a strictly decreasing subsequence and by \ref{sequenceWellFoundedIffNoDecreasingSubsequence}, $\im\seq{x_n}$ is well-founded. We can now recursively construct a sequence of natural numbers $\seq{n_k}$:
\[ \begin{cases}
n_0 = \argmin_{k'\in \N}x_{k'} \\
n_{k+1} = \argmin_{k'> k}x_{k'}.
\end{cases} \]
Now the subsequence $\seq{x_{n_k}}_{k\in \N}$ is increasing.
\end{proof}
\begin{corollary}[Bolzano-Weierstrass]
Every bounded sequence in $\R$ has a convergent subsequence. 
\end{corollary}


\begin{proposition} \label{sequencesToExtrema}
Let $A\subseteq \R$. Then
\begin{enumerate}
\item there exists a monotonically increasing sequence $\seq{x_n}$ in $A$ such that $\lim_{n\to\infty}x_n = \sup A$;
\item there exists a monotonically decreasing sequence $\seq{y_n}$ in $A$ such that $\lim_{n\to\infty}y_n = \inf A$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $x_0$ be any element of $A$. Clearly $x_0\leq \sup A$. If $x_0 = \sup A$, we may take the constant sequence $\underline{x_0}$. Otherwise there exists an element of $A$ that is strictly larger than $x_0$. Let this be $x_1$. Repeat this process recursively using the axiom of dependent choice to obtain the required sequence (TODO relax to countable choice?).

(2) Dual to (1).
\end{proof}

\subsection{Upper and lower limits}
\begin{definition}
Consider the function $D: \R \to\powerset(\R): x\mapsto \interval[co]{x,\infty}$ and the directional convergences $\xi_D$ and $\xi_{D^\transp}$ w.r.t.\ $D$ and $D^\transp$. Let $\xi$ be the standard convergence on $\R$.
Then
\begin{itemize}
\item the initial convergence w.r.t.\ $\{\id_\R: \R\to \sSet{\R,\xi}, \id_\R: \R\to \sSet{\R,\xi_D}\}$ is called the \udef{lower limit convergence} on $\R$ and $\R$ equipped with this convergence is denoted $\R_{ll}$;
\item the initial convergence w.r.t.\ $\{\id_\R: \R\to \sSet{\R,\xi}, \id_\R: \R\to \sSet{\R,\xi_{D^\transp}}\}$ is called the \udef{upper limit convergence} on $\R$ and $\R$ equipped with this convergence is denoted $\R_{ul}$.
\end{itemize}
The space $\R_{ll}$ is also called the \udef{Sorgenfrey line}.
\end{definition}

\begin{proposition}
The spaces $\R_{ll}$ and $\R_{ul}$ are topological and we have
\begin{enumerate}
\item $\neighbourhood_{ll}(x) = \upset \setbuilder[\big]{\interval[co]{x,x+\epsilon}}{\epsilon > 0}$ and $\neighbourhood_{ul}(x) = \upset \setbuilder[\big]{\interval[oc]{x-\epsilon, x}}{\epsilon > 0}$;
\item $\topology_{ll}$ has a basis $\setbuilder[\big]{\interval[co]{a,b}}{a,b\in \R}$;
\item $\topology_{ul}$ has a basis $\setbuilder[\big]{\interval[oc]{a,b}}{a,b\in \R}$.
\end{enumerate}
\end{proposition}
\begin{proof}
Application of \ref{pretopologicalInitialConvergence}.
\end{proof}
\begin{corollary} \label{SorgenfreyLineC1}
Both $\R_{ll}$ and $\R_{ul}$ are $C1$, Fréchet-Urysohn and sequential.
\end{corollary}

\begin{lemma} \label{lowerLimitConvergenceDecreasingSubsequence}
Let $\seq{x_n}\subseteq \R_{ll}$ be a convergent sequence. Then $\seq{x_n}$ has a monotonically decreasing convergent subsequence.
\end{lemma}
\begin{proof}
Suppose $\seq{x_n} \overset{ll}{\longrightarrow} x$. By \ref{monotoneSubsequenceRealSequence} we know that $\seq{x_n}$ has either a monotonically increasing or a monotonically decreasing subsequence. We claim that any monotonically increasing subsequence of $\seq{x_n}$ has the constant sequence $\underline{x}$ as a subsequence.

Let $\seq{x'_n}$ be a monotonically increasing subsequence. We must have that $\seq{x'_n} \overset{ll}{\longrightarrow} x$. Then $\seq{x'_n}$ has a tail $\setbuilder{x'_k}{k \geq k_0}\subseteq \interval[co]{x,\infty}$. We claim that $\setbuilder{x'_k}{k \geq k_0} = \{x\}$. Indeed, suppose there exists $x'_m \in \setbuilder{x'_k}{k \geq k_0}$ such that $x'_m \neq x$, then $\setbuilder{x'_k}{k \geq m} \perp \interval[co]{x, (x'_m-x)/2}$ and $\seq{x'_n}$ does not converge.

We have shown that $\seq{x'_k}_{k\geq k_0}$ is the constant sequence $\underline{x}$.
\end{proof}

\begin{lemma} \label{monotoneContinuityImpliesContinuityRealDomain}
Let $\sSet{Y,\zeta}$ be a pretopological convergence space, $f: \R\to Y$ a function and $x\in \R$. Then $f$ is continuous at $x$ \textup{if and only if} for every monotone sequence $x_n\to x$ in $\R$, $f(x_n) \to f(x)$ in $Y$.
\end{lemma}
\begin{proof}
The direction $\Rightarrow$ is immediate.

For the other direction, it is enough to show that $f$ is sequentially continuous by \ref{FrechetUrysohnSequentialContinuity}. Take an arbitrary sequence $x_n\to x$ in $\R$. We use \ref{pretopologicalConvergenceDeterminedBySubsubsequence} to show $f(x_n) \to f(x)$. To that end, take an arbitrary subsequence $y = f\circ x\circ \varphi$, where $\varphi:\N\to \N$ is strictly increasing.

Now $x\circ \varphi$ has a monotone subsequence $x\circ \varphi\circ \varphi'$ by \ref{existenceMonotoneSubsequenceConnexRelation}. Then $f\circ x\circ \varphi\circ \varphi' \to f(x)$ by assumption and this is a subsequence of $y$. We conclude that $f(x_n) \to f(x)$.
\end{proof}

\section{Sequences}

\begin{proposition}[Fekete's subadditive lemma] \label{FeketesLemma}
Let $\seq{a_n}_{n\in \N}$ be a sequence of real numbers such that
\[ \forall n,m\in \N: \qquad a_{n+m} \leq a_n+a_m. \]
Then $\lim_{n\to \infty} \frac{a_n}{n} = \inf_{n\in\N}\frac{a_n}{n} \in \R\cup\{-\infty\}$.
\end{proposition}
\begin{proof}
Since
\[ \inf_{n\in\N}\frac{a_n}{n} \leq \liminf_{n\to\infty}\frac{a_n}{n} \leq \limsup_{n\to\infty}\frac{a_n}{n} \]
and $\lim_{n\to \infty} \frac{a_n}{n}$ exists if $\liminf_{n\to\infty}\frac{a_n}{n} = \limsup_{n\to\infty}\frac{a_n}{n}$, it is enough to prove that $\limsup_{n\to\infty}\frac{a_n}{n} \leq \inf_{n\in\N}\frac{a_n}{n}$.

Take arbitrary $d > \inf_{n\in\N}\frac{a_n}{n}$. Then there exists $m\in\N$ such that $\frac{a_m}{m} < d$. Each $n\in \N$ can be written as $n = km+l$ with $k\in \N$ and $0\leq l < m$ (thus $k = \frac{n-l}{m}$). Then
\[ a_n = a_{km+l} \leq ka_m + a_l \leq \frac{n-l}{m}a_m + a_l \leq n\frac{a_m}{m} + \Big|\frac{l}{m}a_m\Big| + a_l \leq n\frac{a_m}{m} + |a_m| + \max_{0\leq l < m}a_l, \]
so $\frac{a_n}{n}\leq \frac{a_m}{m} + \frac{|a_m| + \max_{0\leq l < m}a_l}{n}$. If we take $n \geq \frac{|a_m| + \max_{0\leq l < m}a_l}{d - \frac{a_m}{m}}$, then
\[ \frac{a_n}{n}\leq \frac{a_m}{m} + \frac{|a_m| + \max_{0\leq l < m}a_l}{n} \leq \frac{a_m}{m} + \Big(d - \frac{a_m}{m}\Big) = d. \]
Thus $\limsup_{n\to\infty}\frac{a_n}{n} \leq d$ for all $d> \inf_{n\in\N}\frac{a_n}{n}$ and so $\limsup_{n\to\infty}\frac{a_n}{n} \leq \inf_{n\in\N}\frac{a_n}{n}$.
\end{proof}

\section{Series}

\subsection{Convergence tests}
\url{https://en.wikipedia.org/wiki/Convergence_tests}

\subsubsection{Ratio test hierarchy}
\url{https://en.wikipedia.org/wiki/Ratio_test}
\subsubsection{Root test hierarchy}
\url{https://en.wikipedia.org/wiki/Root_test#Root_tests_hierarchy}

\begin{proposition}[Cauchy's criterion] \label{rootTest}
Let $\sum_{n=0}^\infty a_n$ be a positive series. Define the number
\[ C = \limsup_{n\to \infty}\sqrt[n]{a_n}. \]
Then
\begin{itemize}
\item if $C<1$, the series converges;
\item if $C>1$, the series diverges;
\item if $C=1$, the test is inconclusive.
\end{itemize}
\end{proposition}

\subsection{Types of series}
\subsubsection{Geometric series}
\begin{proposition}
Take $a,r\in \R$. Then
\[ \sum_{k=0}^{n-1}ar^k = \begin{cases}
a\left(\frac{1-r^n}{1-r}\right) & (r\neq 1) \\
an & (\text{otherwise}).
\end{cases} \]
\end{proposition}
\begin{corollary}
Take $a\in \R$ and $|r|<1$. Then
\[ \sum_{k=0}^\infty a r^k = \frac{a}{1-r}. \]
\end{corollary}

\subsubsection{Harmonic series and $p$-series}
\begin{proposition} \label{pseriesConvergence}
Take $p\in \R$. Then $\sum_{k=1}^\infty \frac{1}{k^p}$
\begin{enumerate}
\item converges if $p > 1$;
\item does not converge if $p\leq 1$.
\end{enumerate}
\end{proposition}



\section{Continuity}
\subsection{Uniform continuity}
\begin{lemma} \label{affineBoundUniformlyContinuousFunction}
Let $f: \interval[co]{0,+\infty}\to \R$ be a uniformly continuous function such that $f(0) = 0$ and $b > 0$. Then there exist $a\geq 0$ such that $|f(x)| \leq ax+b$ for all $x\in \interval[co]{0,+\infty}$.
\end{lemma}
Note that we can also apply this result if $f(0) \neq 0$, by first shifting $f$.
\begin{proof}
Set $\epsilon = b$ and take a corresponding $\delta$ in \ref{uniformContinuityMetricSpaces}. We claim that we can take $a = \frac{b}{\delta}$.

Take arbitrary $x\in \interval[co]{0,+\infty}$ and define $n \defeq \ceil{\frac{x}{\delta}}$ and $\delta' \defeq \frac{x}{n}$. We have $\delta' = \frac{x}{\ceil{x/\delta}} \leq \frac{x}{x/\delta} = \delta$.
\begin{align*}
|f(x)| &= |f(x) - f(0)| \\
&= \Big|\sum_{j= 1}^{n} f(j\delta') - f\big((j-1)\delta'\big) \Big| \\
&\leq \sum_{j= 1}^{n} \Big|f(j\delta') - f\big((j-1)\delta'\big) \Big| \\
&\leq n\cdot \epsilon = \ceil{\tfrac{x}{\delta}}b \leq \frac{b}{\delta}x + b.
\end{align*}
\end{proof}
\begin{corollary} \label{linearBoundUniformlyContinuousFunction}
Let $f: \interval[co]{0,+\infty}\to \R$ be a uniformly continuous function and $c > 0$. Then there exists $a\geq 0$ such that $|f(x)| \leq ax$ for all $x\in \interval[co]{c,+\infty}$.
\end{corollary}
\begin{proof}
Consider the function $f- \constant{f(0)}$, which goes through the origin. Then there exists $a_0 \geq 0$ such that $f(x) - f(0) \leq a_0 x + 1$ and thus $f(x) \leq a_0 x + 1 + f(0)$. We now claim that we can set $a = \frac{a_0c + 1 + f(0)}{c}$. Indeed,
\[ f(x) \leq a_0 x + 1 + f(0) \leq  a_0 x + \big(1 + f(0)\big)\frac{x}{c} = \frac{a_0c + 1 + f(0)}{c}x. \]
\end{proof}

\begin{example}
In general \ref{affineBoundUniformlyContinuousFunction} does not hold if we take $b=0$. For example, take $x^{1/3}$, which is uniformly continuous and $0^{1/3} = 0$. But it's derivative at $0$ goes to infinity, so it does not have a bound of the form $x^{1/3} \leq ax$.
\end{example}

\subsection{Upper and lower limits}
\begin{definition}
Consider the function $D: \R \to\powerset(\R): x\mapsto \interval[co]{x,\infty}$ and the directional convergences $\xi_D$ and $\xi_{D^\transp}$ w.r.t.\ $D$ and $D^\transp$. Let $\xi$ be the standard convergence on $\R$.
Then
\begin{itemize}
\item the initial convergence w.r.t.\ $\{\id_\R: \R\to \sSet{\R,\xi}, \id_\R: \R\to \sSet{\R,\xi_D}\}$ is called the \udef{lower limit convergence} on $\R$ and $\R$ equipped with this convergence is denoted $\R_{ll}$;
\item the initial convergence w.r.t.\ $\{\id_\R: \R\to \sSet{\R,\xi}, \id_\R: \R\to \sSet{\R,\xi_{D^\transp}}\}$ is called the \udef{upper limit convergence} on $\R$ and $\R$ equipped with this convergence is denoted $\R_{ul}$.
\end{itemize}
The space $\R_{ll}$ is also called the \udef{Sorgenfrey line}.
\end{definition}

\begin{proposition}
The spaces $\R_{ll}$ and $\R_{ul}$ are topological and we have
\begin{enumerate}
\item $\neighbourhood_{ll}(x) = \upset \setbuilder{\interval[co]{x,x+\epsilon}}{\epsilon > 0}$ and $\neighbourhood_{ul}(x) = \upset \setbuilder{\interval[oc]{x-\epsilon, x}}{\epsilon > 0}$;
\item $\topology_{ll}$ has a basis $\setbuilder{\interval[co]{a,b}}{a,b\in \R}$;
\item $\topology_{ul}$ has a basis $\setbuilder{\interval[oc]{a,b}}{a,b\in \R}$.
\end{enumerate}
\end{proposition}
\begin{proof}
Application of \ref{pretopologicalInitialConvergence}.
\end{proof}
\begin{corollary} \label{SorgenfreyLineC1}
Both $\R_{ll}$ and $\R_{ul}$ are $C1$, Fréchet-Urysohn and sequential.
\end{corollary}

\begin{lemma}
Let $\seq{x_n}\subseteq \R_{ll}$ be a convergent sequence. Then $\seq{x_n}$ has a monotonically decreasing convergent subsequence.
\end{lemma}
\begin{proof}
Suppose $\seq{x_n} \overset{ll}{\longrightarrow} x$.
\end{proof}

\begin{definition}
Let $f:A\subseteq\R\to\R$ be a function and $p$ a limit point of $A$. Then
\begin{itemize}
\item the \udef{left limit} of $f(x)$ as $x$ approaches $p$ is the limit of $f|_{A\cap]-\infty,p]}$ as $x\to p$, denoted
\[ \lim_{x\overset{<}{\to} p}f(x) \qquad \text{or} \qquad \lim_{x\to p^-}f(x); \]
\item the \udef{right limit} of $f(x)$ as $x$ approaches $p$ is the limit of $f|_{A\cap[p,+\infty[}$ as $x\to p$, denoted
\[ \lim_{x\overset{>}{\to} p}f(x) \qquad \text{or} \qquad \lim_{x\to p^+}f(x). \]
\end{itemize}
\end{definition}
\begin{lemma}
Let $f:A\subseteq\R\to\R$ be a function and $p$ a limit point of both $A\cap]-\infty,p]$ and $A\cap[p,+\infty[$. Then $\lim_{x\to p} f(x)$ exists if the left and right limit exist and are equal to each other. In this case
\[ \lim_{x\to p} f(x) = \lim_{x\to p^-} f(x) = \lim_{x\to p^+} f(x). \]
\end{lemma}

\subsection{Discontinuities}
If a function $f:A\subseteq\R\to\R$ is not continuous at $p$, then $p$ is a limit point of $A$ by \ref{continuityAtIsolatedPoint} and \ref{notLimitPointSingletonOpen}.
\begin{definition}
Let $f:A\subseteq\R\to\R$ be a function and $p\in A$ such that $f$ is not continuous at $p$. Then
\begin{itemize}
\item if $\lim_{x\to p}f(x)$ exists and is finite, we call $p$ a \udef{removable discontinuity};
\item if both $\lim_{x\to p^-}f(x)$ and $\lim_{x\to p^+}f(x)$ exist and are finite, but are different, we call $p$ a \udef{jump discontinuity};
\item if either $\lim_{x\to p^-}f(x)$ or $\lim_{x\to p^+}f(x)$ do not exist, we call $p$ an \udef{essential discontinuity}.
\end{itemize}
Removable and jump discontinuities are also called \udef{discontinuities of the first kind}. Essential discontinuities are also called \udef{discontinuities of the second kind}.
\end{definition}
TODO: should discontinuities of type 1/x be considered essential?

\subsubsection{Jump discontinuities}
\begin{proposition} \label{monotoneDiscontinuities}
Let $f$ be a monotone real-valued function on an interval $I$. Then all discontinuities are jump discontinuities.
\end{proposition}
\begin{theorem}[Darboux-Froda] \label{DarbouxFroda}
Let $f$ be a monotone real-valued function on an interval $I$. Then the set of discontinuities is at most countable.
\end{theorem}

TODO: intervals must be closed / open?? In \ref{monotoneDiscontinuities} and \ref{DarbouxFroda}.


\begin{definition}
Let $f$ be a real function. We define the \udef{difference operator}
\[ \Delta_{x_0}f \defeq \lim_{x\to x_0+} f(x) - \lim_{x\to x_0-} f(x) \]
\end{definition}

\subsection{Extreme and intermediate value theorems}
\begin{theorem}[Fermat's theorem] \label{fermatsTheorem}
Let $a<b\in \R$ and $f: \interval[o]{a,b}\to \R$ be a real function. If $c\in \interval[o]{a,b}$ is such that $f(c)$ is a maximum or a minimum in $\im(f)$ and $f$ is differentiable at $c$, then $f'(c) = 0$.
\end{theorem}
\begin{proof}
First assume $f(c)$ is a minimum. Then $f(c+h)-f(c) \geq 0$ for all $h\in \interval[o]{a-c, b-c}$, so
\[ \frac{f(c+n^{-1})-f(c)}{n^{-1}} \geq 0 \qquad\text{and}\qquad \frac{f(c-n^{-1})-f(c)}{-n^{-1}} \leq 0 \]
for all $n\in \N$ such that $n^{-1}\in \interval[o]{a-c, b-c}$ and $-n^{-1}\in \interval[o]{a-c, b-c}$. Taking both limits, we see that $f'(c) \geq 0$ and $f'(c) \leq 0$, so $f'(c) = 0$.

The case of $f(c)$ being a maximum is analoguous.
\end{proof}

\begin{theorem}[Extreme value theorem] \label{extremeValueTheorem}
Let $\sSet{X,\xi}$ be a convergence space, $f: X\to \R$ a continuous function and $A\subseteq X$ a non-empty compact subset. Then $f^\imf(A)$ has both a minimum and a maximum.
\end{theorem}
\begin{proof}
We have that $f^\imf(A)$ is compact by \ref{compactConstructions} and thus bounded by \ref{compactImpliesBounded}, which means that $f^\imf(A) \subseteq \interval{a,b}$ for some $a,b\in R$ by \ref{boundedSubsetsRealNumbers}.

Thus we have that $\sup f^{\imf}(A) = c \leq b$. We need to show that $c\in A$. We construct a sequence $\seq{x_n}$ as follows: for all $n\in \N$ we let $x_n$ be some element of $\ball(c, n^{-1})\cap f^{\imf}(A)$.

Each of these sets is non-empty. If one of them was empty for some $n$, then $c-n^{-1}$ would be an upper bound, which is a contradiction.

Clearly $\seq{x_n}$ converges to $c$ in $\R$. As $f^\imf(A)$ is closed by \ref{compactClosedSets} and \ref{metricConvergenceHausdorff}, we have $c\in f^\imf(A)$ and $f^{\imf}(A)$ reaches a maximum.

Similarly $f^{\imf}(A)$ reaches a minimum.
\end{proof}
\begin{corollary}[Rolle's theorem] \label{RollesTheorem}
Let $a<b\in \R$ and $f: \interval{a,b}\to \R$ be a continuous real function that is differentiable on $\interval[o]{a,b}$ such that $f(a) = f(b)$. Then there exists $c\in \interval[o]{a,b}$ such that $f'(c) = 0$.
\end{corollary}
\begin{proof}
We know that $f^{\imf}\big(\interval{a,b}\big)$ has both a maximum and a minimum ($\interval{a,b}$ is compact by \ref{closedRealIntervalCompact}). If $f(a) = f(b)$ is both the minimum and maximum, then for all $c\in \interval[o]{a,b}$, $f(c) = f(a) = f(b)$, so $f(c)$ is both the minimum and maximum, which means that $f'(c) = 0$ by \ref{fermatsTheorem}.

If $f(a) = f(b)$ is not both the minimum and maximum, then there exists another $c\in \interval{a,b}\setminus\{a,b\} = \interval[o]{a,b}$ such that $f(c)$ is either a minimum or a maximum. Then $f'(c) = 0$ by \ref{fermatsTheorem}.
\end{proof}

\begin{proposition}[Intermediate value theorem] \label{intermediateValueTheorem}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ a continuous real function. For all $y\in \interval{f(a), f(b)}$ there exists $c\in \interval{a,b}$ such that $f(c) = y$.
\end{proposition}
\begin{proof}
Follows from \ref{generalisedIntermediateValueTheorem} and \ref{connectedSubsetReals}.
\end{proof}
\begin{corollary} \label{extremaIntermediateValueTheorem}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ a real function. For all $y\in \interval{\inf\im(f), \sup\im(f)}$ there exists $c\in \interval{a,b}$ such that $f(c) = y$.
\end{corollary}
\begin{proof}
Both $\inf\im(f)$ and $\sup\im(f)$ are attained on the interval by \ref{extremeValueTheorem}, say at points $b,c\in \interval{a,b}$. We can then apply the intermediate value theorem 
\end{proof}
\begin{corollary} \label{continuousFunctionOnIntervalFixedPoint}
Let $a,b\in \R$ and $f:\interval{a,b}\to \interval{a,b}$ be a continuous function. Then $f$ has a fixed point.
\end{corollary}
Cfr. Brouwer fixed point theorem.
\begin{proof}
Consider the function $g: \interval{a,b} \to \R: x\mapsto x - f(x)$, which is continuous. By assumption $g(a) \leq 0$ and $g(b)\geq 0$ (since $f(a) \geq a$ and $f(b)\leq b$), so by the intermediate value theorem, there exists $x^* \in \interval{a,b}$ such that $0 = g(x^*) = x^* - f(x^*)$, so $f(x^*) = x^*$ and $x^*$ is a fixed point.
\end{proof}
The important assumption in \ref{continuousFunctionOnIntervalFixedPoint} is that the range is confined to the interval $\interval{a,b}$. A sort of converse is given by \ref{boundDerivativeAndFixedPointGivesRange}.

\subsection{Mean value theorem}

\begin{theorem}[Mean value theorem] \label{meanValueTheorem}
Let $a<b\in \R$ and $f: \interval{a,b}\to \R$ be a continuous real function that is differentiable on $\interval[o]{a,b}$. Then there exists $c\in \interval[o]{a,b}$ such that
\[f'(c) = \frac{f(b)-f(a)}{b-a}. \]
\end{theorem}
\begin{proof}
Define $g(x) = f(x) - x\frac{f(b)-f(a)}{b-a}$. Then
\begin{multline*}
g(a) = f(a) - a\frac{f(b)-f(a)}{b-a} = \frac{bf(a) - af(a)}{b-a} - a\frac{f(b)-f(a)}{b-a} = \\ \frac{bf(a)-af(b)}{b-a} = \frac{bf(a)-bf(b) + bf(b)-af(b)}{b-a} = \\ \frac{bf(b) - af(b)}{b-a} - \frac{bf(b) - bf(a)}{b-a} = f(b) - b \frac{f(b)-f(a)}{b-a} = g(b),
\end{multline*}
so we can apply Rolle's theorem \ref{RollesTheorem} to $g$. Thus there exists $c\in \interval[o]{a,b}$ such that $0 = g'(c) = f'(c) - \frac{f(b)-f(a)}{b-a}$. Thus $f'(c) = \frac{f(b)-f(a)}{b-a}$.
\end{proof}
\begin{corollary}
Let $a,b, M\in \R$ and $f:\interval{a,b}\to \R$ a function differentiable on $\interval[o]{a,b}$. If $|f'(x)| \leq M$ for all $x\in \interval[o]{a,b}$, then $f$ is Lipschitz continuous with Lipschitz constant $M$.
\end{corollary}

TODO: \url{https://ejde.math.txstate.edu/Volumes/2012/34/cakmak.pdf}

\begin{lemma} \label{boundDerivativeAndFixedPointGivesRange}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ be a continuous function that is differentiable on $\interval[o]{a,b}$. If $f$ has a fixed point and $0\leq f' \leq 1$ everywhere, then $\im(f)\subseteq \interval{a,b}$. 
\end{lemma}
\begin{proof}
Let $x^*\in \interval{a,b}$ be a fixed point, then $f(x^*) = x^* \in \interval{a,b}$. Take arbitrary $x\in \interval{a,b}\setminus\{x^*\}$. Then
\[ \frac{f(x) - x^*}{x - x^*} = \frac{f(x) - f(x^*)}{x - x^*} = f'(c) \]
for some $c\in \interval[o]{a,b}$ by the mean value theorem \ref{meanValueTheorem}. Thus $0\leq \frac{f(x) - x^*}{x - x^*} \leq 1$.

First assume $x^* \leq x$, so $x - x^* \geq 0$. Then $0 \leq f(x) - x^* \leq x - x^*$, so $x^* \leq f(x) \leq x$. Since $x^*, x\in \interval{a,b}$, we have $f(x)\in \interval{a,b}$.

Now assume $x\leq x^*$, so $x - x^* \leq 0$. Then $x - x^* \leq f(x) - x^* \leq 0$, so $x \leq f(x) \leq x^*$. Since $x^*, x\in \interval{a,b}$, we have $f(x)\in \interval{a,b}$.
\end{proof}

\subsection{Other results}
\begin{proposition}[Dini's theorem]
Let $X$ be a compact convergence space and $\seq{f_i:X\to \R}_{i\in I}\in \cont(X)^I$ a monotonically increasing net of real-valued, continuous functions on $X$. If $\seq{f_i}$ converges pointwise to some continuous function $f$, then $f_i \to f$ uniformy.
\end{proposition}
\begin{proof}
Fix some arbitrary $\epsilon > 0$. The set $U_i \defeq \setbuilder{x\in X}{f(x)-f_i(x) < \epsilon}$ is open for all $i\in I$. The collection of all $U_i$s (for some fixed $\epsilon$) is an open cover of $X$. Since $X$ is compact, there exists a finite set $F\subseteq I$ such that the corresponding set of $U_i's$ covers $X$. Let $k$ be an upper bound of $F$. By monotonicity, $U_k$ contains $U_i$ for all $i\in F$. Thus $U_k = X$. Thus for all $l \geq k$ and all $x\in X$ we have
\[ |f(x) - f_l(x)| \leq f(x) - f_k(x) < \epsilon. \]
This implies that the convergence $f_i\to f$ is uniform.
\end{proof}



\section{Integration}
\begin{lemma} \label{continuousRealFunctionIntegrable}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ be a continuous real function. Then $f$ is integrable.
\end{lemma}
\begin{proof}
By \ref{extremeValueTheorem}, $\im(f)$ has a minimum $m$ and maximum $M$.

Then $\max\big(\im(|f|)\big) = \max\{|m|, |M|\}<\infty$. Also $\interval{a,b}$ has measure $|b-a|<\infty$, so $f$ is measurable by \ref{finiteMeasureBoundedFunctionMeasurable}.
\end{proof}

\begin{proposition}[Mean value theorem for definite integrals] \label{meanValueTheoremIntegrals}
Let $a<b\in \R$ and $f:\interval{a,b}\to \R$ be a continuous real function. Then there exists $c\in \interval{a,b}$ such that
\[ \int_a^bf(x)\diff{x} = f(c)(b-a). \]
\end{proposition}
TODO in fact we can take $c\in \interval[o]{a,b}$
\begin{proof}
By the extreme value theorem, $f$ reaches both a minimum $m$ and a maximum $M$ on the interval. Then we have
\[ m(b-a) = \int_a^bm\diff{x} \leq \int_a^bf(x)\diff{x} \leq \int_a^bM\diff{x} = M(b-a) \]
and thus $(b-a)^{-1}\int_a^bf(x)\diff{x}$ lies between the extrema. By \ref{extremaIntermediateValueTheorem} there exists $c\in \interval{a,b}$ such that $f(c) = (b-a)^{-1}\int_a^bf(x)\diff{x}$.
\end{proof}


\subsection{Fundamental theorems of calculus}
\begin{theorem}[First fundamental theorem of calculus] \label{firstFundamentalTheoremCalculus}
Let $a\in \R,b\in \R\cup\{\infty\}$ and $f:\interval{a,b}\to \R$ be a continuous real function. Set
\[ F: \interval{a,b} \to \R: x\mapsto \int_a^x f(t) \diff{t}. \]
Then
\begin{enumerate}
\item $F$ is continuous on $\interval{a,b}$;
\item $F$ is differentiable on $\interval{a,b}$;
\item $F'(x) = f(x)$ for all $x\in \interval{a,b}$.
\end{enumerate}
\end{theorem}
\begin{proof}
For any $x,h\in \R$ such that $x, x+h\in \interval{a,b}$, we have
\[ F(x+h) - F(x) = \int_a^{x+h}f(t)\diff{t} - \int_a^{x}f(t)\diff{t} = \int_x^{x+h}f(t)\diff{t}. \]
By the mean value theorem for integrals, \ref{meanValueTheoremIntegrals}, we have $F(x+h) - F(x) = f(c_h)\cdot h$ for some $c_h\in \interval{x,x+h}$. In the limit $h\to 0$, we have $c_h\to x$ by the squeeze theorem and thus $f(c_h)\to f(x)$ by continuity of $f$. Thus
\[ \lim_{h\to 0}F(x+h) - F(x) = \lim_{h\to 0}f(c_h)\cdot h = f(x)\lim_{h\to 0}h = 0, \]
which implies that $F$ is continuous on $\interval{a,b}$.
Also
\[ f(x) = \lim_{h\to 0}f(c_h) = \lim_{h\to 0}\frac{F(x+h) - F(x)}{h} = F'(x). \]
\end{proof}
\begin{corollary} [Weak second fundamental theorem of calculus] \label{weakSecondTheoremCalculus}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ be a differentiable real function such that $f': \interval{a,b}\to \R$ is continuous. Then, for all $x\in \interval{a,b}$,
\[ f(x) = f(a) + \int_a^xf'(t)\diff{t}. \]
In particular $\int_a^bf'(t)\diff{t} = f(b)-f(a)$.
\end{corollary}
We can drop the hypothesis that $f'$ is continuous if we use the Kurzweil-Henstock integral. This strengthening is the second fundamental theorem of calculus \ref{secondFundamentalTheoremCalculus}.
\begin{proof}
The function $f'$ is integrable by \ref{continuousRealFunctionIntegrable}.
Set $g: \interval{a,b}\to \R: x\mapsto \int_a^xf'(t)\diff{t}$, which is differentiable by the first fundamental theorem and $g'(x) = f'(x)$ for all $x\in \interval[o]{a,b}$. Thus we can apply the means value theorem \ref{meanValueTheorem} to $f-g$, restricted to $\interval{a,x}$: there exists $c\in \interval[o]{a,x}$ such that
\[ \frac{(f-g)(x) - (f-g)(a)}{x-a} = (f-g)'(c) = 0. \]
This implies that $f-g$ is a constant function. In order to fix this constant, note that $g(a) = 0$, so $f(x) = f(a) + g(x) = f(a) + \int_a^xf'(t)\diff{t}$ and, in particular, $f(b) = f(a) + \int_a^bf'(t)\diff{t}$.
\end{proof}

\begin{note}
We can build intuition for the second fundamental theorem of calculus as follows:
\begin{itemize}
\item It is clear that it holds for straight lines $f(x) = kx$, i.e. $f(b)-f(a) = k(b-a) = \int_a^b f'(t)\diff{t}$.
\item For piece-wise straight functions, this generalises:
\begin{align*}
f(b) - f(a) &= \big(f(b) - f(x_n)\big) + \big(f(x_n) - f(x_{n-1})\big) + \ldots + \big(f(x_1) - f(a)\big) \\
&= \int_{x_n}^b f'(t)\diff{t} + \int^{x_n}_{x_{n-1}} f'(t)\diff{t} + \ldots + \int_a^{x_1} f'(t)\diff{t} \\
&= \int_a^b f'(t)\diff{t}.
\end{align*}
\item Differentiable functions can be approximated by piece-wise straight functions.
\end{itemize}
\end{note}

\begin{proposition} \label{integralPositiveFunctionContinuous}
Let $a,b\in \R$ and $f: \interval{a,b}\to \R^+$ be a positive integrable function. Then the function
\[ F: \interval{a,b} \to \R^+: x\mapsto \int_a^x f(t)\diff{t} \]
is continuous.
\end{proposition}
We do not assume $f$ continuous.
\begin{proof}
By \ref{monotoneContinuityImpliesContinuityRealDomain} it is enough to consider monotone sequences $\seq{x_n}$ in $\interval{a,b}$. First suppose $x_n\to x$ is an increasing sequence. Then $f\cdot \charFunc{\interval{a,x_n}}$ is an increasing sequence of positive functions that converges pointwise to $f\cdot \charFunc{\interval{a,x}}$. So, by \ref{integralOverSubset} and Beppo Levi's lemma \ref{propertiesIntegralPositiveFunctions},
\[ \lim_{n\to\infty} F(x_n) = \lim_{n\to\infty}\int_a^{x_n}f\diff{t} = \lim_{n\to\infty}\int_a^{b}f\cdot \charFunc{\interval{a,x_n}}\diff{t} = \int_a^{b}f\cdot \charFunc{\interval{a,x}}\diff{t} = \int_a^{x}f\diff{t} = F(x). \]

Now suppose $x_n\to x$ is a decreasing sequence, then $f\cdot\charFunc{\interval{x_n,b}}$ is an increasing sequence of positive functions. So, again by \ref{integralOverSubset} and Beppo Levi's lemma \ref{propertiesIntegralPositiveFunctions},
\[ \lim_{n\to\infty}\int_{x_n}^b f\diff{t} = \lim_{n\to\infty}\int_{a}^b f\cdot\charFunc{\interval{x_n, b}}\diff{t} = \int_a^b f\cdot \charFunc{\interval{x,b}}\diff{t} = \int_x^b f\diff{t} \]
and thus
\[ \lim_{n\to\infty} F(x_n) = \lim_{n\to\infty}\int_a^{x_n}f\diff{t} = \int_a^b f \diff{t} - \lim_{n\to\infty}\int_{x_n}^b f\diff{t} = \int_a^b f \diff{t} - \int_x^b f\diff{t} = \int_a^x f \diff{t} = F(x). \]
\end{proof}

\section{Henstock-Kurzweil integration}
\subsection{Tagged partitions and sums}
\begin{definition}
Let $a <  b\in \R$. A \udef{tagged partition} $P$ of $\interval{a,b}$ is a pair of sequences $(u,t)$, where $u\in \interval{a,b}^{n+1}$ and $t\in \interval{a,b}^{n}$ such that
\begin{itemize}
\item $a < u_0$ and $u_{n} < b$;
\item $u_{k} \leq u_{k+1}$ for all $k\in 0:n$.
\end{itemize}
If $u_{k} \leq t_k \leq u_{k+1}$ for all $k\in 0:n$, then we call the tagged partition \udef{confined}. If this requirement is not imposed, then we call the tagged partition \udef{free}.
\end{definition}

\subsubsection{Riemann sums}
\begin{definition}
Let $f: \interval[o]{a,b}\to \sSet{V,\xi}$ be a function to a convergence vector space $\sSet{V,\xi}$ and $P = (u,t)$ a tagged partition. Then the \udef{Riemann sum} $\sum_P f\Delta x$ is defined as
\[ \sum_P f\Delta x \defeq \sum_{k = 0}^{\len(t)}f(t_k)\big(u_{k+1} - u_{k}\big). \]
\end{definition}

\subsubsection{Stieltjes sums}
\begin{definition}
Let $f: \interval[o]{a,b}\to \sSet{V,\xi}$ be a function to a convergence vector space $\sSet{V,\xi}$, $g: \interval[o]{a,b}\to \F$ a scalar function and $P = (u,t)$ a tagged partition. Then the \udef{Stieltjes sum} $\sum_P f\Delta g$ is defined as
\[ \sum_P f \Delta g \defeq \sum_{k = 0}^{\len(t)}f(t_k)\Big(g\big(u_{k+1}\big) - g\big(u_{k}\big)\Big). \]
\end{definition}
Note that Riemann sums are special cases of Stieltjes sums.

\subsubsection{Integrals}
\begin{definition}
Let $a <  b\in \R$ and $f: \interval[o]{a,b}\to \sSet{V,\xi}$ be a function to a convergence vector space $\sSet{V,\xi}$. Let $\mathcal{P}$ be a filter of tagged partitions. Then $f$ is said to be \udef{$\mathcal{P}$-integrable} if
\[ \upset\Big(\sum_{(-)}f\Delta x\Big)^{\imf\imf}\big(\mathcal{P}\big)\qquad \text{converges in $V$.} \]
The limit is called the \udef{$\mathcal{P}$-integral}, denoted $\mathcal{P}-\int_a^b f\diff{x}$.
\end{definition}
If $\mathcal{P}$ is clear from the context, then we may also just write $\int_a^b f\diff{x}$.

Note that we only assume $f$ defined on $\interval[o]{a,b}$. If the function is in fact defined on $\interval{a,b}$, it has the same integral.

\subsubsection{Stieltjes integrals}
\begin{definition}
Let $a <  b\in \R$ and $f: \interval[o]{a,b}\to \sSet{V,\xi}$ be a function to a convergence vector space $\sSet{V,\xi}$. Let $\mathcal{P}$ be a filter of tagged partitions. Then $f$ is said to be \udef{$(\mathcal{P},g)$-Stieltjes-integrable} if 
\[ \upset\Big(\sum_{(-)}f\Delta g\Big)^{\imf\imf}\big(\mathcal{P}\big)\qquad \text{converges in $V$.} \]
The limit is called the \udef{$(\mathcal{P},g)$-Stieltjes-integral}, denoted $\mathcal{P}-\int_a^b f\diff{g}$.
\end{definition}

\subsubsection{Darboux partitions}
\begin{definition}
Let $f: \interval[o]{a,b}\to \R$ be a real function. We define \udef{Darboux partitions} as follows:
\begin{itemize}
\item A tagged partition $P = (u,t)$ is called an \udef{upper Darboux partition} for $f$ if $f(t_k) = \max_{t\in \interval{u_k, u_{k+1}}}f(t)$.
\item A tagged partition $P = (u,t)$ is called a \udef{lower Darboux partition} for $f$ if $f(t_k) = \min_{t\in \interval{u_k, u_{k+1}}}f(t)$.
\end{itemize}
\end{definition}
Note that Darboux partitions are confined.

\subsection{Gauges and Henstock-Kurzweil filters of partitions}
\begin{definition}
Let $\delta: \interval[o]{a,b}\to \interval[o]{0,+\infty}$ be a function, which we call a \udef{gauge}. We say the tagged partition $P = (u,t)$ is \udef{$\delta$-fine} if
\[ \forall k\in (0:n): \quad \interval{u_k, u_{k+1}} \subseteq \interval[o]{t_k-\delta(t_k), t_k+\delta(t_k)}. \]
\end{definition}
TODO: We are no longer assuming $u_0 = a$ and $u_{n} = b$, in fact forcing $u_0 > a$ and $u_n < b$. I don't think this changes anything, but I need to check.

Can we define a Henstock-Kurzweil uniform / Cauchy structure on the set of tagged partitions??

\begin{lemma} \label{smallerGaugeFunctionFinerPartition}
Let $a <  b\in \R$, $\delta_1, \delta_2: \interval{a,b}\to \interval[o]{0,+\infty}$ and $P = (u,t)$ a tagged partition. If $\delta_1 \leq \delta_2$ pointwise and $P$ is $\delta_1$-fine, then $P$ is $\delta_2$-fine.
\end{lemma}
\begin{proof}
With the assumptions, we have
\[ \forall k\in (0:n): \quad \interval{u_k, u_{k+1}} \subseteq \interval[o]{t_k-\delta_1(t_k), t_k+\delta_1(t_k)} \subseteq \interval[o]{t_k-\delta_2(t_k), t_k+\delta_2(t_k)}, \]
so $P$ is $\delta_2$-fine.
\end{proof}

\begin{lemma} \label{deltaFinePartitionWidthBound}
Let $a <  b\in \R$, $\delta: \interval{a,b}\to \interval[o]{0,+\infty}$ and $P = (u,t)$ a tagged partition. If $P$ is $\delta$-fine, then $0< u_{k+1}-u_k < 2\delta(t_k)$ for all $k\in 0:n$.
\end{lemma}

\begin{lemma}[Cousin's lemma] \label{cousinsLemma}
Let $a <  b\in \R$ and $\delta: \interval{a,b}\to \interval[o]{0,+\infty}$ be a function. Then there exists a $\delta$-fine confined tagged partition of $\interval{a,b}$.
\end{lemma}
\begin{proof}
Consider the set $\setbuilder[\big]{\interval[o]{p-\delta(p), p+\delta(p)}}{p\in \interval[o]{a,b}}$. This is an open cover of $\interval{a,b}$. Since $\interval{a,b}$ is compact by \ref{HeineBorel}, there exists a finite subcover $C$, by \ref{topologyCompactnessOpenCover}. Let the tag sequence $t$ by the sequence obtained by ordering $\setbuilder[\big]{p\in\interval[o]{a,b}}{\interval[o]{p-\delta(p), p+\delta(p)}\in C}$. Let $n$ be the length of this tag sequence.


For all $k\in (1:n)$, we have $t_{k+1}-\delta(t_{k+1}) < t_k + \delta(t_k)$, so we can take $u_{k} \in \interval[o]{t_{k+1}-\delta(t_{k+1}), t_k + \delta(t_k)}$. Setting $u_0 = a$ and $u_{n} = b$, we have that $(u,t)$ is a $\delta$-fine partition.
\end{proof}

\subsubsection{The McShane integral}

\subsubsection{The Henstock-Kurzweil integral}
TODO: for many results we do not need Banach space, only CVS.

\begin{definition}
We call
\[ \mathcal{HK} \defeq \upset \setbuilder[\big]{\{\text{$P$ is $\delta$-fine and confined}\}}{\delta: \interval[o]{a,b}\to \interval[o]{0,\infty}} \]
the \udef{Henstock-Kurzweil} filter of partitions.

The Henstock-Kurzweil integral is the integral associated to the Henstock-Kurzweil partition filter.

The Henstock-Kurzweil-Stieltjes integral is the Stieltjes-integral associated to the Henstock-Kurzweil partition filter.
\end{definition}

\begin{lemma}
Let $f: \interval[o]{a,b}\to X$ be a function to a Banach space. Then $f$ has at most one Henstock-Kurzweil integral.
\end{lemma}
\begin{proof}
Suppose $I_1,I_2$ are both Henstock-Kurzweil intergrals of $f$. Take arbitrary $\epsilon > 0$. Then there exist $\delta_1,\delta_2 \in \big(\interval{a,b}\to \interval[o]{0,\infty}\big)$ such that $\norm{I_1 - \sum_P f} < \epsilon$ for all $\delta_1$-fine partitions $P$ and $\norm{I_2 - \sum_Q f} < \epsilon/2$ for all $\delta_2$-fine partitions $Q$.

Take a tagged partition $P$ that is $\delta_1\wedge \delta_2$-fine. By \ref{smallerGaugeFunctionFinerPartition}, $P$ is both $\delta_1$-fine and $\delta_2$-fine. We then have
\[ \norm{I_1 - I_2} \leq \norm{I_1 - \sum_P f} + \norm{I_2 - \sum_P f} < \epsilon /2 + \epsilon /2 = \epsilon. \]
Since $\epsilon > 0$ was taken arbitrarily, we have $\norm{I_1 - I_2} = 0$ and so $I_1 = I_2$.
\end{proof}

\begin{lemma}
Let $A\subseteq \interval{a,b}$ be a measurable set. Then $\int_a^b \charFunc{A}(x)\diff{x} = \lambda(A)$.
\end{lemma}
\begin{proof}
TODO
\end{proof}

\begin{proposition}
Let $f: \interval[o]{a,b}\to X$ be a function to a Banach space. Suppose $f = 0$ a.e. Then $f$ is Henstock-Kurzweil integrable and $\int_a^b f\diff{x} = 0$.
\end{proposition}
TODO: make corollary of Bochner / Lebesgue integrable $\implies$ Henstock-Kurzweil integrable.
\begin{proof}
Let $E \defeq \setbuilder{x\in \interval[o]{a,b}}{f(x) \neq 0}$ and $E_n \defeq \setbuilder{x\in E}{n-1 \leq |f(x)| < n}$ for all $n \geq 1$. The sets $E_n$ are disjoint and have measure zero.

Take arbitrary $\epsilon > 0$. For each $n\geq 1$, choose an open set $O_n$ such that $E_n \subseteq O_n$ and $\mu(O_n) < \frac{\epsilon}{n2^n}$. Define a gauge function $\delta$ by
\[ \delta(x) = \begin{cases}
1 & (x\notin E) \\ \inf\big|x - O_n^c\big| & (x\in E_n).
\end{cases} \]
TODO (??)
\end{proof}

\begin{proposition}[Second fundamental theorem of calculus] \label{secondFundamentalTheoremCalculus}
Let $f: \interval[o]{a,b}\to X$ be a function to a Banach space. Suppose $f$ is differentiable a.e. Then $f'$ is Henstock-Kurzweil integrable and, for all $x\in \interval{a,b}$,
\[ \int_a^x f' \diff{x} = f(x) - f(a). \]
\end{proposition}
The conclusion also holds for the Lebesgue or Riemann integral, if we additionally assume that $f'$ is Lebesgue / Riemann integrable. These results are also somtimes called the ``Second fundamental theorem of calculus''.
\begin{proof}
TODO
\end{proof}

\subsubsection{Darboux integration}
\begin{definition}
upper-Darboux-Riemann-integral

upper-Darboux-Henstock-Kurzweil-Stieltjes integral

etc.
\end{definition}

\subsection{Riemann integration}
\begin{definition}
Let $f: \interval[o]{a,b}\to X$ be a function to a Banach space $X$ and $P = (u,t)$ a tagged partition. Then the \udef{Riemann sum} $\sum_P f$ is defined as
\[ \sum_P f \defeq \sum_{k = 0}^{\len(t)}f(t)\big(u_{k+1} - u_{k}\big). \]
A number $I\in \R$ is called the \udef{Riemann integral} of $f$ if
\[ \forall \epsilon >0: \exists \delta>0: \forall \,\text{$\constant{\delta}$-fine partitions}: \quad \norm{I - \sum_P f} < \epsilon. \]
We call $f$ \udef{Riemann integrable} if it has a Riemann integral.
\end{definition}
TODO: Compare with Darboux integral (with upper and lower sums)


Since the Riemann integral is the Henstock-Kurzweil integral, where we only consider constant gauges, we have
\begin{lemma}
Every Riemann integral is a Henstock-Kurzweil integral.
\end{lemma}


\begin{proposition} \label{continuousFunctionOnIntervalRiemannIntegrable}
Let $a,b\in \R$ and $f:\interval{a,b}\to X$ be a continuous function to a Banach space $X$. Then $f$ is Riemann integrable.
\end{proposition}
\begin{proof}
We have the $f$ is uniformly continuous by the Heine-Cantor theorem, \ref{HeineCantorTheorem}. TODO: proof naturally uses Darboux intergral. OR: with Cauchy net?



Consider the set $\big(\interval{a,b}\to \interval[o]{0,+\infty}\big)$, ordered pointwise. By Cousin's lemma \ref{cousinsLemma} (using choice), we can find a function $p$ that maps every $\delta: \interval{a,b}\to \interval[o]{0,+\infty}$ to a $\delta$-fine tagged partition $p(\delta)$. Let $s$ be the function that maps a tagged partition $P$ to the Riemann sum $\sum_P f$. Then we claim $s\circ p$ is a Cauchy net.
\end{proof}



\begin{example}
Let $f: \interval{0,1}\to \{0,1\}$ be the function that maps rational numbers to $0$ and irrational numbers to $1$. Then
\begin{itemize}
\item $f$ is not Riemann integrable. Suppose there were some value $I\in \R$ for the integral.

Take $\epsilon = 1/3$. Take arbitrary $\delta > 0$. Consider first the tagged partition $P = (u,t)$, where $u_k = k\delta$ for $k\in 0:\ceil{\delta^{-1}}$ and $t_k \in \interval[o]{u_k, u_{k+1}}\setminus \Q$.
Consider next the partition $Q = (u,t')$ with the same $u$ and $t'_k \in \interval[o]{u_k, u_{k+1}}\cap \Q$. 

Both $P$ and $A$ are $\constant{\delta}$-fine. We have $\sum_P f = 1$ and $\sum_Q f = 0$. Then
\[ 1 = \Big|\sum_P f - \sum_Q f\Big| \leq \Big|I - \sum_P f\Big| + \Big|I - \sum_Q f\Big|, \]
so either $\Big|I - \sum_P f\Big| > \epsilon$ or $\Big|I - \sum_Q f\Big| > \epsilon$. This implies that $I$ is not the value of the Riemann integral.
\item $f$ is Henstock-Kurzweil integrable with integral $1$. To prove this, take arbitrary $\epsilon > 0$. Let $n: \Q\to \N$ be an enumeration of $\Q$ and set $\delta: \interval{0,1}\to \R: x \mapsto \begin{cases}
1 & (x\notin \Q) \\ \frac{\epsilon}{2^{n(x)+2}} & (x\in \Q)
\end{cases}$. Let $P$ be a $\delta$-fine tagged partition. Then 
\begin{align*}
1 - \sum_P f &= \sum_{k=0}^{\len(t)}\big(1 - f(t_k)\big)(u_{k+1} - u_k) \\
&= \sum_{\substack{k\in 0:\len(u) \\ t_k\in \Q}}\big(1 - f(t_k)\big)(u_{k+1} - u_k) \\
&= \sum_{\substack{k\in 0:\len(u) \\ t_k\in \Q}}(u_{k+1} - u_k) \\
&\leq \sum_{\substack{k\in 0:\len(u) \\ t_k\in \Q}}2\delta(t_k) \\
&= \sum_{\substack{k\in 0:\len(u) \\ t_k\in \Q}}2\frac{\epsilon}{2^{n(t_k)+2}} \leq \sum_{n\in \N}\frac{\epsilon}{2^{n+1}} = \epsilon,
\end{align*}
where we have used \ref{deltaFinePartitionWidthBound}.
\end{itemize}
\end{example}

\begin{proposition}
Let $a<b\in \R$ and $f: \interval[o]{a,b}\to \R$ a bounded function. Then $f$ is Riemann integrable \textup{if and only if} the set of points at which $f$ is discontinuous has Lebesgue measure zero.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\subsubsection{Riemann-Stieltjes}

\begin{lemma} \label{rectanglePartitionedByMonotonicFunction}
Let $f: \R^+ \to \R^+$ be an invertible monotonic function and $a\in\R^+$. Then
\[ a\cdot f(a) = \int_0^a f(x)\diff{x} + \int_0^{f(a)} f^{-1}(y)\diff{y}. \]
\end{lemma}
\begin{proof}
We will be evaluating the integral $a\cdot f(a) = \iint_{(x,y)\in S}\diff{x}\diff{y}$, where $S = \setbuilder{(x,y)\in \R^2}{x\leq a, y\leq f(a)}$. To that end, note the partition
\begin{align*}
S &= \setbuilder{(x,y)\in S}{y\leq f(x)} \uplus \setbuilder{(x,y)\in S}{y > f(x)} \\
&= \setbuilder{(x,y)\in S}{y\leq f(x)} \uplus \setbuilder{(x,y)\in S}{x < f^{-1}(y)} \\
&\eqdef S_1 \uplus S_2.
\end{align*}
Then we can calculate
\begin{align*}
ab = \iint_{(x,y)\in S_1}\diff{x}\diff{y} + \iint_{(x,y)\in S_2}\diff{x}\diff{y} \\
\int_0^a\int_0^{f(x)}\diff{y}\diff{x} + \int_0^{f(a)}\int_0^{f^{-1}(y)}\diff{x}\diff{y} \\
\int_0^a\int_0^{f(x)}\diff{y}\diff{x} + \int_0^{f(a)}\int_0^{f^{-1}(y)}\diff{x}\diff{y} \\
\int_0^a f(x)\diff{x} + \int_0^{f(a)} f^{-1}(y)\diff{y}.
\end{align*}
\end{proof}

\subsection{Integrating rational functions}
We can integrate any fraction of polynomials. The integral can be simplified using the partial fraction decomposition \ref{partialFractionDecomposition}.

Quadratic polynomials can be rewritten by completing the square:
\[ ax^2 + bx+c = a\bigg(\Big(x+ \frac{b}{2a}\Big)^2 + \frac{4ac - b^2}{4a^2}\bigg). \]
If the quadratic polynomial is irreducible, then $\frac{4ac - b^2}{4a^2}$ is positive.
Then we only need to know the following integrals:
\begin{proposition}
Let $a,b\in \R$ and $k\geq 2$. Then
\begin{enumerate}
\item $\int \frac{1}{ax+b}\diff{x} = \ln|ax+ b|$;
\item $\int \frac{1}{(ax+b)^k}\diff{x} = \frac{1}{a(1-k)(ax+b)^{k-1}}$;
\item $\int\frac{1}{x^2 + a^2}\diff{x} = \frac{1}{a}\arctan\big(\frac{x}{a}\big)$;
\item $\int \frac{x}{x^2 + a^2}\diff{x} = \frac{1}{2}\ln(x^2 + a^2)$;
\item $\int \frac{1}{(x^2 + a^2)^k} \diff{x} = \frac{x}{2a^2(k-1)(x^2+a^2)^{k-1}}+\frac{2k-3}{2a^2(k-1)}\int \frac{1}{(x^2+ a^2)^{k-1}}\diff{x}$;
\item $\int \frac{x}{(x^2 + a^2)^k}\diff{x} = \frac{1}{2(1-k)(x^2+a^2)^{k-1}}$.
\end{enumerate}
\end{proposition}

\section{Differentiation}
\begin{proposition} \label{differentiationUnderIntegral}
Let $\sSet{X,\mathcal{A},\mu}$ be a measure space, $a,b\in \R$ and $f: X\times \interval{a,b}\to \C$ a function such that
\begin{itemize}
\item $f(-,t): X\to \C$ is integrable for all $t\in \interval{a,b}$;
\item $\pd{f(x,t)}{t}$ exists for almost all $x\in X$;
\item there exists an integrable function $g: X\to \overline{\R^+}$ such that $\left|\pd{f(x,t)}{t}\right| \leq g(x)$ for all $t\in \interval{a,b}$ and almost all $x\in X$.
\end{itemize}
Then $t\mapsto \int_X f(x,t)\diff{\mu}(x)$ is differentiable and
\[ \od{}{t}\int_X f(x,t)\diff{\mu}(x) = \int_X \pd{f(x,t)}{t}\diff{\mu}(x). \]
\end{proposition}
\begin{proof}
To show that $t\mapsto \int_X f(x,t)\diff{\mu}(x)$ is differentiable at $t_0\in \interval{a,b}$, consider the Newton quotient
\[ h(x,t) \defeq \frac{\int_X f(x,t)\diff{\mu}(x) - \int_X f(x,t_0)\diff{\mu}(x)}{t-t_0} = \int_X \frac{f(x,t) - f(x,t_0)}{t-t_0}\diff{\mu}(x). \]
We need to show that the limit $\lim_{t\to t_0} h(x,t)$ exists. By \ref{FrechetUrysohnSequentialContinuityAtAPoint} it is enough to verify that $\lim_{n\to \infty} h(x,t_n)$ exists for every sequence $\seq{t_n}$ that converges to $t$. Fix such a sequence arbitrarily.

By the mean value theorem for vector-valued functions, \ref{meanValueTheoremVectorFunctions}, $\left|\frac{f(x,t_n) - f(x,t_0)}{t_n-t_0}\right| \leq \Big|\left.\pd{f(x,t)}{t}\right|_{t_1}\Big|$ for some $t_1\in \interval{t_0,t_n}\cup \interval{t_n,t_0}$. Thus
\[ \left|\frac{f(x,t_n)-f(x,t_0)}{t_n-t_0}\right| \leq \sup_{t\in \interval{a,b}}\left|\pd{f(x,t)}{t}\right| \leq g(x). \]
By the dominated convergence theorem, \ref{dominatedConvergence}, we have that $\lim_{n\to \infty} h(x,t_n)$ exists and
\begin{align*}
\od{}{t}\int_X f(x,t)\diff{\mu}(x)\Big|_{t_0} &= \lim_{n\to \infty} h(x,t_n) \\
&= \lim_{n\to \infty}\int_X \frac{f(x,t_n) - f(x,t_0)}{t_n-t_0}\diff{\mu}(x) \\
&= \int_X \lim_{n\to \infty}\frac{f(x,t_n) - f(x,t_0)}{t_n-t_0}\diff{\mu}(x) \\
&= \int_X \pd{f(x,t)}{t}\diff{\mu}(x)\Big|_{t_0}.
\end{align*}
\end{proof}


\section{Inequalities}
\subsection{Based on mean value theorems}
\begin{proposition}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ be a differentiable real function such that $f': \interval{a,b}\to \R$ is continuous. Then
\[ 0 \leq \int_a^b|f(x)|\diff{x} - \left|\int_a^bf(x)\diff{x}\right| \leq \frac{(b-a)^2}{2}\max_{x'\in\interval{a,b}}|f'(x')|. \]
\end{proposition}
TODO: according to \url{https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.625.7106&rep=rep1&type=pdf}, we can improve the constant to $1/3$.
\begin{proof}
For all $x,c\in \interval{a,b}$, there exists $d\in\interval{a,b}$ such that
\[ |f(x)-f(c)| = |x-c|\,|f'(d)| \leq |x-c|\max_{x'\in \interval{a,b}}|f'(x')| \]
by the mean value theorem \ref{meanValueTheorem}, and the fact that $f'$ achieves its extrema by the extreme value theorem \ref{extremeValueTheorem}. Thus we have
\[ \int_a^b|f(x)|\diff{x} - |f(c)|(b-a) = \int_a^b|f(x)| - |f(c)|\diff{x} \leq \int_a^b|f(x) - f(x)|\diff{x}\leq \int_a^b|x-c|\diff{x}\max_{x'\in \interval{a,b}}|f'(x')|. \]
We can then calculate
\[ \int_a^b|x-c|\diff{x} = \frac{(c-a)^2}{2} + \frac{(c-b)^2}{2} = c^2 -ac-bc + \frac{a^2}{2} + \frac{b^2}{2}, \]
which, in function of $c$, is a parabola that has a maximum at either $a$ or $b$, so $\int_a^b|x-c|\diff{x}\leq \frac{(b-a)^2}{2}$. Finally we note that we can take $c$ such that $f(c) = \frac{1}{b-a}\int_a^bf(x)\diff{x}$ by \ref{meanValueTheoremIntegrals}. Putting everything together yields the result.
\end{proof}

\begin{lemma}
Let $a,b\in \R$ and $f:\interval{a,b}\to \R$ be a differentiable real function such that $f': \interval{a,b}\to \R$ is continuous. Then
\begin{enumerate}
\item $\max_{t\in \interval{a,b}}|f(t)| \leq \int_a^b \frac{|f(x)|}{b-a} + |f'(x)| \diff{x}$;
\item if $f(a) = f(b) = 0$, then $\max_{t\in \interval{a,b}}|f(t)| \leq \frac{1}{2}\int_a^b|f'(x)|\diff{x}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By \ref{meanValueTheoremIntegrals}, there exists $c\in \interval{a,b}$ such that $|f(c)| = \left|\int_a^b\frac{f(x)}{b-a}\diff{x}\right| \leq \int_a^b\frac{|f(x)|}{b-a}\diff{x}$.
For all $t\in \interval{a,c}$, we have, by \ref{weakSecondTheoremCalculus}, $f(c) = f(t) + \int_t^c f'(x)\diff{x}$, so
\[ |f(t)| \leq |f(c)| + \left|-\int_t^c f'(x) \diff{x}\right| \leq |f(c)| + \int_t^c |f'(x)|\diff{x} \leq |f(c)| + \int_a^b |f'(x)|\diff{x}. \]
For all $t\in \interval{c,b}$, we have $f(t) = f(c) + \int_c^t f'(x)\diff{x}$ and thus
\[ |f(t)| \leq |f(c)| + \left|\int_c^t f'(x) \diff{x}\right| \leq |f(c)| + \int_c^t |f'(x)|\diff{x} \leq |f(c)| + \int_a^b |f'(x)|\diff{x}. \]
Then we have
\[ \max_{t\in \interval{a,b}}|f(t)| \leq |f(c)| + \int_a^b |f'(x)|\diff{x} \leq \int_a^b\frac{|f(x)|}{b-a}\diff{x} + \int_a^b |f'(x)|\diff{x}. \]

(2) By \ref{weakSecondTheoremCalculus}, we have, for all $t\in \interval{a,b}$, $f(t) = \int_a^t f'(x) \diff{x}$ and $f(t) = -\int_t^b f'(x)\ diff{x}$, so
\[ 2|f(t)| = \left|\int_a^t f'(x) \diff{x}\right| + \left|\int_t^b -f'(x) \diff{x}\right| \leq \int_a^t|f'(x)|\diff{x} + \int_t^b |f'(x)|\diff{x} = \int_a^b |f'(x)|\diff{x}. \]
\end{proof}

\subsection{Jensen's inequality}
\begin{theorem}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a probability measure space, $f:\Omega\to \R$ a real measurable function and $\varphi:\R\to \R$ a convex function. Then
\[ \varphi\Big(\int_\Omega f \diff{\mu}\Big) \leq \int_\Omega \varphi\circ f \diff{\mu}. \]
\end{theorem}
It is important that $\mu(\Omega) = 1$.
\begin{proof}
Let $x_0 = \int_\Omega f \diff{\mu}$. Since $\varphi$ has a subdifferential $m$ at $x_0$ by \ref{existenceSubdifferential}, we have
\[ \varphi\big(f(x)\big) \geq \varphi(x_0) + m\big(f(x) - x_0\big). \]
Integrating over $x$ gives
\begin{align*}
\int_\Omega \varphi\circ f \diff{\mu} &\geq \int_\Omega\varphi(x_0)\diff{\mu} + \int_\Omega m\big(f(x) - x_0\big) \diff{\mu} \\
&= \varphi(x_0)\int_\Omega\diff{\mu} + m\Big(\int_\Omega f(x)\diff{mu} -\int_\Omega x_0 \diff{\mu}\Big) \\
&= \varphi(x_0) + m\Big(\int_\Omega f(x)\diff{mu} -x_0\Big) \\
&= \varphi(x_0) = \varphi\Big(\int_\Omega f \diff{\mu}\Big).
\end{align*}
\end{proof}

\subsection{Young's inequality}
TODO: compare (+use) Jensen's inequality.

\subsubsection{Hölder conjugates}
\begin{definition}
Two numbers $p,q\in \R^+$ are called \udef{Hölder conjugate} iff $p^{-1} + q^{-1} = 1$.
\end{definition}

\begin{lemma}
Let $p\in \R^+$. Then $p$ is Hölder conjugate to some $q\in \R^+$ \textup{if and only if} $p > 1$.
\end{lemma}

\begin{lemma} \label{HoelderConjugateEquivalents}
Let $p,q\in \R^+$. The following are equivalent:
\begin{enumerate}
\item $p$ and $q$ are Hölder conjugate (i.e.\ $p^{-1}+q^{-1} = 1$);
\item $p+q = pq$;
\item $(p-1)(q-1) = 1$;
\item $(p-1) = (q-1)^{-1}$;
\item $p = \frac{q}{q-1}$;
\item $q = \frac{p}{p-1}$;
\item $pq^{-1} = p-1$;
\item $qp^{-1} = q-1$.
\end{enumerate}
\end{lemma}

\subsubsection{Young's inequality}
\begin{theorem}
Let $a\in \R$ and $f: \interval{0,a}\to \interval{0,f(a)}$ be a strictly increasing continuous function such that $f(0) = 0$. Then
\[ xy \leq \int_0^x f(t)\diff{t} + \int_0^y f^{-1}(t)\diff{t} \]
for all $x\in \interval{0,a}$ and $y\in \interval{0,f(a)}$.
\end{theorem}
\begin{proof}/
Define the real function $g$ by
\[ g(x) \defeq \int_0^x f(t)\diff{t} + \int_0^{f(x)}f^{-1}(t)\diff{t} - xf(x). \]
Then $g$ is differentiable by \ref{firstFundamentalTheoremCalculus} and (TODO ref chain rule and product rule). The derivative is given by $g'(x) = 0$ for all $x\in \interval{0,a}$. Since $g(0) = 0$, we have $g(x) = 0$ for all $x\in\interval{0,a}$ by \ref{weakSecondTheoremCalculus}. Thus
\[ xf(x) = \int_0^x f(t)\diff{t} + \int_0^{f(x)}f^{-1}(t)\diff{t}. \]
Now we have
\begin{align*}
xy &= xf(x) - x\big(f(x)-y\big) \\
&= \int_0^x f(t)\diff{t} + \int_0^{y}f^{-1}(t)\diff{t} + \int_y^{f(x)}f^{-1}(t)\diff{t} - x\big(f(x)-y\big) \\
&= \int_0^x f(t)\diff{t} + \int_0^{y}f^{-1}(t)\diff{t} + \int_y^{f(x)}\big(f^{-1}(t) - x\big)\diff{t} \\
&\leq \int_0^x f(t)\diff{t} + \int_0^{y}f^{-1}(t)\diff{t},
\end{align*}
where the inequality follows from the fact that $\int_y^{f(x)}\big(f^{-1}(t) - x\big)\diff{t}$ is always positive: if $t \leq f(x)$, then $f^{-1}(t)\leq x$ and if $f(x)\leq t$, then $x\leq f^{-1}(t)$. Since either $y\leq f(x)$ or $f(x)\leq y$, the integral is positive in both cases.
\end{proof}
\begin{corollary}[Young's inequality] \label{YoungsInequality}
Let $p,q\in \R$ be such that $p>0, q>0$ and $p^{-1} + q^{-1} = 1$. Then for all $a,b \geq 0$, we have
\[ ab \leq \frac{a^p}{p} + \frac{b^q}{q}. \]
Equality holds \textup{if and only if} $b = a^{p-1}$.
\end{corollary}
\begin{proof}
TODO
\end{proof}
\begin{proof}[Proof using convexity of exponentiation]
If either $a=0$ or $b =0$, then the result is immediate. Now assume $a>0$ and $b>0$. Then
\begin{align*}
ab &= e^{\ln(ab)} \\
&= e^{\ln(a)+\ln(b)} \\
&= e^{p^{-1}p\ln(a)+q^{-1}q\ln(b)} \\
&= e^{p^{-1}\ln(a^p)+(1-p^{-1})\ln(b^q)} \\
&\leq p^{-1}e^{\ln(a^p)}+(1-p^{-1})e^{\ln(b^q)} \\
&= \frac{a^p}{p} + \frac{b^q}{q}.
\end{align*}
The inequality is due to the convexity of the exponentiation. It is an equality (TODO ref strict convexity) iff
\begin{align*}
\ln(b^q) = \ln(a^p) &\iff b^q = a^p \\
&\iff b = a^{pq^{-1}} = a^{p-1}.
\end{align*}
The last equality follows from \ref{HoelderConjugateEquivalents}.
\end{proof}
\begin{proof}[Geometric proof]
From \ref{HoelderConjugateEquivalents}, we have $(x\mapsto x^{p-1})^{-1} = y\mapsto y^{q-1}$. These functions are monotone (TODO ref).

We have either $a^{p-1}\leq b$ or $b\leq a^{p-1} \iff b^{q-1} \leq a$. If the second option holds, we swap $a$ with $b$ and $p$ with $q$.

Now we can calculate, using \ref{rectanglePartitionedByMonotonicFunction},
\begin{align*}
ab &= aa^{p-1} + a(b-a^{p-1}) \\
&= \int_0^a x^{p-1}\diff{x} + \int_0^{a^{p-1}} y^{q-1}\diff{y} + a(b-a^{p-1}) \\
&= \int_0^a x^{p-1}\diff{x} + \int_0^{a^{p-1}} y^{q-1}\diff{y} + \int_{a^{p-1}}^b a\diff{y} \\
&\leq \int_0^a x^{p-1}\diff{x} + \int_0^{a^{p-1}} y^{q-1}\diff{y} + \int_{a^{p-1}}^b y^{q-1}\diff{y} \\
&= \int_0^a x^{p-1}\diff{x} + \int_0^{b} y^{q-1}\diff{y} \\
&= \frac{a^p}{p} + \frac{b^q}{q}.
\end{align*}
TODO picture.

We clearly have equality iff $a^{p-1} = b$.
\end{proof}

\section{Non-standard analysis}
\url{http://www.lightandmatter.com/calc/}

\begin{proposition}
Let $f:\R\to\R$ be a real function. Then $f$ is continuous at $x\in\R$ \textup{if and only if} for all infinitesimal $\delta$ there exists an infinitesimal $\epsilon$ such that
\[ f(x+\delta) = f(x) + \epsilon. \]
Alternatively we can state this as
\[ f(x+\delta) \approx f(x) \]
for all infinitesimal $\delta$.
\end{proposition}

Clearly continuity is a requirement for differentiability: if $f(x+\delta) - f(x)$ is not infinitesimal, then $\frac{f(x+\delta) - f(x)}{\delta}$ will not be finite.

\begin{lemma} \label{chainLemma}
Let $f:\R\to\R$ be a real function and $y:\R\to\R$ a continuous function. Assume $f$ differentiable at $y_0\in\im(y)$. Consider $f$ as depending on $y$ and $y$ as depending on $x$. Then
\[ \left.\dod{f}{y}\right|_{y_0} = \st\left(\frac{\Delta_y f}{\Delta y}\right) = \st\left(\frac{\Delta_x f\circ y}{\Delta_x y}\right). \]
\end{lemma}
\begin{proof}
We calculate, setting $y_0 = y(x_0)$ and using continuity of $y$,
\begin{align*}
\st\left(\frac{\Delta_x f\circ y}{\Delta_x y}\right) &= \st\left(\frac{f(y(x_0+\Delta x)) -f(y(x_0))}{y(x_0+\Delta x) - y(x_0)}\right) = \st\left(\frac{f(y(x_0)+\delta) -f(y(x_0))}{y(x_0)+\delta - y(x_0)}\right) \\
&= \st\left(\frac{f(y(x_0)+\delta) -f(y(x_0))}{\delta}\right) = \left.\dod{f}{y}\right|_{y_0}.
\end{align*}
\end{proof}

\begin{proposition}[Chain rule]
Let $y,f$ be real functions, differentiable at points $x_0$ and $y_0=y(x_0)$, respectively. Then
\[ \left.\dod{f}{y}\right|_{y_0} \left.\dod{y}{x}\right|_{x_0} = \left.\dod{f\circ y}{x}\right|_{x_0}. \]
\end{proposition}
\begin{proof}
We calculate, using \ref{chainLemma},
\[ \left.\dod{f}{y}\right|_{y_0} \left.\dod{y}{x}\right|_{x_0} = \st\left(\frac{\Delta_y f}{\Delta y}\frac{\Delta_x y}{\Delta x}\right) = \st\left(\frac{\Delta_x f\circ y}{\Delta_x y}\frac{\Delta_x y}{\Delta x}\right) = \st\left(\frac{\Delta_x f\circ y}{\Delta x}\right) = \left.\dod{f\circ y}{x}\right|_{x_0}. \]
\end{proof}

\chapter{Asymptotic analysis and perturbation theory}
\section{Bachmann-Landau notation}
\subsection{Asymptotic bounds: $O, \Theta, \Omega$}
\begin{definition}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions. The statement
\begin{itemize}
\item ``$f(x) = O(g(x))$ as $x\to x_0$'' means there exists a neighbourhood $S$ of $x_0$ and a constant $M\in\R$ such that
\[ \forall x\in S:\; f(x) \leq Mg(x); \]
\item ``$f(x) = \Omega(g(x))$ as $x\to x_0$'' means there exists a neighbourhood $S$ of $x_0$ and a constant $M\in\R$ such that
\[ \forall x\in S:\; f(x) \geq Mg(x); \]
\item ``$f(x) = \Theta(g(x))$ as $x\to x_0$'' means there exists a neighbourhood $S$ of $x_0$ and constants $M_1,M_2\in\R$ such that
\[ \forall x\in S:\; M_1g(x) \leq f(x) \leq M_2g(x). \]
\end{itemize}
We may add the word ``uniformly'' to these statements to mean we can take $S=X$.

We may suppress the $x$ dependence for legibility and write e.g\ $f = O(g)$ instead.
\end{definition}

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions. Then
\begin{enumerate}
\item $f = O(g)$ \textup{if and only if} $g = \Omega(f)$ as $x\to x_0$;
\item $f = \Theta(g)$ \textup{if and only if} $f = O(g)$ and $f = \Omega(g)$ as $x\to x_0$.
\end{enumerate}
\end{lemma}

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f: X\setminus\{x_0\}\to \R^+$ be functions. Then ``being $\Theta(f)$ as $x\to x_0$'' is an equivalence relation.
\end{lemma}

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions. Then
\begin{enumerate}
\item $f(x) = O(g(x))$ as $x\to x_0$ \textup{if and only if} there exists a neighbourhood $S$ of $x_0$ such that $f(x)/g(x)$ is bounded on $S$;
\item $f(x) = \Omega(g(x))$ as $x\to x_0$ \textup{if and only if} there exists a neighbourhood $S$ of $x_0$ such that $f(x)/g(x)$ is bounded below on $S$ by a strictly positive constant.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{asymptoticsBoundedFunctionNormedSpaces}
Let $X,Y$ be normed vector spaces and $A: V\to W$ a linear function. Then $A$ is bounded \textup{if and only if} $\norm{Ax} = O(\norm{x})$.
\end{lemma}

\subsection{Asymptotic domination and equivalence: $o,\sim,\omega$}

TODO: relationship to multiplicative uniform structure: $f \sim g$ iff $(f,g)$ preserves to uniformity when mapping from the product uniformity to the group uniformity of $\sSet{\R\setminus\{0\}, \cdot, 1}$.

\begin{definition}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R$ be functions. The statement
\begin{itemize}
\item ``$f(x) = o(g(x))$ as $x\to x_0$'' or ``$f \ll g$ as $x\to x_0$'' means $\lim_{x\to x_0} \frac{f(x)}{g(x)} = 0$;
\item ``$f(x) \sim g(x)$ as $x\to x_0$'' or ``$f(x) \sim_{x_0} g(x)$'' means $\lim_{x\to x_0} \frac{f(x)}{g(x)} = 1$;
\item ``$f(x) = \omega(g(x))$ as $x\to x_0$'' means $\lim_{x\to x_0} \frac{f(x)}{g(x)} = \infty$.
\end{itemize}
\end{definition}
TODO: here we do not take the codomain to be $\R^+$? Make uniform?

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions. Then $f = o(g)$ implies $f = O(g)$.
\end{lemma}

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g, h: X\setminus\{x_0\}\to \R^+$ be functions. If $f = o(h)$ and $g = o(h)$, then $f+g = O(h)$.
\end{lemma}

\begin{lemma}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions.

Then $f = o(g)$ \textup{if and only if} $g = \omega(f)$ as $x\to x_0$.
\end{lemma}

\begin{lemma}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$ and $f: X\setminus\{x_0\}\to \R^+$ be a function. Then $f \nsim_{x_0} 0$.
\end{lemma}
In other words, there is no function such that $f\sim 0$. In particular $0\nsim 0$.

\begin{lemma} \label{asymptoticEquivalenceLemma}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R^+$ be functions. Then
\begin{enumerate}
\item $f\sim_{x_0} g \iff (f-g)\in o(g)$ as $x\to x_0$;
\item $\sim_{x_0}$ is an equivalence relation on functions that are non-zero near $x_0$;
\item $f \sim_{x_0} g \implies f = \Theta(g)$ as $x\to x_0$;
\item every $\sim_{x_0}$ equivalence class contains at most one constant function.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{asymptoticTransitivity}
Let $(X,\mathcal{T})$ be a topological space. Let $x_0 \in X$ and $f,g, h,k: X\setminus\{x_0\}\to \R^+$ be functions. Then
\begin{enumerate}
\item if $f = o(h)$ and $g = O(k)$, then $fg = o(hk)$ as $x\to x_0$;
\item if $f = O(h)$ and $g = O(k)$, then $fg = O(hk)$ as $x\to x_0$;
\item if $f = O(h)$ and $h = o(k)$, then $f = o(k)$ as $x\to x_0$;
\item if $f = o(h)$ and $h = o(k)$, then $f = o(k)$ as $x\to x_0$.
\end{enumerate}
\end{lemma}
In particular, (1) implies that if $\norm{f(x)} = o(\norm{x})$, then $\norm{(A\circ f)(x)} = o(\norm{x})$. (Cfr. \ref{asymptoticsBoundedFunctionNormedSpaces}).

We can restate (4) as saying that $\ll$ is transitive: $f\ll h$ and $h \ll k$ imply $f \ll k$.

\begin{lemma} \label{asymptoticEquivalenceImpliesSameLimits}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$ and $f,g: X\setminus\{x_0\}\to \R$ be functions. If $f \sim g$ at $x_0$, then $\lim_{x\to x_0} f(x)$ exists iff $\lim_{x\to x_0} g(x)$ exists and these limits are the same.
\end{lemma}
\begin{proof}
We have
\[ \lim_{x\to x_0} f(x) = \lim_{x\to x_0} \frac{f(x)}{g(x)}\cdot g(x) = \lim_{x\to x_0} \frac{f(x)}{g(x)}\cdot \lim_{x\to x_0} g(x) = \lim_{x\to x_0} g(x), \]
so the result follows by continuity of the multiplication.
\end{proof}

\begin{lemma}
Let $a<b \in \R$ and $c > 0$. Then
\begin{enumerate}
\item $x^a \ll x^b$ as $x\to \infty$;
\item $x^b \ll x^a$ as $x\to 0$;
\item $e^{cx} \gg x^a$ as $x\to \infty$ and $e^{-cx} \ll x^a$ as $x\to \infty$;
\item $1 \ll \ln(x) \ll x^c$ as $x\to \infty$;
\item $1 \ll \ln(x) \ll x^{-c}$ as $x\to 0$.
\end{enumerate}
\end{lemma}

\begin{proposition} \label{asymptoticEquivalenceQuotient}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$ and $f,g,h,k: X\setminus\{x_0\}\to \R$ be functions. If $f \sim h$ and $g\sim k$ as $x\to x_0$, then
\begin{enumerate}
\item $\displaystyle \frac{f(x)}{g(x)} \sim \frac{h(x)}{k(x)}$ as $x\to x_0$;
\item $\displaystyle \lim_{x\to x_0}\frac{f(x)}{g(x)} = \lim_{x\to x_0}\frac{h(x)}{k(x)}$, if either limit holds.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We calculate
\[ 1 = \frac{1}{1} = \frac{\lim_{x\to x_0}f(x) / h(x)}{\lim_{x\to x_0}k(x) / g(x)} = \lim_{x\to x_0}\frac{f(x) / h(x)}{k(x) / g(x)}.  \]

(2) By \ref{asymptoticEquivalenceImpliesSameLimits}.
\end{proof}
\begin{example}
This gives a simple way to evaluate certain limits. For example, we immediately see that
\[ \lim_{x\to \infty}\frac{x^3 + 3x^2 - 2x +1}{3x^3 + 2x^2 -5x} = \lim_{x\to \infty}\frac{x^3}{3x^3} = 3. \]
This would have taken three applications of L'Hôpital's rule.
\end{example}

\begin{lemma} \label{limitOperationsAsymptoticNotation}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$, $h: X\setminus\{x_0\}\to \R$, $f,g: A\subseteq \im(h) \to \R$ and $a\in \R\setminus\{0\}$. Then
\begin{enumerate}
\item $h(x) \sim a$ as $x\to x_0$ \textup{if and only if} $\lim_{x\to x_0}h(x) = 0$;
\item $h(x) = o(1)$ as $x\to x_0$ \textup{if and only if} $\lim_{x\to x_0}h(x) = 0$;
\item if $f(x)\sim g(x)$ as $x\to 0$ and $h(x) = o(1)$ as $x\to x_0$, then $(f\circ h)(x) \sim (g\circ h)(x)$ as $x\to x_0$;
\item if $f = o(g)$ as $x\to 0$ and $h(x) = o(1)$ as $x\to x_0$, then $f\circ h = o(g\circ h)$.
\end{enumerate}
\end{lemma}
So we have (1) if $h$ converges to a non-zero value. This cannot be generalised to include the case $a=0$, since we always have $h \nsim 0$. The case $a=0$ is covered by point (2).
\begin{proof}
(1), (2) are restatements of the definition.

(3) By (2), we have $h(x) \to 0$ and so $\frac{f\big(h(x)\big)}{g\big(h(x)\big)} \to 1$.

(4) Similar to (3).
\end{proof}

\begin{lemma}
Let $\sSet{X,\xi}$ be a convergence space. Let $x_0 \in X$, $f,g: X\setminus\{x_0\}\to \R^+$ be functions and $a\in \R$. Assume $f \ll \constant{1}$ as $x\to x_0$. Then $\ln\big(1+f(x)\big) \sim f(x)$ as $x\to x_0$.
\end{lemma}
\begin{proof}
We have $\ln(1+x) \sim x$ as $x\to 0$, so the result follows from \ref{limitOperationsAsymptoticNotation}.
\end{proof}

\subsubsection{Preservation of asymptotic equivalence}
\begin{definition}
Let $h: A\to \R$ be a real function. We say $h$ \udef{preserves asymptotic equivalence} if, for all functions $f, g: X \to A$ from a convergence space $\sSet{X,\xi}$ and $x_0$, we have that $f\sim_{x_0} g$ implies $h\circ f \sim_{x_0} h\sim g$.
\end{definition}

\url{https://math.stackexchange.com/questions/1671090/functions-that-preserve-asymptotic-equivalence}


\begin{lemma}
Let $(X,\xi)$ be a convergence space. Let $x_0 \in X$, $f,g: X\setminus\{x_0\}\to \R$ be functions and $a\in \R$. If $f \sim g$ as $x\to x_0$, then $f^a \sim g^a$.
\end{lemma}
In other words, the function $x\mapsto x^a$ preserves asymptotic equivalence.
\begin{proof}
Since $\lim_{x\to x_0}\frac{f}{g} = 1$, we have
\[ \lim_{x\to x_0}\frac{f^a}{g^a} = \lim_{x\to x_0}\Big(\frac{f}{g}\Big)^a = \Big(\lim_{x\to x_0}\frac{f}{g}\Big)^a = 1^a = 1. \]
\end{proof}

\begin{proposition}
Let $A\subseteq \interval[o]{0,+\infty}$ and $h: A\to \R^+$ a positive real function. Then $h$ preserves asymptotic equivalence \textup{if and only if} $\ln\circ h\circ \exp: \exp^{\preimf}(A) \to \R$ is uniformly continuous.
\end{proposition}
\begin{proof}
First assume $\ln\circ h\circ \exp$ is uniformly continuous.

Let $\sSet{X,\xi}$ be a convergence space, $x_0\in X$ and $f,g: X\to A$ be functions such that $f\sim g$ as $x\to x_0$.

We have
\[ \big|(\ln \circ f)(x) - (\ln \circ g)(x)\big| = \Big|\ln\Big(\frac{f(x)}{g(x)}\Big)\Big| \overset{x\to x_0}{\longrightarrow} |\ln(1)| = 0, \]
by continuity of the logarithm.

For all $x\in A$ we have $f(x), g(x)\in A \subseteq \interval[o]{0,+\infty}$ and thus $f(x) = (\exp\circ \ln)\big(f(x)\big)$ and $g(x) = (\exp\circ \ln)\big(g(x)\big)$. So
\begin{align*}
\Big|\ln\Big(\frac{h\big(f(x)\big)}{h\big(g(x)\big)}\Big)\Big| &= \big|(\ln\circ h \circ f)(x) - (\ln\circ h \circ g)(x)\big| \\
&= \big|(\ln\circ h \circ \exp)\big((\ln\circ f)(x)\big) - (\ln\circ h \circ \exp)\big((\ln\circ g)(x)\big)\big| \overset{x\to x_0}{\longrightarrow} 0,
\end{align*}
since $\ln\circ h \circ \exp$ is uniformly continuous. Since $\ln\Big(\frac{h\big(f(x)\big)}{h\big(g(x)\big)}\Big) \to 0$, applying the continuous function $\exp$ yields $\frac{(h\circ f)(x)}{(h\circ g)(x)} \to 1$ as $x\to x_0$.

Now assume $h$ preserves asymptotic equivalence. Assume, towards a contradiction, that $H \defeq \ln\circ h\circ \exp$ is not uniformly continuous. The negation of \ref{uniformContinuityMetricSpaces} then gives
\[ \exists \epsilon >0: \forall \delta > 0: \exists x,y\in \exp^{\preimf}(A): \; \big(|x-y| \leq \delta\big) \land \Big(\big|H(x) - H(y)\big| > \epsilon\Big). \]
Fix such an $\epsilon$. For all $n\in \N$, we can find $x_n,y_n \in \exp^{\preimf}(A)$ such that $|x_n - y_n| \leq n^{-1}$ and $\big|H(x_n) - H(y_n)\big| > \epsilon$. Now set $f: \N\to A: n\mapsto \exp(x_n)$ and $g: \N\to A: n\mapsto \exp(y_n)$. We have
\[ \lim_{n\to \infty} \frac{f(n)}{g(n)} = \lim_{n\to \infty} \frac{\exp(x_n)}{\exp(y_n)} = \lim_{n\to \infty}\exp(x_n - y_n) = \exp(0) = 1, \]
so $f\sim g$. Since $h$ preserves asymptotic equivalence, we have
\begin{align*}
\Big|\ln\Big(\frac{h\big(f(n))}{h\big(g(n))}\Big)\Big| &= \big|(\ln\circ h)\big(f(n)\big) - (\ln\circ h)\big(g(n)\big)\big| \\
&= \big|(\ln\circ h)\big(\exp(x_n)\big) - (\ln\circ h)\big(\exp(y_n)\big)\big| \\
(\ln\circ h)\big(f(n)\big) - (\ln\circ h)\big(g(n)\big)\big| \\
&= \big|H(x_n) - H(y_n)\big|,
\end{align*}
so $\big|H(x_n) - H(y_n)\big| \to 0$. This contradicts the construction of $\seq{x_n}$ and $\seq{y_n}$.
\end{proof}
\begin{corollary}
Let $\sSet{X,\xi}$ be a convergence space. Let $x_0 \in X$, $f,g: X\setminus\{x_0\}\to \R^+$ be functions, $a\in \R$ and $0< \epsilon < 1$. Then
\begin{enumerate}
\item $\ln: \interval[co]{1+\epsilon, \infty} \to \R$ preserves asymptotic equivalence;
\item $\ln: \interval[oc]{0, 1 - \epsilon}\to \R$ preserves asymptotic equivalence.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) Set $A\defeq \interval[co]{1+\epsilon, \infty}$, so $\exp^{\preimf}(A) = \interval[co]{\ln(1+\epsilon), \infty}$. Since $\ln\circ\ln\circ \exp = \ln$, we just need to observe that $\ln$ is uniformly continuous when restricted to $\interval[co]{\ln(1+\epsilon), \infty}$.

Indeed, it is differentiable and its derivative is bounded by $\ln(1+\epsilon)^{-1}$. This means that it is Lipschitz continuous and thus uniformly continuous by \ref{LipschitzcontinuousContinuous}.

(2) Similar to (1), only using $-\ln: \interval[oc]{0, 1 - \epsilon}\to \R$. It is clear that if $-\ln$ preserves asymptotic equivalence, then so does $\ln$.
\end{proof}
\begin{corollary}
Let $b > 0$ and $h: \interval[o]{b,+\infty}\to \R^+$ a positive real function. If $h$ preserves asymptotic equivalence, then there exists $a \geq 0$ such that $h(x) \leq x^a$ as for all $x \in \interval[o]{b,+\infty}$.
\end{corollary}
\begin{proof}
By \ref{linearBoundUniformlyContinuousFunction}, there exists $a \geq 0$ such that $(\ln\circ h \circ \exp)(x) \leq ax$ for all $x\in \exp^{\preimf}\big(\interval[o]{b,+\infty}\big)$. This implies, for all $x\in \interval[o]{b,+\infty}$, that $(\ln \circ h)(x) = (\ln\circ h \circ \exp)\big(ln(x)\big) \leq a\ln(x)$, so $h(x) \leq \exp\big(a\ln(x)\big) = x^a$.
\end{proof}



\section{Asymptotic analysis}
\begin{definition}
A sequence of functions $\seq{\phi_n:\R\to\R}_{n\in\N}$ is a \udef{gauge sequence} or \udef{asymptotic scale} for $x\to x_0$ if, for all $n\in \N$,
\[ \big|\phi_{n+1}(x)\big| = o\big(\big|\phi_n(x)\big|\big) \qquad\text{as $x\to x_0$.} \]
\end{definition}

\begin{example}
The following are gauge sequences:
\begin{itemize}
\item $\seq{(x-x_0)^n}_{n\in \N}$ as $x\to x_0$;
\item $\seq{x^{-n}}_{n\in \N}$ as $x\to \infty$;
\item $\sin^n(x)$ as $x\to 0$.
\end{itemize}
TODO: $\seq{(x-x_0)^{n-k}}_{n\in \N}$ as $x\to x_0$?
\end{example}

\begin{definition}
Let $f$ be a function and $\seq{\phi_n}_{n\in \N}$ an asymptotic scale as $x\to x_0$. An \udef{asymptotic expansion} of $f$, w.r.t. $\seq{\phi_n}_{n\in \N}$, is a sequence $\seq{a_n}$ of numbers such that
\[ f(x) = \sum_{n=0}^N a_n\phi_n(x) + o(\phi_{N}) \]
for all $N\in\N$.

We denote the asymptotic expansion
\[ f(x) \sim \sum_{n = 0}^\infty a_n\phi_n(x). \]
\end{definition}

\begin{lemma}
Let $f$ be a function and $\seq{\phi_n}_{n\in \N}$ an asymptotic scale as $x\to x_0$. Suppose $\seq{a_n}$ is a sequence of numbers such that
\[ f(x) = \sum_{n=0}^N a_n\phi_n(x) + O(\phi_{N+1}) \]
as $x\to x_n$ for all $N\in\N$, then $\seq{a_n}$ is an asymptotic expansion.
\end{lemma}
\begin{proof}
Since $f(x) - \sum_{n=0}^N a_n\phi_n(x) = O(\phi_{N+1})$ and $\phi_{N+1} = o(\phi_N)$, we have $f(x) - \sum_{n=0}^N a_n\phi_n(x) = o(\phi_{N})$ by \ref{asymptoticTransitivity}.
\end{proof}

\begin{lemma} \label{calculationAsymptoticExpansion}
Let $f$ be a function and $\seq{\phi_n}_{n\in \N}$ an asymptotic scale as $x\to x_0$. If $f$ has an asymptotic expansion w.r.t. this asymptotic scale, then it is unique and given by
\[ a_k = \lim_{x\to x_0}\frac{f(x) - \sum_{n=0}^{k-1}a_n\phi_n(x)}{\phi_k} \]
for all $k\in \N$. In particular, these limits exist.
\end{lemma}
We have, in particular, $a_0 = \lim_{x\to x_0}\frac{f(x)}{\phi_0}$.

We can also consider this as saying that $a_k$ is the unique constant $a_k \sim \frac{f(x) - \sum_{n=0}^{k-1}a_n\phi_n(x)}{\phi_k}$, cfr. \ref{asymptoticEquivalenceLemma}.
\begin{proof}
By definition, we have
\[ f(x) = a_k\phi_{k}(x) + h(x) + \sum_{n=0}^{k-1}a_n\phi_n(x), \]
for some $h \in o(\phi_k)$. Then
\[ \lim_{x\to x_0}\frac{f(x) - \sum_{n=0}^{k-1}a_n\phi_n(x)}{\phi_k} = \lim_{x\to x_0} a_k + \frac{h(x)}{\phi_k(x)} = a_k. \]
\end{proof}

\begin{lemma}
Let $\seq{\phi_n}_{n\in \N}$ be an asymptotic scale as $x\to x_0$. Let $f \sim \sum_{n=0}^\infty a_n\phi_n$ and $g \sim \sum_{n=0}^\infty b_n\phi_n$ be asymptotic expansions of functions and $\alpha,\beta\in \F$. Then
\[ \alpha f+\beta g \sim \sum_{n=0}^\infty \big(\alpha a_n + \beta b_n\big)\phi_n. \]
\end{lemma}


\begin{lemma}
Let $\seq{\phi_n}_{n\in \N}$ be an asymptotic scale as $x\to x_0$. If $f \sim \sum_{n = 0}^\infty a_n\phi_n(x)$ and $g = f+o(\phi_n)$ for all $n\in \N$, then $g \sim \sum_{n = 1}^\infty a_n\phi_n(x)$.
\end{lemma}
Thus many different functions may share the same asymptotic expansion.
\begin{proof}
We have $g = f+ h$ and $h\in o(\phi_n)$ for all $n\in \N$. Then, for all $N\in \N$, we have 
\[ g(x) = h(x) + \sum_{n=0}^N a_n\phi_n(x) + o(\phi_{N}) = \sum_{n=0}^N a_n\phi_n(x) + o(\phi_{N}). \]
\end{proof}


\begin{definition}
Let $\seq{\phi_n}_{n\in \N}$ be an asymptotic scale as $x\to x_0$. A function $f \sim \sum_{n=0}^\infty 0\cdot \phi_n$ is called \udef{subdominant}.
\end{definition}
Two functions have the same asymptotic expansion if and only if their difference is subdominant.

\begin{example}
The function $e^{-x}$ is subdominant to $\seq{x^{-n}}_{n\in \N}$ as $x\to \infty$.
\end{example}

\begin{proposition}
Let $\seq{\phi_n}_{n\in \N}$ be an asymptotic scale as $x\to x_0$. Let $\seq{a_n}_{n\in \N}$ be a sequence of real numbers. Then there exists a function $f: \R\to\R$ such that $f \sim \sum_{n=0}^\infty a_n\phi_n$.
\end{proposition}
\begin{proof}
For all $n\in \N$, construct the set $U_n$ recursively as follows: set $U_0 = \R$ and
\[ U_{n} \defeq \setbuilder{x\in U_{n-1}}{\Big|\frac{\phi_{n+1}(x)}{\phi_{n}(x)}\Big|\leq \Big|\frac{a_n}{2a_{n+1}}\Big|}. \]
We set $f(x) \defeq \sum_{n=0}^\infty \charFunc{U_n}(x)a_n\phi_n(x)$. Now we have
\[  \big|\charFunc{U_{n+1}}(x)a_{n+1}\phi_{n+1}(x)\big| \leq \frac{1}{2}\big|\charFunc{U_{n}}(x)a_{n}\phi_{n}(x)\big|, \]
so
\[ \Big|\frac{\charFunc{U_{n+1}}(x)a_{n+1}\phi_{n+1}(x)}{\charFunc{U_{n}}(x)a_{n}\phi_{n}(x)}\Big| \leq \frac{1}{2} < 1, \]
so the series defining $f$ converges everywhere by the ratio test (TODO ref). To show that $f \sim \sum_{n=0}^\infty a_n\phi_n$, we need to show that $f(x) - \sum_{n=0}^N a_n\phi_n(x)$ is $o\big(\phi_{N}\big)$. If $x\notin U_n$, then this difference is zero, so we may restrict our attention to $x\in U_{N}$ and calculate
\begin{align*}
\Big|f(x) - \sum_{n=0}^N a_n\phi_n(x)\Big| &= \Big|\sum_{n=N+1}^N \charFunc{U_{n}}(x)a_n\phi_n(x)\Big| \\
&\leq \sum_{n=N+1}^N \big|\charFunc{U_{n}}(x)a_n\phi_n(x)\big| \\
&\leq |a_{N+1}\phi_{N+1}(x)|\sum_{n=N+1}^N 2^{N+1-n} \\
&= 2|a_{N+1}|\,|\phi_{N+1}(x)| = o(\phi_{N}).
\end{align*}
\end{proof}

\begin{example}
Asymptotic series are useful for evaluating limits. Consider
\[ \lim_{x\to 0} \frac{e^x - \sqrt{2x+1}}{x^2}. \]
We have $e^x = 1 + x + \frac{x^2}{2} + O(x^3)$ and $\sqrt{2x+1} = 1 + x - \frac{x^2}{2} + O(x^3)$, so
\[ \frac{e^x - \sqrt{2x+1}}{x^2} = \frac{x^2 + O(x^3)}{x^2} = 1 + O(x) \to 1. \]
\end{example}

\subsection{Series of inverse functions}
\subsubsection{Examples}
Choosing a good asymptotic scale is an art.

\begin{example}
Consider the function $f(x) = x^3 + x$. We want to find an asymptotic series for $f^{-1}(x)$ as $x\to \infty$.

Since $x^3 + x \sim x^3$ as $x\to \infty$, we let the first term of our series be $\sqrt[3]{x}$.
\end{example}


\begin{example}
Lambert W
\end{example}


\subsection{Power series expansions}
\subsubsection{The scale $(x-x_0)^n$ as $x\to x_0$}
\begin{lemma}
Let $f \sim \sum_{n=0}^\infty a_n(x-x_0)^n$ and $g \sim \sum_{n=0}^\infty b_n(x-x_0)^n$ be asymptotic power series expansions of functions.
\begin{itemize}
\item $f\cdot g \sim \sum_{n=0}^\infty c_n(x-x_0)^n$, where $c_n = \sum_{m=0}^n a_mb_{n-m}$;
\item if $b_0 \neq 0$, then $\frac{f}{g} \sim \sum_{n=0}^\infty d_n(x-x_0)^n$, where $d_0 = \frac{a_0}{b_0}$ and
\[ d_n = \frac{a_n - \sum_{m=0}^{n-1}d_mb_{n-m}}{d_0} \]
recursively defines the rest of the expansion.
\end{itemize}
\end{lemma}

\begin{proposition}
Let $f$ be a function that is continuous on some neighbourhood of $x_0$ and $f \sim \sum_{n=0}^\infty a_n(x-x_0)^n$ an asymptotic power series expansion as $x\to x_0$. Then
\[ \int_{x_0}^x f(t) \diff{t} \sim \sum_{n=0}^\infty \frac{a_n}{n+1}(x-x_0)^{n+1}. \]
\end{proposition}
\begin{proof}
For any $N\in \N$, there exists $h\in o\big((x-x_0)^N\big)$ such that
\[ f(x) = \sum_{n=0}^N a_n(x-x_0)^n + h(x). \]
Then
\[ \int_{x_0}^x f(t)\diff{t} = \sum_{n=0}^N a_n \int_{x_0}^x (t-x_0)^n\diff{t} + \int_{x_0}^xh(t)\diff{t} = \sum_{n=0}^N \frac{a_n}{n+1} (t-x_0)^{n+1} + \int_{x_0}^xh(t)\diff{t}, \]
so it is enough to show that $\int_{x_0}^xh(t)\diff{t}\in o\big((x-x_0)^{N+1}\big)$. 

By \ref{FrechetUrysohnSequentialContinuityAtAPoint}, it is enough to consider the sequential limit. Let $\seq{x_n}$ be a sequence that converges to $x_0$. Let $U$ be a neighbourhood of $x_0$ on which $f$ is continuous. Then $h$ is also continuous on $U$. Since $\seq{x_n}$ eventually lies in $U$, we may WLOG assume $\seq{x_n}$ to lie in $U$.

Then, by \ref{meanValueTheoremIntegrals}, for each $x_n$, there exists a $c_n\in \interval[o]{\big.x_0 - |x_n-x_0|, x_0 + |x_n-x_0|}$ such that $\int_{x_0}^{x_n}h(t)\diff{t} = h(c_n)(x_n - x_0)$. Clearly $c_n \to x_0$, so $\lim_{n\to \infty} \frac{h(c_n)}{(x_n-x_0)^N} = 0$ by assumption. Thus
\[ \frac{\int_{x_0}^{x_n}h(t)\diff{t}}{(x_n-x_0)^{N+1}} = \frac{h(c_n)(x_n - x_0)}{(x_n-x_0)^{N+1}} = \frac{h(c_n)}{(x_n-x_0)^N} \to 0. \]
\end{proof}

\begin{example}
Taking the derivative of an asymptotic series is more tricky. Since the function $e^{-x}$ is subdominant to $\seq{x^{-n}}$ as $x\to \infty$, and $\sin(e^x) \in O(1)$, we have $e^{-x}\sin(e^x)\sim 0$. Taking the derivative gives
\[ \od{}{x}\big(e^{-x}\sin(e^x)\big) = -e^{-x}\sin(e^x)+ e^{-x}e^x\cos(e^x) = -e^{-x}\sin(e^x)+ \cos(e^x) \nsim 0 = \od{}{x}(0). \]
\end{example}



\begin{proposition}
Let $A,B\subseteq \R$ be subsets with $0\in A$ and $A$ compact. Let $f: A \to B$ be a bijective function with asymptotic expansion $f(x) \sim \sum_{n=1}^\infty a_n x^n$ as $x\to 0$. Suppose $a_0 = 0$ and $a_1 \neq 0$, then $f^{-1}(x)$ has an asymptotic expansion $f(x) \sim \sum_{n=1}^\infty b_n x^n$ as $x\to 0$ where
\begin{align*}
b_1 &= \frac{1}{a_1} \\
b_2 &= - \frac{a_2}{a_1^3} \\
b_3 &= 2\frac{a_2^2}{a_1^5} - \frac{a_3}{a_1^4} \\
b_4 &= - 5\frac{a_2^3}{a_1^7} + 5\frac{a_2a_3}{a_1^6} - \frac{a_4}{a_1^5}.
\end{align*}
\end{proposition}
TODO General expression, see Paulsen, Asymptotic Analysis and Perturbation Theory, p. 27
\begin{proof}
TODO: There is not yet a proof here that the full asymptotic expansion for $f^{-1}(x)$ exists, but we show that the first few terms satisfy the asymptotic requirement. (One way to prove the full asymptotic expansion exists is to prove the asymptotic property for all $N$ using the general expression).

Since $a_0 = 0$, we have $f = o(1)$. Then $f^{-1} = o(1)$ by \ref{compactToHausdorffInverseContinuousAtPoint}.

We have, by \ref{limitOperationsAsymptoticNotation} and \ref{asymptoticTransitivity},
\[ x = f\big(f^{-1}(x)\big) = a_1 f^{-1}(x) + o\big(f^{-1}(x)\big) = f^{-1}(x)\big(a_1 + o(1)\big), \]
so $f^{-1}(x) = \frac{x}{a_1 + o(1)} \sim \frac{x}{a_1}$ by \ref{asymptoticEquivalenceQuotient} and $f^{-1}(x) = \frac{x}{a_1} + o(x/a_1) = \frac{x}{a_1} + o(x)$ by \ref{asymptoticEquivalenceLemma}. By uniqueness of the asymptotic expansion, this implies $b_1 = \frac{1}{a_1}$.

Since $f^{-1}(x) \sim \frac{x}{a_1}$, we have $f^{-1}(x)^2 \sim \frac{x^2}{a_1^2}$. Also
\[ x = f\big(f^{-1}(x)\big) = a_1f^{-1}(x) + a_2f^{-1}(x)^2 + o\big(f^{-1}(x)^2\big), \]
so $x - a_1f^{-1}(x) \sim a_2f^{-1}(x)^2$ and we calculate
\begin{align*}
\frac{f^{-1}(x) - x/a_1}{x^2} &\sim \frac{a_1f^{-1}(x) - x}{a_1x^2} \\
&\sim \frac{-a_2f^{-1}(x)^2}{a_1x^2} \\
&\sim \frac{-a_2x^2}{a_1^3x^2} = \frac{-a_2}{a_1^3}.
\end{align*}
This is equal to $b_2$ by \ref{calculationAsymptoticExpansion}.

Now we write
\[ x = f\big(f^{-1}(x)\big) = a_1f^{-1}(x) + a_2f^{-1}(x)^2 + a_3f^{-1}(x)^3 + o\big(f^{-1}(x)^3\big), \]
since $f^{-1}(x) = o(1)$, so $x - a_1f^{-1}(x) - a_2f^{-1}(x)^2 \sim a_3f^{-1}(x)^3 \sim \frac{a_3}{a_1^3}x^3$. This means that
\[ x - a_1f^{-1}(x) - a_2f^{-1}(x)^2 = \frac{a_3}{a_1^3}x^3 + o(x^3). \]
We also have $f^{-1}(x)^2 = \frac{x^2}{a_1^2} - 2 \frac{a_2}{a_1^4}x^3 + o(x^3)$, so $\frac{x^2}{a_1^2} = f^{-1}(x)^2 + 2 \frac{a_2}{a_1^4}x^3 + o(x^3)$. We calculate
\begin{align*}
a_1f^{-1}(x) - x + a_2x^2/a_1^{2} &= a_1f^{-1}(x) - x + a_2f^{-1}(x)^2 + 2 \frac{a_2^2}{a_1^4}x^3 + o(x^3) \\
&= -a_3x^3/ a_1^3 + 2 \frac{a_2^2}{a_1^4}x^3 + o(x^3) \\
&= \Big(2 \frac{a_2^2}{a_1^4} - \frac{a_3}{a_1^3}\Big)x^3 + o(x^3).
\end{align*}
This implies
\begin{align*}
\frac{f^{-1}(x) - x/a_1 + a_2x^2/a_1^{3}}{x^3} &\sim \frac{a_1f^{-1}(x) - x + a_2x^2 / a_1^2}{a_1x^3} \\
&\sim \frac{\Big(2 \frac{a_2^2}{a_1^4} - \frac{a_3}{a_1^3}\Big)x^3}{a_1x^3} \\
&\sim 2 \frac{a_2^2}{a_1^5} - \frac{a_3}{a_1^4}
\end{align*}
This is equal to $b_3$ by \ref{calculationAsymptoticExpansion}.

For the next step, we write
\begin{align*}
x - a_1 f^{-1}(x) - a_2 f^{-1}(x)^2 - a_3 f^{-1}(x)^3 &= \frac{a_4}{a_1^4}x^4 + o(x^4) \\
f^{-1}(x)^2 &= \frac{1}{a_1^2}x^2 - 2 \frac{a_2}{a_1^4}x^3 + \bigg(2\Big(2 \frac{a_2^2}{a_1^5} - \frac{a_3}{a_1^4}\Big)\frac{1}{a_1} + \frac{a_2^2}{a_1^6}\bigg)x^4 + o(x^4) \\
&= \frac{1}{a_1^2}x^2 - 2 \frac{a_2}{a_1^4}x^3 + \Big(5 \frac{a_2^2}{a_1^6} - 2\frac{a_3}{a_1^5}\Big)x^4 + o(x^4) \\
f^{-1}(x)^3 &= \frac{1}{a_1}x^3 - 3 \frac{a_2}{a_1^5}x^4 + o(x^4)
\end{align*}
We rewrite the first of these equations and plug in the other two:
\begin{align*}
f^{-1}(x) &= \frac{x}{a_1} - \frac{a_2}{a_1}f^{-1}(x)^2 - \frac{a_3}{a_1}f^{-1}(x)^3 - \frac{a_4}{a_1^5}x^4 + o(x^4) \\
&= \frac{x}{a_1} - \frac{a_2}{a_1^3}x^2 + \Big(2 \frac{a_2^2}{a_1^5} - \frac{a_3}{a_1^4}\Big)x^3 + \\
&\quad \Big(- 5 \frac{a_2^3}{a_1^7} + 2\frac{a_2a_3}{a_1^6} + 3 \frac{a_2a_3}{a_1^6} - \frac{a_4}{a_1^5} \Big)x^4 + o(x^4) \\
&= \frac{x}{a_1} - \frac{a_2}{a_1^3}x^2 + \Big(2 \frac{a_2^2}{a_1^5} - \frac{a_3}{a_1^4}\Big)x^3 + \Big(- 5 \frac{a_2^3}{a_1^7} + 5\frac{a_2a_3}{a_1^6} - \frac{a_4}{a_1^5} \Big)x^4 + o(x^4).
\end{align*}
\end{proof}


\subsubsection{The scale $x^{-n}$ as $x\to \infty$}

\begin{proposition}
Let $f$ be a continuous function and $f \sim \sum_{n=0}^N a_nx^{-n} + O(x^{-N-1})$ an asymptotic power series expansion as $x\to \infty$. Then
\[ \int_{x}^\infty \Big(f(t) - a_0 - \frac{a_1}{t}\Big) \diff{t} = \sum_{n=2}^N \frac{a_n}{n-1}x^{-n + 1} + O(x^{-N}). \]
\end{proposition}
\begin{proof}
For any $N\in \N$, there exists $h(x)\in O(x^{-N-1})$ such that
\[ f(x) = \sum_{n=0}^N a_nx^{-n} + h(x). \]
Then
\begin{align*}
\int_{x}^\infty \Big(f(t) - a_0 - \frac{a_1}{t}\Big) \diff{t} &= \sum_{n=2}^N a_n \int_{x}^\infty t^{-n}\diff{t} + \int_{x}^\infty h(t)\diff{t} \\
&= \sum_{n=2}^N \Big[\frac{a_n}{-n+1} t^{-n+1}\Big]_{x}^\infty + \int_{x}^\infty h(t)\diff{t} \\
&= \sum_{n=2}^N \frac{a_n}{n-1} x^{-n+1} + \int_{x}^\infty h(t)\diff{t},
\end{align*}
so it is enough to show that $\int_{x}^\infty h(t)\diff{t}\in O(x^{-N})$. Indeed, we calculate
\begin{align*}
\int_{x}^\infty h(t)\diff{t} &\leq K\int_x^\infty t^{-N-1} \diff{t} \\
&= K\Big[\frac{t^{-N}}{-N}\Big]^\infty_x = \frac{K}{N}x^{-N}.
\end{align*}
\end{proof}

\subsection{Dominant balance}

Kruskal-Newton graphs.

\subsection{Improving power series convergence}
\subsubsection{Shanks transformation}
\begin{definition}
Let $\seq{a_n}_{n\in \N}$ be a sequence of complex numbers. Consider the partial sums $A_n \defeq \sum_{k=0}^n a_k$. The \udef{Shanks transformation} of the series is the sequence
\[ S_n \defeq {\frac {A_{n+1}\,A_{n-1}\,-\,A_{n}^{2}}{A_{n+1}-2A_{n}+A_{n-1}}}=A_{n+1}-{\frac {(A_{n+1}-A_{n})^{2}}{(A_{n+1}-A_{n})-(A_{n}-A_{n-1})}}. \]
\end{definition}

To motivate the Shanks transformation, we assume the distance from $A_n$ to the limit $A$ is of the form $at^n$, with $a,t\in \C$ (we want $|t| < 1$, so this transient term goes to zero). Then we have
\[ A_{n-1} = A + at^{n-1}, \quad A_{n} = A + at^{n} \quad\text{and}\quad A_{n+1} = A + at^{n+1}. \]
These are three equations with three unknowns: $A,a$ and $t$. Solving for $A$ yields
\[ A = {\frac {A_{n+1}\,A_{n-1}\,-\,A_{n}^{2}}{A_{n+1}-2A_{n}+A_{n-1}}}. \]

\begin{lemma}
Let $\seq{a_n}_{n\in \N}$ be a sequence of complex numbers. If the series converges, then the Shanks transform also converges.
\end{lemma}
\begin{proof}
TODO!
\end{proof}

\begin{example}
\begin{itemize}
\item The Shanks transform may converge even if the series diverges.
\item Repeated application of the Shanks transform may improve the convergence.
\end{itemize}
\end{example}

\subsubsection{Euler summation}
\begin{definition}
Let $\seq{a_n}_{n\in \N}$ be a sequence. The \udef{Euler sum} of the series $\sum_{n=0}^\infty a_n$ is defined as
\[ \lim_{z\to 1}\sum_{n=0}^{\infty}a_nz^n. \]
\end{definition}

\subsubsection{Borel summation}
\begin{definition}
Let $\seq{a_n}_{n\in \N}$ be a sequence. The \udef{Borel sum} of the series $\sum_{n=0}^\infty a_nz^n$ is defined as
\[ \int_0^\infty e^{-t}\Big(\sum_{n=0}^\infty \frac{a_nt^nz^n}{n!}\Big)\diff{t}, \]
if the integral exists.
\end{definition}

\section{Asymptotics of integrals}

\begin{theorem}[Watson's lemma]
Let $T>0$ and $\phi: \interval{0,T} \to \C$ be an integrable function. Suppose $\phi(t) = t^\lambda g(t)$ for some $\lambda > -1$ and $g$ is infinitely differentiable on a neighbourhood of $0$. Then 
\[ F(x) \defeq \int_0^T e^{-xt}\phi(t)\diff{t} \]
is finite for all $x > 0$ and has the asymptotic expansion
\[ F(x) \sim \sum_{n=0}^\infty \frac{g^{(n)(0)}\Gamma(\lambda + n + 1)}{n! x^{\lambda + n + 1}} \]
\end{theorem}
\begin{proof}

\end{proof}

\chapter{TODO Formal and function series}
TODO for general convergence fields??
\section{Power series}
\begin{definition}
A \udef{power series} is a partial function of the form
\[ f: \C\not\to \C: z\mapsto \sum_{i=0}^\infty a_i(z-z_0)^i, \]
where $z_0\in \C$ and $\seq{a_n}$ is a sequence of complex numbers. 
\end{definition}
TODO more general algebras.

\begin{proposition}[Cauchy-Hadamard] \label{CauchyHadamard}
Let $s: \C\not\to \C: z\mapsto \sum_{n=0}^\infty a_n(z-z_0)^n$ be a power series. Define the real number $R$ by
\[ \frac{1}{R} \defeq \limsup_{n\to\infty}\left(|a_n|^{1/n}\right). \]
For all $R'< R$, the series $s(z) = \sum_{n=0}^\infty a_n(z-z_0)^n$ converges uniformly for $z\in \cball(z_0, R')$.
\end{proposition}
If $\limsup_{n\to\infty}\left(|a_n|^{1/n}\right) \to \infty$, we consider $R$ to be zero.
\begin{proof}
We use the Weierstrass $M$-test \ref{WeierstrassMTest}.
We have $\sup_{z\in \cball(z_0, R')}|a_n(z-z_0)^n| = |a_n|(R')^n$, so it is enough to show the convergence of $\sum_{n=0}^\infty |a_n|(R')^n$. This follows from the root test, \ref{rootTest}, since 
\[ \limsup_{n\to \infty}\big(|a_n|(R')^n\big)^{1/n}= \limsup_{n\to \infty}|a_n|^{1/n}R' < \limsup_{n\to \infty}|a_n|^{1/n}R = 1. \]
\end{proof}
\begin{corollary} \label{powerSeriesHolomorphic}
Let $s: \C\not\to \C: z\mapsto \sum_{n=0}^\infty a_n(z-z_0)^n$ be a power series with radius of convergence $R$. Then $s$ is well-defined and holomorphic on $\ball(z_0,R)$ with
\[ s'(z) = \sum_{n=0}^\infty na_n(z-z_0)^{n-1.} \]
\end{corollary}
\begin{proof}
TODO: uniform limit of holomorphic functions is holomorphic.
\end{proof}

\begin{definition}
The $R$ defined in \ref{CauchyHadamard} is called the \udef{radius of convergence} of the power series.
\end{definition}

\subsection{Taylor and MacLaurin}
\section{Laurent series}
\begin{definition}
A \udef{Laurent series} is a partial function of the form
\[ f: \C\not\to \C: z\mapsto \sum_{i=-\infty}^\infty a_i(z-z_0)^i \defeq \sum_{i=0}^\infty a_i(z-z_0)^i + a_{-i}(z-z_0)^{-i}, \]
where $z_0\in \C$ and $\seq{a_n}, \seq{a_{-n}}$ are sequences of complex numbers.

The series $\sum_{i=1}^\infty a_{-i}(z-z_0)^{-i}$ is called the \udef{principal part} of the Laurent series.
\end{definition}

\begin{proposition} \label{LaurentSeriesConvergence}
Let $f: \C\not\to \C: z\mapsto \sum_{i=-\infty}^\infty a_i(z-z_0)^i$ be a Laurent series. Define the real numbers $r$ and $R$ by
\begin{align*}
r &\defeq \limsup_{n\to\infty}\left(|a_{-n}|^{1/n}\right); \\
\frac{1}{R} &\defeq \limsup_{n\to\infty}\left(|a_n|^{1/n}\right).
\end{align*}
For all $z\in \C$ such that $r < |z-z_0| < R$, the value $f(z)$ is well-defined.
\end{proposition}
So the domain of convergence of a Laurent series is an annulus around $z_0$.

\section{Puiseux series}
\url{https://en.wikipedia.org/wiki/Puiseux_series}

\chapter{Complex analysis}
\input{complexAnalysis}

\chapter{Function spaces}
\section{The $\mathcal{L}^p(X,\mu)$ spaces}
\begin{definition}
Let $\sSet{X,\mathcal{A},\mu}$ be a measure space and $0<p<\infty \in \R$. We define
\begin{itemize}
\item the set $\mathcal{L}^p(X,\mu) \defeq \setbuilder{f\in \meas(X,\C)}{\int_X |f|^p\diff{\mu} <\infty}$;
\item the real functional $\norm{\cdot}_{p}: \mathcal{L}^p(X,\mu)\to \R: f\mapsto \left(\int_X |f|^p\diff{\mu}\right)^{1/p}$.
\end{itemize}
\end{definition}
We will prove that the functional $\norm{\cdot}_{p}$ is a seminorm.

\begin{lemma} \label{pNormAbsolutelyHomogeneous}
Let $0< p<\infty$ and $\sSet{X,\mathcal{A},\mu}$ be a measure space. Then $\norm{\cdot}_p$ is absolutely homogeneous.
\end{lemma}
\begin{proof}
For all $\lambda\in \R$, we have
\[ \norm{\lambda f}_{p} = \left(\int_X |\lambda f|^p\diff{\mu}\right)^{1/p} = \left(|\lambda|^p\int_X |f|^p\diff{\mu}\right)^{1/p} = |\lambda|\left(\int_X |f|^p\diff{\mu}\right)^{1/p}. \]
\end{proof}

\begin{lemma} \label{pnormLemma}
Let $\sSet{X,\mathcal{A},\mu}$ be a measure space, $k,l\in\interval[o]{1,+\infty}$ and $f\in \mathcal{L}^{kl}(X,\mu)$. Then
\[ \norm{|f|^k}_l = \left(\norm{f}_{kl}\right)^k. \]
\end{lemma}
\begin{proof}
We calculate
\begin{align*}
\left(\norm{f}_{kl}\right)^k &= \left(\left(\int_X|f|^{kl}\diff{\mu}\right)^{1/(kl)}\right)^{k} \\
&= \left(\int_X\big||f|^{k}\big|^l\diff{\mu}\right)^{1/l} \\
&= \norm{|f|^k}_l.
\end{align*}
\end{proof}

\begin{theorem}[Hölder's inequality] \label{HoeldersInequality}
Let $p,q\in \R^+$ be Hölder conjugate and $\sSet{X,\mathcal{A},\mu}$ a measure space. Then for all $f\in \mathcal{L}^p(X,\mu), g\in \mathcal{L}^q(X,\mu)$:
\begin{enumerate}
\item $fg\in \mathcal{L}^1(X,\mu)$;
\item $\norm{fg}_1 \leq \norm{f}_p\norm{g}_q$.
\end{enumerate}
We have equality \textup{if and only if} $\exists K\in \R$ such that $|f|^p = K|g|^q$ a.e.
\end{theorem}
\begin{proof}
If either $\norm{f}_p = 0$ or $\norm{g}_q = 0$, then either $|f|^p$ or $|g|^q$ is $0$ a.e. by \ref{functionPropertiesFromIntegral}. Then $fg = 0$ a.e., so $\norm{fg}_1 = 0$.

Now, assuming $\norm{f}_p \neq 0$ and $\norm{g}_q \neq 0$, we can write $f' = \norm{f}_p^{-1}f$ and $g' = \norm{g}_q^{-1}g$.
These functions satisfy $\norm{f'}_p = 1$ and $\norm{g'}_q = 1$, because of \ref{pNormAbsolutelyHomogeneous}.

Now we can apply Young's inequality \ref{YoungsInequality} pointwise to obtain
\[ |f'(x)g'(x)| \leq \frac{|f'|^p}{p} + \frac{|g'|^q}{q} \qquad \forall x\in X. \]
Integrating both sides (and using \ref{pNormAbsolutelyHomogeneous}), gives
\begin{align*}
\frac{\norm{fg}_1}{\norm{f}_p\norm{g}_q} = \norm{f'g'}_1 = \int_X|f'g'|\diff{\mu} &\leq \int_X\frac{|f'|^p}{p}\diff{\mu} + \int_X\frac{|g'|^q}{q}\diff{\mu} \\
&= \frac{\norm{f'}_p^p}{p} + \frac{\norm{g'}_q^q}{q} = \frac{1}{p} + \frac{1}{q} = 1.
\end{align*}
The Hölder inequality follows.

Now assume $\norm{fg}_1 = \norm{f}_p\norm{g}_q$. Then we must have the inequality is in fact an equality, i.e.\ 
\[ \int_X|f'g'|\diff{\mu} = \int_X\left(\frac{|f'|^p}{p} + \frac{|g'|^q}{q}\right)\diff{\mu}. \]
Then $|f'g'| = \frac{|f'|^p}{p} + \frac{|g'|^q}{q}$ a.e.\ by \ref{functionPropertiesFromIntegral}. By \ref{YoungsInequality} the equality $|f'(x)g'(x)| = \frac{|f'(x)|^p}{p} + \frac{|g'(x)|^q}{q}$ only holds if $|f'(x)|^p = |g'(x)|^q$. We conclude that
\[ 1 = \frac{|g'|^q}{|f'|^p} = \frac{\norm{f}_p^p |g|^q}{\norm{g}_q^q |f|^p} = K \frac{|g|^q}{|f|^p} \]
almost everywhere, for some $K\in \R^+$.
\end{proof}
\begin{proof}[Alternative proof]
Using Jensen's inequality \url{https://en.wikipedia.org/wiki/H%C3%B6lder%27s_inequality}
\end{proof}


\begin{theorem}[Minkowski's sum inequality] \label{MinkowskisInequality}
Let $1< p<\infty$ and $\sSet{X,\mathcal{A},\mu}$ be a measure space. Let $f,g\in\mathcal{L}^p(X,\mu)$ be functions. Then
\[ \norm{f+g}_p \leq \norm{f}_p + \norm{g}_p. \]
\end{theorem}
TODO invert inequality if $p<1$! TODO also inverse Hölder inequality.

See also Minkowski's integral inequality \ref{MinkowskisIntegralInequality}.
\begin{proof}
First we show that $\norm{f+g}_p$ is finite. We show this using the convexity of $\R^+\to \R^+: x\mapsto |x|^p$:
\begin{align*}
|f+g|^p &= 2^p\left|\frac{1}{2}f+ \frac{1}{2}g\right|^p \\
&\leq 2^p\left|\frac{1}{2}|f|+ \frac{1}{2}|g|\right|^p \\
&\leq 2^p\left(\frac{1}{2}|f|^p + \frac{1}{2}|g|^p\right) = 2^{p-1}\left(|f|^p + |g|^p\right) < \infty.
\end{align*}
Then $\norm{f+g}_p^p < \infty$ by \ref{propertiesIntegralPositiveFunctions}, so $\norm{f+g}_p < \infty$.

Now we can calculate (setting $q = \frac{p}{p-1}$, i.e.\ the Hölder conjugate of $p$)
\begin{align*}
\norm{f+g}_p^p &= \int_X|f+g|^p\diff{\mu} \\
&= \int_X|f+g|\cdot |f+g|^{p-1}\diff{\mu} \\
&\leq \int_X\big(|f|+|g|\big)\cdot |f+g|^{p-1}\diff{\mu} \\
&= \norm{|f|\cdot |f+g|^{p-1}}_1 + \norm{|g|\cdot |f+g|^{p-1}}_1 \\
&\leq \norm{f}_p\cdot \norm{|f+g|^{p-1}}_q + \norm{g}_p\cdot \norm{|f+g|^{p-1}}_q \\
&= \big(\norm{f}_p + \norm{g}_p\big)\cdot \norm{|f+g|^{p-1}}_q
\end{align*}
using first the triangle inequality and then Hölder's inequality, \ref{HoeldersInequality}.

Next we calculate
\begin{align*}
\norm{|f+g|^{p-1}}_q &= \left(\norm{f+g}_{(p-1)q}\right)^{p-1} = \left(\norm{f+g}_{(p-1)\frac{p}{p-1}}\right)^{p-1} = \norm{f+g}_{p}^{p-1},
\end{align*}
using \ref{pnormLemma} and \ref{HoelderConjugateEquivalents}.

Putting these two calculations together gives
\[ \norm{f+g}_p^p \leq \big(\norm{f}_p + \norm{g}_p\big)\cdot \norm{f+g}_{p}^{p-1}, \]
or $\norm{f+g}_p \leq \norm{f}_p + \norm{g}_p$.
\end{proof}
\begin{corollary}
Let $0< p<\infty$ and $\sSet{X,\mathcal{A},\mu}$ be a measure space. Then $\norm{\cdot}_{p}$ is a seminorm.
\end{corollary}
\begin{proof}
We need to prove that $\norm{f}_{p}$ is subadditive and absolutely homogeneous. Subadditivity is given by the Minkowski inequality and absolute homogeneity by \ref{pNormAbsolutelyHomogeneous}.
\end{proof}

\begin{theorem}[Minkowski's integral inequality] \label{MinkowskisIntegralInequality}
Let $\sSet{X,\mathcal{A},\mu}, \sSet{Y,\mathcal{B},\nu}$ be $\sigma$-finite measure space, $1\leq p < \infty$ and $f: X\times Y\to \overline{\R^+}$ a $\mathcal{A}\otimes\mathcal{B}$-measurable function. Then
\[ \bigg(\int_X\Big(\int_Y f(x,y)\diff{\nu}(y)\Big)^p\diff{\mu}(x)\bigg)^{1/p} \leq \int_Y\Big(\int_X f(x,y)^p\diff{\mu}(x)\Big)^{1/p}\diff{\nu}(y). \]
\end{theorem}
\begin{proof}
If $p=1$, then the inequality is in fact an equality by Tonelli's theorem \ref{tonellisTheorem}.
\end{proof}
\begin{corollary}
Let $\sSet{X,\mathcal{A},\mu}, \sSet{Y,\mathcal{B},\nu}$ be $\sigma$-finite measure space, $1\leq p \leq \infty$ and $f: X\times Y\to \C$ a $\mathcal{A}\otimes\mathcal{B}$-measurable function. If $f(-,y)\in \mathcal{L}^p(X,\mu)$ for a.e. $y\in Y$ and $\big(y\mapsto \norm{f(-,y)}_p\big)$ is in $\mathcal{L}^1(Y,\nu)$, then
\begin{enumerate}
\item $f(x,-)\in \mathcal{L}^1(Y,\nu)$ for a.e. $x\in X$;
\item $\Big(x\mapsto \int_Y f(x,y)\diff{\nu}(y)\Big)\in \mathcal{L}^p(X,\mu)$;
\item $\norm{\int_Yf(-,y)\diff{\nu}(y)}_p \leq \int_Y\norm{f(-,y)}_p\diff{\nu}(y)$.
\end{enumerate}
\end{corollary}
\begin{proof}

\end{proof}

\subsection{The essential supremum and $\mathcal{L}^\infty(X,\mu)$}
\begin{definition}
Let $(X, \mathcal{A}, \mu)$ be a measure space and $f\in \meas(X, \overline{\R^+})$.
\begin{itemize}
\item The \udef{essential supremum} of $f$ is
\[ \essup(f) \defeq \inf\setbuilder{\sup_{\omega\in E}|f(\omega)|}{E\in \mathcal{A}, \mu(E^c) = 0}. \]
\item We call $f$ \udef{essentially bounded} if $\essup(f)<\infty$.
\item We define
\[ \mathcal{L}^\infty(X,\mu) \defeq \setbuilder{f\in \meas(X, \C)}{\essup(|f|) < \infty}. \]
\end{itemize}
\end{definition}

\begin{lemma}
Let $(X, \mathcal{A}, \mu)$ be a measure space and $f\in \meas(X, \C)$. Then
\[ \essup(f) = \sup D_{|f|}^{\preimf}\big(\interval[o]{0,\infty}\big) = \inf D_{|f|}^{\preimf}\big(\{0\}\big). \]
\end{lemma}

\subsection{Embeddings and inclusions}

\begin{proposition}
Let $0<p<q<r \leq \infty$, $f\in \mathcal{L}^p(X,\mu) \cap \mathcal{L}^r(X,\mu)$ and $g\in \mathcal{L}^q(X,\mu)$. Then
\begin{enumerate}
\item $\norm{f}_q \leq \norm{f}_p^{\lambda}\norm{f}_r^{1-\lambda}$, where
\[ \lambda = \frac{q^{-1} - r^{-1}}{p^{-1} - r^{-1}} \in \interval[o]{0,1} \]
i.e.\ $q^{-1} = \lambda p^{-1} + (1-\lambda)r^{-1}$;
\item $\mathcal{L}^p(X,\mu)\cap \mathcal{L}^r(X,\mu) \subseteq \mathcal{L}^q(X,\mu) \subseteq \mathcal{L}^p(X,\mu) + \mathcal{L}^r(X,\mu)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) First note that
\[ \lambda = \frac{q^{-1} - r^{-1}}{p^{-1} - r^{-1}} \iff \lambda p^{-1} - \lambda r^{-1} = q^{-1} - r^{-1} \iff q^{-1} = \lambda p^{-1} + (1-\lambda)r^{-1}. \]
 
First suppose $r = \infty$, then $|f(x)|^{q-p} \leq \norm{f}_\infty^{q-p}$ a.e., so $|f(x)|^q \leq |f(x)|^p\norm{f}_\infty^{q-p}$ a.e. and
\[ \norm{f}_q \leq \Big(\int |f|^p\norm{f}_\infty^{q-p} \diff\mu\Big)^{1/q} = \norm{f}_p^{p/q}\norm{f}_\infty^{1-p/q} = \norm{f}_p^{\lambda}\norm{f}_\infty^{1-\lambda}, \]
because $\lambda = \frac{q^{-1} - \infty^{-1}}{p^{-1} - \infty^{-1}} = \frac{q^{-1}}{p^{-1}} = p/q$.

Now suppose $r < \infty$. Since $q<\infty$, we have
\[ q^{-1} = \lambda p^{-1} + (1-\lambda)r^{-1} \iff 1 = \frac{\lambda q}{p} + \frac{(1-\lambda) q}{r}, \]
so $p/\lambda q$ and $r/(1-\lambda)q$ are Hölder conjugate and we can use the Hölder's inequality \ref{HoeldersInequality} to calculate
\begin{align*}
\int_X |f|^q \diff{\mu} &= \int_X |f|^{\lambda q}|f|^{(1-\lambda)q} \diff{\mu} \\
&\leq \Big(\int_X \big(|f|^{\lambda q}\big)^{p/\lambda q}\diff{\mu}\Big)^{\lambda q /p} \Big(\int_X \big(|f|^{(1 -\lambda) q}\big)^{r/(1-\lambda)q}\diff{\mu}\Big)^{(1 - \lambda) q /r} \\
&= \Big(\int_X |f|^{p}\diff{\mu}\Big)^{\lambda q /p} \Big(\int_X |f|^{r}\diff{\mu}\Big)^{(1 - \lambda) q /r} \\
&= \norm{f}_p^{\lambda q}\norm{f}_r^{(1-\lambda) q}.
\end{align*}
Taking the $q^\text{th}$ root gives $\norm{f}_q \leq \norm{f}_p^{\lambda}\norm{f}_r^{1-\lambda}$.

(2) The first inclusion follows straight from (1).

For the second inclusion, take $g\in \mathcal{L}^q(X,\mu)$. Set $E \defeq \setbuilder{x\in X}{|f(x)| > 1}$, $g_1 \defeq g\cdot \charFunc{E}$ and $g_2 = g\cdot \charFunc{E^c}$.

Then
\begin{align*}
|g_1|^p &= |g|^p\charFunc{E} \leq |g|^q\charFunc{E} \leq |g|^q < \infty \\
|g_2|^r &= |g|^r\charFunc{E^c} \leq |g|^q\charFunc{E^c} \leq |g|^q < \infty,
\end{align*}
so $g = g_1 + g_2 \in \mathcal{L}^p(X,\mu) + \mathcal{L}^r(X,\mu)$.
\end{proof}


\begin{proposition}
Let $0<p<q \leq \infty$ and $f\in \mathcal{L}^q(X,\mu)$. Then
\begin{enumerate}
\item if $\mu(X)<\infty$, then $\mathcal{L}^p(X,\mu) \supseteq \mathcal{L}^q(X,\mu)$ and $\norm{f}_p \leq \norm{f}_q\cdot\mu(X)^{p^{-1}-q^{-1}}$;
\item if there exists $\epsilon > 0$ such that $\mu(A) > \epsilon$ for all $A\in \mathcal{A}$, then TODO.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) First suppose $q = \infty$. Then
\[ \norm{f}_p^p = \int_X |f|^p\diff\mu \leq \norm{f}_\infty^p\int_X \constant{1}\diff\mu = \norm{f}_\infty^p\mu(X), \]
so $\norm{f}_p \leq \norm{f}_\infty\mu(X)^{1/p} = \norm{f}_\infty\mu(X)^{p^{-1} - \infty^{-1}}$.

Now suppose $q < \infty$. Then $\frac{p}{q} + \frac{q-p}{q} = \frac{q}{q} = 1$ implies that $\frac{q}{p}$ and $\frac{q}{q-p}$ are Hölder conjugate. We use Hölder's inequality \ref{HoeldersInequality} and \ref{pnormLemma} to get
\[ \norm{f}^p_p = \int_X |f|^p \cdot \constant{1}\diff\mu \leq \norm{|f|^p}_{\frac{q}{p}}\norm{\constant{1}}_{\frac{q}{q-p}} = \norm{f}_q^p \mu(X)^{\frac{q-p}{q}}. \]
Taking the $p^\text{th}$ root gives $\norm{f}_p \leq \norm{f}_q\cdot\mu(X)^{p^{-1}-q^{-1}}$.

(2) TODO
\end{proof}


\begin{proposition}
Let $0< p<q \leq \infty$ and $\sSet{X,\mathcal{A},\mu}$ be a measure space. Then
\begin{enumerate}
\item $\mathcal{L}^p(X,\mu) \supseteq \mathcal{L}^q(X,\mu)$ \textup{if and only if} $X$ does not contain sets of finite but arbitrary large measure;
\item $\mathcal{L}^p(X,\mu) \subseteq \mathcal{L}^q(X,\mu)$ \textup{if and only if} $X$ does not contain sets of non-zero but arbitrary small measure.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO \url{https://en.wikipedia.org/wiki/Lp_space#Embeddings}
\end{proof}
\begin{corollary}
For all $0< p<q \leq \infty$ and $a,b\in\R$, we have $\mathcal{L}^p([a,b],\lambda) \supseteq \mathcal{L}^q([a,b],\lambda)$.
\end{corollary}

\subsection{The $L^p(X,\mu)$ spaces}
TODO: identification of a.e.\ equal functions + this is compatible with algebraic operations by \ref{equalAECongruence}.

TODO: allow functions that are only defined a.e.

\begin{proposition}
TODO every equivalence class contains exactly one continuous functions (for Borel measures?)
\end{proposition}

\subsubsection{Completeness and density}

\begin{theorem}[Riesz-Fisher]
The space $L^p(X,\diff{\mu})$ is complete.
\end{theorem}
TODO $\mathcal{L}^p(X,\diff{\mu})$ is complete?

For $L^\infty$: essential supremum.

\begin{proposition}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $1\leq p \leq \infty$. Then $L^p(X,\mu)$ is a Banach space.
\end{proposition}

\begin{proposition}
Let $X$ be a set. For all $1\leq p < \infty$, the set of $p$-integrable simple functions is dense in $L^p(\diff{\mu})$.
\end{proposition}


\begin{proposition}
Let $X$ be a locally compact Hausdorff space and $\mu$ a Radon measure on $X$. Then $\cont_c(X)$ is dense in $L^p(\diff{\mu})$ for all $1\leq p < \infty$.
\end{proposition}
\begin{proof}

\end{proof}





\subsubsection{$L^0(\Omega, \mu)$}
TODO: $\norm{f}_0 = \mu\{f\neq 0\}$ (?)


\subsubsection{The dual system $\pair{f,g} = \int_X fg \diff\mu$}

\begin{lemma}
Let $\sSet{X, \mathcal{A}, \mu}$ be a measure space and $0<p,q\leq \infty$ Hölder conjugate exponents. Then $\sSet{\mathcal{L}^p(X,\mu), \mathcal{L}^q(X,\mu), \pair{\cdot, \cdot}}$ is a pairing, where
\[ \pair{\cdot, \cdot}: \mathcal{L}^p(X,\mu)\times \mathcal{L}^q(X,\mu) \to \C: (f,g) \mapsto \pair{f,g} \defeq \int_X f\cdot g \diff\mu. \]
\end{lemma}
\begin{proof}
The pairing is bilinear by linearity of the integral. We just need to observe that the function is well-defined. This follows from Hölder's inequality \ref{HoeldersInequality}.
\end{proof}

\begin{proposition}
Let $\sSet{X, \mathcal{A}, \mu}$ be a measure space and $1 \leq p,q\leq \infty$ Hölder conjugate exponents. The function $L^q(X,\mu)\to \dual{L^p(X,\mu)}: f \mapsto \pair{f,-}$ is an isometry if either
\begin{enumerate}
\item $q<\infty$; or
\item $\mu$ is semi-finite.
\end{enumerate}
\end{proposition}
TODO: can we learn anything by considering polar topologies?
\begin{proof}
TODO Folland p.188
\end{proof}

\begin{proposition}
Let $\sSet{X, \mathcal{A}, \mu}$ be a measure space and $1\leq p,q \leq \infty$ Hölder conjugate exponents. The function $L^q(X,\mu)\to \dual{L^p(X,\mu)}: f \mapsto \pair{f,-}$ is an isometry if either
\begin{enumerate}
\item $1<p<\infty$; or
\item $p=1$ and $\mu$ is $\sigma$-finite.
\end{enumerate}
\end{proposition}

\begin{example}
TODO: counterexamples. See Folland p. 191.
\end{example}

\subsection{Operators on $L^p$ spaces}
\subsubsection{Multiplication operators}
\begin{definition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $f\in \meas(\Omega, \C)$ and $1\leq p \leq \infty$. Then
\[ M_f: L^p(X, \diff{\mu}) \to L^p(X, \diff{\mu}): g\mapsto f\cdot g \]
with domain
\[ \dom(M_f) = \setbuilder{g\in L^p(X, \diff{\mu})}{f\cdot g \in L^p(X, \diff{\mu})} \]
is called a \udef{multiplication operator}.
\end{definition}

\begin{proposition} \label{boundedMultiplicationOperator}
Let $(\Omega, \mathcal{A}, \mu)$ be a semi-finite measure space, $f\in \meas(\Omega, \C)$ and $1\leq p < \infty$. Then $M_f$ is bounded \textup{if and only if} $f$ is essentially bounded.

In this case $\norm{M_f} = \essup(f)$.
\end{proposition}
TODO also holds for $p = \infty$.
\begin{proof}
$\boxed{\Rightarrow}$ We prove the contraposition. Assume $f$ is not essentially bounded. For all $n$, consider $A_n = \{|f| \geq n\}$, which is in $\mathcal{A}$ by \ref{measurablesSetsRealMeasurableFunction}. Then $\mu(A_n) > 0$. By semi-finiteness, we can find $B_n\subseteq A_n$ such that $B_n\in \mathcal{A}$ and $0 < \mu(B_n)< \infty$. Then $\norm{\charFunc{B_n}}_p = \mu(B_n)^{1/p}$, which means $\charFunc{B_n}\in L^p(X, \diff{\mu})$. We have
\begin{align*}
\norm{M_f\charFunc{B_n}}_p^p &= \int_\Omega |f\cdot \charFunc{B_n}|^{p}\diff{\mu} \\
&= \int_\Omega \charFunc{B_n}\cdot|f|^p\diff{\mu} \\
&= \int_{B_n}|f|^p\diff{\mu} \\
&\geq n^p\int_{B_n}\diff{\mu} \\
&= n^p\mu(B_n) = n^p\norm{\charFunc{B_n}}^p,
\end{align*}
which implies $\norm{M_f\charFunc{B_n}}_p \geq n\norm{\charFunc{B_n}}_p$ for all $n\in \N$. Thus $M_f$ is not bounded.

$\boxed{\Leftarrow}$ Set $f' = |f| \wedge \underline{\essup(f)}$, which is measurable by \ref{modulusMeasurable} and \ref{limitOperationsOnRealMeasurableFunctions}. Also $|f| = f'$ almost everywhere. Then, for $g\in L^p(X, \diff{\mu})$, we have
\begin{align*}
\norm{M_fg}_p^p &= \int_\Omega |f\cdot g|^p \diff{\mu} \\
&= \int_\Omega f'^p\cdot |g|^p \diff{\mu} \\
&\leq \essup(f)^p\int_\Omega |g|^p \diff{\mu} = \essup(f)^p\norm{g}_p^p.
\end{align*}
Thus $M_f$ is bounded and $\norm{M_f} \leq \essup(f)$.

Finally, we need to prove $\norm{M_f} \geq \essup(f)$. Take arbitrary $\epsilon > 0$. Consider $A_\epsilon = \{|f| \geq \essup(f)-\epsilon\}$, which is in $\mathcal{A}$ by \ref{measurablesSetsRealMeasurableFunction}. By construciton, $\mu(A_\epsilon) > 0$. By semi-finiteness, we can find $B_\epsilon\subseteq A_\epsilon$ such that $B_\epsilon\in \mathcal{A}$ and $0 < \mu(B_\epsilon)< \infty$. Then $\norm{\charFunc{B_\epsilon}}_p = \mu(B_\epsilon)^{1/p}$, which means $\charFunc{B_\epsilon}\in L^p(X, \diff{\mu})$. We have
\begin{align*}
\norm{M_f\charFunc{B_\epsilon}}_p^p &= \int_\Omega |f\cdot \charFunc{B_\epsilon}|^{p}\diff{\mu} \\
&= \int_\Omega \charFunc{B_\epsilon}\cdot|f|^p\diff{\mu} \\
&= \int_{B_\epsilon}|f|^p\diff{\mu} \\
&\geq (\essup(f)-\epsilon)^p\int_{B_\epsilon}\diff{\mu} \\
&= \big(\essup(f)-\epsilon\big)^p\mu(B_\epsilon) = \big(\essup(f)-\epsilon\big)^p\norm{B_\epsilon}^p,
\end{align*}
which implies $\norm{M_f\charFunc{B_\epsilon}}_p \geq \big(\essup(f)-\epsilon\big)\norm{B_\epsilon}$, and so $\norm{M_f} \geq \essup(f)-\epsilon$ for all $\epsilon >0$. Thus $\norm{M_f} \geq \essup(f)$.
\end{proof}

\subsection{Locally integrable spaces}
\begin{definition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space. The \udef{locally $L^p$} space is the space
\[ L^p_\text{loc}(\Omega) \defeq \setbuilder{f \in (\Omega\to\C)}{\text{$f\in L^p(K)$ for all compact $K\subset \Omega$}}. \]
The functions in $L^1_\text{loc}(\Omega)$ are called \udef{locally integrable} on $\Omega$.
\end{definition}
TODO: deal with equivalence classes??


\subsection{Sequence spaces}
TODO:  $L^p(A,\mu)$ with $\mu$ counting measure.

Let $J$ be a countable index set and $x:J\to \mathbb{F}$ a sequence indexed by $J$. We define
\[ \norm{x}_p := \left(\sum_{j\in J}|x(j)|^p\right)^{1/p} \qquad\text{and}\qquad \norm{x}_\infty = \sup_{j\in J}|x(j)|. \]
So $\norm{\cdot}_1$ is the standard norm on $\mathbb{F}^n$. For general sequences there is no guarantee that these norms do not diverge.
\begin{definition}
Let $J$ be an index set, $D$ a directed set and $p\geq 1$,
\begin{align*}
\ell^p(J) &= \setbuilder{x:J\to \F}{\norm{x}_p < +\infty},\\
\ell^\infty(J) &= \setbuilder{x:J\to \F}{\norm{x}_\infty < +\infty},\\
c_0(D) &= \setbuilder{x:D\to \F}{\lim_{n\to\infty}|x(n)| = 0}, \\
c_{00}(D) &= \setbuilder{x:D\to \F}{\setbuilder{n\in D}{x(n)\neq 0}\;\text{has finite cardinality}}.
\end{align*}
unless specified we equip $c_0$ and $c_{00}$ with the norm $\norm{\cdot}_\infty$.
\end{definition}

\begin{lemma}
$c_{00}$ is dense in $\ell^p$ if it is equipped with the norm $\norm{\cdot}_p$ and dense in $c_0$ if it is equipped with the norm $\norm{\cdot}_\infty$.
\end{lemma}

Let $1<p,q<\infty$ satisfy $\frac{1}{p}+\frac{1}{q}$. We have the inequalities
\begin{align*}
\norm{xy}_1 &\leq \norm{x}_p\norm{y}_q\qquad\text{(Hölder inequality)} \\
\norm{x+y}_p &\leq \norm{x}_p+\norm{y}_p\qquad\text{(Minkowski inequality)}
\end{align*}
which follow from the general cases (TODO ref) by applying the counting measure.

\begin{proposition}
The continuous dual of $l^p(J)$ is $l^q(J)$ where $1<p,q<\infty$ satisfy $\frac{1}{p}+\frac{1}{q}$.
Also, the continuous dual of $l^1$ is $l^\infty$.
\end{proposition}



\section{Classification by support}
\begin{definition}
Let $\sSet{\Omega, \xi}$ be a convergence space, $\sSet{V,\zeta}$ a convergence vector space and $f\in (\Omega\to V)$.
\begin{itemize}
\item The \udef{set-theoretic support} of $f$ is
\[ \supp_\text{st}(f) \defeq \setbuilder{x\in \Omega}{f(x) \neq 0}. \]
\item The \udef{(closed) support} of $f$ is $\supp(f) \defeq \closure_\xi\big(\supp_\text{st}(f)\big)$.
\end{itemize}
\end{definition}

\begin{lemma}
Let $\sSet{\Omega, \xi}$ be a convergence space, $\sSet{V,\zeta}$ a Hausdorff convergence vector space and $A\subseteq \Omega$ a subset. Then
\begin{enumerate}
\item $\setbuilder{f\in (\Omega\to V)_p}{\supp_\text{st}(f)\subseteq A}$ is a closed subset of $(\Omega\to V)_p$;
\item if $A$ is closed, then $\setbuilder{f\in (\Omega\to V)_p}{\supp(f)\subseteq A}$ is a closed subset of $(\Omega\to V)_p$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Set $X \defeq \setbuilder{f\in (\Omega\to V)_p}{\supp_\text{st}(f)\subseteq A}$.

We need to show that $\adh_p(X) \subseteq X$. To that end, take $f\in \adh_p(X)$, then, by \ref{principalAdherenceInherence}, there exists $H\in \powerfilters(\Omega\to V)$ such that $X\in H$. For all $b\notin A$, we have $\evalMap_b^{\imf\imf}(H) = \pfilter{0}$. As $\evalMap_b^{\imf\imf}(H) \to f(b)$, we have that $f(b) = 0$ by Hausdorffness, which means that $f\in X$.

(2) If $A$ is closed, then $\overline{\supp_\text{st}(f)}\subseteq A \iff \supp_\text{st}(f) \subseteq A$.
\end{proof}

\subsection{Functions of compact support}
\begin{definition}
Let $\sSet{\Omega, \xi}$ be a convergence space and $\sSet{V,\zeta}$ a convergence vector space. We define
\begin{itemize}
\item $(\Omega\to V)_C \defeq \setbuilder{f\in (\Omega\to V)}{\text{$\supp(f)$ is compact}}$;
\item $\cont_C(\Omega,V) \defeq (\Omega\to V)_C \cap \cont(\Omega, V)$;
\item $W_C \defeq (\Omega\to V)_C \cap W$ for all subspaces $W\subseteq (\Omega\to V)$.
\end{itemize}
\end{definition}
Note that $(\Omega\to V)_C \neq (\Omega\to V)_c$ and $\cont_C(\Omega) \neq \cont_c(\Omega)$!

Observation: if $\Omega$ is Hausdorff, then the set of compact subsets of $\Omega$ forms a $\pi$-system of closed subsets of $\Omega$. This means that

\section{Distributions}
\begin{definition}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $f: \Omega\to \overline{\R^+}$ a measurable function. The \udef{distribution function} of $f$ is the function
\[ D_f: \overline{\R^+}\to \overline{\R^+}: \alpha \mapsto \mu\setbuilder[\big]{\omega}{f(\omega)>\alpha}.  \]
\end{definition}

\begin{lemma} \label{distributionContinuity}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $f: \Omega\to \overline{\R^+}$ a measurable function. Then
\begin{enumerate}
\item $D_f$ is monotonically decreasing;
\item $D_f$ is right-continuous.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Let $\alpha \leq \beta$, then $\setbuilder{\omega}{f(\omega) > \alpha} \supseteq \setbuilder{\omega}{f(\omega) > \beta}$, so
\[ D_f(\alpha) = \mu\setbuilder{\omega}{f(\omega) > \alpha} \geq \mu\setbuilder{\omega}{f(\omega) > \beta} = D_f(\beta). \]


(2) Since the lower limit topology is sequential, by \ref{SorgenfreyLineC1}. It is enough to check that $D_f$ is sequentially continuous.


Take an arbitrary sequence that converges to an arbitrary $x\in\overline{\R^+}_{ll}$. By \ref{lowerLimitConvergenceDecreasingSubsequence}, we can find a decreasing subsequence $\seq{x_n}$. Then $\seq{D_f(x_n)}$ is monotonically increasing.

Now we can calculate
\begin{align*}
\lim_{n\to\infty} D_f(x_n) &= \sup_{n\in\N}D_f(x_n) \\
&= \sup_{n\in\N} \mu\setbuilder{\omega}{f(\omega) > x_n} \\
&= \mu\Big(\bigcup_{n\in\N}\setbuilder{\omega}{f(\omega) > x_n}\Big) \\
&= \mu\setbuilder{\omega}{f(\omega) > x} \\
&= D_f(x),
\end{align*}
where we have used \ref{premeasureChainContinuous}. We have also used the fact that $\bigcup_{n\in\N}\setbuilder{\omega}{f(\omega) > x_n} = \setbuilder{\omega}{f(\omega) > x}$, which we now prove:
The inclusion $\bigcup_{n\in\N}\setbuilder{\omega}{f(\omega) > x_n} \subseteq \setbuilder{\omega}{f(\omega) > x}$ follows from the fact that $\setbuilder{\omega}{f(\omega) > x_n} \subseteq \setbuilder{\omega}{f(\omega) > x}$ for all $n\in \N$. For the other inequality, take $\omega \in \setbuilder{\omega}{f(\omega) > x}$. Then $\omega \in \setbuilder{\omega}{f(\omega) > x+(f(\omega)-x)/2}$ and there exists an $x_m$ such that
\[ \setbuilder{\omega}{f(\omega) > x+(f(\omega)-x)/2} \subseteq \setbuilder{\omega}{f(\omega) > x_m}. \] 
\end{proof}

\begin{lemma} \label{distributionOfFunctionLemma}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $f,g: \Omega\to \overline{\R^+}$ measurable functions and $c\in \interval[o]{0,\infty}$. Then
\begin{enumerate}
\item if $f \leq g$ a.e., then $D_f \leq D_g$;
\item $D_{cf}(\alpha) = D_f\Big(\frac{\alpha}{c}\Big)$;
\item $D_{f+g}(\alpha+\beta) \leq D_f(\alpha) + D_g(\beta)$;
\item $D_{fg}(\alpha\beta) \leq D_f(\alpha) + D_g(\beta)$.
\end{enumerate}
\end{lemma}
In particular if $f = g$ a.e., then $D_f = D_g$. If $h,h': \Omega\to \C$ are measurable functions, then $D_{|h+h'|}\leq D_{|h|+|h'|} \leq D_{|h|} \leq D_{|h'|}$.
\begin{proof}
(1) Fix $\alpha\in \overline{\R^+}$ and set
\[ N \defeq \{f > g\}, \quad A \defeq \{f \geq \alpha\}, \quad\text{and}\quad B \defeq \{g \geq \alpha\}. \]
For all $\omega\in\Omega$, we have that $f(\omega)\leq g(\omega)$ and $\alpha < f(\omega)$ imply $\alpha < g(\omega)$, so
\[ A\setminus (N\cap A) = A\setminus N = A\cap N^c \subseteq B. \]
Also $N$ is measurable (by \ref{measurablesSetsRealMeasurableFunction}) and a null set (by assumption). 
As $(N\cap A) \subseteq A$ and $N\cap A$ is measurable, we have \[ \mu\big(A\setminus (N\cap A)\big) = \mu(A) - \mu(N\cap A) = \mu(A) - 0 = \mu(A), \]
using \ref{ringPositiveContent} and \ref{measureNullSet}. Thus we have
\[ D_f(\alpha) = \mu(A) = \mu\big(A\setminus (N\cap A)\big) = \mu(A\cap N^c) \leq \mu(B) = D_g(\alpha), \]
where the inequality is given by \ref{semiringPositiveContent}.

(2) We have $\{cf>\alpha\} = \{f>\frac{\alpha}{c}\}$.

(3) Take $\alpha,\beta\in \R^+$ and $\omega\in \Omega$. 
Because the order on $\overline{\R^+}$ is linear, \ref{additionVectorInequalities} gives
\[ \alpha + \beta < f(\omega) + g(\omega) \;\implies\; \big(\alpha < f(\omega)\big) \lor \big(\beta < g(\omega)\big). \]
This implications shows
\[ \{\alpha + \beta < f(\omega)+g(\omega)\} \;\subseteq\; \{\alpha < f(\omega)\} \cup \{\beta < g(\omega)\}. \]
Thus we calculate
\begin{align*}
D_{f+g}(\alpha+\beta) &= \mu\{\alpha + \beta < f(\omega)+g(\omega)\} \\
&\leq \mu\Big(\{\alpha < f(\omega)\} \cup \{\beta < g(\omega)\}\Big) \\
&\leq \mu\{\alpha < f(\omega)\} + \mu \{\beta < g(\omega)\} \\
&= D_f(\alpha) + D_g(\beta)
\end{align*}
by \ref{semiringPositiveContent}.

(4) Take $\alpha,\beta\in \overline{\R^+}$ and $\omega\in \Omega$. Then we have the implication
\[ \{\alpha\beta < f(\omega)g(\omega)\} \;\subseteq\; \{\alpha < f(\omega)\} \cup \{\beta < g(\omega)\}. \]
Thus we calculate
\begin{align*}
D_{fg}(\alpha+\beta) &= \mu\{\alpha\beta < f(\omega)g(\omega)\} \\
&\leq \mu\Big(\{\alpha < f(\omega)\} \cup \{\beta < g(\omega)\}\Big) \\
&\leq \mu\{\alpha < f(\omega)\} + \mu \{\beta < g(\omega)\} \\
&= D_f(\alpha) + D_g(\beta)
\end{align*}
by \ref{semiringPositiveContent}.
\end{proof}



\begin{proposition}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a $\sigma$-finite measure space, $\varphi: \R^+\to \R^+$ a monotone differentiable function with $\phi(0) = 0$ and $f: X\to \R^+$ a measurable function such that $\varphi\circ f$ is integrable. Then
\[ \int_\Omega\varphi\circ f \diff{\mu} = \int_0^\infty \varphi'(\alpha)D_f(\alpha)\diff{\alpha}. \]
\end{proposition}
\begin{proof}
We have
\begin{align*}
\int_\Omega\varphi\big(f(\omega)\big) \diff{\mu(\omega)} &= \int_\Omega\int_{0}^{f(\omega)}\varphi'(\alpha)\diff{\alpha} \diff{\mu(\omega)} \\
&= \int_\Omega\int_{0}^{\infty}[\alpha < f(\omega)]\varphi'(\alpha)\diff{\alpha} \diff{\mu(\omega)} \\
&= \int_{0}^{\infty}\varphi'(\alpha)\int_\Omega[\alpha < f(\omega)]\diff{\mu(\omega)}\diff{\alpha} \\
&= \int_{0}^{\infty}\varphi'(\alpha)D_f(\alpha)\diff{\alpha}.
\end{align*}
by Tonelli's theorem \ref{tonellisTheorem} (as $\varphi'$ is positive) and \ref{weakSecondTheoremCalculus}.
\end{proof}
\begin{corollary} \label{LpNormFromDistribution}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a $\sigma$-finite measure space, $0<p<\infty$ and $f\in \mathcal{L}^p(X,\mu)$. Then
\[ \norm{f}_p = \left(p\int_0^\infty \alpha^{p-1}D_f(\alpha)\diff{\alpha}\right)^{1/p}. \]
\end{corollary}
\begin{proof}
Take $\varphi: \alpha\mapsto \alpha^p$. Then $\varphi'(\alpha) = p\alpha^{p-1}$ and so
\[ \norm{f}_p^p = \int_\Omega |f|^p \diff{\mu} = \int_\Omega \varphi\circ|f| \diff{\mu} = \int_0^\infty \varphi'(\alpha)D_f(\alpha)\diff{\alpha} = p\int_0^\infty \alpha^{p-1}D_f(\alpha)\diff{\alpha}. \]
\end{proof}

\subsection{Distribution inequalities}
\begin{proposition}[Markov's inequality]
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $f:\Omega\to\C$ a measurable function and $\alpha>0$. Then
\[ D_f(\alpha) + \mu\{f = \alpha\} = \mu\{f\geq \alpha\} \leq \frac{1}{\alpha}\int_{\{f\geq \alpha\}}f\diff{\mu} \leq \frac{1}{\alpha}\int_\Omega f\diff{\mu}. \]
\end{proposition}
Also called Chebyshev's inequality or Chebyshev's first inequality. The next inequality would then be Chebyshev's second inequality. 
\begin{proof}
We have $\alpha\cdot \big[f(\omega)\geq \alpha\big]\leq f(\omega)$ for all $\omega\in\Omega$, so
\[ \alpha\cdot \mu\{f\geq \alpha\} = \alpha \int_{\{f\geq \alpha\}}\constant{1}\diff{\mu} = \int_{\{f\geq \alpha\}}\constant{\alpha}\diff{\mu} \leq \int_{\{f\geq \alpha\}}f\diff{\mu} \leq \int_\Omega f\diff{\mu}, \]
using \ref{measureFromIntegralCharacteristicFunctions}, \ref{simpleIntegralOverSubset} and \ref{propertiesIntegralPositiveFunctions}. This implies Markov's inequality.
\end{proof}
\begin{corollary}[Chebyshev's inequality]
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $f:\Omega\to\R$ a measurable function, $\varphi:\im(f) \to \R^+$ a monotone measurable function and $\alpha>0$. Then
\[ \mu\{f\geq \alpha\} \leq \frac{1}{\varphi(\alpha)}\int_{\{\varphi\circ f \geq \varphi(\alpha)\}} \varphi\circ f\diff{\mu} \leq \frac{1}{\varphi(\alpha)}\int_\Omega \varphi\circ f\diff{\mu}. \]
\end{corollary}
\begin{proof}
Since $\varphi$ is monotone, we have $\{f\geq \alpha\} \subseteq \{\varphi\circ f\geq \varphi(\alpha)\}$, so
\[ \mu\{f\geq \alpha\} \leq \mu\{\varphi\circ f\geq \varphi(\alpha)\} \leq \frac{1}{\varphi(\alpha)}\int_{\{\varphi\circ f \geq \varphi(\alpha)\}} \varphi\circ f\diff{\mu} \leq \frac{1}{\varphi(\alpha)}\int_\Omega \varphi\circ f\diff{\mu}, \]
using \ref{semiringPositiveContent}.
\end{proof}
By choosing specific functions $\varphi$, we obtain the following forms of Chebyshev's inequality:
\begin{corollary} \label{ChebyshevInequalityCorollary}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $f:\Omega\to\R^+$ a positive measurable function, $g: \Omega\to \C$ a measurable function, $\alpha>0$ and $0<p$. Then
\begin{enumerate}
\item $D_f(\alpha) \leq \mu\{f\geq \alpha\} \leq \frac{1}{\alpha^p}\int_{\{f \geq \alpha\}} f^p\diff{\mu} \leq \frac{1}{\alpha^p}\int_\Omega f^p\diff{\mu}$;
\item $\alpha D_{|g|}(\alpha)^{1/p}\leq \norm{g}_p$.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) The function $x\mapsto x^p$ is monotone. It is also an order similarity, so $\{f \geq \alpha\} = \{f^p \geq \alpha^p\}$.

(2) We use (1) to obtain $D_{|g|}(\alpha) \leq D_{|g|}(\alpha) + \mu\{|g| = \alpha\} \leq \frac{1}{\alpha^p}\int_\Omega |f|^p\diff{\mu} = \left(\frac{\norm{f}_p}{\alpha}\right)^p$.
\end{proof}
\begin{corollary}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $\alpha>0$, $0<p$ and $f:\Omega\to\R^+$ a positive measurable function such that $\norm{f}_p < \infty$. Then
\begin{enumerate}
\item $\lim_{\alpha \to +\infty}\alpha^p D_f(\alpha) = 0$;
\item $\lim_{\alpha \to 0}\alpha^p D_f(\alpha) = 0$.
\end{enumerate}
\end{corollary}
TODO: Hao requires $p\geq 1$ for (2). Why?
\begin{proof}
(1) We have
\begin{align*}
0 \leq \lim_{\alpha \to +\infty}\alpha^p D_f(\alpha) &\leq \lim_{\alpha \to +\infty}\int_{\{f \geq \alpha\}} f^p\diff{\mu} \\
&= \lim_{\alpha \to +\infty}\int_\Omega [f \geq \alpha] f^p\diff{\mu} \\
&= \int_\Omega \lim^p_{\alpha \to +\infty}[f \geq \alpha] f^p\diff{\mu} \\
&= \int_\Omega \constant{0}\diff{\mu} = 0,
\end{align*}
where we have used \ref{functionPropertiesFromIntegral} and the dominated convergence theorem \ref{dominatedConvergence}, since $[f \geq \alpha]\cdot f^p$ is dominated by $f^p$, which is integrable by assumption.

(2) Fix $\alpha > 0$. For all $\beta > \alpha$ we have
\begin{align*}
\alpha^p\big(D_f(\alpha) - D_f(\beta)\big) &= \alpha^p\big(\mu\{f > \alpha\} - \mu\{f >\beta\}\big) \\
&= \alpha^p\mu\big(\{f > \alpha\} \setminus \{f >\beta\}\big) \\
&= \alpha^p\mu\{\alpha < f \leq \beta\} \\
&= \alpha^p\int_\Omega[\alpha < f \leq \beta]\diff{\mu} \\
&\leq \int_\Omega[\alpha < f \leq \beta]f^p\diff{\mu} \\
&\leq \int_\Omega[f \leq \beta]f^p\diff{\mu},
\end{align*}
using \ref{ringPositiveContent}, \ref{measureFromIntegralCharacteristicFunctions} and \ref{propertiesIntegralPositiveFunctions}. Now
\begin{align*}
\lim_{\alpha\to 0}\alpha^p D_f(\alpha) &= \lim_{\alpha\to 0}\alpha^p D_f(\alpha) - \alpha^p D_f(\beta) \\
&= \lim_{\alpha\to 0}\alpha^p \big(D_f(\alpha) - D_f(\beta)\big) \\
&\leq \lim_{\alpha\to 0} \int_\Omega[f \leq \beta]f^p\diff{\mu} \\
&= \int_\Omega[f \leq \beta]f^p\diff{\mu}.
\end{align*}
We have
\[ \lim_{\beta\to 0}\int_\Omega[f \leq \beta]f^p\diff{\mu} = \int_\Omega\lim_{\beta\to 0}[f \leq \beta]f^p\diff{\mu} = \int_\Omega \constant{0}\diff{\mu} = 0 \]
by \ref{functionPropertiesFromIntegral} and the dominated convergence theorem \ref{dominatedConvergence}. Since we are considering the limit $\alpha \to 0$, we can take $\beta$ arbitrarily small, and thus $\int_\Omega[f \leq \beta]f^p\diff{\mu}$ becomes arbitrarily small and we have $\lim_{\alpha \to 0}\alpha^p D_f(\alpha) = 0$.
\end{proof}

\subsection{Decreasing rearrangements}
\begin{definition}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space and $f: \Omega\to \R$ a measurable function. The \udef{decreasing rearrangement} of $f$ is the function
\[ \decRearrange{f}: \overline{\R^+}\to \overline{\R^+}: t \mapsto \inf\setbuilder{\alpha > 0}{D_f(\alpha)\leq t} = \inf D_f^{\preimf}\big(\interval{0,t}\big).  \]
\end{definition}

The function $\decRearrange{f}$ is decreasing and supported in $\interval[c]{0,\mu(X)}$.



\begin{proposition}
Let $\sSet{\Omega, \mathcal{A}, \mu}$ be a measure space, $f: \Omega\to \overline{\R^+}$ a measurable function and $s,t\in \overline{\R^+}$. Then
\begin{enumerate}
\item $\decRearrange{f}\big(D_f(t)\big) \leq t$;
\item $D_f\big(\decRearrange{f}(s)\big) \leq s$;
\item $s < \decRearrange{f}(s) \iff t < D_f(s)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have $t\in D_f^\preimf\big(\interval{0,D_f(t)}\big)$, so
\[ \decRearrange{f}\big(D_f(t)\big) = \inf D_f^\preimf\big(\interval{0,D_f(t)}\big)\leq \inf\{t\} = t. \]

(2)

(3) We calculate
\[ s < \decRearrange{f}(s) \iff s< \inf D_f^{\preimf}\big(\interval{0,t}\big) \iff s\notin D_f^{\preimf}\big(\interval{0,t}\big) \iff D_f(s) \notin \interval{0,t} \iff t < D_f(s), \]
where we have used the fact that $D_f^{\preimf}\big(\interval{0,t}\big)$ is upwards closed and topologically closed.
\end{proof}


\subsection{Convergence in measure}
\begin{definition}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space, $F\in \powerfilters\big(\meas(\Omega, \C)\big)$ and $f\in \meas(\Omega, \C)$. Then $F$ is said to \udef{converge in measure} to $f$ if
\[ \upset D_{|-|}(\epsilon)^{\imf\imf}(F-f) \overset{\overline{\R^+}}{\longrightarrow} 0 \]
for all $\epsilon > 0$.
\end{definition}

\begin{lemma}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space. The following are group norms on $\meas(\Omega, \C)$ whose norm topology coincides with convergence in measure:
\begin{enumerate}
\item $n_1: f \mapsto \min\setbuilder[\big]{\epsilon > 0}{D_{|f|}(\epsilon) \leq \epsilon}$;
\item $n_2: f \mapsto \inf_{\epsilon>0} D_{|f|}(\epsilon) + \epsilon$;
\item if $\mu$ is finite, $n_4: f \mapsto \int_\Omega \frac{|f|}{1+|f|}\diff{\mu}$;
\item if $\mu$ is finite, $n_5: f \mapsto \int_\Omega\min\{|f|, \underline{1}\}\diff{\mu}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We first need to show that this is well-defined, i.e.\ that $\setbuilder[\big]{\epsilon > 0}{D_{|f|}(\epsilon) \leq \epsilon}$ has a minimum.

Set $\epsilon' = \inf\setbuilder[\big]{\epsilon > 0}{D_{|f|}(\epsilon) \leq \epsilon}$. We need to show that $D_{|f|}(\epsilon') \leq \epsilon'$, or $0 \leq \epsilon'- D_{|f|}(\epsilon')$. By \ref{sequencesToExtrema}, we can find a decreasing sequence $\seq{x_n}$ in $\setbuilder[\big]{\epsilon > 0}{D_{|f|}(\epsilon) \leq \epsilon}$ that converges to $\epsilon'$.

Since $\epsilon'- D_{|f|}(\epsilon') = \epsilon' + \big(- D_{|f|}(\epsilon')\big)$ is the sum of two increasing functions, it is increasing and $x_n- D_{|f|}(x_n) \geq 0$ for all $n\in \N$. Thus $\seq{x_n- D_{|f|}(x_n)}$ is a sequence that converges to $\epsilon'- D_{|f|}(\epsilon')$ by right-continuity of $D_{|f|}$, \ref{distributionContinuity}. Since limits preserve inequalities, $\epsilon'- D_{|f|}(\epsilon')$ is positive.

Now we prove that $n_1$ is a group seminorm. It is clear that $n_1(f) = n_1(-f)$ for all $f\in\meas(\Omega, \C)$. Next we prove the triangle inequality. Take arbitrary $f,g\in \meas(\Omega, \C)$. We prove that $D_{|f+g|}\big(n_1(f) + n_1(g)\big) \leq n_1(f) + n_1(g)$, since this implies $n_1(f) + n_1(g) \in \setbuilder[\big]{\epsilon > 0}{D_{|f+g|}(\epsilon) \leq \epsilon}$ and thus
\[ n_1(f+g) = \min\setbuilder[\big]{\epsilon > 0}{D_{|f+g|}(\epsilon) \leq \epsilon} \leq n_1(f) + n_1(g). \]
The proof is as follows:
\begin{align*}
D_{|f+g|}\big(n_1(f) + n_1(g)\big) &= \mu\{|f+g| \leq n_1(f) + n_1(g)\}^c \\
&\leq \mu\{|f|+|g| \leq n_1(f) + n_1(g)\}^c \\
&\leq \mu\big(\{|f| \leq n_1(f)\} \cap \{|g| \leq n_1(g)\}\big)^c \\
&= \mu\big(\{|f| \leq n_1(f)\}^c \cup \{|g| \leq n_1(g)\}^c\big) \\
&\leq \mu\{|f| \leq n_1(f)\}^c + \mu\{|g| \leq n_1(g)\}^c \\
&= D_{|f|}\big(n_1(f)\big) + D_{|g|}\big(n_1(g)\big) \\
&\leq n_1(f) + n_1(g),
\end{align*}
where we have used \ref{semiringPositiveContent} and the fact that $D_{|f|}\big(n_1(f)\big)\leq n_1(f)$ and $D_{|g|}\big(n_1(g)\big)\leq n_1(g)$ (i.e.\ that the minimum is reached).
\end{proof}

\begin{definition}
The metric $d_1$ is known as the \udef{Ky Fan metric}. We can define a whole family of Ky Fan metrics
\[ K_\lambda: (f,g) \mapsto \inf\setbuilder[\big]{\epsilon > 0}{D_{|f-g|}(\lambda\epsilon) \leq \epsilon} \]
\end{definition}

\begin{proposition}
$\lim_{\lambda\to 0}K_\lambda(\cdot) = \norm{\cdot}_0$ and $\lim_{\lambda\to \infty}K_\lambda(\cdot) = \norm{\cdot}_\infty$.
\end{proposition}
\begin{proof}
TODO \url{https://statistik.econ.kit.edu/download/doc_secure1/3_StochModels_Appendix.pdf}
\end{proof}

\begin{lemma}
Let $(\Omega, \mathcal{A}, \mu)$ be a measure space. Then convergence in measure is a topological vector space convergence on $\meas(\Omega,\C)$ with neighbourhood filter
\[ \neighbourhood(0) = \bigvee_{\epsilon > 0}\upset D_{|-|}(\epsilon)^{\preimf\imf}(\neighbourhood_\R(0)). \]
\end{lemma}
\begin{proof}
By construction, the function $f\mapsto f+g$ is a homeomorphism for all $g\in \meas(\Omega, \C)$. Thus it is sufficient to consider the vicinity at the origin and verify the conditions in \ref{TVSconstruction}.

Take $F\in\powerfilters\big(\meas(\Omega,\C)\big)$. Then
\begin{align*}
\upset D_{|-|}(\epsilon)^{\imf\imf}(F) \overset{\overline{\R^+}}{\longrightarrow} 0 &\iff \neighbourhood_\R(0) \subseteq \upset D_{|-|}(\epsilon)^{\imf\imf}(F) \\
&\iff \upset D_{|-|}(\epsilon)^{\preimf\imf}(\neighbourhood_\R(0)) \subseteq F.
\end{align*}
This holds for all $\epsilon > 0$ if and only if $\bigvee_{\epsilon>0}\upset d_{|-|}(\epsilon)^{\preimf\imf}(\neighbourhood_\R(0)) \subseteq F$. Thus the convergence is pretopological with the prescribed neighbourhood filter.

We are now ready to verify the conditions in \ref{TVSconstruction}. Take arbitrary $A\in \bigvee_{\epsilon>0}\upset D_{|-|}(\epsilon)^{\preimf\imf}(\neighbourhood_\R(0))$. So for all $\epsilon > 0$ there exists $\delta > 0$ such that $D_{|-|}(\epsilon)^{\preimf}\big(\interval{0,\delta}\big) \subseteq A$, which is equivalent to
\[ \interval{0,\delta} \subseteq D_{|-|}(\epsilon)^{\imf\imf}\big(\interval{0,\delta}\big) \]
Take arbitrary $\lambda\in \C$. \ref{distributionOfFunctionLemma}
\end{proof}


\subsection{Weak $L^p(X,\diff{\mu})$ spaces}
\begin{definition}
Let $0<p<\infty$ and let $\sSet{X,\mathcal{A}, \mu}$ be a measure space. Then we define the extended real functional
\[ \norm{\cdot}_{p,\infty}: \meas(X, \C)\to \overline{\R}^+: f\mapsto \sup\setbuilder{\alpha D_f(\alpha)^{1/p}}{\alpha > 0}. \]
The \udef{weak $L^p(X,\diff{\mu})$ space}, denoted $L^{p,\infty}(X,\diff{\mu})$, is the subset of functions $f$ in $\meas(X, \C)$ for which $\norm{f}_{p,\infty}$ is finite.
\end{definition}

\begin{lemma}
Let $0<p<\infty$, let $\sSet{X,\mathcal{A}, \mu}$ be a measure space and $f\in \meas(X, \C)$. Then
\[ \norm{f}_{p,\infty} = \inf\setbuilder{C\in \R^+}{\forall \alpha>0: \; D_f(\alpha) \leq \frac{C^p}{\alpha^p}}. \]
\end{lemma}


\begin{proposition}
Let $0<p<\infty$ and let $\sSet{X,\mathcal{A}, \mu}$ be a measure space. Then
\begin{enumerate}
\item the functional $\norm{\cdot}_{p,\infty}$ is constant on the equivalence classes of a.e.\ equality;
\item $\norm{\cdot}_{p,\infty}: \Big(\meas(X, \C)/\overset{a.e.}{=}\Big) \to \overline{\R}^+$ is a quasi-norm;
\item $\norm{\cdot}_{p,\infty} \leq \norm{\cdot}_{p}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) If $f = g$ a.e.\ then $D_f = D_g$ by \ref{distributionOfFunctionLemma}.

(2) TODO

(3) By \ref{ChebyshevInequalityCorollary}, we have $\alpha D_f(\alpha)^{1/p} \leq \norm{f}_p$ and thus $\norm{f}_{p,\infty} = \sup_{\alpha > 0}\alpha D_f(\alpha)^{1/p} \leq \norm{f}_p$.
\end{proof}
\begin{corollary}
Let $0<p<\infty$ and let $\sSet{X,\mathcal{A}, \mu}$ be a measure space. Then $L^{p,\infty}(X,\diff{\mu})$ is a subspace of $L^{p}(X,\diff{\mu})$.
\end{corollary}
\begin{proof}
TODO \ref{realPartExtendedRealFunctional}
\end{proof}

\begin{example}
The inclusion $L^{p,\infty}(X,\diff{\mu}) \subseteq L^{p}(X,\diff{\mu})$ is strict in general.

Take $h: \R\to \R: x\mapsto |x|^{-1/p}$. Then
\[ \norm{h}_p^p = \int_\R |x|^{-1} \diff{x} = 2\int_0^\infty x^{-1}\diff{x} = \infty. \]
We also have
\[ D_h(\alpha) = \mu\big\{|x|^{-1/p} > \alpha\big\} = \mu\big\{|x| < \alpha^{-p}\big\} = 2\alpha^{-p}, \]
so
\[ \norm{h}_{p,\infty} = \sup_{\alpha > 0}\alpha\cdot (2\alpha^{-p})^{1/p} = \sup_{\alpha > 0}2^{1/p}\alpha\cdot \alpha^{-1} = 2^{1/p} < \infty. \]
\end{example}

\section{Interpolation}

\begin{proposition}
Let $\sSet{X,\Omega, \mu}$ be a $\sigma$-finite measure space.
Let $0<p<q<\infty$ and $f\in L^{p,\infty(X,\diff{\mu})} \cap L^{q,\infty(X,\diff{\mu})}$. Then for all $p<r<q$, we have
\[ \norm{f}_r \leq \left(\frac{r}{r-p} + \frac{r}{q-r}\right)^{1/r}\norm{f}_{p,\infty}^{\frac{r^{-1}- q^{-1}}{p^{-1} - q^{-1}}}\norm{f}_{q,\infty}^{\frac{p^{-1}- r^{-1}}{p^{-1} - q^{-1}}}, \]
with the interpretation $\infty^{-1} = 0$.
\end{proposition}
TODO: split calculation into lemma!
\begin{proof}
We know that $\alpha D_f(\alpha)^{1/p} \leq \norm{f}_{p,\infty}$, so $\alpha^p D_f(\alpha) \leq \norm{f}_{p,\infty}^p$. Similarly $\alpha^q D_f(\alpha) \leq \norm{f}_{q,\infty}^q$. Thus
\[ D_f(\alpha) \leq \min\left(\frac{\norm{f}^p_p}{\alpha^p}, \frac{\norm{f}^q_q}{\alpha^q}\right). \]
Now we have
\[ \frac{\norm{f}^p_{p,\infty}}{\alpha^p} \leq \frac{\norm{f}^q_{q,\infty}}{\alpha^q} \iff \alpha \leq \left(\frac{\norm{f}_{q,\infty}^q}{\norm{f}_{p,\infty}^p}\right)^{\frac{1}{q-p}} \eqdef B. \]
We calculate, using \ref{LpNormFromDistribution},
\begin{align*}
\norm{f}_r^r &= r \int_0^\infty\alpha^{r-1}D_f(\alpha)\diff{\alpha} \\
&\leq r \int_0^\infty\alpha^{r-1}\min\left(\frac{\norm{f}^p_{p,\infty}}{\alpha^p}, \frac{\norm{f}^q_{q,\infty}}{\alpha^q}\right)\diff{\alpha} \\
&= r \int_0^B\alpha^{r-1}\frac{\norm{f}^{p,\infty}}{\alpha^p}\diff{\alpha} + r \int_B^\infty\alpha^{r-1}\frac{\norm{f}^q_{q,\infty}}{\alpha^q}\diff{\alpha} \\
&= r \norm{f}^p_{p,\infty} \int_0^B\alpha^{r-p-1}\diff{\alpha} + r \norm{f}^q_{q,\infty} \int_B^\infty\alpha^{r-q-1}\diff{\alpha} \\
&= \frac{r}{r-p} \norm{f}^p_{p,\infty} B^{r-p} + \frac{r}{q-r} \norm{f}^q_{q,\infty} B^{r-q} \\
&= \left(\frac{r}{r-p} + \frac{r}{q-r}\right)\norm{f}_{p,\infty}^{\frac{1- rq^{-1}}{p^{-1} - q^{-1}}}\norm{f}_{q,\infty}^{\frac{rp^{-1}- 1}{p^{-1} - q^{-1}}}.
\end{align*}
Observe that the integrals converge because $p<r<q$, so $r-p>0$ and $r-q<0$.
\end{proof}

\subsection{The Marcinkiewicz interpolation theorem}
TODO
\subsection{The Riesz-Thorin Interpolation Theorem}
The scalars are complex.

\begin{theorem}[Riesz-Thorin interpolation theorem]
Let $\sSet{X,\mu}$ and $\sSet{Y,\nu}$ be $\sigma$-finite measure spaces. Let $p_0,p_1,q_0,q_1\in \interval{1,\infty}$ and let $T: L^{p_0}(X) + L^{p_1}(X) \to L^{q_0}(Y) + L^{q_1}(Y)$ be a linear operator such that there exist $A_0,A_1 \geq 0$ with 
\begin{align*}
\forall f\in L^{p_0}(X): \quad &\norm{Tf}_{q_0} \leq A_0 \norm{f}_{p_0} \\
\forall f\in L^{p_1}(X): \quad &\norm{Tf}_{q_1} \leq A_1 \norm{f}_{p_1}.
\end{align*}
For all $0<\theta <1$, set
\[ p \defeq \frac{p_0p_1}{\theta p_0 + (1-\theta)p_1} \qquad\text{and}\qquad q \defeq \frac{q_0q_1}{\theta q_0 + (1-\theta)q_1}. \]
Then, for all $f\in L^p(X)$, we have
\[ \norm{Tf}_{q} \leq A_\theta \norm{f}_p, \]
with $A_\theta \leq A_0^{1-\theta}A_1^\theta$.
\end{theorem}
\begin{proof}
TODO
\end{proof}


\section{Schwartz distributions}
TODO: $\R^n$ is the natural setting. In order the easily take derivatives, we need it to be a normed space. Convergence we need local compactness. These two requirements give $\R^n$. TODO ref: every Hausdorff locally compact space is finite dimensional.

See \url{https://terrytao.wordpress.com/2011/05/24/locally-compact-topological-vector-spaces/}.


\subsection{Spaces of test functions}
\begin{definition}
Let $\Omega\subseteq X$ be an open subset of a normed vector space. The space of \udef{test functions} on $\Omega$ is $\cont^\infty_c(\Omega)$ equipped with a particular vector space convergence. This space is also commonly denoted $\testFuncs(\Omega)$.

For any compact $K\subseteq \Omega$, we define
\[ \testFuncs_K(\Omega) \defeq \setbuilder{f\in \testFuncs(\Omega)}{\supp(f) \subseteq K}. \]
\end{definition}

\begin{example}
The \udef{bump function}
\[ \phi: \R\to\R: x\mapsto \begin{cases}
e^{1/(x^2-1)} & |x|<1 \\ 0 & |x| \geq 1
\end{cases} \]
is a test function in $\testFuncs(\R)$.
\end{example}

\begin{lemma}
Every test function is bounded.
\end{lemma}
\begin{proof}
TODO
\end{proof}

\subsubsection{The convergence of test functions}

\begin{definition}
We denote by $\testFuncs(\Omega)$ the convergence space $\cont^\infty_C(\Omega)$ with the inductive limit convergence.

The topological modification of $\testFuncs_c(\Omega)$ is denoted $\testFuncs(\Omega)$.
\end{definition}

\begin{lemma}
The convergence space
\end{lemma}



\subsection{Defining distributions}
\begin{definition}
    Let $X$ be an open subset of a normed vector space.
    A linear map $T: \testFuncs(X) \to \C$ is a \udef{distribution} on $X$ is an element of the topological dual of $\testFuncs(X)$ equipped with the strong dual topology. It is denoted $\dists(X)$.
\end{definition}

\begin{proposition}
    The space of distributions $\dists(X)$ is a module over the ring $\cont^\infty(X)$.
    
    If $T\in \dists(X)$ and $a\in \cont^\infty(X)$, then the multiplication is defined by
    \[ (aT)(\phi) = T(a\phi) \qquad \forall \phi \in \testFuncs(X). \]
\end{proposition}

\subsection{Types of distributions}
\subsubsection{Regular distributions}
\begin{lemma}
Let $X$ be an open subset of a normed vector space and $f: X\to\C$ a locally integrable function in $L^1_\text{loc}(X)$. Then
\[ T_f: \testFuncs(X) \to \C: \phi \mapsto \int_X f(x)\phi(x)\diff{x} \]
is a distribution.
\end{lemma}
\begin{proof}
TODO We just need to show continuity (from boundedness)
\end{proof}

\begin{definition}
Distributions of the form $T_f$ for some $f\in L^1_\text{loc}(X)$ are called \udef{regular distributions}.
\end{definition}


\begin{lemma} \label{uniquenessIntegratedFunction}
Let $f,g: X\to \C$ be locally, absolutely integrable functions. If $T_f = T_g$, then $f(x) = g(x)$ a.e.
\end{lemma}


\subsection{The derivative of a distribution}
\begin{definition}
Let $X$ be an open subset of a normed vector space $V$ and let $T\in \dists(X)$. For $u\in V$ we define the directional derivative of $T$ as
\[ \partial_u(T) \defeq - T\circ \partial_u. \]

In particular, if $V = \R$, we define
\[ T' \defeq \od{}{x}(T) \defeq - T\circ \od{}{x}. \]
\end{definition}

\begin{lemma}
Let $T_f$ be an integral distribution such that $\partial_u(f)$ is well-defined on $X$, then
\[ \partial_u(T_f) = T_{\partial_{u}(f)}. \]
\end{lemma}
\begin{proof}
TODO by partial integration.
\end{proof}

\begin{lemma}
Let $X$ be an open subset of $\R^N$ and let $T\in \dists(X)$. Then
\[ D^\alpha T = (-1)^{|\alpha|}T\circ D^\alpha. \]
\end{lemma}

\begin{proposition}
    Let $X$ be an open subset of a normed vector space $V$, $T\in \dists(X)$ and $u\in V$. Then
    \begin{enumerate}
    \item $\partial_{u}T \in \dists(X)$;
    \item $\partial_{u}$ is linear on the module $\dists(X)$.
    \end{enumerate}
\end{proposition}

\subsection{Convolution}

\subsection{Dirac delta distribution}
\begin{definition}
    Let $X$ be an open subset of a normed vector space and $x_0\in X$. The \udef{Dirac delta distribution} at $x_0$ is the distribution
    \[ \delta_{x_0}: \testFuncs(X) \to \C: \phi \mapsto \phi(x_0). \]
    We write $\delta \defeq \delta_0$.
\end{definition}

\begin{proposition}
Let $X$ be an open subset of a normed vector space containing $0$. Suppose $\seq{f_n: X\to \C}$ is a sequence of functions such that
\begin{enumerate}
\item $\int_X f_n(x)\diff{x} = 1$ for all $n$;
\item there exists a constant $C$ such that $\int_X |f_n(x)|\diff{x} \leq C$ for all $n$;
\item $\lim_{n\to \infty} \int_{|x|>r}|f_n(x)|\diff{x} = 0 $ for all $r > 0$.
\end{enumerate}
If $\phi$ is bounded on $X$ and continuous at $0$, then
\[ \lim_{n\to \infty} \int_X f_n(x)\phi(x)\diff{x} = \phi(0) \]
and in particular $f_n\to \delta$ in $\dists(X)$.
\end{proposition}
Notice that the condition of $\phi$ being bounded on $X$ and continuous at $0$ is much less strong than $\phi\in\testFuncs$.
\begin{proof}
TODO + iff? Then we could define delta sequences as sequences that converge to $\delta$.

TODO link with (and formulation of integral mean value theorem)
\end{proof}
Sequences $\seq{f_n}$ satisfying the assumptions of the proposition are called \udef{delta sequences}.

\begin{lemma}
If $f_n$ is such that $\int f_n(x) \diff{x} = 1$ and the support shrinks to zero, then $f_n$ is a delta sequence.
\end{lemma}

\begin{lemma}
Let $f: \R^N\to\C$ be an integrable function with $\int_{\R^N}f(x)\diff{x} = 1$. Then $\seq{n^Nf(nx)}_{n\in \N}$ is a delta sequence.
\end{lemma}

\begin{example}
The following are examples of delta sequences:
\begin{itemize}
\item $f_n(x) = \begin{cases}
n & \big(|x| \leq \frac{1}{2n}\big) \\ 0 & \big(\text{otherwise}\big)
\end{cases}$;
\item $f_n(x) = \sqrt{\frac{n}{\pi}}e^{-nx^2}$;
\item $f_n(x) = \frac{1}{\pi} \frac{n}{(nx)^2 + 1}$;
\item $f_n(x) = \frac{\sin(n^{-1}x)}{\pi x}$;
\item $f_n(x) = \frac{1}{2\pi}\int_{-n}^n e^{ixt}\diff{t}$;
\item $f_n(x) = \frac{1}{2\pi} \sum_{k = -n}^n e^{ikx}$.
\end{itemize}
TODO: check these.
\end{example}

\begin{proposition}
Let $\theta$ be the Heaviside function. Then
\[ (T_\theta)' = \delta. \]
\end{proposition}

\begin{proposition}
Let $\Omega\subseteq \R^n$ be an open set that cont and $g\in L^1_\text{loc}(\Omega)\cap \cont^1(\Omega)$ (TODO is this a Sobolev space?) with countable many zeros $\seq{x_j}$ and $a\in \Omega$. Then
\[ \delta_a \circ T_g = \sum_{j} \frac{1}{f'(x_j)}\delta_{x_j - a} \]
\end{proposition}
TODO: check assumptions. $x_j - a \in \Omega$?
\begin{proof}
TODO:
Composition of the Dirac $\delta$ with a smooth, continuously differentiable function $g$ follows from the following relation
\[ \int_\R \delta(g(x))f(g(x))|g'(x)|\diff{x} = \int_{g(\R)} \delta(u)f(u)\diff{u} \]
Thus we say that
\[ \delta(g(x)) = \sum_i \frac{\delta(x-x_i)}{|g'(x_i)|}\]
Where $x_i$ are the simple roots of $g$.
\end{proof}

\begin{proposition}
$f\cdot \delta' = -\delta \cdot f'$??

$x\delta(x) = 0$

$x \delta'(x) = -\delta(x)$

$\delta(ax) = \frac{\delta(x)}{a}$

$\delta'(x) = -\delta'(-x)$.
\end{proposition}

\subsubsection{Jump discontinuities in integral distributions}
\begin{proposition}
Let $f$ be a function that is $\cont^1$ on $]-\infty, x_0[$ and $]x_0, +\infty[$ for some $x_0\in\R$. Then
the derivative of $f$ as distribution is given by
\[ f' = (f|_{\R\setminus\{x_0\}})' + (\Delta_{x_0}f)\delta_{x_0}. \]
\end{proposition}
Note that if $f$ is continuous at $x_0$, this gives $f' = (f|_{\R\setminus\{x_0\}})'$ as distributions.
\begin{proof}
Let $\phi\in\testFuncs(\R)$. Then we calculate
\begin{align*}
f'(\phi) &= \int_{-\infty}^\infty f(x)\phi'(x)\diff{x} = \int_{-\infty}^{x_0} f(x)\phi'(x)\diff{x} + \int_{x_0}^\infty f(x)\phi'(x)\diff{x} \\
&= \Big[f(x)\phi(x)\Big]_{-\infty}^{x_0} - \int_{-\infty}^{x_0} f'(x)\phi(x)\diff{x} + \Big[f(x)\phi(x)\Big]_{x_0}^{+\infty} - \int_{x_0}^{+\infty} f'(x)\phi(x)\diff{x} \\
&= -\int_{\R\setminus\{x_0\}} f'(x)\phi(x)\diff{x} + \lim_{x\to x_0+}f(x)\phi(x)-\lim_{x\to x_0-}f(x)\phi(x) \\
&= \int_{\R}f|_{\R\setminus\{x_0\}}\phi'(x)\diff{x} + \phi(x_0)\lim_{x\to x_0+}f(x)- \phi(x_0)\lim_{x\to x_0-}f(x) = \int_{\R}(f|_{\R\setminus\{x_0\}})'\phi(x)\diff{x} + (\Delta_{x_0}f)\delta_{x_0}.
\end{align*}
\end{proof}
\begin{corollary}
Let $f$ be a function that is $\cont^1$ on $]-\infty, x_0[$ and $]x_0, +\infty[$ for some $x_0\in\R$. Then
the $k^\text{th}$ derivative of $f$ as distribution is given by
\[ f^{(k)} = (f|_{\R\setminus\{x_0\}})^{(k)} + \sum_{j=0}^{k-1}(\Delta_{x_0}f^{(j)})\delta^{(k-1-j)}_{x_0}. \]
\end{corollary}


\section{Sobolev spaces}
TODO: after $L^p$ spaces.
\subsection{Weak and strong derivatives}
\begin{definition}
    Let $X$ be an open subset of a normed vector space, $f\in L^p(X)$ and $D^\alpha$ a derivative on $X$. If there exists $g\in L^q(X)$ such that $D^\alpha T_f = T_g$, then $g$ is the \udef{weak $\alpha$ derivative} of $f$ in $L^q(X)$.
\end{definition}
The weak $\alpha$ derivative is unique if it exists, due to \ref{uniquenessIntegratedFunction}.

The definition of weak derivative translates to the requirement
\[ \int_X f D^\alpha \phi \diff{x} = (-1)^{|\alpha|}\int_X g\phi\diff{x} \qquad \forall \phi\in\testFuncs(X). \]

\begin{definition}
    Let $X$ be an open subset of a normed vector space, $f\in L^p(X)$ and $D^\alpha$ a derivative on $X$. We call $g\in L^q(X)$ a \udef{strong $\alpha$ derivative} if there exists a sequence $\seq{f_n} \subset \cont^\infty(X)$  such that
    \begin{itemize}
    \item $f_n \to f$ in $L^p(X)$; and
    \item $D^{\alpha}f_n \to g$ in $L^q(X)$.
    \end{itemize}
\end{definition}

\begin{theorem}
Let $f\in L^p(X)$. Then $g\in L^q(X)$ is a weak $\alpha$ derivative \textup{if and only if} it is a strong $\alpha$ derivative.
\end{theorem}

\subsection{Sobolev spaces}
\begin{definition}
Let $X$ be an open subset of a normed vector space, $1\leq p \leq \infty$ and $k\in\N$. Then the \udef{Sobolev space} $W^{k,p}(X)$ is defined as
\[ W^{k,p}(X) \defeq \setbuilder{T\in \dists(X)}{\text{$T$ has a weak $\alpha$ derivative in $L^p(X)$ for all $|\alpha|\leq k$}}.
 \]
\end{definition}
In particular each distribution in $W^{k,p}(X)$ is an integral distribution $T_f$ for some $f$ in $L^p(X)$.

\begin{lemma}
    Let $X$ be an open subset of a normed vector space, $1\leq p \leq \infty$ and $k\in\N$. Then
    \[ \testFuncs(X) \subset W^{k,p}(X) \subset L^p(X), \]
    so that $W^{p,k}(X)$ is a dense subspace of $L^p(X)$.
\end{lemma}

\begin{proposition}
A Sobolev space $W^{k,p}(X,\diff{\mu})$ is a Banach space with norm
\[ \norm{f}_{W^{k,p}(X,\diff{\mu})} = \begin{cases}
\left(\sum_{|\alpha|\leq k}\norm{D^\alpha f}^p_{L^{p}(X, \diff{\mu})}\right)^{1/p} & 1\leq p < \infty \\
\max_{|\alpha|\leq k} \norm{D^\alpha f}_{L^{\infty}(X, \diff{\mu})} & p = \infty.
\end{cases} \]
If the measure is clear, we may also write $W^{k,p}(X)$.

In particular $W^{k,2}(X, \diff{\mu})$ is a Hilbert space with inner product
\[ \inner{f,g} \sum_{|\alpha| \leq k} \int_X D^\alpha f(x) \overline{D^\alpha g(x)}\diff{\mu(x)}. \]
The Hilbert space $W^{k,2}(X, \diff{\mu})$ is more commonly denoted $H^k(X, \diff{\mu})$.
\end{proposition}
TODO: alternative definition: use ordinary derivative and take completion???

\begin{proposition}
Let $X$ be an open subset of a normed vector space, $1\leq p < \infty$ and $k\in\N$. Then $W^{k,p}(X)$ coincides with the closure of $\cont^\infty(X) \cap W^{k,p}(X)$ in the $W^{k,p}(X)$-norm.
\end{proposition}

\begin{definition}
Let $X$ be an open subset of a normed vector space, $1\leq p < \infty$ and $k\in\N$. We define $W_0^{k,p}(X)$ to be the closure of $\cont^\infty_c(X)$ in the $W^{k,p}(X)$-norm.
\end{definition}


\chapter{Harmonic analysis}
\input{harmonicAnalysis}



\chapter{Analysis on metric spaces}
\begin{definition}
A \udef{metric measure space} is a structured set $\sSet{X, d, \mu}$ such that $d$ is a metric on $X$ and $\mu$ is a Borel measure on $\sSet{X,d}$.
\end{definition}

\begin{proposition} \label{interchangeLimitIntegralUniformLimit}
Let $\sSet{X,d, \mu}$ be a metric measure space such that $\mu(X)\leq \infty$ and $\seq{f_n: X\to \R}$ a sequence of integrable functions that converges uniformly to a function $f:X \to \R$. Then $f$ is integrable and
\[ \int_X\lim_{n\to\infty}f_n \diff{s} = \int_X f \diff{s} = \lim_{n\to\infty}\int_X f_n \diff{s}. \]
\end{proposition}
Note that if the $f_n$s are measurable, then $f$ is measurable by \ref{pointwiseLimitMeasurable}.
\begin{proof}
Take arbitrary $\epsilon >0$. By \ref{metricUniformConvergence}, there exists $N\in \N$ such that $|f_n(x) - f(x)| \leq \epsilon$ for all $n\geq N$ and $x\in X$. Then
\[ \int_X |f_n - f| \diff{\mu} \leq \epsilon \int_X \diff{\mu} = \epsilon \mu(X) < \infty. \]
Since $f_n$ is integrable, we have
\[ \int_X |f| \diff{\mu} = \int_X |f-f_n + f_n| \diff{\mu} \leq \int_X |f-f_n| \diff{\mu} + \int_X |f_n| \diff{\mu} < \infty, \]
so $f$ is integrable.

The show that $\int_X f_n \diff{\mu}$ converges to $\int_X f \diff{\mu}$, we use the triangle inequality for integrals, \ref{integralTriangleInequality}, to calculate
\[ \Big|\int_X f\diff{\mu} - \int_X f_n\diff{\mu}\Big| = \Big|\int_X f- f_n\diff{\mu}\Big| \leq \int_X|f-f_n|\diff{\mu} \to 0. \]
\end{proof}

\begin{example}
For \ref{interchangeLimitIntegralUniformLimit}, it is important that $\mu(X)$ be finite. Consider the sequence $\seq{f_n: \R^+ \to \R}$ defined by
\[ f_n(x) \defeq \begin{cases} 1 & (x = 0) \\
\ceil{x}^{-1} & (0 < x \leq n) \\
0 & (n < x)
\end{cases}, \]
then $\seq{f_n}$ converges \emph{uniformly} to a function that is not integrable, since $\sum_{n=1}^\infty n^{-1}$ diverges to infinity.
\end{example}

\section{Doubling measures and differentiation}
\subsection{Doubling measures}
\begin{definition}
A metric measure space $\sSet{X,d,\mu}$ is called a \udef{doubling space} and the measure $\mu$ a \udef{doubling measure} if
\begin{itemize}
\item each ball of non-zero radius has finite and non-zero measure;
\item there exists $C\geq 1$ such that
\[ \forall x\in X: \delta >0:\quad \mu\big(\ball_d(x, 2\delta)\big) \leq C \mu\big(\ball_d(x, \delta)\big). \]
\end{itemize}
We call $C$ the \udef{doubling constant}.
\end{definition}
TODO: $C\geq 2$ \url{https://www.acadsci.fi/mathematica/Vol44/vol44pp1015-1030.pdf}

\begin{lemma} \label{doublingMeasureFiniteMeasureOfBallsImpliesCountableCollection}
Let $\sSet{X,d,\mu}$ be a doubling metric measure space and $\big\{\ball(x_i, \epsilon_i)\big\}_{i\in I}$ a set of pairwise disjoint balls such that $\mu\Big(\biguplus_{i\in I}\ball(x_i, \epsilon_i)\Big) < \infty$. Then at most countably many $\epsilon_i$ are non-zero.
\end{lemma}
\begin{proof}
We have
\[ \sum_{i\in I}\mu\big(\ball(x_i, \epsilon_i)\big) \leq \mu\Big(\biguplus_{i\in I}\ball(x_i, \epsilon_i)\Big) < \infty \]
by \ref{ringPositiveContent}, so only countably many balls have non-zero measure by \ref{finiteSumsAreCountable} and each ball with non-zero radius has non-zero measure, by definition.
\end{proof}

\begin{lemma}
Let $\sSet{X,d,\mu}$ be a doubling metric measure space with doublng constant $C$, $x\in X$ and $r,k>0$. Then
\[ \mu\big(\ball(x,kr)\big) \leq C^{\ceil{\log_2(k)}}\ball(x,r). \]
\end{lemma}
\begin{proof}
We have
\[ \mu\big(\ball(x,kr)\big) = \mu\big(\ball(x,2^{\log_2(k)}r)\big) \leq \mu\big(\ball(x,2^{\ceil{\log_2(k)}}r)\big) \leq C^{\ceil{\log_2(k)}}\mu\big(\ball(x,r)\big). \]
\end{proof}

\subsection{Covering theorems}
\subsubsection{Vitali spaces}
\begin{definition}
Let $\sSet{X,d,\mu}$ be a metric measure space.
\begin{itemize}
\item A \udef{Vitali covering} of $E\subseteq X$ is a set $\mathcal{C}$ of closed balls such that 
\[ \forall x\in E: \inf \setbuilder{\epsilon > 0}{\cball(x,\epsilon) \in \mathcal{C}} = 0. \]
\item We call $\sSet{X,d,\mu}$ a \udef{Vitali space} if balls in $X$ have finite measure every Vitali covering of $E$ has a countable disjoint subset that covers almost all of $E$.
\end{itemize}
\end{definition}
TODO: allow Vitali coverings that are not balls.

\begin{theorem}[Vitali's covering theorem]
Every doubling metric measure space $\sSet{X,d,\mu}$ is a Vitali space.
\end{theorem}
\begin{proof}
Take $E\subseteq X$ and let $\mathcal{C}$ be a Vitali covering of $E$. We can restrict $\mathcal{C}$ to the balls contained in it with diameter strictly larger than $0$ and less than $1$. By \ref{5foldCoveringLemma} we can find a pairwise disjoint subset $\mathcal{C}'\subseteq \mathcal{C}$ such that $A\subseteq \bigcup_{\cball(x,r)\in \mathcal{C}'}\cball(x,5r)$.

If $\bigcup \mathcal{C}'$ has finite measure, then it is countable by \ref{doublingMeasureFiniteMeasureOfBallsImpliesCountableCollection}.

TODO
\end{proof}

\begin{proposition}
Let $d$ be the standard metric on $\R^n$ and $\mu$ a Radon measure. Then $\sSet{\R^n, d,\mu}$ is a Vitali space.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\begin{theorem}[Lebesgue's differentiation theorem]
Let $\sSet{X,d,\mu}$ be a Vitali space and $f: X\to \R^+$ a positive locally integrable function. Then
\[ \lim_{r\to 0} \frac{1}{\mu\big(\ball(x, r)\big)}\int_{\ball(x, r)}f\diff{\mu} = f(x) \]
for almost all $x\in X$.
\end{theorem}
\begin{proof}
Let $E$ be the set of points in $X$ where the statement does not hold. 
\end{proof}

\subsubsection{Directionally limited spaces}

TODO Besicovitch-Federer covering theorem.

\section{Maximal functions and differentiation}
\subsection{The Hardy-Littlewood maximal operator}
\begin{definition}
Let $\sSet{X,d}$ be a metric space equipped with a Borel measure $\mu$. The \udef{Hardy-Littlewood maximal operator} $\HLmax$ maps a function $f: X\to \R^+$ to the function $\HLmax(f): X\to \overline{\R^+}$ defined by
\[ \HLmax(f)(x) = \sup_{\delta >0}\frac{1}{\mu\big(\ball(x,\delta)\big)}\int_{\ball(x,\delta)} f \diff{\mu}. \]
\end{definition}

\begin{proposition}
Let $\sSet{X,d}$ be a metric space equipped with a Borel measure $\mu$ and $f: X\to \R^+$ some function. Then
\begin{enumerate}
\item if $\HLmax(f)$ is integrable, then $f = 0$ a.e.;
\item if $\HLmax(f)(x) = 0$ for some $x\in X$, then $f=0$ a.e. 
\end{enumerate}
\end{proposition}
\begin{proof}
TODO!
\end{proof}

\begin{proposition}
Let $\sSet{X,d, \mu}$ be a doubling space with doubling contstant $C$, $f: X\to \R^+$ some function and $\alpha > 0$. Then
\[ \mu\{\HLmax(f) > \alpha\} \leq \frac{C^2}{\alpha}\int_{X}f\diff{\mu}. \]
\end{proposition}
\begin{proof}
For any $R>0$ we define the bounded Hardy-Littlewood maximal operator $\HLmax_R(f)$ by
\[ \HLmax_R(f)(x) \defeq \sup_{R\geq\delta >0}\frac{1}{\mu\big(\ball(x,\delta)\big)}\int_{\ball(x,\delta)} f \diff{\mu}. \]
For all $x\in \{\HLmax_R(f) > \alpha\}$, we can find a ball $\ball(x,r)$ with $0<r\leq R$ such that
\[ \int_{\ball(x,r)}f \diff{\mu} \geq \alpha\mu\big(\ball(x,r)\big). \]
Clearly $\HLmax(f) = \sup_{R>0}\HLmax_R(f)$.

We can now apply \ref{5foldCoveringLemma} to this collection of balls (with an improved constant of $4 = 2^2$ by \ref{improvedConstant5foldCoveringLemma}) to obtain a countable subset $\mathcal{C}$ such that
\begin{align*}
\mu\{\HLmax_R(f) > \alpha\} &\leq \mu\Big(\bigcup_{\ball(x,r)\in \mathcal{C}}\ball(x,4r)\Big) \\
&\leq \sum_{\ball(x,r)\in \mathcal{C}}\mu\Big(\ball(x,4r)\Big) \\
&\leq C^2\sum_{\ball(x,r)\in \mathcal{C}}\mu\Big(\ball(x,r)\Big) \\
&\leq C^2\sum_{\ball(x,r)\in \mathcal{C}}\frac{1}{\alpha}\int_{\ball(x,r)}f \diff{\mu} = \frac{C^2}{\alpha}\int_{\biguplus \mathcal{C}} f \diff{\mu} \leq \frac{C^2}{\alpha}\int_{X} f \diff{\mu}.
\end{align*} 



\end{proof}
\begin{corollary}

\end{corollary}

\section{Approximation}
\subsection{Korovkin approximation}

\begin{theorem}[Korovkin]
Let $\sSet{X,d}$ be a metric space. Let $\varphi: \interval[co]{0,\infty} \to \R^+$ be a continuous function such that
\begin{itemize}
\item $\varphi(t) > 0$ for all $t>0$;
\item $\exists T>0, \epsilon_0>0: \varphi(t) \geq \epsilon_0$ for all $t\geq T$.
\end{itemize}
Let $E$ be a Riesz subspace of $(X\to \R)$ such that $\varphi\circ d(x,-)\in E$ for all $x\in X$ and $\underline{1} \in E$.

Let $\seq{L_n: E\to (X\to \R)}$ be a sequence of positive linear operators such that
\begin{itemize}
\item $\lim_{n\to \infty} L_n(\underline{1}) = \underline{1}$ uniformly; and
\item $\lim_{n\to \infty} x\mapsto L_n(\varphi\circ d(x,-))(x) = \underline{0}$ uniformly for all $x\in X$.
\end{itemize}
Then $\lim_{n\to \infty}L_n(f) = f$ uniformly for all uniformly continuous $f\in E$.
\end{theorem}
\begin{proof}
Let $f\in E$ be uniformly continuous. By uniform continuity (\ref{uniformContinuityMetricSpaces}), there exists a $\delta > 0$ such that $d(x,y)\leq \delta \implies |f(x)-f(y)| \leq \epsilon$.

Now we claim that $\inf\varphi^\imf\big(\interval[co]{\delta, +\infty}\big)$ is strictly positive. Indeed,
\[ \inf\varphi^\imf\big(\interval[co]{\delta, +\infty}\big) = \min \Big(\inf\varphi^\imf\big(\interval{\delta, T}\big), \inf\varphi^\imf\big(\interval[co]{T, +\infty}\big) \Big) \geq \min\Big(\inf\varphi^\imf\big(\interval{\delta, T}\big), \epsilon_0\Big), \]
and $\varphi$ attains its infimum on $\interval{\delta, T}$ by \ref{extremeValueTheorem}, so $\inf\varphi^\imf\big(\interval{\delta, T}\big) = \min\varphi^\imf\big(\interval{\delta, T}\big) > 0$. We can now set $C = \inf\varphi^\imf\big(\interval[co]{\delta, +\infty}\big)^{-1}$.

For all $x,y\in X$ such that $d(x,y) \geq \delta$, we have
\[ |f(x) - f(y)| \leq 2\norm{f}_u \leq \frac{2\norm{f}_\infty}{C}(\varphi\circ d)(x,y). \]
Putting the cases of $d(x,y) \leq \delta$ and $d(x,y) \geq \delta$ together, gives
\[ |f(x) - f(y)| \leq \epsilon + \frac{2\norm{f}_u}{C}(\varphi\circ d)(x,y) \]
for all $x,y\in X$. Or, for fixed $x\in X$, $|f - f(x)\underline{1}| \leq \epsilon\underline{1} + \frac{2\norm{f}_u}{C}(\varphi\circ d)(x,-)$.

Thus, for any $x\in X$ and $n\in \N$, we have
\begin{align*}
|L_n(f)(x) - f(x)L_n(\underline{1})(x)| &\leq |L_n(f - f(x)\underline{1})(x)| \\
&\leq L_n(|f - f(x) \underline{1}|)(x) \\
&\leq \epsilon L_n(\underline{1})(x) + \frac{2\norm{f}_u}{C}L_n\big((\varphi\circ d)(x,-)\big)(x),
\end{align*}
where we have used that each $L_n$ preserves to order. Taking the supremum over $x$ and then the limsup $n\to \infty$ gives
\[ \limsup_{n\to\infty}\norm{L_n(f) - f\cdot L_n(\underline{1})}_u \leq \epsilon \]
for all $\epsilon >0$. Thus $\limsup_{n\to\infty}\norm{L_n(f) - f\cdot L_n(\underline{1})} = 0$, which means it must equal the liminf and $L_n(f) - f\cdot L_n(\underline{1})$ converges uniformly to $0$ (by \ref{realConvergenceOrderConvergence} and \ref{vectorSpaceUniformNorm}). Since $f\cdot L_n(\underline{1})$ converges uniformly to $f$ by assumption and the uniform convergence is a vector space convergence (\ref{vectorSpaceUniformNorm}), $L_n(f)$ converges uniformly to $f$.
\end{proof}
\begin{corollary}[Korovkin's first theorem or Bohman-Korovkin theorem] \label{BohmanKorovkin}
Let $\seq{L_n: \cont(\interval{0,1})\to (\interval{0,1}\to \R)}$ be a sequence of positive linear operators and consider $(-)^i: \interval[0,1] \to \R: x\mapsto x^i$. If $L_n\big((-)^i\big) \to (-)^i$ uniformly for $i\in\{0,1,2\}$, then $L_n(f) \to f$ uniformly for all $f\in\cont(\interval{0,1})$.
\end{corollary}
\begin{proof}
We set $\varphi = (-)^2$. Then
\begin{align*}
(\varphi\circ d)(x,y) &= |x-y|^2 = (x-y)^2 = x^2 -2xy +y^2 \\
&= \big(x^2\underline{1} - 2x\id_X + (-)^2\big)(y) \\
&= \big(x^2(-)^0 - 2x(-)^1 + (-)^2\big)(y),
\end{align*}
and, since the uniform convergence is a vector space convergence (by \ref{vectorSpaceUniformNorm}), we have
\begin{align*}
L_n\big((\varphi\circ d)(x,-)\big)(x) &= \Big(x^2L_n\big((-)^0\big) - 2xL_n\big((-)^1\big) + L_n\big((-)^2\big)\Big)(x) \\
&\to \Big(x^2(-)^0 - 2x(-)^1 + (-)^2\Big)(x) \\
&= x^2 - 2x\, x + x^2 = 2x^2 - 2x^2 = 0.
\end{align*}
Because every continuous function on $\cont(\interval{0,1})$ is uniformly continuous (by the Heine-Cantor theorem \ref{HeineCantorTheorem}), we may apply the theorem.
\end{proof}
\begin{corollary}[Korovkin's second theorem]
TODO. See Ciarlet and Altomare.
\end{corollary}

\subsubsection{Bernstein polynomials and Weierstrass approximation}
\begin{definition}
The polynomials
\[ b_{k,n}(x) = \begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} \]
for $k,n\in \N$ and $k\leq n$ are called \udef{Bernstein polynomials}.
\end{definition}

\begin{example}
Here are some explicit Bernstein polynomials:
\begin{align*}
b_{0,0}(x) &= 1 \\
& \\
b_{0,1}(x) &= 1-x \\
b_{1,1}(x) &= x \\
& \\
b_{0,2}(x) &= 1 -2x + x^2 \\
b_{1,2}(x) &= 2x-2x^2 \\
b_{2,2}(x) &= x^2 \\
& \\
b_{0,3}(x) &= 1-3x+3x^2 - x^3 \\
b_{1,3}(x) &= 3x -6x^2 + 3x^3 \\
b_{2,3}(x) &= 3x^2 - 3x^3 \\
b_{3,3}(x) &= x^3
\end{align*}
\end{example}

\begin{lemma} \label{BernsteinPartitionUnity}
The Bernstein polynomials of degree $n$ form a partition of unity:
\[ \sum_{k=0}^n b_{k,n}(x) = 1. \]
\end{lemma}
\begin{proof}
The binomial identity \ref{binomialIdentity} gives
\[ \sum_{k=0}^n b_{k,n}(x) = \sum_{k=0}^n \begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} = (x+1-x)^n = 1^n = 1. \]
\end{proof}

\begin{proposition}
Let $n,k\in \N$. Then
\begin{enumerate}
\item $\displaystyle b_{k,n}(x) = \sum_{m=k}^n \begin{pmatrix}
n \\ m
\end{pmatrix}\begin{pmatrix}
m \\ k
\end{pmatrix}(-1)^{m-k}x^m$;
\item $\displaystyle x^m = \begin{pmatrix}
n \\ m
\end{pmatrix}^{-1}\sum_{k=m}^n \begin{pmatrix}
k \\ m
\end{pmatrix}b_{k,n}(x)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Filling in the binomial identity \ref{binomialIdentity} gives
\begin{align*}
b_{k,n}(x) &= \begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} \\
&= \begin{pmatrix}
n \\ k
\end{pmatrix}\sum_{m=0}^{n-k}\begin{pmatrix}
n-k \\ m
\end{pmatrix}(-1)^{m}x^mx^k \\
&= \sum_{m=k}^{n}\begin{pmatrix}
n \\ k
\end{pmatrix}\begin{pmatrix}
n-k \\ m-k
\end{pmatrix}(-1)^{m-k}x^m \\
&= \sum_{m=k}^{n}\begin{pmatrix}
n \\ m
\end{pmatrix}\begin{pmatrix}
m \\ m-k
\end{pmatrix}(-1)^{m-k}x^m \\
&= \sum_{m=k}^{n}\begin{pmatrix}
n \\ m
\end{pmatrix}\begin{pmatrix}
m \\ k
\end{pmatrix}(-1)^{m-k}x^m,
\end{align*}
where we have used \ref{binomialCoefficientMultiplicationLemma} and \ref{binomialCoefficientLemma}.

(2) We calculate
\begin{align*}
\sum_{k=m}^n \begin{pmatrix}
k \\ m
\end{pmatrix}b_{k,n}(x) &= \sum_{k=m}^n \begin{pmatrix}
k \\ m
\end{pmatrix}\begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} \\
&= \begin{pmatrix}
n \\ m
\end{pmatrix}\sum_{k=m}^n \begin{pmatrix}
n-m \\ k-m
\end{pmatrix}x^k(1-x)^{n-k} \\
&= \begin{pmatrix}
n \\ m
\end{pmatrix}\sum_{k=0}^{n-m} \begin{pmatrix}
n-m \\ k
\end{pmatrix}x^mx^k(1-x)^{n-m-k} \\
&= \begin{pmatrix}
n \\ m
\end{pmatrix}x^m(x+1-x)^{n-m} = \begin{pmatrix}
n \\ m
\end{pmatrix}x^m,
\end{align*}
where we have used \ref{binomialCoefficientMultiplicationLemma} and \ref{binomialIdentity}.
\end{proof}
\begin{corollary}
Let $n\in\N$. Then $\{b_{k,n}\}_{k\leq n}(x)$ is a basis of $\R[x]/(x^{n+1})$.
\end{corollary}

\begin{proposition} \label{uniformApproximationByBernsteinPolynomials}
Let $f\in\cont(\interval{0,1})$ and consider $B_n: \cont(\interval{0,1}) \to \cont(\interval{0,1})$ defined by
\[ B_n(f): \interval{0,1} \to \R: x\mapsto \sum_{k=0}^nf\Big(\frac{k}{n}\Big)b_{k,n}(x). \]
Then $B_n(f) \to f$ uniformly.
\end{proposition}
Note that if $f(0) = 0$, then $B_n(f)$ does not have a constant term, since $b_{k,n}$ has a constant term iff $k=0$.
\begin{proof}
We aim to apply the Bohman-Korovkin theorem \ref{BohmanKorovkin}. To this end we calculate
\[ B_n\big(\underline{1}\big)(x) = \sum_{k=0}^nb_{k,n}(x) = 1, \]
by \ref{BernsteinPartitionUnity}. Next
\begin{align*}
B_n\big(\id_{\interval{0,1}}\big)(x) &= \sum_{k=0}^n \frac{k}{n}b_{k,n}(x) \\
&= \sum_{k=0}^n \frac{k}{n} \begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} \\
&= 0 + \sum_{k=1}^{n} \frac{k}{n}\begin{pmatrix}
n \\ k
\end{pmatrix}x^k(1-x)^{n-k} \\
&= \sum_{k=1}^{n} \begin{pmatrix}
n-1 \\ k-1
\end{pmatrix}x^k(1-x)^{n-k} \\
&= \sum_{k=0}^{n-1} \begin{pmatrix}
n-1 \\ k
\end{pmatrix}xx^{k}(1-x)^{n-1-k} \\
&= x (x + 1 - x)^{n-1} = x = \id_{\interval{0,1}}(x),
\end{align*}
by \ref{binomialCoefficientLemma} and \ref{binomialIdentity} for all $n\in \N$. Thus $B_n\big(\id_{\interval{0,1}}\big)$ converges uniformly to $\id_{\interval{0,1}}$.

Finally we need to calculate $B_n\big((-)^2\big)(x) = \sum_{k=0}^n \frac{k^2}{n^2}b_{k,n}(x)$. Now applying multiple times gives
\[ k^2 \begin{pmatrix}
n \\ k
\end{pmatrix} = \big(k(k-1) + k\big)\begin{pmatrix}
n \\ k
\end{pmatrix} = n(n-1) \begin{pmatrix}
n - 2 \\ k - 2
\end{pmatrix} + n \begin{pmatrix}
n-1 \\ k-1
\end{pmatrix}. \]
The second term, like before, gives a contribution of $\frac{x}{n}$. The first term gives a contribution of $\frac{n(n-1)}{n^2}x^2$. Putting everything together gives $B_n\big((-)^2\big)(x) = x^2 - n^{-1}(x^2-x) = \big((-)^2 - n^{-1}(x\mapsto x^2 - x)\big)(x)$. Since uniform convergence is a vector convergence, this converges uniformly to $(-)^2$. Thus we can apply the Bohman-Korovkin theorem.
\end{proof}
\begin{corollary}[Weierstrass approximation theorem] \label{WeierstrassApproximationTheorem}
\begin{enumerate}
\item For every $f\in \cont(\interval{0,1})$, there exists a sequence of polynomials on $\interval{0,1}$ that converges uniformly to $f$.
\item The polynomials are dense in $\cont(\interval{0,1})$ w.r.t.\ the uniform norm.
\end{enumerate}
\end{corollary}
Note that these two points are equivalent by \ref{FrechetUrysohnLemma}, since $\cont(\interval{0,1})$ with the uniform norm is metric and thus Fréchet-Urysohn by \ref{pseudometricSpaceFrechetUrysohn}.

\begin{example}
Here are the first three terms of the Bernstein approximation of $\sqrt{-}$:
\begin{align*}
B_1(\sqrt{-})(x) &= x \\
B_2(\sqrt{-})(x) &= \sqrt{2}x - \big(\sqrt{2}-1\big)x^2 \\
B_3(\sqrt{-})(x) &= \sqrt{3}x - (3-\sqrt{2})\sqrt{3}x^2 + \big(1 - \sqrt{3}(\sqrt{2}-1)\big)x^3.
\end{align*}
\end{example}

\subsubsection{Kantorovich polynomials}
\begin{definition}
Take $n\in \N$ and $f\in L^p(\interval{0,1})$. Then the \udef{Kantorovich polynomial} $K_n(f)(x)$ is defined by
\[ K_n(f)(x) \defeq \sum_{k=0}^n\left((n+1)\int_{\frac{k}{n+1}}^{\frac{k+1}{n+1}}f(t)\diff{t}\right)b_{k,n}(x). \]
\end{definition}

\begin{proposition}
Let $f\in L^p(\interval{0,1})$ and $1\leq p <\infty$. Then $K_n(f) \to f$ in $L^p(\interval{0,1})$.
\end{proposition}
\begin{proof}
TODO, see Korovkin-type Theorems and Approximation by Positive Linear Operators - Altomare.
\end{proof}

\chapter{Analysis on Euclidean spaces}
\section{Derivatives}
\begin{definition}
We write $\partial_j \defeq \pd{}{x_j}$.
\end{definition}

\subsection{Multi-indices}

\begin{definition}
For all $n\in \N$, we define $\multiIndex(n) \defeq \N^n$. An element of $\multiIndex(n)$ is called a \udef{multi-index} of length $n\in \N$. If $\alpha, \beta$ are multi-indices of length $n$, then we define
\begin{itemize}
\item $|\alpha| \defeq \sum_{j=1}^n\alpha_j$;
\item $\alpha! \defeq \prod_{j=1}^n\alpha_j!$;
\item $\displaystyle\begin{pmatrix}
\alpha \\ \beta
\end{pmatrix} \defeq \frac{\alpha!}{\beta!(\beta - \alpha)!} = \begin{pmatrix}
\alpha_1 \\ \beta_1
\end{pmatrix}\hdots \begin{pmatrix}
\alpha_n \\ \beta_n
\end{pmatrix}$;
\item $\partial^\alpha = \Big(\pd{}{x_1}\Big)^{\alpha_1}\hdots\Big(\pd{}{x_n}\Big)^{\alpha_n}$;
\item $x^\alpha = \prod_{j=1}^n x_j^{\alpha_j}$ for all $x\in \R^n$.
\end{itemize}
We also have pointwise addition and order.
\end{definition}

TODO: notation for the all zero multi-index and Dirac delta multi-index.

\begin{lemma}
Let $n\in\N$ and $\alpha \in \multiIndex(n)$. Then $|()^\alpha|$ is subadditive: $|(x+y)^\alpha| \leq |x^\alpha| + |y^\alpha|$ for all $x,y\in \R^n$.
\end{lemma}
\begin{proof}
We have
\[ |(x+y)^\alpha| = \Big|\prod_{j=1}^n(x_j+ y_j)^{\alpha_j}\Big| =  \]
\end{proof}

\begin{proposition}[Taylor's formula]
Let $f\in \cont^k(\R^n)$ be a function and $x_0\in \R^n$. Then
\[ f(x) = \sum_{|\alpha|\leq k}(\partial^\alpha f)(x_0)\frac{(x-x_0)^\alpha}{\alpha!} + R_k(x), \]
where $\lim_{x\to x_0}\frac{|R_k(x)|}{\norm{x-x_0}^k} = 0$.
\end{proposition}
TODO the sum is only over multi-indices of length $n$.

\begin{proposition}
Let $k\in \N$, $\alpha$ be a multi-index with $|\alpha| \leq k$ and $f,g\in \cont^k(\R^n)$. Then
\[ \partial^\alpha(fg) = \sum_{\beta\leq \alpha}\begin{pmatrix}
\alpha \\ \beta
\end{pmatrix}\big(\partial^\beta f\big)\big(\partial^{\alpha - \gamma} g\big). \]
\end{proposition}

\begin{proposition}
Let $x,y\in \R^n$ and $\alpha\in\multiIndex(n)$, then
\[ (x+y)^\alpha = \sum_{\beta \leq \alpha}\begin{pmatrix}
\alpha \\ \beta
\end{pmatrix}x^\beta y^{\alpha - \beta}. \]
\end{proposition}

\subsection{The Schwartz space}
\begin{definition}
Let $n\in \N$. For all $\alpha, \beta\in \multiIndex(n)$, we define
\[ \norm{\cdot}_{\alpha, \beta}: \cont^\infty(\R^n)\to \overline{\R^+}: f\mapsto \sup_{x\in \R^n}\big|x^\alpha\partial^\beta f(x)\big|. \]
We call
\[ \Schwartz(\R^n) \defeq \setbuilder{f\in \cont^\infty(\R^n)}{\forall \alpha,\beta\in\multiIndex(n):\;\norm{f}_{\alpha,\beta}<\infty} \]
the \udef{Schwartz space}. We equip it with the initial convergence w.r.t. $\big\{\norm{\cdot}_{\alpha, \beta}\big\}_{\alpha,\beta\in \multiIndex(n)}$.
\end{definition}

\begin{lemma} \label{SchwartzBoundedLemma}
Let $x\in \R^n$, $\alpha\in\multiIndex(n)$ and $N\in \N$. Then
\begin{enumerate}
\item $|x^\alpha| \leq \norm{x}^{|\alpha|}$;
\item $(1+\norm{x})^N \leq 2^N n^{\frac{N-2}{2}}\sum_{|\beta|\leq N}|x^\beta|$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) For all $1\leq j\leq n$ we have $|x_j| \leq |x|$. We calculate
\[ |x^\alpha| = \Big|\prod_{j=1}^n x_j^{\alpha_j}\Big| = \prod_{j=1}^n |x_j|^{\beta_j} \leq \prod_{j=1}^n \norm{x}^{\beta_j} = \norm{x}^{\sum_{j=1}^n\beta_j} = \norm{x}^{|\beta|}. \]

(2) First we calculate
\begin{align*}
\norm{x}^N &= \Big(\sum_{j=1}^n x_j^2\Big)^{N/2} \\
&\leq \Big(\sum_{j=1}^n \big(\max_{1\leq k\leq n}|x_k|\big)^2\Big)^{N/2} = \Big(n\big(\max_{1\leq k\leq n}|x_k|\big)^2\Big)^{N/2} = n^{N/2}\max_{1\leq k\leq n}|x_k|^N \\
&\leq n^{N/2}\sum_{k=1}^n |x_k|^N.
\end{align*}
Then we have, using \ref{consequencesBinomialIdentity},
\[ \big(1+\norm{x}\big)^N  = \sum_{k=0}^N \begin{pmatrix}
N \\ k
\end{pmatrix}1^k\norm{x}^{N-k} \leq \sum_{k=0}^N \begin{pmatrix}
N \\ k
\end{pmatrix}(1 + \norm{x}^N) = 2^N\big(1+\norm{x}^N\big), \]
because either $\norm{x}\leq 1$, so $\norm{x}^{N-k} \leq \norm{x}\leq 1 \leq 1+\norm{x}^N$, or $\norm{x} > 1$, so $\norm{x}^{N-k} \leq \norm{x}^N \leq 1+\norm{x}^N$.

Then we calculate
\begin{align*}
2^N\big(1+\norm{x}^N\big) &\leq 2^N\Big(1+n^{N/2}\sum_{k=1}^n |x_k|^N\Big) \\
&\leq 2^N\Big(n^{N/2}n+n^{N/2}\sum_{k=1}^n |x_k|^N\Big) \\
&= 2^N\Big(n^{N/2}\sum_{k=1}^n|x_j|^0+n^{N/2}\sum_{k=1}^n |x_k|^N\Big) \\
&\leq 2^Nn^{N/2}\sum_{|\beta|\leq N}|x^\beta|.
\end{align*}
The last inequality is because if $\beta$ is the all zero multi-index, then $|\beta| = 0 \leq N$, and if $\beta$ is such that all components are zero, except for one that is equal to $N$, then $|\beta| = N$.
\end{proof}

\begin{proposition} \label{SchwartzAlternateDefinition}
For all $N\in \N$ and $\beta\in\multiIndex(n)$, define
\[ n_{N,\beta}: \cont^{\infty}(\R^n) \to \overline{R^+}: f \mapsto \sup_{x\in\R^n}\big(1+ \norm{x}\big)^N\big|\partial^\beta f(x)\big|. \]
Then
\[ \Schwartz(\R^n) = \setbuilder{f\in \cont^\infty(\R^n)}{\forall N\in \N,\beta\in\multiIndex(n):\;n_{N,\beta}(f)<\infty} \]
and the topology on $\Schwartz(\R^n)$ is the initial topology w.r.t.\ the functions $n_{N,\beta}$.
\end{proposition}
\begin{proof}
Immediate from \ref{SchwartzBoundedLemma}.
\end{proof}

\subsection{Convolution}

\begin{proposition} \label{derivativeConvolution}
Let $f\in L^1(\R^n)$, $g\in \cont^k(\R^n)$ such that $\partial^\alpha g$ is bounded for all $|\alpha|\leq k$ and $\beta\in \multiIndex(n)$. Then
\begin{enumerate}
\item $f* g \in \cont^k(\R^n)$;
\item $\partial^\beta(f*g) = f*(\partial^\beta g)$.
\end{enumerate}
\end{proposition}
\begin{proof}
We have $\partial^\beta\big(f(y)g(x-y)\big) = f(y)\big(\partial^\beta g\big)(x-y)$, which is integrable since
\[ \int_{\R^n}\big|f(y)\big(\partial^\beta g\big)(x-y)\big|\diff{y} \leq \sup_{x\in \R^n}\big|\big(\partial^\beta g\big)(x)\big|\int_{\R^n}\big|f(y)|\big|\diff{y} < \infty. \]
Thus, by \ref{differentiationUnderIntegral},
\[ \partial^\beta(f*g) = \partial^\beta \int_{\R^n}f(y)g(x-y)\diff{y} = \int_{\R^n}\partial^\beta \big(f(y)g(x-y)\big)\diff{y} = \int_{\R^n}f(y)\big(\partial^\beta g\big)(x-y)\diff{y} = f*(\partial^\beta g).  \]
\end{proof}

\begin{proposition}
Let $f,g\in \Schwartz(\R^n)$. Then $f*g \in \Schwartz(\R^n)$.
\end{proposition}
\begin{proof}
By \ref{derivativeConvolution}, we have $f*g\in \cont^\infty(\R^n)$. By \ref{SchwartzAlternateDefinition}, it is enough to show that $n_{N,\beta}\big(f*g\big) < \infty$ for all $N\in\N$ and $\beta\in\multiIndex(n)$. Take arbitrary such $N,\beta$. First we calculate
\begin{align*}
1+\norm{x} = 1+\norm{(x-y)+y} &\leq 1+\norm{x-y} + \norm{y} \\
&\leq 1+\norm{x-y} + \norm{y} + \norm{x-y}\;\norm{y} = (1+\norm{x-y})(1+\norm{y}).
\end{align*}
Then, for all $x\in \R^n$, we have, by \ref{derivativeConvolution},
\begin{align*}
\big(1+\norm{x}\big)^N\big|\partial^\beta(f*g)(x)\big| &= \big(1+\norm{x}\big)^N\big|(\partial^\beta(f)*g)(x)\big| \\
&= \big(1+\norm{x}\big)^N\int_{\R^n}\big|\partial^\beta f(x-y)\big|\, \big|g(y)\big|\diff{y} \\
&\leq \int_{\R^n}(1+\norm{x-y})^N\big|\partial^\beta f(x-y)\big|\, \big(1+\norm{y}\big)^N\big|g(y)\big|\diff{y} \\
&= \int_{\R^n}(1+\norm{x-y})^N\big|\partial^\beta f(x-y)\big|\big(1+\norm{y}\big)^{N+n+1}\big|g(y)\big|\big(1+\norm{y}\big)^{-n-1}\diff{y} \\
&\leq n_{N,\beta}(f)n_{N+n+1, 0}(g)\int_{\R^n}\big(1+\norm{y}\big)^{-n-1}\diff{y}.
\end{align*}
Thus $n_{N,\beta}\big(f*g\big) \leq n_{N,\beta}(f)n_{N+n+1, 0}(g)\int_{\R^n}\big(1+\norm{y}\big)^{-n-1}\diff{y}$, which is finite, since $\big(1+\norm{y}\big)^{-n-1}$ is integrable (TODO ref).
\end{proof}

\section{The Fourier transform}
\begin{definition}
Let $n\in \N$ then the \udef{Fourier transform} is the function
\[ \Fourier: L^1(\R^n) \to L^\infty(\R^n): f\mapsto \Big( \xi \mapsto \int_{\R^n}f(x)e^{-2\pi \xi\cdot x}\diff{x} \Big). \]
\end{definition}

\begin{lemma}
Let $n\in \N$. Then $\im(\Fourier) \subseteq L^\infty(\R^n)\cap \cont(\R^n)$.
\end{lemma}
Thus $\Fourier$ is well-defined.
\begin{proof}
Let $f\in L^1(\R^n)$. Then
\[ \sup_{\xi}\big|\Fourier(f)(\xi)\big| \leq \int_{\R^n}|f(x)e^{-2\pi \xi\cdot x}|\diff{x} = \int_{\R^n}|f(x)|\diff{x} = \norm{f}_1 < \infty, \]
so $\Fourier(f) \in L^\infty(\R^n)$.

Continuity follows from \ref{continuityIntegralTwoParameterFunction}, because $|f(x)e^{-2\pi \xi\cdot x}| \leq |f(x)|\in L^1(\R^n)$ and $f(x)e^{-2\pi \xi\cdot x}$ is a continuous function of $\xi$.
\end{proof}


\chapter{Calculus}
\input{calculus}

