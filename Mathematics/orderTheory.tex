\chapter{Ordered sets}
\section{Order relations}
\begin{definition}
All types of orders are transitive.
\begin{itemize}
\item A \udef{preorder} or \udef{quasiorder} $\precsim$ is also reflexive.
\item A \udef{total preorder} is also connex.
\item A \udef{partial order} $\preceq$ is also reflexive and anti-symmetric.
\item A \udef{strict partial order} $\prec$ is also irreflexive (or, equivalently, asymmetric).
\item A \udef{total order} $\leq$ is also reflexive, anti-symmetric and connex. Connex means all elements are comparable.
\item A \udef{strict total order} $<$ is also trichotomous.
\end{itemize}
An \udef{ordered set} is a pair $\sSet{P,\Yleft}$ such that $P$ is a set and $\Yleft$ is an order on $P$. We call this ordered set
\begin{itemize}
\item a \udef{proset} if $\Yleft$ is a preorder;
\item a \udef{poset} if $\Yleft$ is a partial order;
\end{itemize}
\end{definition}

A total preorder is necessarily also reflexive by \ref{connexityConsequences}.

A strict partial order is necessarily also anti-symmetric by \ref{asymmetricIrreflexive} and \ref{asymmetryAntisymmetry} (which is why there is no separate notion of ``strict preorder'').

A strict total order is like a total order that is strict (i.e.\ irreflexive instead of reflexive).  However by \ref{connexityConsequences}, no irreflexive relation can be connex, so we relax the requirement to semi-connexity:
\[ \begin{cases}
\text{transitive} \\ \text{trichotomous}
\end{cases} \iff \begin{cases}
\text{transitive} \\ \text{irreflexive} \\ \text{\textit{semi}-connex}
\end{cases}. \]

If we say $\sSet{P,\Yleft}$ is an ordered set without any other qualifiers, we only assume $\Yleft$ is transitive.

\begin{example}
\begin{itemize}
\item Every equivalence relation is a preorder. Conversely, symmetric preorders are equivalence relations.
\item Let $X$ be a set. Then $\sSet{\powerset(X), \subseteq}$ is a poset.
\item Let $A$ be a set and $\id_A$ the identity relation on $A$. Then $\sSet{A,\id_A}$ is a poset. Such posets are called \udef{discrete posets}. Two elements $x,y\in A$ are comparable if and only if $x=y$.
\item Let $B$ be a set and $\bot\in B$. Then the order $\preceq$ defined by
\[ x \preceq y \defequiv (x=\bot) \lor (x = y) \]
is a partial order. Such posets are called \udef{flat posets}.
\end{itemize}
\end{example}

\begin{lemma}
For any binary homogeneous relation $R$,
\begin{enumerate}
\item the reflexive transitive closure, $R^{+=}$, is a preorder;
\item the left residual, $R\backslash R = \overline{R^\transp;\overline{R}}$ is a preorder.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{orderQuasiEquivalence}
Let $\sSet{X,\Yleft}$ be an ordered set. Then $\Yleft \cap \Yleft^\transp$ is a quasi-equivalence relation.
\end{lemma}

\begin{definition}
We call the quasi-equivalence of \ref{orderQuasiEquivalence} the \udef{associated quasi-equivalence} of $\Yleft$. We denote it $\sim_\Yleft$.
\end{definition}

\begin{lemma} \label{preorderEquivalence}
Let $(P, \precsim)$ be a proset. Then $\precsim \cap \precsim^\transp$ is an equivalence relation.
\end{lemma}

Let $\sSet{P,\Yleft}$ be an ordered set. We can decompose $\Yleft = \Yleft_S \cup \Yleft_A$, as in \ref{symmetricAsymmetricDecomposition}, into a symmetric and asymmetric part.
\begin{itemize}
\item By \ref{asymmetricIrreflexive} an order is strict (i.e.\ irreflexive) if and only if it is asymmetric: $\Yleft_S = E_P$ and $\Yleft_A = \Yleft$.
\item For non-strict partial and total orders we have $\Yleft_S = \id_P$.
\end{itemize}

So we can turn a partial / total order into a strict partial / total order by removing $\id_P$. Conversely, we can turn a strict partial / total order into a partial / total order by adding $\id_P$.

\begin{proposition}
\mbox{}
\begin{enumerate}
\item Let $(P, \precsim)$ be a proset. The relation $\precsim \cap\; \overline{\precsim}^\transp$
is a strict partial order.
\item Let $(P, \preceq)$ be a poset. The relation $\preceq \cap \;\overline{\preceq}^\transp = \preceq \cap\; \overline{\id}_P$
is a strict partial order.
\item Let $(P, \prec)$ be a strict partial order. Then $\prec \cup \id_P$ is a partial order.
\item Let $(P, \leq)$ be a totally ordered set. The relation $\leq \cap\; \overline{\leq}^\transp = \leq \cap\; \overline{\id}_P = \overline{\leq}^\transp$
is a strict total order.
\item Let $(P, <)$ be a strict total order. Then $< \cup \id_P$ is a total order.
\end{enumerate}
Multiple different preorders are associated to the same strict partial orders. For partial and total orders the association is one-to-one.
\end{proposition}

\section{Covering relations}
\begin{definition}
Let $(P,\Yleft)$ be a an order relation and $x,y\in P$. We say $y$ \udef{covers} $x$ if
\begin{itemize}
\item $x\Yleft y$;
\item $x\neq y$
\item $\nexists z\in P\setminus\{x,y\}: x\Yleft z \Yleft y$).
\end{itemize}
We write $x\lessdot y$.
\end{definition}

\begin{lemma}
Let $(P,\Yleft)$ be an ordered set. Let $\Yleft_A$ be the asymmetric part of $\Yleft$. Then $\lessdot = \Yleft_A \cap \overline{\Yleft_A^2}$.
\end{lemma}

\begin{lemma}
Let $P$ be a preordered set. Then $y$ covers $x$ \textup{if and only if} $x\neq y$ and $[x,y] = \{x,y\}$.
\end{lemma}

\subsection{Hasse diagrams}
A \udef{Hasse diagram} is a graphical depiction of an order relation. Each element of the ordered set is a point and points are connected such that:
\begin{enumerate}
\item if $x \Yleft y$, then the point for $x$ is drawn lower than the point for $y$;
\item two elements $x,y$ are connected if $y$ covers $x$ or $x$ covers $y$.
\end{enumerate}

TODO is transitive (reflective) reduction! (+ link Galois)

\begin{lemma}
The Hasse diagrams of partial orders are acyclic due to anti-symmetry.
\end{lemma}

\begin{example}
The power set $\powerset\{a,b,c\}$ can be ordered by the inclusion relation $\subseteq$. The following is a Hasse diagram for this ordered set:
\begin{center}
\begin{tikzcd}
 & \{a,b,c\} & \\
\{a,b\}\ar[ru, dash] & \{a,c\}\ar[u,dash] & \{b,c\}\ar[lu,dash] \\
\{a\} \ar[u,dash] \ar[ru, dash] & \{b\} \ar[lu, dash] \ar[ru, dash] & \{c\} \ar[lu,dash] \ar[u, dash] \\
 & \emptyset \ar[lu, dash] \ar[u, dash] \ar[ru, dash] &
\end{tikzcd}
\end{center}
\end{example}

\section{The dual of an ordered set}
\begin{definition}
For any ordered set $(P, \Yleft)$ the \udef{dual} of $P$ is the ordered set $(P^o, \Yleft^o)$, where $P^o \defeq P$ and $\Yleft^o \defeq \Yleft^\transp = \Yright$.
\end{definition}
This means $\forall a,b\in P: a\Yleft b \iff b\Yleft^o a$.

\begin{lemma}
The dual of an ordered set of a particular type is an ordered set of the same type.
\end{lemma}
\begin{corollary}
All statements about all ordered sets also hold for all duals of ordered sets.
\end{corollary}

\section{Functions on ordered sets}
TODO define for all relations
\begin{definition}
Let $(P, \Yleft_P)$ and $(Q, \Yleft_Q)$ be ordered sets and $f: P\to Q$ a function.
\begin{itemize}
\item $f$ is \udef{order-preserving}, \udef{isotone}, \udef{monotonically increasing} or just \udef{increasing} if $f$ is relation-preserving;
\item $f$ is \udef{order-reversing}, \udef{antitone}, \udef{monotonically decreasing} or just \udef{decreasing} if $f: P\to Q^o$ is relation-preserving;
\item $f$ is \udef{monotone} or \udef{monotonic} if $f$ is relation-preserving as either a function $P\to Q$ or $P\to Q^o$.
\end{itemize}
Similarly we say $f$ is \udef{(reverse) order-reflecting} or a \udef{(reverse) order embedding} if $f$ is relation-reflecting or a relation embedding as a function $P\to Q$ (resp. $P\to Q^o$).

The adjectives ``strict'' and ``weak'' can be added to any of these cases to identify whether the (weak, i.e.\ reflexive) order or the associated strict order is meant.

We let $(P\to Q)_\Yleft$ denote the set of order-preserving functions from $P$ to $Q$.
\end{definition}
The concept of order isomorphism (or \udef{similarity}) is similarly inherited. Let $U,V$ be ordered sets. We write $U =_o V$ if $U$ and $V$ are order isomorphic and $U \neq_o V$ if not.

\begin{lemma}
Let $(P, \Yleft_P)$ and $(Q, \Yleft_Q)$ be ordered sets such that $P$ is anti-symmetric and $Q$ is reflexive. If a function $f: P \to Q$ is order-preserving and -reflecting, then it is an order embedding.
\end{lemma}
In other words, the conditions are sufficient for $f$ to be injective.
\begin{proof}
Take $x,y\in P$ such that $f(x) = f(y)$. Then $f(x) \Yleft_Q f(y)$ and $f(y) \Yleft_Q f(x)$. Since $f$ reflects the order, we have $x \Yleft_P y$ and $y \Yleft_P x$, so $x = y$ by anti-symmetry.
\end{proof}

\begin{lemma}
Let $f:P\to Q$ be a function between posets. Then
\begin{enumerate}
\item If $f$ preserves strict order, then it is order-preserving.
\item If $f$ is order-reflecting, then it reflects strict order.
\end{enumerate}
If $f$ is injective, the opposite implications also hold.
\end{lemma}
\begin{corollary}
Let $f: P\to Q$ be a function between posets.
\begin{enumerate}
\item If $f$ is an order embedding, then it is a strict order embedding.
\item If $P$ is totally ordered, the converse implication holds as well.
\end{enumerate}
\end{corollary}
\begin{proof}
Use \ref{relationPreservingFunctionFromSemiConnexStructure}.
\end{proof}

The converse does not hold in general if $P$ is a poset because a strict order embedding between posets is not necessarily injective. A counterexample is
\[
\begin{tikzcd}
& \top & \\
x \ar[ur, dash] & & y \ar[ul, dash] \\
& \bot \ar[ul, dash] \ar[ur, dash] &
\end{tikzcd} \qquad \begin{tikzcd} {} \arrow[rr, "f"] & {}& {}\end{tikzcd} \qquad \begin{tikzcd}
f(\top) \\ f(x) = f(y) \ar[u,dash] \\ f(\bot) \ar[u,dash]
\end{tikzcd}.
\]

\begin{lemma} \label{equivalenceOrderPreservingReflecting}
Let $f:P\to Q$ be a function between totally ordered sets. Then
\begin{enumerate}
\item If $f$ preserves strict order, then it is order-preserving.
\item If $f$ is order-reflecting, then it reflects strict order.
\end{enumerate}
If $f$ is injective, the opposite implications also hold.
\end{lemma}
\begin{proof}
(1) Assume $f$ order-reflecting. Assume $x\leq y$. Either $f(x)\leq f(y)$ or $f(y)\leq f(x)$. If $f(y)\leq f(x)$, then
\[ y\leq x \implies x=y \implies f(x)=f(y) \implies f(x)\leq f(y). \]
So in both cases $f(x)\leq f(y)$.

(2) Assume $f$ preserves strict order. Assume $f(x) < f(y)$. Either $x<y, y<x$ or $x=y$. If either $y<x$ or $x=y$ hold, preservation of strict order yields a contradiction. So $x<y$.

(1') Assume $f$ order-preserving and injective. Assume $f(x)\leq f(y)$. Either $x\leq y$ or $y\leq x$. If $y\leq x$, then
\[ f(y)\leq f(x) \implies f(x)=f(y) \implies x= y \implies x\leq y. \]
So in both cases $x\leq y$.

(2') Assume $f$ is injective reflects strict order. Assume $x < y$. Either $f(x)<f(y), f(y)<f(x)$ or $f(x)=f(y)$. If $f(y)<f(x)$, preservation of strict order yields a contradiction. If $f(x)=f(y)$, injectivity yields a contradiction. So $f(x)<f(y)$.
\end{proof}


\begin{proposition} \label{monotonicityOrderClosure}
Let $\sSet{P,R}$ and $\sSet{Q,\Yleft}$ be relational structures and $f:P\to Q$ a function. Assume $\Yleft$ is a preorder. Then the following are equivalent:
\begin{enumerate}
\item $f$ is relation-preserving;
\item $R;f;\Yleft \subseteq f;\Yleft$;
\item the inverse image of every principal down-set is closed under $R^\transp$;
\item $\Yleft;f^\transp; R \subseteq \Yleft;f^\transp$
\item the inverse image of every principal up-set is closed under $R$.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1 \Rightarrow 2)$ By \ref{relationPreserving} we have $R;f \subseteq f;\Yleft$. Then $R;f;\Yleft \subseteq f;\Yleft^2 \subseteq f;\Yleft$ by transitivity.

$(2 \Rightarrow 1)$ By reflexivity we have $\id_Q \subseteq \Yleft$ and so $R;f \subseteq R;f;\Yleft \subseteq f;\Yleft$. Thus $f$ is relation-preserving by \ref{relationPreserving}.

$(3)$ Is simply a translation of $\forall x: R;f;Sx \subseteq f;Sx$.

$(4)$ Equivalent to (2) by taking transposed and using that $f$ is $\Yleft$-preserving iff $f$ is $\Yleft^\transp$-preserving.

$(3)$ Is simply a translation of $\forall x: xS;f^\transp; R \subseteq xS;f^\transp;f^\transp$.
\end{proof}
\begin{corollary}
If $R$ is reflexive, then we can replace the inclusions by equalities.

If $R$ is a preorder, we have that the following are equivalent:
\begin{enumerate}
\item $f$ is relation-preserving;
\item $\upset f^\imf(\upset A) = \upset f^\imf(A)$ for all $A\subseteq P$.
\end{enumerate}
\end{corollary}

\begin{proposition}
Let $\sSet{P,\leq_P}$ and $\sSet{Q,\leq_Q}$ be posets and $f:P\to Q$ a function. Then $f$ is residuated \textup{if and only if} the inverse image of every principal down-set is a principal down set.
\end{proposition}
Clearly we can replace ``down-set'' with ``up-set'' by considering the dual order.
\begin{proof}
This follows directly from \ref{preimagesGaloisIdentity} and \ref{preorderGaloisIdentity}.
\end{proof}

\begin{definition}
A function $f: P\to P$ on an ordered set $(P,\Yleft)$ into itself is
\begin{itemize}
\item \udef{expansive} if $\forall x\in P: x\Yleft f(x)$;
\item \udef{contractive} if $\forall x\in P: f(x)\Yleft x$.
\end{itemize}
\end{definition}

\begin{lemma}
Let $f:P\to P$ be a function on an ordered set $(P,\Yleft)$. Consider $(P\to P)$ to be ordered by pointwise order. Then the following are equivalent:
\begin{enumerate}
\item $f$ is expansive;
\item $\id_P \Yleft f$;
\item $\graph(f) \subseteq \graph(\Yleft)$.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $f$ is contractive;
\item $f \Yleft \id_P$;
\item $\graph(f) \subseteq \graph(\Yleft^\transp)$.
\end{enumerate}
\end{lemma}


\section{Subsets of ordered sets}
\subsection{Up and down sets}
\begin{lemma} \label{imageClosureTransitiveRelations}
Let $\sSet{P, \Yleft}$ be an ordered set. Then the closure function $\Closure_{\Yleft}$ equals the image function $\im_{\Yleft^=}$ of the reflexive closure $\Yleft^=$.
\end{lemma}

\begin{definition}
Let $\sSet{P, \Yleft}$ be an ordered set and $Q\subseteq P$. We denote
\begin{itemize}
\item the \udef{upward closure} of $Q$ as $\upset_P Q \defeq \Closure_{\Yleft}(Q) = Q_{\Yleft} \cup Q$;
\item the \udef{downward closure} of $Q$ as $\downset_P Q \defeq \Closure_{\Yleft^\transp}(Q) = Q_{\Yleft^\transp} \cup Q$.
\end{itemize}
We usually write $\upset$ and $\downset$ instead of $\upset_P$ and $\downset_P$ if the ambient ordered set is clear.

We call $Q$
\begin{itemize}
\item \udef{upwards closed} or an \udef{up set} if $\upset Q = Q$;
\item \udef{downwards closed} or a \udef{down set} if $\downset Q = Q$.
\end{itemize}
For $x\in P$,
\begin{itemize}
\item $\upset x \defeq \upset\{x\}$ is the \udef{principal up set} generated by $x$;
\item $\downset x \defeq \downset\{x\}$ is the \udef{principal down set} generated by $x$.
\end{itemize}
We denote
\begin{itemize}
\item the set of upsets by $\upsetset(P)$;
\item the set of downsets by $\downsetset(P)$.
\end{itemize}
\end{definition}

\begin{lemma} \label{upwardDownwardClosure}
Let $\sSet{P, \Yleft}$ be an ordered set and $Q\subseteq P$. Then
\begin{enumerate}
\item $Q$ is upwards closed \textup{if and only if} $Q_\Yleft \subseteq Q$;
\item $Q$ is downwards closed \textup{if and only if} $Q_{\Yright} \subseteq Q$;
\end{enumerate}
also
\begin{enumerate} \setcounter{enumi}{2}
\item if $\Yleft$ is a preorder, then $Q_\Yleft = \upset Q$ and $Q_{\Yright} = \downset Q$.
\end{enumerate}
\end{lemma}
\begin{proof}
This follows directly from \ref{imageClosureTransitiveRelations}.
\end{proof}


\begin{lemma} \label{intersectionUpwardsClosedIsUpwardsClosed}
Let $\sSet{P, \precsim}$ be a preordered space and $A,B\subseteq P$. Then $\upset A \cap \upset B$ is upwards closed.
\end{lemma}
\begin{proof}
Take $x\in \upset(\upset A \cap \upset B)$. Then there exists $a\in \upset A$ and $b\in \upset B$ such that $a\precsim x$ and $b\precsim x$. Then $x\in \upset A$ and $x\in \upset B$, so $x\in \upset A \cap \upset B$.
\end{proof}

\begin{lemma} \label{principalDownSetEmbedding}
Let $\sSet{P,\precsim}$ be a preordered set and $x,y\in P$. Then the following are equivalent:
\begin{enumerate}
\item $x \precsim y$;
\item $\downset \{x\} \subseteq \downset \{y\}$;
\item $\upset \{y\} \subseteq \upset \{x\}$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Take $z\in \downset\{x\}$. Then $z \precsim x\precsim y$, so $z\precsim y$ by transitivity and so $z\in \downset\{y\}$.

$(2) \Rightarrow (1)$ By reflexivity, $x\in \downset\{x\}$, so $x\in \downset\{y\}$, which implies $x\precsim y$.

$(1) \Rightarrow (3)$ Take $z\in \upset\{y\}$. Then $x\precsim y \precsim z$, so $x\precsim z$ by transitivity and so $z\in \upset\{x\}$.

$(3) \Rightarrow (1)$ By reflexivity, $y\in \upset\{y\}$, so $y\in \upset\{x\}$, which implies $x\precsim y$.
\end{proof}

\begin{proposition} \label{completeLatticeUpDownSets}
Let $\sSet{P,\Yleft}$ be an ordered set. Then
\begin{enumerate}
\item $\downsetset(P)$ is a complete sublattice of $\powerset(P)$ with closure $\downset(-)$,
\[ \bigwedge_{\downsetset(P)}\mathcal{E} = \bigcap\mathcal{E} \qquad\text{and}\qquad \bigvee_{\downsetset(P)}\mathcal{E} = \bigcup\mathcal{E} \]
for all $\mathcal{E} \subseteq \downsetset(P)$;
\item $\upsetset(P)$ is a complete sublattice of $\powerset(P)$ with closure $\upset(-)$,
\[ \bigwedge_{\upsetset(P)}\mathcal{E} = \bigcap\mathcal{E} \qquad\text{and}\qquad \bigvee_{\upsetset(P)}\mathcal{E} = \bigcup\mathcal{E} \]
for all $\mathcal{E} \subseteq \upsetset(P)$.
\end{enumerate}
\end{proposition}
TODO: compare with closure under relation in relational universal algebra.
\begin{proof}
(1) TODO: $\downset(-)$ is a Moore closure. The form of the meet is given by \ref{meetJoinImageMooreClosure}. For the join, we need to show that $\bigcup\mathcal{E}$ is downwards closed for all $\mathcal{E} \subseteq \downsetset(P)$. Take arbitrary $x\in P$. Then
\begin{align*}
x\in \downset\Big(\bigcup\mathcal{E}\Big) &\implies \exists y \in \bigcup\mathcal{E}:\; x \Yleft y \\
&\implies \exists A\in \mathcal{E}: \exists y \in A:\; x \Yleft y \\
&\implies \exists A\in \mathcal{E}: x \in \downset A \\
&\implies \exists A\in \mathcal{E}: x \in A \\
&\implies x\in \bigcup \mathcal{E}.
\end{align*}

(2) Dual.
\end{proof}

\subsubsection{Galois connections}
\begin{lemma} \label{GaloisConnectionOrderClosure}
Let $\sSet{P, \Yleft}$ be an ordered set and $A,B \subset P$. Then
\[ \upset A \mesh B \quad\iff\quad A\mesh \downset B. \]
\end{lemma}
\begin{proof}
Assume $\upset A \mesh B$, then there exists $x\in \upset A \cap B$, which means there exists $y\in A$ and $x\in B$ such that $y\Yleft x$. So $y\in A\cap \downset B$ and thus $A\mesh \downset B$.

The opposite implication is dual.
\end{proof}

\begin{proposition} \label{upsetResiduatedImageGaloisConnection}
Let $P,Q$ be posets and $f: P\to Q$ a residuated function with residual $g: Q\to P$. Then
\[ \upset\circ g^{\imf}: \upsetset(Q) \to \upsetset(P) \qquad\text{and}\qquad \upset\circ f^{\imf}: \upsetset(P) \to \upsetset(Q) \]
form a Galois connection $(\upset\circ g^{\imf}, \upset\circ f^{\imf})$.
\end{proposition}
TODO same for downsets.
\begin{proof}
We verify the Galois identity \ref{preorderGaloisIdentity}: take arbitrary $F\in \upsetset(Q), G\in \upsetset(P)$ and calculate (using \ref{functionImagePreimageGaloisConnection})
\begin{align*}
\upset g^{\imf}(F) \subseteq G &\iff g^\imf(F) \subseteq G \\
&\iff \forall a\in F: \; g(a) \in G \\
&\iff \forall a\in F: \exists b\in G: \; b \leq g(a) \\
&\iff \forall a\in F: \exists b\in G: \; f(b) \leq a \\
&\iff F \subseteq \upset f^{\imf}(G).
\end{align*}
\end{proof}
\begin{corollary} \label{upsetPreimageImageGaloisConnection}
Let $X, Y$ be sets and $f: X\to Y$. Then
\[ f^{\preimf\imf}: \upsetset\big(\powerset(Y)\big) \to \upsetset\big(\powerset(X)\big) \qquad\text{and}\qquad \upset\circ f^{\imf\imf}: \upsetset\big(\powerset(X)\big) \to \upsetset\big(\powerset(Y)\big) \]
form a Galois connection $(\upset\circ f^{\preimf\imf}, \upset\circ f^{\imf\imf})$.
\end{corollary}
\begin{corollary} \label{imageUpsetsPreservesIntersection}
Let $X, Y$ be sets and $\mathcal{F}\subseteq\upsetset\big(\powerset(X)\big)$. Let $f:X\to Y$ be a function. Then
\[ \upset f^{\imf\imf}\Big(\bigwedge \mathcal{F}\Big) = \bigwedge (\upset\circ f^{\imf\imf})^{\imf}(\mathcal{F}). \]
In particular for $F,G\in \upsetset\big(\powerset(X)\big)$, we have $\upset f^{\imf\imf}(F\wedge G) = \upset f^{\imf\imf}(F) \wedge \upset f^{\imf\imf}(G)$.
\end{corollary}
\begin{proof}
Immediate from the proposition and \ref{GaloisConnectionLatticePreservation}.
\end{proof}
\begin{proof}[Alternate proof.]
The inequality $\subseteq$ is given by \ref{orderPreservingFunctionLatticeOperations}.

For the other inequality, take $A\in \bigcap (\upset\circ f^{\imf\imf})^{\imf}(\mathcal{F})$. Then, for all $F\in\mathcal{F}$, there exists $B_F\in F$ such that $f^{\imf}(B_F) \subseteq A$. Now $f^{\imf}\left(\bigcup_{F\in\mathcal{F}}B_F\right) = \bigcup_{F\in\mathcal{F}}f^{\imf}(B_F) \subseteq A$. Also $\bigcup_{F\in\mathcal{F}}B_F \in \bigcap \mathcal{F}$ by upwards closure of each filter. Thus $A\in \upset f^{\imf\imf}(\bigcap \mathcal{F})$.
\end{proof}

\subsection{Upper and lower bounds}

\begin{lemma} \label{upperBoundUpsetLowerBoundDownset}
Let $(P,\Yleft)$ be an ordered set and $S$ a non-empty subset of $P$, then
\begin{enumerate}
\item $\upset S^u \subseteq S^u$ and $(\downset S)^u \subseteq S^u$;
\item $\upset S^u \subseteq S^u$ and $(\upset S)^l \subseteq S^l$.
\end{enumerate}
\end{lemma}
In particular $S^u$ is an up set and $S^l$ a down set.
\begin{corollary} \label{minMaxUpsetDownset}
Let $(P,\Yleft)$ be an ordered set, $x\in P$ and $S$ a non-empty subset of $P$, then
\begin{enumerate}
\item $x \in \max(\downset x)$;
\item $x \in \min(\upset x)$;
\item if $\max(S)\neq \emptyset$, then $\downset S = \downset \max(S)$;
\item if $\min(S)\neq \emptyset$, then $\upset S = \upset \min(S)$.
\end{enumerate}
\end{corollary}


\begin{proposition} \label{supInfPreserveOrder}
Let $(P,\Yleft)$ be an ordered set and $A\subseteq P$. Then
\begin{enumerate}
\item $A^\Yleft \subseteq \sup(A)^\Yleft$;
\item $A^{\Yleft^\transp} \subseteq \inf(A)^{\Yleft^\transp}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We calculate, using the fact that $(-)^\Yleft$ and $(-)^{\Yleft^\transp}$ are generalised inverses and \ref{orderPreservingFunctionLatticeOperations}
\[ A^\Yleft = ((A^\Yleft)^{\Yleft^\transp})^\Yleft \subseteq (A^{\Yleft})^\Yleft \cup ((A^\Yleft)^{\Yleft^\transp})^\Yleft \subseteq \big(A^{\Yleft} \cap (A^\Yleft)^{\Yleft^\transp}\big)^\Yleft = \sup(A)^\Yleft. \]
(2) Dual.
\end{proof}
The proposition is more familiar in the following form:
\begin{corollary}
Let $P$ be a poset and $x\in P$, then
\begin{enumerate}
\item if $a \leq x$ for all $a\in A$, then $\sup(A) \leq x$;
\item if $x \leq a$ for all $a\in A$, then $x\leq \inf(A)$.
\end{enumerate}
\end{corollary}

\begin{lemma} \label{boundsOnSetWithLeastBoundIsPrincipalIdeal}
Let $(P,\Yleft)$ be an ordered set, $A\subseteq P$ and $x\in P$. Then
\begin{enumerate}
\item if $x\in \sup(A)$, then $A^\Yleft = \upset \{x\}$;
\item if $x\in \inf(A)$, then $A^\Yright = \downset \{x\}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Suppose $x\in \sup(A) =  A^\Yleft \cap (A^\Yleft)^\Yright$. First take $y\in A^\Yleft$. Since $x\in (A^\Yleft)^\Yright$, we have $x\Yleft y$, so $y\in \upset \{x\}$.

Now take $y\in \upset \{x\}$, so $x \Yleft y$. Take arbitrary $a\in A$. Since $x \in A^\Yleft$, we have $a \Yleft x$. By transitivity, $a\Yleft y$. Since $a\in A$ was taken arbitrarily, we have $y\in A^\Yleft$.

(2) Dual.
\end{proof}

\subsection{Chains}
\begin{definition}
Let $(PX,\Yleft)$ be an ordered set. A \udef{chain} in $X$ is a linearly ordered (i.e.\ connex) subset $S$ of $X$, i.e.\
\[ \forall x,y\in S: x\Yleft y \lor y\Yleft x. \]

An \udef{antichain} is a subset $A$ such that no two elements of $A$ are comparable.
\end{definition}

\begin{example}
For every $n\in \N$ there exists a chain $\mathbb{n}$ of $n$ elements and an antichain $\overline{\mathbb{n}}$ of $n$ elements:
\[ \mathbb{1}: \begin{tikzcd}
\circ
\end{tikzcd} \qquad \mathbb{2}: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \mathbb{3}: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \hdots \]
\[ \overline{\mathbb{1}}: \begin{tikzcd}
\circ
\end{tikzcd} \qquad \overline{\mathbb{2}}: \begin{tikzcd}
\circ & \circ
\end{tikzcd} \qquad \overline{\mathbb{3}}: \begin{tikzcd}
\circ & \circ & \circ
\end{tikzcd} \qquad \hdots \]
\end{example}

\begin{lemma} \label{boundsFiniteChain}
Let $X$ be an ordered set. If $C$ is a non-empty, finite chain in $X$, then
\begin{enumerate}
\item $\sup(C) \supseteq \max(C) \neq \emptyset$;
\item $\inf(C) \supseteq \min(C) \neq \emptyset$.
\end{enumerate}
\end{lemma}
\begin{proof}
The $\supseteq$-relation is due to \ref{maxSupMinInf}.

The proof that $\max(C)$ is non-empty is by induction on the cardinality of $C$. For the base case, assume $C$ has one element $x$. Then $x \leq x$, so $x\in \max(C)$.

Now assume all chains with one fewer element than $C$ have a maximal element. Pick some $x_0\in C$, then $y = \max(C\setminus \{x_0\})$ exists. We can compare $x_0$ and $y$ because $C$ is a chain. If $x_0 \leq y$, then $\max(C) = y$. If $y \leq x_0$, then $\max(C) = x_0$. This exhausts the possibilities.
\end{proof}

\begin{definition}
An ordered set $X$ is \udef{chain-complete} or \udef{inductive} if every chain in $X$ has a least upper bound.

For any cardinal $\kappa$, we say $X$ is \udef{$\kappa$-chain-complete} or \udef{$\kappa$-inductive} if every chain in $X$ of at most cardinality $\kappa$ has a least upper bound.
\end{definition}

\begin{lemma}
Every inductive poset has a least element.
\end{lemma}
\begin{proof}
The empty set $\emptyset$ is a chain in any poset $P$. Then $\sup(\emptyset) = \min(\emptyset^u) = \min(P)$.
\end{proof}

\begin{example}
The set $\N$ is not inductive, because $\N$ itself does not have a least upper bound.
\end{example}

\begin{proposition} \label{inductive}
Let $A,B$ be sets and $X$ an ordered set. Then the following posets are inductive:
\begin{enumerate}
\item $\powerset(A)$, ordered by inclusion;
\item $(A \not\to B)$, ordered by inclusion;
\item the set of chains in $X$, ordered by inclusion.
\end{enumerate}
\end{proposition}
\begin{proof}
In all cases the least upper bound of a chain $S$ is given by $\bigcup S$.
\end{proof}

\subsection{Intervals}
\begin{definition}
Let $(P,\Yleft)$ be an ordered set and $m,n\in P$. We define
\begin{itemize}
\item the \udef{closed interval} $\interval[c]{m,n} \defeq \setbuilder{k\in P}{m\Yleft k \land k\Yleft n}$;
\item the \udef{open interval} $\interval[o]{m,n} \defeq [m,n]\setminus\{m,n\}$;
\item the \udef{half-open intervals}
\begin{align*}
\interval[co]{m,n} &\defeq \interval{m,n}\setminus\{n\}; \\
\interval[oc]{m,n} &\defeq \interval{m,n}\setminus\{m\}.
\end{align*}
\end{itemize}
We also write $m:n \defeq \interval[co]{m,n}$.
\end{definition}

\begin{lemma} \label{emptyInterval}
Let $(P,\Yleft)$ be an ordered set and $m,n\in P$.
\begin{enumerate}
\item If $m \cancel\Yleft n$, then $[m,n] = \emptyset$.
\item If $\Yleft$ is a preorder, then
\begin{enumerate}
\item $m \cancel\Yleft n$ \textup{if and only if} $[m,n] = \emptyset$;
\item either $[m,n] = \emptyset$ or $\{m,n\} \subseteq [m,n]$.
\end{enumerate}
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We prove by contraposition. Assume $k\in [m,n]$, then $m\Yleft k$ and $k\Yleft n$, so $m\Yleft n$ by transitivity.

(2) (a) The direction $\Rightarrow$ is given by \ref{emptyInterval}. Now assume $m \Yleft n$. Also $m\Yleft m$ and $n \Yleft n$ by reflexivity. So $m,n\in [m,n]$ by definition. This also gives point (b).
\end{proof}


\section{Completeness}
\begin{definition}
An ordered set $P$ is 
\begin{itemize}
\item \udef{order complete} (or simply \udef{complete}) if each subset has a supremum and an infimum;
\item \udef{order $\sigma$-complete} if each countable subset has a supremum and an infimum;
\item \udef{finitely order complete} if each finite subset has a supremum and an infimum;
\item \udef{Dedekind complete} if
\begin{itemize}
\item each non-empty subset that is bounded above has a supremum; and
\item each non-empty subset that is bounded below has an infimum;
\end{itemize}
\item \udef{Dedekind $\sigma$-complete} if
\begin{itemize}
\item each non-empty countable subset that is bounded above has a supremum; and
\item each non-empty countable subset that is bounded below has an infimum.
\end{itemize}
\item \udef{finitely Dedekind complete} if
\begin{itemize}
\item each non-empty finite subset that is bounded above has a supremum; and
\item each non-empty finite subset that is bounded below has an infimum.
\end{itemize}
\end{itemize}
\end{definition}
Some authors use ``order completeness'' to mean what we have called Dedekind completeness.

\begin{example}
The closed unit disk in $\R^2$ with coordinatewise ordering is Dedekind complete, but not order complete and is not a lattice.
\end{example}

\begin{lemma}
Let $P$ be an ordered set that contains a least and a greatest element. Then $P$ is order complete \textup{if and only if} $P$ is Dedekind complete.
\end{lemma}
\begin{proof}
Every set is bounded (by the least and greatest elements).
\end{proof}

\begin{proposition} \label{existenceSupremaInfima}
Let $(P,\Yleft)$ be an ordered set. Then the following are equivalent:
\begin{enumerate}
\item $P$ is order complete;
\item each subset of $P$ has a supremum;
\item each subset of $P$ has an infimum;
\item each non-empty subset of $P$ has a supremum and $P$ has a least element;
\item each non-empty subset of $P$ has an infimum and $P$ has a greatest element.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $P$ is Dedekind complete
\item each non-empty set that is bounded above has a supremum;
\item each non-empty set that is bounded below has an infimum.
\end{enumerate}
\end{proposition}
\begin{proof}
We show that (2) and (3) are equivalent. The other assertions then follow simply.

Suppose each subset has a supremum and let $S$ be a subset. Then in particular $S^\Yright$ has a supremum. This supremum of $S^\Yright$ is an infimum of $S$, since $\sup(S^\Yright) = \inf(S)$ by \ref{supInfConnection}.

The converse is similar.

For equivalence with (3) and (4), we just need to remark that $\sup(\emptyset) = \min(P)$ and $\inf(\emptyset) = \max(P)$.

For Dedekind completeness the argument is similar, we just need to remark that if $S$ is non-empty and bounded below, then $S^\Yright$ is non-empty and bounded above.
\end{proof}
\begin{corollary}
Every complete ordered set has a greatest and least element.
\end{corollary}


\begin{lemma}
The ordered natural numbers $\sSet{\N,\leq}$ are complete.
\end{lemma}
\begin{proof}
Any set of natural numbers has a least element by \ref{proposition:wellOrderingN}. Any non-empty set $S$ of natural numbers that is bounded above, we can take $\max(S) = \min(\N\setminus S)-1$.
\end{proof}

\section{Directed sets}
\begin{definition}
An ordered set $\sSet{D,\Yleft}$ is called
\begin{itemize}
\item \udef{(upwards) directed} if every finite subset has an upper bound;
\item \udef{downwards directed} if every finite subset has a lower bound.
\end{itemize}
Let $(D,\Yleft)$ be a directed set. We call
\begin{itemize}
\item the relation $\Yleft$ a \udef{direction};
\item $D$ \udef{progressive} if $D$ does not contain a maximum.
\end{itemize}

Let $\sSet{P,\Yleft}$ be an ordered set. The set of directed subsets of $P$ is denoted $\directed(P)$.


\end{definition}
Note that directed sets are nonempty: they must contain an upper (or lower) bound of the empty set.

TODO: use $\Closure_\vee$ and $\Closure_\wedge$.

TODO: important note: $\Closure_\vee$ only implies closure under finite $\vee$

\begin{example}
\begin{itemize}
\item Any non-empty chain is directed.
\item An antichain is directed iff it is a singleton.
\end{itemize}
\end{example}

TODO: move:
\begin{proposition}
Let $\{(D_i,\Yleft_i)\}_{i\in I}$ be a family of directed sets. Then $D= \prod_{i\in I}D_i$ is a directed set with direction defined by
\[ (a_i)_{i\in I} \Yleft (b_i)_{i\in I} \iff \forall i\in I: a_i\Yleft_i b_i. \]
The directed set $(D,\Yleft)$ is called a \udef{product direction}.
\end{proposition}

\begin{proposition}
Let $\sSet{D, \Yleft}$ a directed set. Every maximal element in $D$ is a greatest element.
\end{proposition}
\begin{proof}
Let $a\in D$ be a maximal element. Take an arbitrary $x\in D$. By directedness, $\{a,x\}$ has an upper bound, say $c$. Because $a$ is maximal, $a\leq c$ implies $c\leq a$. So $x\leq c\leq a$, which means $a$ is a greatest element.
\end{proof}

\begin{proposition} \label{imageDirectedSet}
Let $\sSet{D,\Yleft_D}, \sSet{P,\Yleft_P}$ be ordered sets and $f: D\to P$ an isotone function. If $D$ is upwards / downwards directed, then $f^{\imf}(D)$ is upwards / downwards directed.
\end{proposition}
\begin{proof}
Assume $D$ upwards directed.

Take some finite subset $S\subseteq f^\imf(D)$. Then there exists a finite subset $S'$ such that $f^\imf(S') = S$. We can find $b\in D$ such that $b$ is an upper bound. By isotonicity, $f(b)$ is an upper bound of $S$.

The proof in the case that $D$ is downwards directed is dual.
\end{proof}

\subsection{Directed-completeness}
\begin{definition}
An ordered set $P$ is called \udef{directed-complete} if every directed subset has a supremum.
\begin{itemize}
\item If $P$ is a poset, then it is called a directed-complete partially ordered set, or \udef{DCPO}.
\item If $A \subseteq P$ is directed, then we may denote $\sup(A)$ as $\dirvee A$.
\item For any cardinal $\kappa$, we say $P$ is \udef{$\kappa$-directed complete} (or a \udef{$\kappa$-DCPO} if $P$ is partially ordered) if every directed subset of at most cardinality $\kappa$ has a supremum.
\end{itemize}
\end{definition}

\begin{proposition}
Let $P$ be a poset and $\kappa$ a cardinal. Then $P$ is a $\kappa$-DCPO \textup{if and only if} $P$ is $\kappa$-inductive.
\end{proposition}
This result uses choice.
\begin{proof}
The direction $\Rightarrow$ is immediate.

Consider the other direction. Let $D$ be a directed set of cardinality $\gamma \leq \kappa$. 
If $\gamma$ is finite, then the result is immediate: the only finite directed sets are principal ideals.

Now suppose $\gamma$ is infinite. Then take an ordinal assignement and derive a cardinal assignment using \ref{cardinalsFromOrdinals}. Then $\gamma$ corresponds to a limit ordinal and so
\[ \gamma = \bigcup_{\alpha < \gamma} \alpha \]
by \ref{supLesserElementsOfLimitPoint}. (TODO rewrite without using cardinal assigment?? Maximal chain of subsets of strictly smaller cardinality?) Now there exists a bijection $f: \gamma \to D$ by assumption and set $D_\alpha \defeq f^\imf(\alpha)$. The family $\{D_\alpha\}_{\alpha\leq\gamma}$ is a familty of subsets of $D$ such that $|D_\alpha| = \alpha < \gamma$ and $\bigcup_{\alpha < \gamma}D_\alpha = D$.


Now by choice we can find an ``upper bound function'' $u$ that maps finite subsets of $D$ to some upper bound of the subset in $D$. WLOG we may assume singletons are mapped to their contents and that $u$ is monotone.

We define $D_\alpha'$ by adding the image of all finite subsets of $D_\alpha$ under $u$. This adds at most a distinct point for each finite subset, so $|D_\alpha'| =_c 2\cdot|D_\alpha| = |D_\alpha|$ by \ref{cardinalityStringsFiniteSubsets}. We claim $D_\alpha'$ is directed. Indeed, take $x,y\in D_\alpha'$. 
We can find finite subsets $F,F'\subseteq D_\alpha$ such that $x = u(F)$ and $y = u(F')$ (if $x\in F_\alpha$, we can take $F = \{x\}$ and if $y\in D_\alpha$, we can take $F'= \{y\}$). Now $u(F\cup F')$ is an upper bound of both $x$ and $y$.

We can now prove the claim by induction on the cardinality $\gamma$. By the induction hypothesis, each $D_\alpha'$ has a supremum $s_\alpha$. These suprema form a chain and $\sup_{\alpha<\gamma}s_\alpha$ exists by $\kappa$-inductivity and is a supremum of $D$.
\end{proof}
TODO: clean up the flow of this proof.

\subsection{Preservation of directed joins}
\begin{definition}
Let $B,D$ be ordered sets and $f:B\to D$ a function. Then $f$ is \udef{preserves directed joins} or is \udef{Scott-continuous} if for all directed sets $S$ such that $\dirvee S$ exists, we have
\[ f\big(\dirvee S\big) \;=\; \bigvee f^\imf(S). \]
\end{definition}

\section{Ordered sets of subsets}
\subsection{Refinement}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set and $A,B \subseteq P$. We say $A$ \udef{refines} $B$ (or $A$ is a \udef{refinement} of $B$) if $A\subseteq \upset B$. We write $A \preceq B$.

If $A$ refines $B$ and $B$ refines $A$, we write $A \approx B$ and say $A$ and $B$ are \udef{equally fine}.
\end{definition}

Alternatively, we say $A$ refines $B$ iff
\[ \forall a\in A: \exists b\in B: \; b \Yleft a. \]

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $A,B,C \subseteq P$. Then
\begin{enumerate}
\item if $A$ refines $B$ and $B$ refines $C$, then $A$ refines $C$;
\item if $\Yleft$ is a preorder, then $A$ refines $A$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $A$ refines $B$ and $B$ refines $C$. Then $A \subseteq \upset B$ and $B\subseteq \upset C$, so $\upset B \subseteq \upset\upset C$ and thus $A \subseteq \upset\upset C \subseteq \upset C$.

(2) from  ref TODO.
\end{proof}
\begin{corollary}
Let $\sSet{P,\Yleft}$ be a preordered set.
\begin{enumerate}
\item The relation $\preceq$ is a preorder on $\powerset(P)$.
\item The relation $\approx$ is an equivalence relation.
\end{enumerate}
\end{corollary}
The equivalence relation is the equivalence from \ref{preorderEquivalence}.

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $A \subseteq P$. Then
\begin{enumerate}
\item $A$ is a refinement of $\upset A$;
\item if $\Yleft$ is a preorder, then $A \approx \upset A$;
\item $A \approx B$ implies $\upset A = \upset B$;
\item if $\Yleft$ is a preorder, then $A \approx B$ \textup{if and only if} $\upset A = \upset B$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) is equivalent to $\upset A \subseteq \upset A$.

(2) We need to show that $\upset A$ is refines $A$, i.e.\ $A\subseteq \upset\upset A$. This follows from ref TODO.

(3) Assume $A \approx B$. Then $A \subseteq \upset B$ and $B \subseteq \upset A$. This implies $\upset A \subseteq \upset\upset B \subseteq \upset B$ and $\upset B \subseteq \upset\upset A \subseteq \upset A$.

(4) Assume $\upset A = \upset B$. Then $A$ refines $\upset B$ and $B$ is refines $\upset A$. The result then follows using (2).
\end{proof}

\subsection{Initial segments}
\begin{definition}
Let $(X,\Yleft)$ be an ordered set. An \udef{initial segment} $I$ of $X$ is a downward closed subset.

We write $I \sqsubseteq J$ if $I$ and $J$ are downward closed and $I\subseteq J$.

A \udef{principal initial segment} is a principal down set, i.e.\ an initial segment of the form $\downset\{x\}$ for some $x\in X$.
\end{definition}

\begin{lemma} \label{orderingInitialSegments}
Let $\sSet{X,\Yleft}$ be an ordered set and $x,y\in X$, then
\[ \downset\{x\} \sqsubseteq \downset\{y\} \qquad\iff\qquad \big(x \Yleft y\big) \lor \big(x=y\big). \]
\end{lemma}
\begin{proof}
$\boxed{\Rightarrow}$ Assume $\downset\{x\} \sqsubseteq \downset\{y\}$, then $x\in \downset\{x\} \subseteq \downset\{y\}$, so $x\Yleft y$ or $x=y$.

$\boxed{\Leftarrow}$ Assume $x \Yleft y$ and $z\in \downset\{x\}$. Then either $z=x$ and thus $z\Yleft y$ or $z\Yleft x$ and $z\Yleft y$ by transitivity. In both cases $z\in \downset\{y\}$. 
\end{proof}
\begin{corollary}
If the order is antisymmetric, then
\[ \downset\{x\} = \downset\{y\} \qquad\iff\qquad x = y. \]
\end{corollary}
\begin{corollary} \label{principalDownsetEmbedding}
Let $\sSet{X,\Yleft}$ be an ordered set. Then
\begin{enumerate}
\item $x\mapsto \downset\{x\}$ is an order embedding of the reflexive closure of $X$ in the principal down sets of $X$ (ordered by $\sqsubseteq$);
\item $x\mapsto \downset\{x\}$ is an order isomorphism if $X$ is a poset.
\end{enumerate}
\end{corollary}
Compare with \ref{upsetDownsetConnections}.
\begin{proof}
(1) Immediate from the lemma.

(2) The function $x\mapsto \downset x$ is surjective by definition. For injectivity: the inverse map is given by $Q\mapsto \max(Q)$. This is a function by \ref{minMaxSingletons} and an inverse by \ref{minMaxUpsetDownset}.
\end{proof}
\begin{corollary} \label{orderedSetPowerset}
Every poset is isomorphic to a subset of $\powerset(A)$ for some set $A$. 
\end{corollary}
\begin{proposition} 
Let $\sSet{X,\Yleft}$ be an ordered set. Then $x\mapsto \downset\{x\}$ is an order embedding of the reflexive closure of $X$ in the principal down sets of $X$ (ordered by $\sqsubseteq$).

If $P$ is a partial order, then the map is bijective and thus an order isomorphism.
\end{proposition}

\section{Combining ordered sets}
\begin{definition}
Let $P,Q$ be ordered sets. Then
\begin{itemize}
\item the \udef{disjoint union} $P\sqcup Q$ is ordered by
\[ x\precsim y \iff \begin{cases}
x,y\in P \;\text{and}\; x\precsim y \\
x,y\in Q \;\text{and}\; x\precsim y
\end{cases} \]
\item the \udef{linear sum} $P\oplus Q$ is the disjoint union ordered by
\[ x\precsim y \iff \begin{cases}
x,y\in P \;\text{and}\; x\precsim y \\
x,y\in Q \;\text{and}\; x\precsim y \\
x\in P \;\text{and}\; y\in Q
\end{cases} \]
\end{itemize}
\end{definition}

\begin{example}
We define $\mathbf{M}_n \defeq \mathbb{1}\oplus \overline{\mathbb{n}} \oplus \mathbb{1}$:
\[ \mathbf{M}_1: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \mathbf{M}_2: \begin{tikzcd}
&\circ \ar[ld, dash] \ar[rd, dash] & \\ \circ \ar[rd, dash] && \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd} \qquad \mathbf{M}_3: \begin{tikzcd}
&\circ \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ \circ \ar[rd, dash]& \circ \ar[d, dash] & \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd} \qquad \hdots \]
\end{example}

\begin{lemma}
For ordered sets taking the disjoint union or linear sum is associative.
\end{lemma}

\begin{lemma}
Let $m,n\in \N$. If $p = m+n$, then $\mathbb{m}\oplus\mathbb{n} = \mathbb{p}$.
\end{lemma}


\chapter{Posets}
TODO: notation: use $\inf, \sup$ for sets and $\bigwedge, \bigvee$ for the singleton unpacking of $\inf,\sup$.

\section{Order-preserving functions}

\begin{proposition} \label{mappingJoinsMeets}
Let $P,Q$ be posets, $f:P\to Q$ an order-preserving function and $A\subseteq P$. Then
\begin{enumerate}
\item if $\bigwedge_P A$ exists, then $f\Big(\bigwedge_P A\Big)$ is a lower bound of $f^\imf(A)$;
\item if $\bigwedge_P A$ and $\bigwedge_Q f^\imf(A)$ exist, then $f\Big(\bigwedge_P A\Big)\leq \bigwedge_Q f^\imf(A)$;
\item if $\bigwedge_P A$ exists, then $f\Big(\bigwedge_P A\Big)$ is a lower bound of $f^\imf(A)$;
\item if $\bigvee_P A$ and $\bigvee_Q f^\imf(A)$ exist, then $\bigvee_Q f^\imf(A) \leq f\Big(\bigvee_P A\Big)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Straightforward application of \ref{imagePolars}. We can also prove the statement from scratch: take arbitrary $y\in f^\imf(A)$. Then $y = f(x)$ for some $x\in A$. We have $\bigwedge_P A \leq x$, so $f\Big(\bigwedge_P A\Big) \leq f(x) = y$.

(2) Immediate from (1).

(3,4) Dual to (1) and (2).
\end{proof}

\begin{lemma} \label{orderSimilarityPreservesJoinsMeets}
Let $P,Q$ be posets and $f:P\to Q$ an order similarity. Then $f$ preserves all meets and joins, i.e.\ $\forall A\subseteq P$:
\begin{enumerate}
\item if $\bigwedge A$ exists, then $\bigwedge f^\imf(A)$ exists and $f(\bigwedge A) = \bigwedge f^\imf(A)$;
\item if $\bigvee A$ exists, then $\bigvee f^\imf(A)$ exists and $f(\bigvee A) = \bigvee f^\imf(A)$.
\end{enumerate}
\end{lemma}
\begin{proof}
Follows from \ref{relationIsomorphismSamePolars}.
\end{proof}

\section{$\mathrm{Z}$-systems}
\begin{definition}
Let $Z: \setbuilder{P}{\text{$P$ is a poset}} \to \setbuilder{X}{\Set(X)}$ be a class function. Then we call $Z$ a \udef{$\mathrm{Z}$-system} if
\begin{itemize}
\item $Z(P) \subseteq \powerset(P)$ for all posets $P$;
\item there exists a poset $P'$ such that $Z(P')$ contains a non-empty set;
\item $f^{\imf\imf}\big(Z(P)\big) \subseteq Z(Q)$ for all isotone functions $f: P\to Q$ between posets.
\end{itemize}
We call the elements of $Z(P)$ \udef{$Z$-subsets} of $P$. We say $Z$ is \udef{strict} if there exists a poset $P$ such that $\emptyset \in Z(P)$.
\end{definition}

\begin{lemma} \label{subsetZsets}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $Q\subseteq P$. Then $Z(Q) \subseteq Z(P)$.
\end{lemma}
\begin{proof}
The inclusion $\incl_Q$ is isotone.
\end{proof}

\begin{lemma} \label{singletonsAreZSets}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $p\in P$. Then $\{p\} \in Z(P)$.
\end{lemma}
\begin{proof}
Let $P'$ be a poset such that $Z(P')$ contains a non-empty set $X$. Now consider the constant function $\constant{p}: P'\to P: x\mapsto p$, which is isotone. Thus $\{p\} = f^\imf(X) \in Z(P)$.
\end{proof}

\begin{lemma} \label{strictZSystemEveryEmptySetZSet}
Let $Z$ be a $\mathrm{Z}$-system. Then $Z$ is strict \textup{if and only if} $\emptyset \in Z(P)$ for every non-empty poset $P$.
\end{lemma}
\begin{proof}
It is clear that if $\emptyset \in Z(P)$ for every non-empty poset $P$, then $Z$ is strict.

Now assume $Z$ is strict and let $P'$ be a poset such that $\emptyset\in Z(P')$. Let $P$ be an arbitrary non-empty poset. Then we can find $x\in P$. The constant function $\constant{x}: P'\to P$ is isotone, so $\emptyset = f^\imf(\emptyset) \in f^{\imf\imf}\big(Z(P')\big) \subseteq Z(P)$.
\end{proof}

\begin{lemma}
Let $Z: \setbuilder{P}{\text{$P$ is a poset}} \to \setbuilder{X}{\Set(X)}$ be a class function. Then $Z$ is a $\mathrm{Z}$-system \textup{if and only if}
\begin{itemize}
\item $Z(P) \subseteq \powerset(P)$ for all posets $P$;
\item there exists a poset $P'$ such that $Z(P')$ contains a non-empty set;
\item $f^{\imf\imf}\big(Z(P)\big) \subseteq Z\big(\im(f)\big)$ for all isotone functions $f: P\to Q$ between posets.
\end{itemize}
\end{lemma}
We can also write the third condition, somewhat imprecisely, as $f^{\imf\imf}\circ Z \subseteq Z\circ f^\imf$.
\begin{proof}
Since, for any isotone function $f: P\to Q$ the restriction $f|^{\im(f)}$ is also isotone, the third condition follows straight from the definition.

Conversely, take an arbitrary isotone function $f: P\to Q$ and assume the third condition holds. Then
\[ f^{\imf\imf}\big(Z\big) \subseteq Z\big(\im(f)\big) \subseteq Z(Q) \]
by \ref{subsetZsets}.
\end{proof}

\begin{lemma} \label{isomorphismsPreserveZstructure}
Let $Z$ be a $\mathrm{Z}$-system and $f: P\to Q$ an isomorphism between posets. Then $A\in Z(P) \iff f^\imf(A) \in Z(Q)$.
\end{lemma}
\begin{proof}
The direction $\Rightarrow$ is immediate by definition of Z-system.

For the converse, assume $f^\imf(A)\in Z(Q)$. Then $A = (f^{-1})^{\imf}\big(f^\imf(A)\big) \in Z(P)$.
\end{proof}

\begin{example}
The following are $\mathrm{Z}$-systems:
\begin{itemize}
\item $\powerset$;
\item non-empty subsets;
\item subsets with cardinality strictly less than $\kappa$ (e.g.\ finite subsets);
\item subsets with cardinality at most $\kappa$ (e.g.\ countable subsets, we also call this system the \udef{$\sigma$-system});
\item chains;
\item subsets that have an upper bound (we call this system the \udef{Dedekind system});
\item subsets that have a maximum;
\item subsets that have a maximal element.
\end{itemize}
\end{example}

\subsection{Constructions}
\begin{lemma} \label{unionIntersectionZsystems}
Let $Z_1$ and $Z_2$ be two $\mathrm{Z}$-systems. Then
\begin{enumerate}
\item $P\mapsto Z_1(P) \cup Z_2(P)$ is a $\mathrm{Z}$-system;
\item $P\mapsto Z_1(P) \cap Z_2(P)$ is a $\mathrm{Z}$-system.
\end{enumerate}
\end{lemma}
\begin{proof}
Take an arbitrary poset $P$. Since $Z_1(P) \subseteq \powerset(P)$ and $Z_2(P) \subseteq \powerset(P)$, we have $Z_1(P)\cup Z_2(P) \subseteq \powerset(P)$ and $Z_1(P)\cap Z_2(P) \subseteq \powerset(P)$.

Let $x$ be an element. Then $\{x\}$ with the identity relation is a poset. By \ref{singletonsAreZSets}, we have $\{x\} \in Z_1\big(\{x\}\big)$ and $\{x\} \in Z_2\big(\{x\}\big)$, so $\{x\} \in Z_1\big(\{x\}\big) \cup Z_2\big(\{x\}\big)$ and $\{x\} \in Z_1\big(\{x\}\big) \cap Z_2\big(\{x\}\big)$. In particular both $Z_1\big(\{x\}\big) \cup Z_2\big(\{x\}\big)$ and $Z_1\big(\{x\}\big) \cap Z_2\big(\{x\}\big)$ contain a non-empty set.

Now take an arbitrary isotone function $f:P\to Q$ between posets. Then $f^{\imf\imf}\big(Z_1(P)\big) \subseteq Z_1(Q)$ and $f^{\imf\imf}\big(Z_2(P)\big) \subseteq Z_2(Q)$, so $f^{\imf\imf}\big(Z_1(P)\big) \cup f^{\imf\imf}\big(Z_2(P)\big) \subseteq Z_1(Q)\cup Z_2(Q)$ and $f^{\imf\imf}\big(Z_1(P)\big) \cap f^{\imf\imf}\big(Z_2(P)\big) \subseteq Z_1(Q)\cap Z_2(Q)$.
\end{proof}

\subsubsection{Reflecting $\mathrm{Z}$-systems}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system. Then $Z$ is called \udef{reflecting} if $f^{\imf\imf}\big(Z(P)\big) = Z\big(\im(f)\big)$ for all isotone functions $f: P\to Q$ between posets.
\end{definition}

\begin{example}
The following $\mathrm{Z}$-systems are reflecting:
\begin{itemize}
\item non-empty subsets;
\item subsets with cardinality strictly less than $\kappa$ (e.g.\ finite subsets);
\item subsets with cardinality at most $\kappa$ (e.g.\ countable subsets, we also call this system the \udef{$\sigma$-system}).
\end{itemize}
For the last two examples, we need some version of choice if $\kappa$ is infinite.
\end{example}

\begin{lemma} \label{ZsystemWhereAllZSetsAreZSets}
Let $Z_1$ be a reflecting $\mathrm{Z}$-system and $Z_2$ a $\mathrm{Z}$-system. Assume either $Z_2$ is strict or $Z_1$ is not strict. Then the following are $\mathrm{Z}$-systems:
\begin{enumerate}
\item $P\mapsto \setbuilder{X \subseteq P}{Z_1(X)\subseteq Z_2(X)}$;
\item $P\mapsto \setbuilder{X \subseteq P}{Z_1(X)\subseteq Z_2(P)}$. If $Z_2$ is strict, then this system is also strict.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Let the function $P\mapsto \setbuilder{X \subseteq P}{Z_1(X)\subseteq Z_2(X)}$ be denoted $Z_3$. By construction $Z_3(P) \subseteq \powerset(P)$.

Let $x$ be an element. Then $\{x\}$ with the identity relation is a poset. By \ref{singletonsAreZSets}, we have $\{x\} \in Z_1\big(\{x\}\big)$ and $\{x\} \in Z_2\big(\{x\}\big)$.

First assume $Z_2$ is strict. Then $\big\{\emptyset, \{x\}\big\} \subseteq Z_2\big(\{x\}\big) \subseteq \powerset\big(\{x\}\big) = \big\{\emptyset, \{x\}\big\}$ by \ref{strictZSystemEveryEmptySetZSet}, so $Z_2\big(\{x\}\big) = \powerset\big(\{x\}\big)$. Now take arbitrary $X\subseteq \{x\}$. We have $Z_1\big(\{x\}\big) \subseteq \powerset\big(\{x\}\big) = Z_2\big(\{x\}\big)$, so $\{x\} \in Z_3\big(\{x\}\big)$ and there exists a poset $P'$ such that $Z(P')$ contains a non-empty set.

Now assume $Z_1$ is not strict. Then $\emptyset \notin Z_1\big(\{x\}\big)$, so $Z_1\big(\{x\}\big) = \big\{\{x\}\big\}$. Since $\{x\} \in Z_2\big(\{x\}\big)$, we have $Z_1\big(\{x\}\big) \subseteq Z_2\big(\{x\})$ and thus $\{x\} \in Z_3\big(\{x\}\big)$, which means there exists a poset $P'$ such that $Z(P')$ contains a non-empty set.

Let $f: P\to Q$ be an arbitrary isotone function between posets and take $X\in Z_3(P)$. Then we need to show that $f^\imf(X) \in Z_3(Q)$. Indeed, since $Z_1$ is reflecting and $Z_1(X) \subseteq Z_2(X)$, we have
\[ Z_1\big(f^\imf(X)\big) = f^{\imf\imf}\big(Z_1(X)\big) \subseteq f^{\imf\imf}\big(Z_2(X)\big) \subseteq Z_2\big(f^\imf(X)\big). \]

(2) Let the function $P\mapsto \setbuilder{X \subseteq P}{Z_1(X)\subseteq Z_2(P)}$ be denoted $Z_4$. By construction $Z_4(P) \subseteq \powerset(P)$.

Let $x$ be an element. Then $\{x\}$ with the identity relation is a poset. By \ref{singletonsAreZSets}, we have $\{x\} \in Z_1\big(\{x\}\big)$ and $\{x\} \in Z_2\big(\{x\}\big)$.

First assume $Z_2$ is strict. Then $\big\{\emptyset, \{x\}\big\} \subseteq Z_2\big(\{x\}\big) \subseteq \powerset\big(\{x\}\big) = \big\{\emptyset, \{x\}\big\}$ by \ref{strictZSystemEveryEmptySetZSet}, so $Z_2\big(\{x\}\big) = \powerset\big(\{x\}\big)$. Now take arbitrary $X\subseteq \{x\}$. We have $Z_1\big(\{x\}\big) \subseteq \powerset\big(\{x\}\big) = Z_2\big(\{x\}\big)$, so $\{x\} \in Z_3\big(\{x\}\big)$ and there exists a poset $P'$ such that $Z(P')$ contains a non-empty set.

Now assume $Z_1$ is not strict. Then $\emptyset \notin Z_1\big(\{x\}\big)$, so $Z_1\big(\{x\}\big) = \big\{\{x\}\big\}$. Since $\{x\} \in Z_2\big(\{x\}\big)$, we have $Z_1\big(\{x\}\big) \subseteq Z_2\big(\{x\})$ and thus $\{x\} \in Z_3\big(\{x\}\big)$, which means there exists a poset $P'$ such that $Z(P')$ contains a non-empty set.

Let $f: P\to Q$ be an arbitrary isotone function between posets and take $X\in Z_4(P)$. Then we need to show that $f^\imf(X) \in Z_4(Q)$. Indeed, since $Z_1$ is reflecting and $Z_1(X) \subseteq Z_2(P)$, we have
\[ Z_1\big(f^\imf(X)\big) = f^{\imf\imf}\big(Z_1(X)\big) \subseteq f^{\imf\imf}\big(Z_2(P)\big) \subseteq Z_2(Q). \]

Finally, assume $Z_2$ is strict. Then there exists a poset $P$ such that $\emptyset \in Z_2(P)$, i.e.\ $\big\{\emptyset\big\} \subseteq Z_2(P)$. Then $Z_1(\emptyset) \subseteq \powerset(\emptyset) = \big\{\emptyset\big\} \subseteq Z_2(P)$, so $\emptyset\in Z_3(P)$, which means $Z_3$ is strict.
\end{proof}

\begin{example}
The following $\mathrm{Z}$-systems can be constructed using \ref{ZsystemWhereAllZSetsAreZSets}:
\begin{itemize}
\item directed subsets;
\item well-ordered subsets (i.e.\ where each non-empty subsubset has a minimum);
\item subsets such that each pair in the subset has an upper bound in $P$ (the \udef{pairwise consistent system});
\item subsets such that each finite subsubset has an upper bound in $P$ (the \udef{consistent system}).
\end{itemize}
\end{example}

\subsubsection{Hereditary $\mathrm{Z}$-systems}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system. Then $Z$ is called \udef{hereditary} if $Z(Q) = Z(P)\cap \powerset(Q)$ for all posets $P \supseteq Q$.
\end{definition}

\begin{lemma}
Let $Z$ be a $\mathrm{Z}$-system. Then the following are equivalent:
\begin{enumerate}
\item $Z$ is hereditary;
\item $Z(Q) \supseteq Z(P)\cap \powerset(Q)$ for all posets $P \supseteq Q$;
\item $f^\imf(A) \in Z(P) \implies A \in Z(Q)$ for every order-embedding $f: Q\to P$ between posets and $A\subseteq Q$;
\item $A \in Z(Q) \iff f^\imf(A) \in Z(P)$ for every order-embedding $f: Q\to P$ between posets and $A\subseteq Q$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Immediate.

$(2) \Rightarrow (3)$ Take $A\subseteq Q$ such that $f^\imf(A) \in Z(P)$. We also have $f^\imf(A) \in \powerset\big(\im(f)\big)$, so
\[ f^\imf(A) \in Z(P) \cap \powerset\big(\im(f)\big) \subseteq Z\big(\im(f)\big). \]
Since the function $f|^{\im(f)}: Q \to \im(f)$ is an isomorphism, we have $A\in Z(Q)$ by \ref{isomorphismsPreserveZstructure}.

$(3) \Rightarrow (4)$ One direction is true by assumption. The other is immediate by the definition of $\mathrm{Z}$-system.

$(4) \Rightarrow (1)$ Let $P\supseteq Q$ be posets. The inclusion function $\incl_Q$ is an order-embedding. For all $A\in \powerset(Q)$, we have $A\in Z(Q)$ iff $\incl_Q^\imf(A) = A \in Z(P)$. Thus $Z(Q) = Z(Q) \cap \powerset(Q) = Z(P) \cap \powerset(Q)$.
\end{proof}

\begin{lemma}
Let $Z_1$ and $Z_2$ be hereditary $\mathrm{Z}$-systems. Then
\begin{enumerate}
\item $P\mapsto Z_1(P) \cup Z_2(P)$ is a hereditary $\mathrm{Z}$-system;
\item $P\mapsto Z_1(P) \cap Z_2(P)$ is a hereditary $\mathrm{Z}$-system.
\end{enumerate}
\end{lemma}
\begin{proof}
These class functions are $\mathrm{Z}$-systems by \ref{unionIntersectionZsystems}.

To show that they are hereditary, take posets $P \supseteq Q$. Then
\begin{align*}
Z_1(Q) \cup Z_2(Q) &= \big(Z_1(P) \cap \powerset(Q)\big)\cup \big( Z_2(P) \cap \powerset(Q)\big) \\
&= \big(Z_1(P) \cup Z_2(P)\big) \cap \big(\powerset(Q) \cup \powerset(Q)\big) \\
&= \big(Z_1(P) \cup Z_2(P)\big) \cap \powerset(Q). 
\end{align*}
Also
\begin{align*}
Z_1(Q) \cap Z_2(Q) &= \big(Z_1(P) \cap \powerset(Q)\big)\cap \big( Z_2(P) \cap \powerset(Q)\big) \\
&= \big(Z_1(P) \cap Z_2(P)\big) \cap \powerset(Q).
\end{align*}
\end{proof}

\begin{example}
The following $\mathrm{Z}$-systems are hereditary:
\begin{itemize}
\item $\powerset$;
\item non-empty subsets;
\item subsets with cardinality strictly less than $\kappa$ (e.g.\ finite subsets);
\item subsets with cardinality at most $\kappa$ (e.g.\ countable subsets, we also call this system the \udef{$\sigma$-system});
\item chains;
\item subsets that have a maximum;
\item subsets that have a maximal element;
\item directed sets.
\end{itemize}
The following $\mathrm{Z}$-systems are not hereditary:
\begin{itemize}
\item subsets that have an upper bound (i.e.\ the Dedekind system).
\end{itemize}
\end{example}

\subsection{Closedness and completeness}
\subsubsection{Closedness}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $A\subseteq P$. We call $A$
\begin{itemize}
\item \udef{$Z$-closed} in $P$ if $\bigvee_P B \in A$ for all $B\subseteq A$ such that
\begin{itemize}
\item $B\in Z(P)$; and
\item $\bigvee B$ exists in $P$.
\end{itemize}
\item \udef{${\downarrow}Z$-closed} in $P$ if $A$ is both $Z$-closed and downwards closed.
\end{itemize}
We denote the set of $Z$-closed subsets of $P$ by $\mathcal{C}_Z(P)$ and the set of ${\downarrow}Z$-closed subsets of $P$ by $\mathcal{C}_{\downarrow Z}(P)$.
\end{definition}

\begin{lemma}
Let $Z$ be a $\mathrm{Z}$-system and $P$ a poset. Then both $\mathcal{C}_Z(P)$ and $\mathcal{C}_{\downarrow Z}(P)$ are complete $\wedge$-subsemilattices of $\powerset(P)$.
\end{lemma}

\begin{definition}
We denote the Moore closures associated to $\mathcal{C}_Z(P)$ and $\mathcal{C}_{\downarrow Z}(P)$ by $\Closure_Z: \powerset(P)\to \mathcal{C}_Z(P)$ and $\Closure_{\downarrow Z}: \powerset(P)\to \mathcal{C}_{\downarrow Z}(P)$.
\end{definition}

\begin{lemma} \label{ZclosureContainsJoin}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $A\in Z(P)$. If $\bigvee A$ exists, then $\bigvee A \in \Closure_{Z}(A)$.
\end{lemma}
\begin{proof}
Immediate, since $A \subseteq \Closure_{Z}(A)$ and $\Closure_{Z}(A)$ is $Z$-closed.
\end{proof}

\begin{lemma} \label{principalDownsetsZclosed}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $x\in P$. Then
\begin{enumerate}
\item $\downset\{x\}$ is $Z$-closed;
\item $\downset\{x\}$ is ${\downarrow}Z$-closed.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take arbitrary $B\subseteq \downset\{x\}$ such that $B\in Z(P)$ and $\bigvee B$ exists. Since $x$ is an upper bound of $B$, we have $\bigvee B\leq x$ and so $\bigvee B \in \downset\{x\}$.

(2) Immediate, since $\downset\{x\}$ is downwards closed.
\end{proof}
\begin{corollary} \label{closureZsetWithJoin}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $A\in Z(P)$. If $\bigvee A$ exists, then $\Closure_{\downarrow Z}(A) = \downset\{\bigvee A\}$.
\end{corollary}
\begin{proof}
By \ref{ZclosureContainsJoin} and the definition of ${\downarrow}Z$-closedness, we have that $\bigvee A\in \Closure_{\downarrow Z}(A)$ and that $\Closure_{\downarrow Z}(A)$ be downwards closed. Thus $\downset\{\bigvee A\} \subseteq \Closure_{\downarrow Z}(A)$.

For the other inclusion, it is enough to note that $\downset\{\bigvee A\}$ is ${\downarrow}Z$-closed.
\end{proof}

\begin{example}
The result of \ref{principalDownsetsZclosed} can be rephrased as saying that the downwards closure of principal $Z$-closed sets is $Z$-closed.

This is not true for more general $Z$-closed sets. Consider the following poset:
\[ \begin{tikzcd}
A \ar[d, dash] & b \ar[dl, dash] \ar[dr, dash] & C \ar[d, dash] \\
d & {} & e
\end{tikzcd} \]
Let $Z$ be any $Z$-system such that $\{d,e\}$ is a $Z$-set (e.g.\ $Z = \powerset$).
Let $X$ be the subset $\{A,C\}$. It is clearly $Z$-closed, since each subset that has a join (i.e.\ $\{A\}$ and $\{C\}$) has a join in $X$.

Consider the $Z$-set $\{d,e\} \subseteq \downset X$. It has a join, $b$, which is not an element of $\downset X = \{A,C,d,e\}$.

This also means that $\Closure_{\downarrow Z} \neq (\downarrow) \circ \Closure_Z$.
\end{example}

\subsubsection{Preservation of $Z$-joins}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P,Q$ a poset and $f: P\to Q$ a function. We say $f$ \udef{preserves $Z$-joins} or is \udef{$Z$-continuous} if $\bigvee f^\imf(A)$ exists and $f\Big(\bigvee A\Big) = \bigvee f^\imf (A)$ for all $A\in Z(P)$ such that $\bigvee A$ exists.
\end{definition}
TODO can $Z$-continuity be associated to a convergence?? Definitely not to a topological convergence in general!

\begin{lemma} \label{ZcontinuousImpliesIsotone}
Let $Z$ be a $\mathrm{Z}$-system, $P,Q$ a poset and $f: P\to Q$ a $Z$-continuous function. If $\{a,b\}\in Z(P)$ for all $a\leq b$, then $f$ is isotone.
\end{lemma}
\begin{proof}
Take $a\leq b\in P$. Then $b = \bigvee \{a,b\}$, so $\bigvee\big\{f(a), f(b)\big\}$ exists and it is equal to $f(b)$. This means that $f(a) \leq f(b)$.
\end{proof}
\begin{corollary}
Directed-continuous functions are isotone.
\end{corollary}

\begin{example}
A $Z$-continuous function is not necessarily isotone. For instance, let $Z$ be the $\mathrm{Z}$-system consisting of singletons. Then every function is $Z$-continuous.
\end{example}

\begin{lemma}
Let $Z$ be the $\mathrm{Z}$-system of the sets that contain a maximum. Let $P, Q$ be posets and $f: P\to Q$ a function. Then the following are equivalent:
\begin{enumerate}
\item $f$ is isotone;
\item $f$ is $Z$-continuous.
\end{enumerate}
$(1) \Rightarrow (2)$ Take $A\in Z(P)$ with maximum $a\in A$, so $\downset A = \downset \{a\}$. Then, by \ref{isotoneIffDownsetContinuous}
\[ \{f(a)\} \subseteq f^\imf(A) \subseteq f^\imf(\downset A) = f^\imf\big(\downset \{a\}\big) \subseteq \downset \{f(a)\}. \]
Taking downwards closure gives $\downset\{f(a)\} = \downset f^\imf(A)$. Thus, by \ref{extremaAfterOrderClosure}, we have
\[ f\Big(\bigvee A\Big) = f(a) = \bigvee \downset\{f(a)\} = \bigvee \downset f^\imf(A) = \bigvee f^\imf(A). \]

$(2) \Rightarrow (1)$ Immediate, by \ref{ZcontinuousImpliesIsotone}.
\end{lemma}

If we remove the requirement that a $Z$-closed set needs to be downwards closed, the following holds, even for non-isotone $f$:
\begin{proposition} \label{ZcontinuityZclosureContinuity}
Let $Z$ be a $\mathrm{Z}$-system, $P,Q$ a poset and $f: P\to Q$ a function. The following are equivalent:
\begin{enumerate}
\item $f$ is $Z$-continuous;
\item $f$ is $\Closure_{Z}$-continuous.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Let $B\subseteq Q$ be an arbitrary $Z$-closed. Let $A\subseteq f^\preimf(B)$ be such that $A\in Z(P)$ and $\bigvee A$ exists in $P$. Then, by assumption, $\bigvee f^\imf(A)$ exists and is equal to $f\big(\bigvee A\big)$.

Since $A\subseteq f^\preimf(B)$, we have $f(A) \subseteq B$. Since $\bigvee f^\imf(A)$ exists, $f^\imf(A)\subseteq B$, $f^\imf(A) \in Z(Q)$ and $B$ is $Z$-closed, we have that $\bigvee f^\imf(A) = f\big(\bigvee A\big) \in B$. Thus $\bigvee A \in f^\preimf(B)$. This implies that $f^\preimf(B)$ is $Z$-closed.

$(2) \Rightarrow (1)$ Take $A\in Z(P)$ such that $\bigvee A$ exists. We have that $f(\bigvee A)$ is an upper bound of $f^\imf(A)$. To show that it is the least upper bound, let $b\in Q$ be some other upper bound of $f^\imf(A)$, so $f^\imf(A) \subseteq \downset\{b\}$.
We have $\bigvee A \in \Closure_Z(A)$ by \ref{ZclosureContainsJoin}, so we calculate, using \ref{closureContinuousEquivalents},
\[ f\Big(\bigvee A\Big) \in f^\imf\big(\Closure_Z(A)\big) = (f^\imf\circ \Closure_Z)(A) \subseteq (\Closure_Z\circ f^\imf)(A)\subseteq \Closure_Z\big(\downset\{b\}\big) = \downset\{b\}, \]
since $\downset\{b\}$ is $Z$-closed by \ref{principalDownsetsZclosed}. This implies that $f\big(\bigvee A\big) \leq b$.
\end{proof}


\begin{proposition} \label{isotoneZcontinuousFunction}
Let $Z$ be a $\mathrm{Z}$-system, $P,Q$ a poset and $f: P\to Q$ a function. The following are equivalent:
\begin{enumerate}
\item $f$ is $Z$-continuous and isotone;
\item $f$ is $\Closure_{\downarrow Z}$-continuous.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Let $B\subseteq Q$ be a subset that is both $Z$-closed and downwards closed. By $Z$-continuity, through \ref{ZcontinuityZclosureContinuity}, and isotonicity, through \ref{isotoneIffDownsetContinuous}, we have that $f^\preimf(B)$ is both $Z$-closed and downwards closed, i.e.\ a ${\downarrow Z}$-set.

$(2) \Rightarrow (1)$ Since principal downsets are ${\downarrow}Z$-closed, by \ref{principalDownsetsZclosed}, the preimage of a principal downset is ${\downarrow}Z$-closed and, in particular, downwards closed. This implies that $f$ is isotone by \ref{isotoneIffDownsetContinuous}.

Now take $A\in Z(P)$ such that $\bigvee A$ exists. We have that $f(\bigvee A)$ is an upper bound of $f^\imf(A)$. To show that it is the least upper bound, let $b\in Q$ be some other upper bound of $f^\imf(A)$, so $f^\imf(A) \subseteq \downset\{b\}$.
We have $\bigvee A \in \Closure_Z(A) \subseteq \Closure_{\downarrow Z}(A)$ by \ref{ZclosureContainsJoin}, so we calculate, using \ref{closureContinuousEquivalents},
\[ f\Big(\bigvee A\Big) \in f^\imf\big(\Closure_{\downarrow Z}(A)\big) = (f^\imf\circ \Closure_{\downarrow Z})(A) \subseteq (\Closure_{\downarrow Z}\circ f^\imf)(A)\subseteq \Closure_{\downarrow Z}\big(\downset\{b\}\big) = \downset\{b\}, \]
since $\downset\{b\}$ is ${\downarrow} Z$-closed by \ref{principalDownsetsZclosed}. This implies that $f\big(\bigvee A\big) \leq b$.
\end{proof}

\subsubsection{Completeness}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system and $P$ a poset. We call $P$ \udef{$Z$-complete} if every subset in $Z(P)$ has a least upper bound.
\end{definition}

Let $Z$ be the $\mathrm{Z}$-system of sets with one or zero elements. Then a poset is $Z$-complete iff it has a least element.


\subsubsection{$Z$-stable subsets}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $Q\subseteq P$. Then $Q$ is called \udef{$Z$-stable} in $P$ if $\Closure_{\downarrow Z, Q}(A) = \Closure_{\downarrow Z}(A) \cap Q$ for all $A\subseteq Q$.
\end{definition}

\begin{lemma} \label{ZstableLemma}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $Q\subseteq P$. Then the following are equivalent:
\begin{enumerate}
\item $Q$ is $Z$-stable;
\item $\Closure_{\downarrow Z, Q}(A) \supseteq \Closure_{\downarrow Z}(A) \cap Q$ for all $A\subseteq Q$ and $\incl_Q$ is $Z$-continuous;
\item $\Closure_{\downarrow Z, Q}(A) \supseteq \Closure_{\downarrow Z}\big(\Closure_{\downarrow Z, Q}(A)\big) \cap Q$ for all $A\subseteq Q$ and $\incl_Q$ is $Z$-continuous.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ The first part is immediate. For the $Z$-continuity of $\incl_Q$, we take arbitrary $B\subseteq P$ and calculate
\[ \Closure_{\downarrow Z, Q}\big(\incl_Q^\preimf(B)\big) = \Closure_{\downarrow Z, Q}(B\cap Q) = \Closure_{\downarrow Z}(B\cap Q) \cap Q \subseteq \Closure_{\downarrow Z}(B) \cap Q = \incl_Q^\preimf\big(\Closure_{\downarrow Z}(B)\big). \]
This implies that $\incl_Q$ is $\Closure_{\downarrow Z}$-continuous by \ref{closureContinuousEquivalents} and thus $Z$-continuous by \ref{isotoneZcontinuousFunction}.

$(2) \Rightarrow (1)$ The $Z$-continuity of $\incl_Q$ implies $\Closure_{\downarrow Z}$-continuity by \ref{isotoneZcontinuousFunction} and thus, by \ref{closureContinuousEquivalents},
\[ \Closure_{\downarrow Z, Q}(A) = \Closure_{\downarrow Z, Q}(A\cap Q) = \Closure_{\downarrow Z, Q}\big(\incl_Q^\preimf(A)\big) \subseteq \incl_Q^\preimf\big(\Closure_{\downarrow Z}(A)\big) = \Closure_{\downarrow Z}(A) \cap Q. \]

$(2) \Leftrightarrow (3)$ Since $\incl_Q$ is $Z$-continuous, we have
\[ \Closure_{\downarrow Z}\big(\Closure_{\downarrow Z, Q}(A)\big) = (\Closure_{\downarrow Z}\circ \incl_Q^\imf \circ \Closure_{\downarrow Z, Q})(A) = (\Closure_{\downarrow Z}\circ \incl_Q^\imf)(A) = \Closure_{\downarrow Z}(A), \]
by \ref{closureContinuousEquivalents}.
\end{proof}

\begin{example}
The $Z$-continuity of $\incl_Q$ can easily fail. Let, for example, $Z$ be the $\mathrm{Z}$-system of $\sigma$-chains. Let $P$ be the following lattice
\[ \begin{tikzcd}
1 \ar[d, dash] \\
2 \ar[d, dash, dashed] \\
\bullet
\end{tikzcd} \]
Here the dashed line means a copy of $\N$. Let $Q$ be the dashed line together with $1$. Then the join of the dashed line in $Q$ is $1$. In $P$, however, the join is $2$.
\end{example}


\subsection{Results for specific $\mathrm{Z}$-systems}
\subsubsection{$\sigma$-chains}

TODO: results about subsequences above here!

\begin{lemma} \label{monotoneSequenceLemma}
Let $P$ be a poset and $A\subseteq P$ be a $\sigma$-chain in $P$ such that $\bigvee A$ exists. Then
\begin{enumerate}
\item there exists a monotonically increasing sequence $\seq{x_n}_{n\in \N}$ in $A$ such that $\bigvee_{n\in \N} x_n = \bigvee A$.
\item if $A$ has no maximum, then $\seq{x_n}$ can be taken to be strictly increasing.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Since $A$ is countable, there exists an enumeration $\seq{y_n}_{n\in \N}$ of $A$. Now define
\[ x_n \defeq \max_{k\leq n} y_k, \]
where the maximum exists, since it is taken over a finite set of elements that are all comparable.
This is clearly a monotonically increasing sequence. We have
\[ \bigvee_{n\in \N} x_n = \bigvee \downset \setbuilder{x_n}{n\in \N} = \bigvee \downset \setbuilder{y_n}{n\in \N} = \bigvee \downset A = \bigvee A. \]

(2) Take the sequence $\seq{x_n}$ from (1). We first observe that $\seq{x_n}$ has not got a tail that is a singleton. If it did, then the element of this singleton would be a maximum of $A$. This is not the case by assumption. By \ref{RlinkedSequenceHasStrictSubsequence}, we can find a strictly increasing subsequence $\seq{y_n}$ with the same image, so
\[ \bigvee_{n\in \N}y_n = \bigvee \im(y) = \bigvee \im(x) = \bigvee A. \]
Replace $\seq{x_n}$ by $\seq{y_n}$.
\end{proof}

\begin{proposition} \label{sigmaClosureOfSubjoinSemilattice}
Let $Z$ be the $\mathrm{Z}$-system of $\sigma$-chains. Let $L$ be a lattice and $Q\subseteq L$ a subset that is closed under finite joins. Then
\begin{enumerate}
\item $\setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ is the $\sigma$-closure of $Q$;
\item if $L$ is a $\sigma$-complete lattice, then $\downset \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ is the $\downarrow \sigma$-closure of $Q$;
\item if $L$ is countably join-distributive, then $\setbuilder{x\in L}{\exists A\in Z(\downset Q): x = \bigvee A}$ is the $\downarrow \sigma$-closure of $Q$.
\end{enumerate}
\end{proposition}
In particular, $\setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ is $\sigma$-chain-closure of $Q$.
\begin{proof}
(1) Since $\setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ is obviously contained in the $\sigma$-closure of $Q$, it is enough to show that it is $\sigma$-closed.

Let $B\subseteq \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ be a countable set such that $\bigvee B$ exists. We need to show that $\bigvee \in \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$. Since $B$ is countable, we can find an enumeration $\seq{b_n}$ of $B$. For each $b_n$ we can find an increasing sequence $\seq{x_{n,k}}_{k\in \N}$ in $Q$ such that $\bigvee_{k\in\N}x_{n,k} = b_n$, by \ref{monotoneSequenceLemma}.

Now define
\[ y_n \defeq \bigvee_{n'= 0}^n x_{n',n}, \]
which is a sequence in $Q$, since all the joins are finite. It is also increasing since
\[ y_n = \bigvee_{n'= 0}^n x_{n',n} \geq \bigvee_{n'= 0}^{n-1} x_{n',n} \geq \bigvee_{n'= 0}^{n-1} x_{n',n-1} = y_{n-1}. \]
Finally, we want to show that $\bigvee_{n\in \N} y_n$ exists and is equal to $\bigvee B$. We have that $\bigvee B$ is an upper bound of $\seq{y_n}$, since
\[ y_n = \bigvee_{n'= 0}^n x_{n',n} \leq \bigvee_{n'= 0}^n b_{n'} \leq \bigvee_{n'= 0}^{\infty} b_{n'} = \bigvee B. \]
Now suppose $u$ is some other upper bound of $\seq{y_n}$. Then
\[ x_{n,k} \leq x_{n, \max(n,k)} \leq \bigvee_{n'=0}^{\max(n,k)}x_{n, \max(n,k)} = y_{\max(n,k)} \leq u. \]
This implies that, for all $n\in \N$, $u$ is an upper bound of $\seq{x_{n,k}}_{k\in \N}$ and so $b_n = \bigvee_{k\in \N}x_{n,k} \leq u$. Thus $u$ is an upper bound of $\seq{b_n}$, which means that $\bigvee B = \bigvee_{n\in\N} b_n \leq u$. So $\bigvee B$ is the least upper bound of $\seq{y_n}$.

(2) We just need to show that $\downset \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ is $\sigma$-closed. To that end, take some countable $B\subseteq \downset \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$. Let $\seq{b_n}$ be an enumeration of $B$. We can then find a sequence $\seq{c_n}$ in $\setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$ such that $b_n \leq c_n$ for all $n\in \N$. We have that $\bigvee_{n\in \N}c_n$ exists since $L$ is $\sigma$-complete. Then $\bigvee B = \bigvee_{n\in \N}b_n \leq \bigvee_{n\in \N}c_n \in \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$, since it is $\sigma$-closed by (1). This implies $\bigvee B \in \downset \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A}$.

(3) Since $\setbuilder{x\in L}{\exists A\in Z(\downset Q): x = \bigvee A}$ is $\sigma$-closed by (1) (since $\downset Q$ is also a sublattice of $L$), we just need to show that it is downwards closed.

Take arbitrary $y\in \downset \setbuilder{x\in L}{\exists A\in Z(\downset Q): x = \bigvee A}$. Then there exists $A\in Z(\downset Q)$ such that $y \leq \bigvee A$. By \ref{monotoneSequenceLemma} there exists an increasing sequence $\seq{a_n}$ such that $\bigvee_{n\in \N} a_n = \bigvee A$. Then $\seq{a_n \wedge y}$ is an increasing sequence in $\downset Q$ and
\[ \bigvee_{n\in \N}a_n \wedge y = y \wedge \bigvee_{n\in \N}a_n = y \wedge \bigvee A = y \wedge x = y. \]
Thus $y\in \setbuilder{x\in L}{\exists A\in Z(\downset Q): x = \bigvee A}$.
\end{proof}

\begin{example}
We give some examples to support the necessity of the conditions in \ref{sigmaClosureOfSubjoinSemilattice}. are necessary.

\begin{itemize}
\item Consider the lattice $L$ with Hasse diagram
\[ \begin{tikzcd}
\infty \ar[dd, dashed, dash] & {} \ar[d, dashed, dash] \\
{} & \bullet \ar[dl, dash] \ar[d, dash] \\
\bullet \ar[d, dash] & \bullet \ar[dl, dash] \ar[d, dash] \\
\bullet \ar[d, dash] & \bullet \ar[dl, dash] \ar[d, dash] \\
\bullet & \bullet
\end{tikzcd} \]
where both columns are countable. Let $Q$ be the right column. Then $\setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A} = Q$ and $\downset \setbuilder{x\in L}{\exists A\in Z(Q): x = \bigvee A} = \downset Q$, which does not include $\infty$, so it is not $\sigma$-chain-closed. 

\item Consider the lattice $L$ with Hasse diagram
\[ \begin{tikzcd}
\infty \ar[dd, dashed, dash] \ar[dr, dash] & {} \\
{} & \bullet \ar[dl, dash] \\
0 & {}
\end{tikzcd} \]
where the dashed part is $\N \setminus\{0\}$, call it $Q$. In this case $\setbuilder{x\in L}{\exists A\in Z(\downset Q): x = \bigvee A}$ is everything except $\bullet$. It is not downwards closed.
\end{itemize}
\end{example}

\subsubsection{Finite sets or $\sigma$-chains}

\begin{proposition}
Let $Z_0$ be the $\mathrm{Z}$-system of sets that are either finite or $\sigma$-chains. Let $Z$ be a $\mathrm{Z}$-system such that $Z_0 \subseteq Z \subseteq \sigma$. Let $L$ be a countably join-distributive lattice and $Q$ a subset that is closed under finite joins. If $\incl_Q: Q\to L$ is a $Z$-continuous, then $Q$ is $Z$-stable in $L$.
\end{proposition}
\begin{proof}
By \ref{ZstableLemma}, it is enough to show that $\Closure_{\downarrow Z, Q}(A) \supseteq \Closure_{\downarrow Z}\big(\Closure_{\downarrow Z, Q}(A)\big) \cap Q$ for all $A\subseteq Q$ and $\incl_Q$ is $Z$-continuous.

By \ref{sigmaClosureOfSubjoinSemilattice} and the fact that $\Closure_{\downarrow Z, Q}(A)$ is closed under finite joins, we have $\Closure_{\downarrow Z}\big(\Closure_{\downarrow Z, Q}(A)\big) = \setbuilder{x\in L}{\exists B\in Z'\big(\Closure_{\downarrow Z, Q}(A)\big): x = \bigvee B}$, where $Z'$ is the $\mathrm{Z}$-system of $\sigma$-chains.

Take arbitrary $x\in \Closure_{\downarrow Z}\big(\Closure_{\downarrow Z, Q}(A)\big) \cap Q$. Then there exists $B\in Z'\big(\Closure_{\downarrow Z, Q}(A)\big)$ such that $x = \bigvee_L B$. Since $x\in Q$ and $B\subseteq Q$, we have $x = \bigvee_{Q} B$. Since $B\in Z'\big(\Closure_{\downarrow Z, Q}(A)\big) \subseteq Z\big(\Closure_{\downarrow Z, Q}(A)\big)$, we have $x\in \Closure_{\downarrow Z, Q}(A)$.
\end{proof}

\subsection{Completion}
\subsubsection{$Z$-continuous completion}
\begin{definition}
Let $P$ be a poset and $Z$ a $\mathrm{Z}$-system. A \udef{$Z$-continuous completion} of $P$ is a $Z$-continuous embedding $f: P \to L$, where $L$ is a complete lattice.

We call the completion \udef{join-dense} if $\im(f)$ is join-dense in $L$.
\end{definition}

\begin{lemma} \label{closureGivesJoinDenseCompletion}
Let $f: P \to L$ be a $Z$-continuous completion. Then $f: P\to \Closure_{\powerset}(\im(f))$ is a join-dense completion.
\end{lemma}
\begin{proof}
It is clear that $f: P\to \Closure_{\powerset}(\im(f))$ is a completion. Consider the set $C \defeq \setbuilder{\bigvee A}{A\subseteq \im(f)}$. This set is $\powerset$-closed, by \ref{joinMeetUnion}, and join-dense, so $\Closure_{\powerset}(\im(f)) \subseteq C$ and $\Closure_{\powerset}(\im(f))$ is join-dense.
\end{proof}

\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system and $P$ a poset. A complete $\wedge$-subsemilattice $M\subseteq \powerset(P)$ is called a \udef{$Z$-continuous intersection system} on $P$ if
\begin{itemize}
\item $A$ is downwards closed for all $A\in M$;
\item $\Closure_{M}(D) = \downset\big\{\bigvee D\big\}$ for all $D\in Z(P)$ such that $\bigvee D$ exists.
\end{itemize}
\end{definition}

\begin{proposition} \label{ZcontinuityIntersectionSystem}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $M \subseteq \powerset(P)$ a complete $\wedge$-subsemilattice. Let $\Closure_{M}$ be the associated Moore closure. Then the following are equivalent:
\begin{enumerate}
\item $M$ is $Z$-continuous;
\item $\setbuilder[\big]{\downset\{x\}}{x\in P} \subseteq M \subseteq \mathcal{C}_{\downarrow Z}(P)$;
\item $\setbuilder{A^\leq}{A\subseteq P} \subseteq M \subseteq \mathcal{C}_{\downarrow Z}(P)$.
\end{enumerate}
\end{proposition}
Note that $\setbuilder[\big]{\downset\{x\}}{x\in P}$ is not, in general, a complete $\wedge$-subsemilattice! 
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $x\in P$. Then $\{x\}\in Z(P)$ by \ref{singletonsAreZSets}, so $\Closure_{M}\big(\{x\}\big) = \downset\{x\}$. This implies that $\downset\{x\}$ is in $M$.

Take arbitrary $A\in M$. We need to show that $A$ is $Z$-closed. To that end take $D\subseteq A$ such that $D\in Z(P)$ and $\bigvee D$ exists. Then
\[ \downset\{\bigvee D\} = \Closure_{M}(D) \subseteq \Closure_{M}(A) = A, \]
so $\bigvee D \in A$.

$(2) \Rightarrow (1)$ Since each set in $\mathcal{C}_{\downarrow Z}(P)$ is downwards closed, each set in $M$ is also downwards closed. Now take arbitrary $D\in Z(P)$ such that $\bigvee D$ exists. Since $\Closure_{M}(D) \in \mathcal{C}_Z(P)$, we have $(\Closure_{\downarrow Z}\circ \Closure_{M})(D) = \Closure_{M}(D)$. Thus $D\subseteq \Closure_{M}(D)$ implies $\Closure_{\downarrow Z}(D) \subseteq (\Closure_{\downarrow Z}\circ \Closure_{M})(D) = \Closure_{M}(D)$. We have $D\subseteq \downset\{\bigvee D\}$, so using \ref{closureZsetWithJoin} we calculate
\[ \downset\{\bigvee D\} = \Closure_{\downarrow Z}(D) \subseteq \Closure_{M}(D) \subseteq \Closure_{M}\big(\downset \{\bigvee D\}\big) = \downset\{\bigvee D\}. \]
Thus all the inclusions are equalities and we have $\Closure_{M}(D) = \downset\big\{\bigvee D\big\}$.

$(2) \Leftrightarrow (3)$ Take arbitrary $A\subseteq P$. Since $M$ is a complete $\wedge$-subsemilattice, we have $\bigcap_{x\in A}\downset\{x\} = A^\leq \in M$.

For the converse, it is enough to note that $\{x\}^\leq = \downset\{x\}$ for all $x\in P$.
\end{proof}
\begin{corollary}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $M \subseteq \powerset(P)$ a complete $\wedge$-subsemilattice. Let $\Closure_{M}$ be the associated Moore closure. Then the following are equivalent:
\begin{enumerate}
\item $M$ is $Z$-continuous, where $Z$ is the $\mathrm{Z}$-system of singletons;
\item $\Closure_{M(P)}\big(\{x\}\big) = \downset\{x\}$ for all $x\in P$ and $A$ is downwards closed for all $A\in M$;
\item $\setbuilder[\big]{\downset\{x\}}{x\in P} \subseteq M(P) \subseteq \setbuilder{\downset A}{A\subseteq P}$;
\item $\setbuilder{A^\leq}{A\subseteq P} \subseteq M(P) \subseteq \setbuilder{\downset A}{A\subseteq P}$.
\end{enumerate}
\end{corollary}

\begin{lemma} \label{closureDownwardsClosedSets}
Let $P$ be a poset, $A\subseteq P$ and $M$ a complete $\wedge$-subsemilattice of $\powerset(P)$ that consists of downwards closed sets. Then $\Closure_M(A) = \Closure_M(\downset A)$.
\end{lemma}
\begin{proof}
Clearly $\Closure_{M}(A) \subseteq \Closure_{M}(\downset A)$. Conversely, we have $A\subseteq \Closure_{M}(A)$, which is downwards closed, so $\downset A \subseteq \Closure_{M}(A)$. Taking the closure gives $\Closure_{M}(\downset A) \subseteq \Closure_{M}(A)$.
\end{proof}

\begin{lemma} \label{dFunctionLemma}
Let $P$ be a poset, $\mathcal{A} \subseteq \setbuilder[\big]{\downset\{x\}}{x\in P}$,  $A\subseteq P$ and $d$ the function $d: P\to M: x\mapsto \downset\{x\}$. Then
\begin{enumerate}
\item $\bigcup \mathcal{A} = d^{\preimf}\big(\downset \mathcal{A}\big)$;
\item $\bigcup d^\imf(A) = \downset A$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) First take an arbitrary $x\in \bigcup \mathcal{A}$. Then there exists $\downset\{y\}\in \mathcal{D}$ such that $x\in \downset\{y\}$, so $\downset\{x\} \subseteq \downset\{y\}$. Thus $d(x) = \downset\{x\}\in \downset\mathcal{A}$ and $x\in d^\preimf\big(\downset \mathcal{A}\big)$.

Now take arbitrary $x\in d^{\preimf}\big(\downset \mathcal{A}\big)$, so $d(x) = \downset\{x\}\in \downset\mathcal{A}$. This means that there exists $\downset\{y\}\in\mathcal{A}$ such that $\downset\{x\} \subseteq \downset\{y\}$, so $x\in \downset\{y\} \subseteq \bigcup \mathcal{A}$.

(2) First take $x\in \bigcup d^\imf(A)$. Then there exists $y\in A$ such that $x\in d(y) = \downset\{y\}$, so $x \leq y$. Thus $x\in \downset A$.

Now take $x\in \downset A$. Then there exists $y\in A$ such that $x\leq y$, so $x\in \downset\{y\} = d(y) \subseteq \bigcup d^\imf(A)$.
\end{proof}

\begin{proposition} \label{continuousIntersectionSystemGivesJoinDenseCompletion}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $M \subseteq \powerset(P)$ a $Z$-continuous intersection system on $P$. Then
\begin{enumerate}
\item the function $d: P\to M: x\mapsto \downset\{x\}$ preserves arbitrary meets;
\item the function $d: P\to M: x\mapsto \downset\{x\}$ preserves $Z$-joins;
\item $\im(d)$ is join-dense in $M$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $A\subseteq P$ be a set such that $\bigwedge A$ exists. We need to show that $\bigcap d^\imf(A) = d\big(\bigwedge A\big)$. Since $\bigwedge A \in d(x)$ for all $x\in A$, we have $d\big(\bigwedge A\big) \subseteq \bigcap d^\imf(A)$. For the other inclusion, take $a\in \bigcap d^\imf(A)$. Then $a$ is a lower bound of $A$, so $a \leq \bigwedge A$ and $a \in d\big(\bigwedge A\big)$.

(2) Take some $D\in Z(P)$ such that $\bigvee D$ exists. We calculate
\begin{align*}
\bigvee_{M} d^\imf(D) &= \Closure_{M}\Big(\bigcup d^\imf(D)\Big) \\
&= \Closure_{M}(\downset D) = \Closure_{M}(D) \\
&= \downset\big\{\bigvee D\big\} = d\Big(\bigvee D\Big),
\end{align*}
by \ref{meetJoinImageMooreClosure}, \ref{dFunctionLemma} and \ref{closureDownwardsClosedSets}.

(3) Take $A \in M$. Then $A = \Closure_M(A) = \Closure_M(\downset A) = \Closure_M\big(\bigcup d^\imf(A)\big) = \bigvee_M d^\imf(A)$ by \ref{dFunctionLemma} and \ref{meetJoinImageMooreClosure}.
\end{proof}

\begin{proposition} \label{classificationZcontinuousCompletions}
Let $Z$ be a $\mathrm{Z}$-system and $P$ a poset. Then
\begin{enumerate}
\item if $M \subseteq \powerset(P)$ is a $Z$-continuous intersection system on $P$, then $d: P \to M$ is a join-dense $Z$-continuous completion;
\item if $c: P\to L$ is a join-dense $Z$-continuous completion, then $M \defeq \setbuilder{c^\preimf\big(\downset \{y\}\big)}{y \in L} \subseteq \powerset(P)$ is a $Z$-continuous intersection system on $P$;
\item if $c$ is join-dense, then $f: M \to L: A\mapsto \bigvee_L c^\imf(A)$ is an order similarity, with inverse $f^{-1}: L \to M: x\mapsto c^\preimf\big(\downset\{x\}\big)$. In particular $L \cong M$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Immediate from \ref{continuousIntersectionSystemGivesJoinDenseCompletion}.

(2) To show that $M$ is closed under intersections, take arbitrary $Y\subseteq L$. Then, by \ref{functionImagePreimageGaloisConnection},
\[ \bigcap_{y\in Y} c^\preimf\big(\downset \{y\}\big) = c^\preimf\Big(\bigcap_{y\in Y}\downset \{y\}\Big) = c^\preimf\big(\downset\{\bigwedge Y\}\big) \in M. \]

Take $y\in L$. Then $c^\preimf\big(\downset \{y\}\big)$ is downwards closed, since $c$ is isotone and \ref{isotoneIffDownsetContinuous}.

Now take $D\in Z(P)$ such that $\bigvee D$ exists. We have, using \ref{completeSubsemilattices},
\begin{align*}
\Closure_M(D) &= \bigcap \setbuilder{A \in M}{D \subseteq A} \\
&= \bigcap \setbuilder{c^\preimf\big(\downset \{y\}\big)}{y\in L,\; D \subseteq c^\preimf\big(\downset \{y\}\big)} \\
&= \bigcap \setbuilder{c^\preimf\big(\downset \{y\}\big)}{y\in L,\; c^\imf(D) \subseteq \downset \{y\}} \\
&= \bigcap \setbuilder{c^\preimf\big(\downset \{y\}\big)}{y\in L,\; \bigvee c^\imf(D) \leq y} \\
&= \bigcap \setbuilder{c^\preimf\big(\downset \{y\}\big)}{y\in \upset\big\{\bigvee c^\imf(D)\big\}} \\
&= c^\preimf\Big(\bigcap \setbuilder{\downset \{y\}}{y\in \upset\big\{\bigvee c^\imf(D)\big\}}\Big) \\
&= c^\preimf\Big(\downset\big\{\bigwedge \upset\big\{\bigvee c^\imf(D)\big\}\big\}\Big) \\
&= c^\preimf\Big(\downset\big\{\bigvee c^\imf(D)\big\}\Big) \\
&= c^\preimf\Big(\downset\big\{c\big(\bigvee D\big)\big\}\Big),
\end{align*}
where we have made repeated use of \ref{upsetDownsetConnections} and the fact that $c$ is $Z$-continuous.

Finally, we show that $c^\preimf\big(\downset\big\{c\big(\bigvee D\big)\big\}\big) = \downset\{\bigvee D\}$. It is clear that $\bigvee D \in c^\preimf\big(\downset\big\{c\big(\bigvee D\big)\big\}\big)$ and $c^\preimf\big(\downset\big\{c\big(\bigvee D\big)\big\}\big)$ is downwards closed, as this has already been shown. This means that $\downset \{\bigvee D\} \subseteq c^\preimf\big(\downset \{c\big(\bigvee D\big)\}\big)$. Conversely, take $x \in c^\preimf\big(\downset \{c\big(\bigvee D\big)\}\big)$. Then there exists $y \in \downset \{c\big(\bigvee D\big)\}$ such that $c(x) = y$. Thus $c(x) = y \leq c\big(\bigvee D\big)$, so $x\leq \big(\bigvee D\big)$, since $c$ is order-reflecting, and $x\in \downset\{\big(\bigvee D\big)\}$. 

(3) It is clear $f$ and $f^{-1}$ are order-preserving. We show they are inverses of each other. First take $x\in L$. Then
\begin{align*}
(f\circ f^{-1})(x) &= \bigvee_L (c^\imf \circ c^{\preimf})\big(\downset\{x\}\big) \\
&= \bigvee_L \downset\{x\}\cap \im(c) \\
&= x,
\end{align*}
by join-density of $\im(c)$. Now take $A = c^\preimf\big(\downset\{y\}\big) \in M$. Then
\begin{align*}
(f^{-1}\circ f)(A) &= c^\preimf\Big(\downset\big\{\bigvee_L c^{\imf}(A)\big\}\Big) \\
&= c^\preimf\Big(\downset\big\{\bigvee_L (c^{\imf}\circ c^\preimf)\big(\downset\{y\}\big)\big\}\Big) \\
&= c^\preimf\Big(\downset\big\{\bigvee_L \downset\{y\} \cap \im(c)\big\}\Big) \\
&= c^\preimf\Big(\downset\{y\}\Big),
\end{align*}
by join-density of $\im(c)$.
\end{proof}

\subsubsection{$Z_1$-continuous $Z_2$-completion}
\begin{definition}
Let $P$ be a poset and $Z_1,Z_2$ $\mathrm{Z}$-systems. A \udef{$Z_1$-continuous $Z_2$-completion} of $P$ is a $Z_1$-continuous embedding $f: P \to L$, where $L$ is a $Z_2$-complete poset.

We call the completion \udef{join-dense} if $\im(f)$ is join-dense in $L$.
\end{definition}

\begin{lemma} \label{ZcompletionFromCompletion}
Let $P$ be a poset and $Z_1,Z_2$ $\mathrm{Z}$-systems. Let $c: P\to L$ be a $Z_1$-continuous completion of $P$. Then $c|^{\Closure_{Z_2}(\im(c))}: P \to \Closure_{Z_2}(\im(c))$ is a join-dense $Z_1$-continuous $Z_2$-completion.
\end{lemma}
\begin{proof}
The only point that may not be clear is join-density. We have $\Closure_{Z_2}(\im(c)) \subseteq \Closure_{\powerset}(\im(c))$ and $\Closure_{\powerset}(\im(c))$ is a join-dense completion by \ref{closureGivesJoinDenseCompletion}.
\end{proof}

\begin{proposition} \label{standardFormZcontinuousZcompletion}
Let $Z_1,Z_2$ be $\mathrm{Z}$-systems, $P$ a poset and $M$ a $Z_1$-continuous intersection system on $P$. Then $d: P \to \Closure_{Z_2}\big(\im(d)\big): x\mapsto \downset\{x\}$ is a join-dense $Z_1$-continuous $Z_2$-completion.
\end{proposition}
\begin{proof}
This follows straight from \ref{classificationZcontinuousCompletions} and \ref{ZcompletionFromCompletion}.
\end{proof}

TODO: presumably we also have a result saying that all join-dense $Z_1$-continuous $Z_2$-completions are isomorphic to one of this form.

\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset, $M$ a $Z$-continuous intersection system on $P$ and $A\subseteq P$. Then $A$ is called \udef{$(Z,M)$-tapered} if $f^\imf(A)$ has a join for all closure-continuous functions $f: \sSet{P, \Closure_M}\to \sSet{L, (-)^{\leq\geq}}$ to a $Z$-continuous poset $L$.
\end{definition}

\begin{lemma} \label{MfunctionIsotone}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $M$ an intersection system on $P$ with downwards closed elements. Let $f: \sSet{P, \Closure_M}\to \sSet{Q, (-)^{\leq\geq}}$ be a closure-continuous function to some poset $Q$. Then $f$ is isotone.
\end{lemma}
\begin{proof}
This follows from $\downset\{y\} = \big(\downset\{y\}\big)^{\leq\geq}$ for all $y\in Q$, the fact that all elements of $M$ are downwards closed and \ref{isotoneIffDownsetContinuous}.
\end{proof}

\begin{lemma} \label{ZsetsTapered}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset, $M$ a $Z$-continuous intersection system on $P$ and $A\in Z(P)$. 
Then
\begin{enumerate}
\item $A$ is $(Z,M)$-tapered;
\item $\downset A$ is $(Z,M)$-tapered.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Let $f: P\to L$ be an $M$-continuous function to a $Z$-complete poset $L$. Since $f$ is isotone, by \ref{MfunctionIsotone}, we have that $f^\imf(A)\in Z(L)$ has a join in $L$ because $L$ is $Z$-complete.

(2) We have $f^\imf(A) \subseteq f^\imf(\downset A) \subseteq \downset f^\imf(A)$ by \ref{isotoneIffDownsetContinuous}. The first and third sets have the same join, so the middle set also has a join.
\end{proof}

\begin{proposition} \label{extensionMcontinuousFunctionZcontinuous}
Let $Z$ be a hereditary $\mathrm{Z}$-system, $P$ a poset and $M$ an intersection system on $P$. Let $f: \sSet{P, \Closure_M}\to \sSet{L, (-)^{\leq\geq}}$ be a closure-continuous function to a $Z$-complete poset $L$. Take $\mathcal{D} \in Z(M)$ such that $\mathcal{D} \subseteq \setbuilder{A\in M}{\text{$A$ is $(Z,M)$-tapered}}$. Then 
\begin{enumerate}
\item the join $\bigvee_{D\in \mathcal{D}}\bigvee_L f^\imf(D)$ exists and $\setbuilder{\bigvee_L f^\imf(D)}{D\in \mathcal{D}} \in Z(L)$;
\item the join $\bigvee_L \Big(\bigcup_{D\in \mathcal{D}}f^\imf(D)\Big)$ exists;
\item the join $\bigvee_L f^\imf\Big(\bigvee_{M}\mathcal{D}\Big)$ exists;
\item these joins are equal.
\end{enumerate}
\end{proposition}
Note that we do not need $M$ to be $Z$-continuous.
\begin{proof}
Let $T$ be the set $\setbuilder{A\in M}{\text{$A$ is $(Z,M)$-tapered}}$. The function $D\mapsto \bigvee_L f^\imf(D)$ is a well-defined isotone function on $T$. Since $T\subseteq M$, $\mathcal{D} \subseteq T$ and $\mathcal{D}\in Z(M)$, we have $\mathcal{D} \in Z(T)$ because $Z$ is hereditary. This implies that $\setbuilder{\bigvee_L f^\imf(D)}{D\in \mathcal{D}} \in Z(L)$. Thus $\bigvee_{D\in \mathcal{D}}\bigvee_L f^\imf(D)$ exists, by $Z$-completeness of $L$ and $\bigvee_L \Big(\bigcup_{D\in \mathcal{D}}f^\imf(D)\Big)$ exists by \ref{joinMeetUnion} and is equal to $\bigvee_{D\in \mathcal{D}}\bigvee_L f^\imf(D)$.
Then we can calculate
\begin{align*}
\bigcup_{D\in \mathcal{D}}f^\imf(D) &= f^\imf\Big(\bigcup \mathcal{D}\Big) \\
&\subseteq f^\imf\Big(\Closure_{M}\big(\bigcup \mathcal{D}\big)\Big) \\
&\subseteq \Big(f^\imf\big(\bigcup \mathcal{D}\big)\Big)^{\leq\geq} \\
&= \Big(\bigcup_{D\in \mathcal{D}}f^\imf(D) \Big)^{\leq\geq} \\
&\subseteq \Big(\bigcup_{D\in \mathcal{D}}\downset\{\bigvee_L f^\imf(D)\} \Big)^{\leq\geq} \\
&= \Big(\downset \setbuilder[\big]{\bigvee_L f^\imf(D)}{D\in \mathcal{D}} \Big)^{\leq\geq} \\
&= \downset \Big\{\bigvee \setbuilder[\big]{\bigvee_L f^\imf(D)}{D\in \mathcal{D}} \Big\},
\end{align*}
where we have used the continuity of $f$. Since the joins of the first and last sets exist in $L$ and are equal (both to $\bigvee_{D\in \mathcal{D}}\bigvee_L f^\imf(D)$), the set $f^\imf\Big(\Closure_{M}\big(\bigcup \mathcal{D}\big)\Big) = f^\imf\big(\bigvee_{M}\mathcal{D}\big)$ (the equality follows from \ref{meetJoinImageMooreClosure}) has the same join in $L$.
\end{proof}
\begin{corollary} \label{ZMtaperedSetsZclosed}
Let $Z$ be a hereditary $\mathrm{Z}$-system, $P$ a poset and $M$ a $Z$-continuous intersection system on $P$. Then the set $\setbuilder{A\in M}{\text{$A$ is $(Z,M)$-tapered}}$ is a $Z$-closed subset of $M$.
\end{corollary}
\begin{proof}
Let $T$ be the set $\setbuilder{A\in M}{\text{$A$ is $(Z,M)$-tapered}}$. To show that $T$ is $Z$-closed, take arbitrary $\mathcal{D} \subseteq T$ such that $\mathcal{D}\in Z(M)$. We have to show that $\bigvee_{M}\mathcal{D}$ is $(Z,M)$-tapered. This is indeed the case: let $f: \sSet{P, \Closure_M}\to \sSet{L, (-)^{\leq\geq}}$ be a closure-continuous function to a $Z$-complete poset $L$. Then the join $\bigvee_L f^\imf\Big(\bigvee_{M}\mathcal{D}\Big)$ exists by the proposition. Thus $\bigvee_{M}\mathcal{D}\in T$ and $T$ is $Z$-closed.
\end{proof}

\begin{proposition} \label{ZcontinuousExtension}
Let $Z_1$ be a $\mathrm{Z}$-system, $Z_2$ a hereditary $\mathrm{Z}$-system, $P$ a poset and $M$ a $Z_1$-continuous intersection system on $P$. Then the $Z_1$-continuous $Z_2$-completion $d: P \to \Closure_{Z_2}\big(\im(d)\big) \subseteq M: x\mapsto \downset\{x\}$ satisfies the following property:

Let $L$ be a $Z_2$-complete poset and $f: \sSet{P, \Closure_M}\to \sSet{L, (-)^{\leq\geq}}$ a closure-continuous function. Then there exists a unique $Z_2$-continuous function $\tilde{f}: \Closure_{Z_2}\big(\im(d)\big) \to L$ such that
\[ \begin{tikzcd}
P \ar[r, "d"] \ar[dr, swap, "f"] & \Closure_{Z_2}\big(\im(d)\big) \ar[d, dashed, "{\tilde{f}}"] \\ {} & L
\end{tikzcd} \qquad \text{commutes.} \]
This $\tilde{f}$ is defined by $\tilde{f}(A) = \bigvee_L f^\imf(A)$.
\end{proposition}
We have that $d: P \to \Closure_{Z_2}\big(\im(d)\big): x\mapsto \downset\{x\}$ is a $Z_1$-continuous $Z_2$-completion by \ref{standardFormZcontinuousZcompletion}.
\begin{proof}
First we observe that $\tilde{f}$ is well-defined. Indeed, $\im(d)$ consists of $(Z_2, M)$-tapered sets by \ref{ZsetsTapered} and the fact that singletons are $Z$-sets, \ref{singletonsAreZSets}. Also the set of $(Z_2, M)$-tapered sets is $Z_2$-closed by \ref{ZMtaperedSetsZclosed}. Thus all elements of $\Closure_{Z_2}\big(\im(d)\big)$ are $(Z_2, M)$-tapered.

Next we show that $\tilde{f}$ is $Z_2$-continuous. Take $\mathcal{D} \in Z_2\big(\Closure_{Z_2}(\im(d))\big)$. Then \ref{extensionMcontinuousFunctionZcontinuous} says that $\tilde{f}\Big(\bigvee \mathcal{D}\Big) = \bigvee_{D\in \mathcal{D}}\tilde{f}(D) = \bigvee\tilde{f}^\imf(\mathcal{D})$.

Finally we show that $\tilde{f}$ is unique. Let $g: \Closure_{Z_2}\big(\im(d)\big) \to L$ be some other $Z_2$-continuous function such that $f = g\circ d$. Consider the set $S\defeq\setbuilder{A\in \Closure_{Z_2}\big(\im(d)\big)}{g(A) = \tilde{f}(A)}$. By assumption $\im(d) \subseteq S$. It is now enough to show that $S$ is a $Z_2$-closed subset of $M$.

Let $\mathcal{D} \subseteq S$ such that $\mathcal{D} \in Z_2(M)$. Since $Z_2$ is hereditary, we have $\mathcal{D} \in Z_2\big(\Closure_{Z_2}(\im(d))\big)$. Then, since each $D\in\mathcal{D}$ is an element of $S$,
\[ g\Big(\bigvee \mathcal{D}\Big) = \bigvee_{D\in \mathcal{D}}g(D) = \bigvee_{D\in \mathcal{D}}\tilde{f}(D) = \tilde{f}\Big(\bigvee \mathcal{D}\Big). \]
Since $\bigvee \mathcal{D}\in \big(\Closure_{Z_2}(\im(d))\big)$, we have that $\bigvee \mathcal{D} \in S$ and thus that $S$ is $Z_2$-closed.
\end{proof}
\begin{corollary} \label{ZcontinuousExtensionZcontinuousFunction}
Let $Z$ be a hereditary $\mathrm{Z}$-system and $P$ a poset. Then the $Z$-continuous $Z$-completion $d: P \to \Closure_{Z}\big(\im(d)\big) \subseteq \mathcal{C}_{\downarrow Z}(P): x\mapsto \downset\{x\}$ satisfies the following property:

Let $L$ be a $Z$-complete poset and $f: P \to L$ an isotone $Z$-continuous function. Then there exists a unique $Z$-continuous function $\tilde{f}: \Closure_{Z}\big(\im(d)\big) \to L$ such that
\[ \begin{tikzcd}
P \ar[r, "d"] \ar[dr, swap, "f"] & \Closure_{Z}\big(\im(d)\big) \ar[d, dashed, "{\tilde{f}}"] \\ {} & L
\end{tikzcd} \qquad \text{commutes.} \]
This $\tilde{f}$ is defined by $\tilde{f}(A) = \bigvee_L f^\imf(A)$.
\end{corollary}
\begin{proof}
We first observe that $\mathcal{C}_{\downarrow Z}(P)$ is $Z$-continuous, by \ref{ZcontinuityIntersectionSystem}.

Now it is enough to prove that every isotone $Z$-continuous function $f: P \to L$ is closure-continuous as a function $f: \sSet{P, \Closure_{\mathcal{C}_{\downarrow Z}}}\to \sSet{L, (-)^{\leq\geq}}$. Indeed, take $A\subseteq L$. Then $A^{\leq\geq}$ is downwards closed and $f^\preimf(A^{\leq\geq})$ is downards closed by \ref{MfunctionIsotone} and \ref{isotoneIffDownsetContinuous}. We also have that $A^{\leq\geq}$ is $Z$-closed. Since $f$ is $Z$-continuous, we have that $f^\preimf\big(A^{\leq\geq}\big)$ is $Z$-closed by \ref{ZcontinuityZclosureContinuity}. Thus $f^\preimf\big(A^{\leq\geq}\big)$ is an element of $\mathcal{C}_{\downarrow Z}$, making $f: \sSet{P, \Closure_{\mathcal{C}_{\downarrow Z}}}\to \sSet{L, (-)^{\leq\geq}}$ closure continuous.
\end{proof}



\subsubsection{Extension of functions to $Z$-closure}
\begin{lemma} \label{extensionDomainDownsetCompletion}
Let $Z$ be a hereditary $\mathrm{Z}$-system, $P$ a $Z$-complete poset and $Q \subseteq P$ a subposet such that $\incl_Q$ is $Z$-continuous. Then $\Closure_{\downarrow Z, P}(A) = \downset \{\bigvee_P A\}$ for all $A\in \Closure_Z\big(\im(d)\big) \subseteq \mathcal{C}_{\downarrow Z}(Q)$.
\end{lemma}
\begin{proof}
First note that the join $\bigvee_P A = \bigvee \incl_Q^\imf(A) = \widetilde{\incl_Q}(A)$ exists for all $A\in \Closure_Z\big(\im(d)\big)$ by \ref{ZcontinuousExtensionZcontinuousFunction}, since $\incl_Q$ is isotone and $Z$-continuous.

Next note that $\Closure_{\downarrow Z, P}\big(\downset \{x\}\big) = \downset_P \{x\} = \downset_P \{\bigvee_P \downset \{x\}\}$ for all $x\in Q$, so $\Closure_{\downarrow Z}(A) = \downset \{\bigvee_P A\}$ holds for all $A\in \im(d)$.

Finally, we need to show that the set
\[ C \defeq \setbuilder{A\in \Closure_Z\big(\im(d)\big)}{\Closure_{\downarrow Z,P}(A) = \downset \{\bigvee_P A\}} \]
is a $Z$-closed subset of $\mathcal{C}_{\downarrow Z}(Q)$. To that end, take $\mathcal{D} \subseteq C$ such that $\mathcal{D}\in Z\big(\mathcal{C}_{\downarrow Z}(Q)\big)$. We then calculate, using \ref{meetJoinImageMooreClosure} and the fact that $\Closure_{\downarrow Z,Q}(A) \subseteq \Closure_{\downarrow Z,P}(A) \cap Q$ by $Z$-continuity of $\incl_Q$ (cfr. \ref{ZstableLemma}),
\begin{align*}
\Closure_{\downarrow Z}\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big) &= \big(\Closure_{\downarrow Z}\circ \Closure_{\downarrow Z, Q}\big)\Big(\bigcup \mathcal{D}\Big) \\
&\supseteq \Closure_{\downarrow Z}\Big(\bigcup \mathcal{D}\Big) \\
&= \Closure_{\downarrow Z}^2\Big(\bigcup \mathcal{D}\Big) \\
&\supseteq \Closure_{\downarrow Z}\Big(\Closure_{\downarrow Z}\big(\bigcup \mathcal{D}\big) \cap Q\Big) \\
&= \big(\Closure_{\downarrow Z}\circ \Closure_{\downarrow Z,Q}\big)\Big(\bigcup \mathcal{D}\Big) \\
&= \Closure_{\downarrow Z}\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big),
\end{align*}
so $\Closure_{\downarrow Z}\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big) = \Closure_{\downarrow Z}\Big(\bigcup \mathcal{D}\Big)$.
By \ref{closureContinuityJoin} we have
\begin{align*}
\Closure_{\downarrow Z}\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big) &= \Closure_{\downarrow Z}\Big(\bigcup_{D\in \mathcal{D}} D\Big) \\
&= \Closure_{\downarrow Z}\Big(\bigcup_{D\in \mathcal{D}} \Closure_{\downarrow Z}(D)\Big) \\
&= \Closure_{\downarrow Z}\Big(\bigcup_{D\in \mathcal{D}} \downset \{\bigvee_P D\}\Big) \\
&= \Closure_{\downarrow Z}\Big(\downset \setbuilder{\bigvee_P D}{D\in \mathcal{D}}\Big) \\
&= \downset \{\bigvee_{D\in \mathcal{D}}\bigvee_P D\} \\
&= \downset \{\bigvee_P\bigvee_{\mathcal{C}_{\downarrow Z}(Q)}\mathcal{D} \},
\end{align*}
where we have used the fact that $\setbuilder{\bigvee_P D}{D\in \mathcal{D}} \in Z(P)$ (by \ref{extensionMcontinuousFunctionZcontinuous}), \ref{closureZsetWithJoin} and \ref{extensionMcontinuousFunctionZcontinuous} again.
\end{proof}

\begin{lemma} \label{closureSetInClosureIsClosureOfPartInSet}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $Q \subseteq P$ a subposet. Then $\Closure_{\downarrow Z, P}(A) = \Closure_{\downarrow Z, P}(\downset A \cap Q)$ for all $A\subseteq \Closure_{Z}(Q)$.
\end{lemma}
\begin{proof}
We first prove the special case $\Closure_{\downarrow Z, P}(\downset \{x\} \cap Q) = \downset \{x\}$ for all $x\in \Closure_Z(Q)$. Clearly this holds for all $x\in Q$. We then define
\[ S \defeq \setbuilder{x\in P}{\Closure_{\downarrow Z, P}(\downset \{x\} \cap Q) = \downset \{x\}} \]
and attempt to show that $S$ is a $Z$-closed subset of $P$. Indeed, take $D\in Z(P)$ such that $D\subseteq S$ and $\bigvee D$ exists. Then, by \ref{closureZsetWithJoin} and \ref{closureContinuityJoin},
\begin{align*}
\downset \{\bigvee D\} &= \Closure_{\downarrow Z, P}(\downset D) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in D} \downset \{x\}\Big) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in D} \Closure_{\downarrow Z, P}(\downset \{x\} \cap Q)\Big) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in D}\downset \{x\} \cap Q \Big) \\
&= \Closure_{\downarrow Z, P}(\downset D \cap Q ) \\
&\subseteq \Closure_{\downarrow Z, P}(\downset \{\bigvee D\} \cap Q ) \\
&\subseteq \Closure_{\downarrow Z, P}(\downset \{\bigvee D\}) \\
&= \downset \{\bigvee D\}.
\end{align*}
This implies $\Closure_{\downarrow Z, P}(\downset \{\bigvee D\} \cap Q ) = \downset \{\bigvee D\}$, so $\bigvee D\in S$ and thus $S$ is $Z$-closed, so $\Closure_Z(Q) \subseteq S$.

Now take $A\subseteq \Closure_Z(Q)$. Then, by \ref{closureZsetWithJoin},
\begin{align*}
\Closure_{\downarrow Z, P}(A) &= \Closure_{\downarrow Z, P}(\downset A) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in A} \downset \{x\}\Big) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in A} \Closure_{\downarrow Z, P}(\downset \{x\} \cap Q)\Big) \\
&= \Closure_{\downarrow Z, P}\Big(\bigcup_{x\in A} \downset \{x\} \cap Q\Big) \\
&= \Closure_{\downarrow Z, P}\Big(\downset A \cap Q\Big).
\end{align*}
\end{proof}

\begin{lemma} \label{ZclosureSimilarToIntersectionSystem}
Let $Z$ be a hereditary $\mathrm{Z}$-system, $P$ a $Z$-complete poset and $Q \subseteq P$ a $Z$-stable subposet. Then
\[ \tilde{\incl}_Q: \Closure_Z\big(\im(d)\big) \subseteq \mathcal{C}_{\downarrow Z}(Q) \to \Closure_Z(Q): A \mapsto \bigvee_P A \]
is an order similarity, with inverse
\[ \tilde{\incl}_Q^{-1}: \Closure_Z(Q) \to \Closure_Z\big(\im(d)\big): x\mapsto \downset_P\{x\} \cap Q. \]
\end{lemma}
\begin{proof}
First we need to verify that the functions are well-defined. Since $\incl_Q$ is $Z$-continuous, by \ref{ZstableLemma}, we have that $\tilde{\incl}_Q: \Closure_Z\big(\im(d)\big) \subseteq \mathcal{C}_{\downarrow Z}(Q) \to P$ is well-defined with the codomain $P$. We then need to verify that the image in fact lies in $\Closure_Z(Q)$, so we can perform the codomain restriction.

To that end we verify that $S_1 \defeq \setbuilder{A \in \Closure_Z\big(\im(d)\big)}{\tilde{\incl}_Q(A) \in \Closure_Z(Q)} = \Closure_Z\big(\im(d)\big)$. First note that $\bigvee_P d(x) = x$ for all $x\in Q$, so $\im(d) \subseteq S_1$. It is then enough to show that $S_1$ is a $Z$-closed subset of $\mathcal{C}_{\downarrow Z}(Q)$. Take $\mathcal{D} \in Z\big(\mathcal{C}_{\downarrow Z}(Q)\big)$ such that $\mathcal{D} \subseteq S_1$. Then, by \ref{extensionMcontinuousFunctionZcontinuous},
\begin{align*}
\tilde{\incl}_Q\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big) &= \bigvee_P\Big(\bigvee_{\mathcal{C}_{\downarrow Z}(Q)} \mathcal{D}\Big) \\
&= \bigvee_{D\in \mathcal{D}}\bigvee_{P}D,
\end{align*}
where $\setbuilder{\bigvee_{P}D}{D\in \mathcal{D}} \in Z(P)$ and $\setbuilder{\bigvee_{P}D}{D\in \mathcal{D}} \subseteq \Closure_Z(Q)$ by assumption. Since $\Closure_Z(Q)$ is $Z$-closed, we have $\bigvee_{D\in \mathcal{D}}\bigvee_{P}D \in \Closure_Z(Q)$.

Next we verify that the putative inverse is well-defined, i.e.\ we need to check that $\downset\{x\} \cap Q \in \Closure_Z\big(\im(d)\big)$. First note that $\downset\{x\} \cap Q \in \mathcal{C}_{\downarrow Z}(Q)$, for all $x\in P$. Indeed,
\begin{align*}
\Closure_{\downarrow Z,Q}\big(\downset_P\{x\} \cap Q\big) &= \Closure_{\downarrow Z,P}\big(\downset_P\{x\} \cap Q\big) \cap Q \\
&\subseteq \Closure_{\downarrow Z,P}\big(\downset_P\{x\}\big) \cap Q \\
&= \downset_P\{x\} \cap Q.
\end{align*}
Now define $S_2 \defeq \setbuilder{x\in \Closure_{Z}(Q)}{\tilde{\incl}_Q^{-1}(x) \in \Closure_Z\big(\im(d)\big)}$. For all $x\in Q$, we have $\downset_P \{x\} \cap Q = \downset_Q \{x\} = d(x) \in \Closure_Z\big(\im(d)\big)$, so $Q \subseteq S_2$. We check that $S_2$ is a $Z$-closed subset of $P$. By \ref{closureSetInClosureIsClosureOfPartInSet}, we have
\begin{align*}
\downset_P\{\bigvee D\} &= \Closure_{\downarrow Z,P}(D) \\
&= \Closure_{\downarrow Z,P}(\downset D \cap Q) \\
&= \Closure_{\downarrow Z,P}\Big(\bigcup_{x\in D}\downset \{x\} \cap Q\Big).
\end{align*}
This implies
\begin{align*}
\downset_P\{\bigvee D\} \cap Q &= \Closure_{\downarrow Z,P}\Big(\bigcup_{x\in D}\downset \{x\} \cap Q\Big) \cap Q \\
&= \Closure_{\downarrow Z,Q}\Big(\bigcup_{x\in D}\downset \{x\} \cap Q\Big) \\
&= \bigvee_{\mathcal{C}_{\downarrow Z}(Q)}\setbuilder{\downset \{x\} \cap Q}{x\in D}.
\end{align*}
Since $x\mapsto \downset \{x\} \cap Q$ is an isotone function, we have $\setbuilder{\downset \{x\} \cap Q}{x\in D} \in Z\Big(\mathcal{C}_{\downarrow Z}(Q)\Big)$. Since $\setbuilder{\downset \{x\} \cap Q}{x\in D} \subseteq \Closure_Z\big(\im(d)\big)$ by assumption, this implies $\downset_P\{\bigvee D\} \cap Q \in \Closure_Z\big(\im(d)\big)$ and that $S_2$ is $Z$-closed.

We conclude that both functions are well-defined. It is clear that both functions are order-preserving.

Now define
\[ S_3 \defeq \setbuilder{x\in \Closure_Z(Q)}{(\tilde{\incl}_Q^{-1}\circ \tilde{\incl}_Q)(x) = x} = \setbuilder{x\in \Closure_Z(Q)}{\bigvee_P \big(\downset\{x\} \cap Q\big) = x}. \]
Clearly $Q\subseteq S_3$, so we just need to show that $S_3$ is a $Z$-closed subset of $P$. Take $D\in Z(P)$ such that $D\subseteq S_3$. We need to show that $\bigvee D \in S_3$. Since $\bigvee D$ is an upper bound of $\downset_P\big\{\bigvee D\big\}$ it is also an upper bound of $\downset_P\big\{\bigvee D\big\} \cap Q$. 

We now show that $\bigvee D$ is in fact the least upper bound of $\downset_P\big\{\bigvee D\big\} \cap Q$. Indeed, let $u$ be some other upper bound of $\downset_P\big\{\bigvee D\big\} \cap Q$. Take arbitrary $d\in D$, so $d\leq \bigvee D$. This implies $\downset_P\{d\} \subseteq \downset_P \{\bigvee D\}$ and $\downset_P\{d\} \cap Q \subseteq \downset_P \{\bigvee D\} \cap Q$, so $u$ is an upper bound of $\downset_P\{d\} \cap Q$. Since $d\in D\subseteq S_3$, we have
\[ d = \bigvee \big(\downset_P\{d\} \cap Q\big) \leq u. \]
As $d$ was taken arbitrarily, we have that $u$ is an upper bound of $D$ and so $\bigvee D \leq u$.

Finally we show that $(\tilde{\incl}_Q\circ \tilde{\incl}_Q^{-1})(A) = A$ for all $A\in \Closure_Z\big(\im(d)\big)$. This follows immediately from \ref{extensionDomainDownsetCompletion}:
\[ (\tilde{\incl}_Q\circ \tilde{\incl}_Q^{-1})(A) = \downset_P \{\bigvee_P A\} \cap Q = \Closure_{\downset Z, P}(A) \cap Q = \Closure_{\mathcal{C}_{\downarrow Z}(Q)}(A) = A. \]
\end{proof}

\begin{proposition}
Let $Z$ be a hereditary $\mathrm{Z}$-system, $P,L$ $Z$-complete posets and $Q \subseteq P$ a $Z$-stable subposet. Let $f: Q\to L$ be an isotone $Z$-continuous function. Then there exists a unique $Z$-continuous function $\tilde{f}: \Closure_Z(Q) \to L$ such that
\[ \begin{tikzcd}
Q \ar[r, "\incl_P"] \ar[dr, swap, "f"] & \Closure_{Z}(Q) \ar[d, dashed, "{\tilde{f}}"] \\ {} & L
\end{tikzcd} \qquad \text{commutes.} \]
This $\tilde{f}$ is defined by $\tilde{f}(x) = \bigvee_L f^\imf\big(\downset\{x\}\cap Q\big)$.
\end{proposition}
The commutation of the diagram just means that $\tilde{f}|_Q = f$.
\begin{proof}
This is immediate from \ref{ZcontinuousExtensionZcontinuousFunction} (since $\incl_Q$ is $Z$-continuous by \ref{ZstableLemma}) and \ref{ZclosureSimilarToIntersectionSystem}.
\end{proof}

\subsubsection{The Dedekind-MacNeille completion}

The intersection system $\setbuilder{A^\leq}{A\subseteq P}$ is $\powerset$-continuous.

\begin{example}
The sets $A^{\leq\geq}$ are $\powerset$-closed, but the converse is not true. There exist $\powerset$-closed sets that are not of the form $A^\geq$. For example, let $P$ be the poset consisting of two parallel copies of $\N$, together with a top $\top$:
\[ \begin{tikzcd}
{} & \top \ar[dl, dash] \ar[dr, dash] & {} \\
\hdots \ar[d,dash] & {} & \hdots \ar[d,dash] \\
2 \ar[d,dash] & {} & 2 \ar[d,dash] \\
1 \ar[d,dash] & {} & 1 \ar[d,dash] \\
0 & {} & 0
\end{tikzcd} \]
Then each copy of $\N$ is $\powerset$-closed, but not of the form $A^\geq$ for any $A\subseteq P$.
\end{example}


\subsection{Below relations}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $x,y\in P$. Then $x$ is said to be \udef{$Z$-below} $y$, denoted $x \ll_Z y$ if, for all $S\in Z(P)$ such that $\bigvee S$ exists, we have
\[ y \leq \bigvee S \qquad \implies \qquad x \in \downset S. \]
For all $A\subseteq P$ we define
\begin{align*}
\uupset_Z A &\defeq \setbuilder{y\in P}{\exists x\in A: \; x \ll_Z y} \\
\ddownset_Z A &\defeq \setbuilder{x\in P}{\exists y\in A: \; x \ll_Z y}.
\end{align*}
\end{definition}

\subsubsection{$Z$-compact elements}
\begin{definition}
Let $Z$ be a $\mathrm{Z}$-system, $P$ a poset and $x\in P$. Then $x$ is called \udef{$Z$-compact} if $x \ll_Z x$. We denote the set of $Z$-compact elements of $P$ by $\compacts_Z(P)$.
\end{definition}

\begin{lemma}
Let $Z$ be a $\mathrm{Z}$-system and $P$ a non-empty poset with bottom $\bot$. Then $\bot$ is $Z$-compact \textup{if and only if} $Z$ is not strict. 
\end{lemma}
\begin{proof}
First suppose $\bot$ is $Z$-compact and, towards a contradiction, that $Z$ is not strict. Now $\emptyset \in Z(P)$ by \ref{strictZSystemEveryEmptySetZSet} and $\bigvee \emptyset$ exists since it is equal to $\bot$. Thus $\bot \leq \bigvee \emptyset$, so $\bot \in \downset \emptyset$ by compactness, but this is clearly false.

Conversely, Suppose $Z$ is not strict. Then $\emptyset\notin Z(P)$. Suppose $\bigvee S$ exists and $\bot \leq \bigvee S$ for some $S\in Z(P)$. Then $\bot \leq S$ since $S$ is not empty. Thus $\bot$ is $Z$-compact.
\end{proof}

\subsection{Continuity of posets}

\section{Atoms, density and irreducibility}
TODO: move down!!
\subsection{Join- and meet-density}
\begin{definition}
Let $P$ be a poset and let $Q\subset P$ be a subset. Then $Q$ is called \udef{join-dense} in $P$ if for every $x\in P$, there exists a subset $S\subset Q$ such that $x= \bigvee_P S$.

The dual of join-dense is \udef{meet-dense}.
\end{definition}

\begin{lemma}
Let $P$ be a poset, $Q\subset P$ a subset and $x\in P$. Then
\begin{enumerate}
\item if $Q$ is join-dense, then $x = \bigvee Q\cap \downset\{x\}$;
\item if $Q$ is meet-dense, then $x = \bigwedge Q\cap \upset\{x\}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By join-density, there exists $S\subseteq Q$ such that $x = \bigvee S$. Now $x$ is an upper bound of $Q\cap \downset\{x\}$, because it is a subset of $\downset\{x\}$. Also $S\subseteq Q\cap \downset\{x\}$, so any upper bound of $Q\cap \downset\{x\}$ is an upper bound of $S$ and thus greater than $x$. This means that $x$ is the least upper bound of $Q\cap \downset\{x\}$.

(2) Dual.
\end{proof}

\subsection{Join- and meet-irreducible elements}
\begin{definition}
Let $P$ be a poset. We call $x\in P$ \udef{join-irreducible} if
\begin{itemize}
\item $x$ is not a least element of $P$,
\item for all $a,b\in P$: $x= a\vee b$ implies $x=a$ or $x=b$.
\end{itemize}
The definition of \udef{meet-irreducible} is dual.

We denote the set of join-irreducible elements in $P$ as $\joinIr(P)$ and the set of meet-irreducible elements in $P$ as $\meetIr(P)$.
\end{definition}

\begin{lemma} \label{joinIrreducibleLemma}
Let $P$ be a poset and $x\in P$ not a least element. Then the following are equivalent:
\begin{enumerate}
\item $x$ is join-irreducible;
\item for all $a,b\in P$: $x= a\vee b$ implies $x \leq a$ or $x \leq b$;
\item for all $a,b\in P$: $x > a$ and $x > b$ implies $x > a\vee b$;
\item for all finite $F\subseteq P$: $x = \bigvee F$ implies $x\in F$.
\end{enumerate}
\end{lemma}

\begin{lemma}
In a finite lattice $L$, an element is join-irreducible if and only if it
has exactly one lower cover.
\end{lemma}

\begin{example}
Consider the lattice $\seq{\N,\lcm, \gcd}$. A non-zero element of $\N$ is join irreducible if and only if it is of the form $p^r$ for some prime $p$ and $r\in\N$.
\end{example}

\begin{proposition}
$x$ is join-irreducible iff $\downset x$ is linearly ordered.
\end{proposition}

TODO: isolated points
link with boundary

\url{http://www.m-hikari.com/ijcms-password2008/9-12-2008/xuluoshanIJCMS9-12-2008.pdf}

\url{http://imar.ro/journals/Revue_Mathematique/pdfs/2015/2/5.pdf}

\url{https://link.springer.com/content/pdf/10.1007/BF01349957.pdf}


\subsection{Atomic elements}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset.
\begin{itemize}
\item An element $a\in P$ is called an \udef{atom} if $a$ is minimal in $P\setminus\min(P)$.
\item An element $a\in P$ is called a \udef{coatom} if $a$ is maximal in $P\setminus\max(P)$.
\end{itemize}
We denote the set of atoms of $P$ as $\atoms(P)$. The set of coatoms is denoted $\coatoms(P)$.
\end{definition}
If $P$ has a least element $\bot$, then $a$ is an atom if and only if it covers $\bot$.

\begin{lemma} \label{atomsJoinIrriducible}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{enumerate}
\item $\atoms(P) \subseteq \joinIr(P)$;
\item $\coatoms(P) \subseteq \meetIr(P)$;
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $a\in \atoms(P)$. Then $a$ is not a least element of $P$. Assume there exist $x,y\in P$ such that $a = x\vee y$. Then $x,y\in \downset a \subseteq \{\bot, a\}$. If $x= \bot = y$, then $a = \bot$, which is not an atom. So either $x = a$ or $y = a$.

(2) Dual.
\end{proof}


\subsubsection{Atomic and atomistic posets}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{itemize}
\item $P$ is \udef{atomic} if $\forall x\in P\setminus\min(P): \atoms(P)\mesh \downset\{x\}$;
\item $P$ is \udef{coatomic} if $\forall x\in P\setminus\max(P): \coatoms(P)\mesh \upset\{x\}$;
\end{itemize}
also
\begin{itemize}
\item $P$ is \udef{strongly atomic} if $\forall x,y\in P$ the poset $\interval{x,y}$ is atomic;
\item $P$ is \udef{strongly coatomic} if $\forall x,y \in P$ the poset $\interval{x,y}$ is coatomic;
\end{itemize}
and
\begin{itemize}
\item $P$ is \udef{atomistic} if $\atoms(P)$ is join-dense in $L$;
\item $P$ is \udef{coatomistic} if $\coatoms(P)$ is meet-dense in $L$.
\end{itemize}
\end{definition}
Thus ``atomic'' means that every element has an atom under it and ``coatomic'' means that every element has a coatom above it.

\url{https://www.emis.de/journals/PM/51f4/pm51f409.pdf}

\begin{lemma}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{enumerate}
\item if $P$ is atomistic, then $P$ is atomic;
\item if $P$ is strongly atomic and $P$ has a bottom, then $P$ is atomic;
\item if $P$ is coatomistic, then $P$ is coatomic;
\item if $P$ is strongly coatomic and $P$ has a top, then $P$ is coatomic.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $P$ is atomistic and take arbitrary $x\in P\setminus\min(P)$. Then $x = \bigvee \atoms(P)\cap \downset\{x\}$. If $\atoms(P)\cap \downset\{x\}$ were empty, then $x = \bigvee \atoms(P)\cap \downset\{x\}$ would be equal to $\min(P)$, which is not the case. So $\atoms(P)\mesh \downset\{x\}$.

(2) Take arbitrary $x\in P\setminus\min(P)$. Then $\interval{\min(P), x} = \downset\{x\}$ is atomic and thus contains atoms, which are also atoms in $P$.

(3) Dual to (1).

(4) Dual to (2).
\end{proof}

\begin{example}
An atomistic poset is not necessarily strongly atomic. Consider
\[ \begin{tikzcd}[column sep=small, row sep=small]
&&&& {\top} \ar[dddd, dash] \\
&&& {\bullet} \ar[ur, dash] \ar[ddd, dash] & \\
&& {\bullet} \ar[ur, dash] \ar[dd, dash] && \\
& {x} \ar[ur, dotted, no head] \ar[d, dash] &&& \\
{\bullet} \ar[ur, dash] & {\bullet} \ar[r, dotted, no head] & {\bullet} & {\bullet} & {\bullet}
\end{tikzcd} \]
such that there is no element immediately above $x$. Then $\interval{x,\top}$ is not atomic, even though the poset is atomistic.
\end{example}

\subsection{Tiny elements}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset. An element $x\in P$ is called \udef{tiny} if it is $\powerset$-compact.
\end{definition}

\begin{proposition}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{enumerate}
\item if $P$ is infinitely join-distributive, then every atom is tiny;
\item if $P$ is a Boolean algebra, then every tiny element is an atom.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $x\in P$ be an atom. Let $D\subseteq P$ be a subset such that $\bigvee D$ exists and $x \leq \bigvee D$. Then
\[ x = x\wedge \bigvee D = \bigvee_{d\in D}x\wedge d. \]
Now for all $d\in D$, $x\wedge d \leq x$, so either $x\wedge d = x$ or $x\wedge d = \bot$. If $x\wedge d = \bot$ for all $d\in D$, then $x =  \bigvee_{d\in D}x\wedge d = \bot$, which is a contradiction. Thus there mus exist at least one $d'\in D$ such that $x\wedge d' = x$. This implies $x\leq d'$ and thus $x\in \downset D$. We conclude that $x$ is tiny.

(2) Let $x\in P$ be tiny. Suppose there exists $y \leq x$ and $x \neq y \neq \bot$. We show that this would imply that $x$ is not tiny. Consider the set $D \defeq \{y, x\wedge \overline{y}\}$. Then
\[ \bigvee D = y \vee (x\wedge \overline{y}) = (y\vee x)\wedge (y\vee \overline{y}) = (y\vee x)\wedge \top = y\wedge x = x, \]
so $x \leq \bigvee D$. We do not, however, have $x\in \downset D$. If $x \leq y$, then $x=y$, which is not the case. If $x \leq x\wedge \overline{y}$, then $x = x\wedge \overline{y}$ and thus $x \leq \overline{y}$. By \ref{BooleanComplementLargestDisjoint}, this implies $\bot = x\wedge y = y$, which was disallowed.
\end{proof}

\chapter{Semilattice}
\begin{definition}
A \udef{semilattice} is an algebraic structure $\sSet{S,\star}$ where $\star$ is a binary operation on the set $S$ satisfying
\begin{itemize}[leftmargin=2.5cm]
\item[\textbf{Associativity}] $x\star (y\star z) = (x\star y) \star z$;
\item[\textbf{Commutativity}] $x \star y = y \star x$;
\item[\textbf{Idempotency}] $x\star x = x$.
\end{itemize}
We call a semilattice \udef{bounded} if it contains an identity $e$ for $\star$. We write $\sSet{S, \star, e}$.
\end{definition}
In other words a semilattice is a commutative idempotent semigroup or commutative band.

\begin{lemma}
Let $(P,\leq)$ be a poset and let $\{x,y,z\}\subseteq P$ be such that each subset has a supremum. Then
\[ \sup\{\sup\{x,y\},z\} = \sup\{x,y,z\} = \sup\{x,\sup\{y,z\}\} \]
and, dually,
\[ \inf\{\inf\{x,y\},z\} = \inf\{x,y,z\} = \inf\{x,\inf\{y,z\}\}. \]
\end{lemma}
\begin{corollary}
Let $(P,\leq)$ be a poset.
\begin{enumerate}
\item If $\sup\{x,y\}$ exists for all $x,y\in P$, then $\sSet{P,\sup}$ is a semilattice.
\item If $\inf\{x,y\}$ exists for all $x,y\in P$, then $\sSet{P,\inf}$ is a semilattice.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{orderSemilattice}
Let $\sSet{S,\star}$ be a semilattice. Define the relations $\leq_1, \leq_2$ on $S$ by
\[ \forall x,y\in S:\qquad x\leq_1 y \; \iff \; x = x\star y \;\iff\; y\leq_2 x. \] 
Then
\begin{enumerate}
\item $\sSet{S,\leq_1}$ is a poset such that $\forall x,y\in S:\; x\star y = \inf_{\leq_1}\{x,y\}$;
\item $\sSet{S,\leq_2}$ is a poset such that $\forall x,y\in S:\; x\star y = \sup_{\leq_2}\{x,y\}$;
\item $\sSet{S,\leq_1}$ and $\sSet{S,\leq_2}$ are dual order structures, i.e.\ $\leq_1 = \leq_2^\transp$.
\end{enumerate}
Also,
\begin{enumerate} \setcounter{enumi}{3}
\item if $S$ has an identity, then it is a greatest element in $S$ w.r.t.\ $\leq_1$ (and a least element in $S$ w.r.t.\ $\leq_2$);
\item if $S$ has an absorbing element, then it is a least element in $S$ w.r.t.\ $\leq_1$ (and a greatest element in $S$ w.r.t.\ $\leq_2$).
\end{enumerate}
\end{proposition}
\begin{proof}
(1) First we prove $\sSet{S,\leq_1}$ is a poset:
\begin{itemize}
\item Reflexivity follows from idempotency.
\item Antisymmetry follows from commutativity:
\[ x\leq_1 y, y\leq_1 x \quad\implies\quad x = x\star y = y \star x = y. \]
\item For transitivity: assume $x\leq_1 y$ and $y\leq_1 z$. This implies $x = x\star y$ and $y = y\star z$, and so $x = x\star (y\star z) = (x\star y) \star z = x\star z$. This implies $x\leq_1 z$.
\end{itemize}
Next we prove that $\forall x,y\in S:\; x\star y = \inf_{\leq_1}\{x,y\}$.

First we note that $x \star y$ is a lower bound of $\{x,y\}$: we have $(x\star y) \leq_1 x$ because $x\star(x\star y) = (x\star x)\star y = x\star y$. Let $u$ be any other lower bound of $\{x,y\}$. Then $u = x\star u = x\star (y\star u) = (x\star y)\star u$. So $u \leq_1 x\star y$, meaning $x\star y$ is the infimum.

(2) Similar to (1).

(3) Immediate.

(4) Let $e\in S$ be an identity. For all $x\in S$, we have $x = x\star e$, so $x\leq_1 e$. This means that $e$ is a $\leq_1$-greatest element.

(5) Let $a$ be an absorbing element. For all $x\in S$, we have $a = a\star x$, so $a\leq_1 x$. This means that $a$ is a $\leq_1$-least element.
\end{proof}

Often we will want to interpret a semilattice as a partially ordered set. This means we need to choose $\leq_1$ or $\leq_2$.
\begin{definition}
Let $\sSet{S,\star}$ be a semilattice. We call $S$
\begin{itemize}
\item a \udef{meet-semilattice} or \udef{$\wedge$-semilattice} if we consider it ordered by $\leq_1$, i.e.\ $x\star y = \inf\{x,y\}$;
\item a \udef{join-semilattice} or \udef{$\vee$-semilattice} if we consider it ordered by $\leq_2$, i.e.\ $x\star y = \sup\{x,y\}$.
\end{itemize}
By convention, we represent the semilattice operation $\star$ of a $\wedge$-semilattice by $\wedge$ and of a $\vee$-semilattice by $\vee$.

We usually denote the identity of a $\wedge$-semilattice by $\top$ and the identity of a $\vee$-semilattice by $\bot$.
\end{definition}

We call a poset $\sSet{P,\leq}$
\begin{itemize}
\item a $\wedge$-semilattice if $\inf\{x,y\}$ exists for all $x,y\in P$;
\item a $\vee$-semilattice if $\sup\{x,y\}$ exists for all $x,y\in P$.
\end{itemize}

\begin{example}
Let $X,Y$ be sets then the set of partial functions $(X\not\to Y)$ ordered by inclusion is a $\wedge$-semilattice.

Take $f,g\in (X\not\to X)$, then
\[ f\wedge g = \setbuilder{(x,y)\in X\times Y}{x\in \dom(f)\cap \dom(g), f(x)=y=g(x)}. \]
Note that $\dom(f\wedge g) \subseteq \dom(f)\cap \dom(g)$.

In fact every non-empty set has an infimum. This does not make $(X\not\to Y)$ a complete lattice (despite \ref{existenceSupremaInfima}), since the empty set does not have an infimum.
\end{example}

\section{Semilattice homomorphisms}
\begin{proposition} \label{orderPreservingFunctionLatticeOperations}
Let $\sSet{P,\leq}$, $\sSet{Q,\leq}$ be posets and $f: P\to Q$ an order-preserving function.
\begin{enumerate}
\item If $P,Q$ are $\wedge$-semilattices, then
\[  \forall x,y\in P: f(x\wedge y) \leq f(x)\wedge f(y) \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are complete $\wedge$-semilattices, then
\[  \forall D\subseteq P: f(\bigwedge D) \leq \bigwedge f[D] \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are $\vee$-semilattices, then
\[  \forall x,y\in P: f(x\vee y) \geq f(x)\vee f(y) \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are complete $\vee$-semilattices, then
\[  \forall D\subseteq P: f(\bigvee D) \geq \bigvee f[D] \quad\iff\quad \text{$f$ is order-preserving}. \]
\end{enumerate} 
\end{proposition}
TODO: cfr. \ref{mappingJoinsMeets}.
\begin{proof}
(1) Assume $f(x\wedge y) \leq f(x)\wedge f(y)$. Then $x\leq y$ implies $x = x\wedge y$, which implies $f(x) = f(x\wedge y) \leq f(x)\wedge f(y) \leq f(y)$.

For the converse: From $x\wedge y \leq x$ we get $f(x\wedge y) \leq f(x)$. Similarly $f(x\wedge y) \leq f(y)$. Together this gives $f(x\wedge y) \leq f(x)\wedge f(y)$.

(2) The direction $\Rightarrow$ follows from (1). Assume $f$ order-preserving. Take arbitrary $D\subseteq P$. For all $x\in D$ we have $\bigwedge D \leq x$, so $f(\bigwedge D) \leq f(x)$. This means $f(\bigwedge D)$ is a lower bound of $f[D]$, so $f(\bigwedge D) \leq \bigwedge f[D]$.

(3,4) Similar.
\end{proof}
\begin{corollary}
Let $\sSet{S,\wedge}, \sSet{T, \wedge}$ be a semilattices and $f: S\to T$ a function. If $f$ is a semilattice homomorphism, then it is order-preserving. The converse does not hold in general.
\end{corollary}
\begin{proof}
We just need to show the converse does not hold. TODO
\end{proof}


\begin{proposition}
Let $\sSet{S,\wedge}$ be a semilattice and $X$ a set. Then the pointwise ordering of $(X\to S)$ makes it a semilattice. For all $f,g\in (X\to S)$, the function $f\wedge g$ is defined by
\[ f\wedge g: X\to S: x\mapsto (f\wedge g)(x) = f(x) \wedge g(x). \]
If $S$ is a complete semilattice, then so is $(X\to S)$.
\end{proposition}

\begin{proposition} \label{semilatticeOfSemilatticeHomomorphisms}
Let $\sSet{S,\wedge}, \sSet{T, \wedge}$ be (complete) semilattices. The set of (complete) semilattice homomorphisms is a (complete) subsemilattice of $(S\to T)$.
\end{proposition}
\begin{proof}
We calculate for all $x,y\in S$:
\begin{align*}
(f\wedge g)(x\wedge y) &= f(x\wedge y)\wedge g(x\wedge y) = f(x)\wedge f(y) \wedge g(x) \wedge g(y) \\
&= (f(x)\wedge g(x))\wedge(f(y)\wedge g(y)) = (f\wedge g)(x) \wedge (f\wedge g)(y).
\end{align*}
TODO complete notation.
\end{proof}
TODO link universal algebra.

\section{Complete semilattices}
\begin{lemma}
Let $\sSet{S,\wedge}$ be a semilattice. For every finite set $D\subset S$, $\inf(D)$ exists.
\end{lemma}
\begin{definition}
Let $\sSet{S,\wedge}$ be a semilattice. We call $S$ a \udef{complete semilattice} if each subset $D\subseteq S$ has an infimum. We write
\[ \inf(D) = \bigwedge D. \]
If we want to emphasise that the infimum of $D$ is taken as a subset of $S$, we write $\bigwedge_S D$.
\end{definition}

We of course have dual definitions for $\vee$-semilattices. In this case we consider suprema and write $\sup(D) = \bigvee D$.

\begin{lemma} \label{supInfFiniteSubsetsLattice}
Let $\sSet{S,\wedge}$ be a semilattice and $F\subseteq S$ a finite subset. Then $\bigvee S$ exists. 
\end{lemma}
In particular every finite semilattice is complete.


\begin{theorem}[Knaster-Tarski fixed-point theorem for semilattices] \label{KnasterTarskiSemilattice}
Let $\sSet{S,\wedge}$ be a complete semilattice and $f:S\to S$ an order-preserving map. Then 
\[ \bigwedge \setbuilder{x\in S}{f(x) \leq x} \]
is the least fixed point of $f$.
\end{theorem}
\begin{proof}
Let $P$ be the set of fixed points of $f$. Set $H = \setbuilder{x\in L}{f(x)\leq x}$ and $\alpha = \bigwedge H$. It is clear that $\alpha$ is a lower bound of $P$ because $P \subset H$. So we just need to show that $\alpha$ is a fixed point.

Now $f(\alpha)$ is a lower bound of $H$ due to $f$ being order preserving: for all $x\in H$ we have $\alpha\leq x$, so $f(\alpha) \leq f(x)$ and also $f(\alpha) \leq f(x) \leq x$. So $f(\alpha)\leq \alpha$ because $\alpha$ is the greatest lower bound.

Conversely, $f(f(\alpha)) \leq f(\alpha)$ because $f$ is order preserving. This means $f(\alpha)\in H$, so $f(\alpha)\leq \alpha$. We have thus shown that $\alpha = f(\alpha)$.
\end{proof}

\begin{example}
In \ref{KnasterTarskiSemilattice}, the semilattice $\sSet{S,\wedge}$ must be complete, not just Dedekind-complete.

As a counter-example, consider $f: \R\to\R: x\mapsto x+1$.
\end{example}

\section{Subsets of semilattices}
\subsection{Disjoint elements and meshing elements}
TODO compare with set-theoretical definitions.
\begin{definition}
Let $S$ be a $\wedge$-semilattice with absorbing element $\bot$.

We say $x,y\in S$
\begin{itemize}
\item are \udef{disjoint}, denoted $x \perp y$, if $x\wedge y = \bot$;
\item \udef{mesh}, denoted $x\mesh y$, if $x\wedge y \neq \bot$.
\end{itemize}

Let $D, E \subset S$. Then
\begin{itemize}
\item the polar $D^\perp$ is called the \udef{disjoint complement} of $D$;
\item the polar $D^{\mesh}$ is called the \udef{grill} of $D$.
\end{itemize}
\end{definition}

\begin{lemma} \label{grillUpwardsClosed}
Let $S$ be a $\wedge$-semilattice with absorbing element $\bot$ and $A\subseteq S$. Then $A^\mesh$ is upwards closed.
\end{lemma}
\begin{proof}
Take $a\in A^\mesh$ and $b \geq a$. Take arbitrary $c\in A$. Then $c\wedge b \geq c\wedge a > \bot$, so $b\mesh c$. Since $c$ was taken arbitrarily, we have $b\in A^\mesh$.
\end{proof}

\section{Subsemilattices}
\subsection{Proper subsemilattices}
\begin{definition}
Let $S$ be a semilattice. A subsemilattice is called \udef{proper} if it does not contain an absorbing element.
\end{definition}

\begin{lemma} \label{properSubsemilatticeLemma}
Let $S$ be a $\wedge$-semilattice with bottom $\bot$ and $D$ a subsemilattice. Then the following are equivalent:
\begin{enumerate}
\item $D$ is proper;
\item $D\amesh D$;
\item $D\subseteq D^\mesh$;
\item $D^\mesh$ is not empty;
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $a,b\in D$. Then $a\wedge b\in D$ because $D$ is a subsemilattice. Thus $a\wedge b \neq \bot$ because $\bot\notin D$, so $a\mesh b$.

$(2) \Rightarrow (3)$ By \ref{polarsSetRelation}.

$(3) \Rightarrow (4)$ If $D$ is empty, then $D^\mesh = S$, which is not empty (because it contains at least $\bot$). 

If $D$ is not empty, then $D\subseteq D^\mesh$ implies that $D^\mesh$ is not empty.

$(4) \Rightarrow (1)$ Assume $\bot\in D$. Then $D^\mesh \subseteq \{\bot\}^\mesh$ by \ref{antitonicityPolars}. Now $\{\bot\}^\mesh = \emptyset$, which implies that $D^\mesh$ is empty. This contradicts our assumption and we conclude that $D$ is proper.
\end{proof}

\subsection{Ordering proper subsemilattices}
\begin{definition}
Let $S$ be a semilattice and $D,E$ subsemilattices. Then we write $D\lhd E$ if $D\subseteq E$ and $E$ is proper.
\end{definition}

\begin{lemma} \label{properGrills}
Let $S$ be a $\wedge$-semilattice and $A\subseteq S$ a subset. Then the following are equivalent:
\begin{enumerate}
\item $A = \emptyset$;
\item $A^\mesh = S$;
\item $\bot \in A^\mesh$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Immediate by definition.

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (1)$ Assume $A$ is not empty and $\bot\in A^\mesh$. Then $a\in A$ and we have $a \mesh \bot$, i.e.\ $a\wedge \bot \neq \bot$. This is impossible, so $A$ is empty.
\end{proof}

\begin{proposition}
Let $S$ be a $\wedge$-semilattice and $D,E$ subsemilattices. Assume that $D$ is not empty. Then
\[ D \lhd E \qquad\iff\qquad D\subseteq E \subseteq D^\mesh. \]
\end{proposition}
\begin{proof}
First assume $D \lhd E$. Then $E\subseteq E^\mesh$ by \ref{properSubsemilatticeLemma}. Also $E^\mesh \subseteq D^\mesh$ by \ref{antitonicityPolars}, so $E\subseteq E^\mesh \subseteq D^\mesh$ by transitivity.

Now assume $D\subseteq E \subseteq D^\mesh$. We need to prove that $\bot\notin E$. It is enough to prove that $\bot \notin D^\mesh$. This is given by \ref{properGrills}.
\end{proof}


\section{Generalised inverse of inf}
\begin{proposition}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset such that $\sSet{S,\leq}$ is a complete $\wedge$-semilattice. Then
\[ f: P \to \powerset(S)^o: x\mapsto \upset x \cap S \qquad\text{and}\qquad g: \powerset(S)^o\to P: D\mapsto \bigwedge_S D \]
are order-preserving generalised inverses. Additionally, they form a Galois connection \textup{if and only if} for all $D\subseteq S$: $\bigwedge_P D$ exists and is equal to $\bigwedge_S D$.
\end{proposition}
\begin{proof}
TODO first part.

Assume for all $D\subseteq S$: $\bigwedge_P D$ exists and $\bigwedge_S D = \bigwedge_P D$. It is enough to verify, for all $x\in P$ and $B\subseteq S$
\[ (\upset x)\cap S \supseteq B \iff x\leq \bigwedge_S B. \]
Assume $(\upset x)\cap S \supseteq B$. Then $\upset x \supseteq B$, so $x \bigwedge_P \leq \bigwedge_P B = \bigwedge_S B$. Conversely, assume $x\leq \bigwedge_S B$. Then $B\subseteq \upset_S\bigwedge_S B \subseteq \upset_S x = \upset x\cap S$.

Assume these functions form a Galois connection. In order to obtain a contradiction, assume there exists a $D\subseteq S$ such that $\bigwedge_P D$ does not exist or is larger than $\bigwedge_S D$ (it can never be smaller). In both cases this means there exists a lower bound $y$ of $D$ in $P$ that is larger than $\bigwedge_S D$.

Then $(\upset y)\cap S \supseteq (\upset \bigwedge_S D)\cap S \supseteq D$, but $y\geq \bigwedge_S D$.
\end{proof}

\subsection{Projection onto a complete subsemilattice}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset such that $\sSet{S,\leq}$ is a complete $\wedge$-semilattice. Then the \udef{(upper) order projection} on $S$ is the function
\[ P_S^u: P \to S: x\mapsto \bigwedge(\upset x\cap S). \]
\end{definition}

\begin{lemma}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset that is a complete $\wedge$-semilattice. The upper order projection $P_S^u$ is
\begin{enumerate}
\item idempotent;
\item order-preserving.
\end{enumerate}
Also $P_S^u$ is expansive \textup{if and only if} for all $D\subseteq S$: $\bigwedge_S D = \bigwedge_P D$.
\end{lemma}
\begin{proof}
(1) Assume $x\in S$. Then $x\in (\upset x \cap S)$ and $x$ is a lower bound of $(\upset x \cap S)$, so $P_S^u(x) = x$.

(2) Assume $x \leq y$. Then $\upset x \supseteq \upset y$, so $\upset x\cap S \supseteq \upset y\cap S$ and $\bigwedge(\upset x\cap S) \subseteq \bigwedge(\upset y\cap S)$.


\end{proof}



\chapter{Lattices}
\url{file:///C:/Users/user/Downloads/Gr%C3%A4tzer,%20George%20-%20General%20lattice%20theory-Birkh%C3%A4user%20(2007).pdf}
\url{file:///C:/Users/user/Downloads/R.%20Padmanabhan,%20S.%20Rudeanu%20-%20Axioms%20for%20lattices%20and%20Boolean%20algebras-World%20Scientific%20(2008).pdf}
\begin{definition}
A \udef{lattice} is an algebraic structure $\seq{L,\vee, \wedge}$, where $\vee, \wedge$ are binary operations on the set $L$ such that $\seq{L,\vee}$ and $\seq{L,\wedge}$ are semilattices and $\vee,\wedge$ are linked by the absorption law:
\[ \forall a,b\in L: \; a \vee (a \wedge b) = a = a \wedge (a\vee b). \]
We call
\begin{itemize}
\item $\sSet{L,\vee}$ the \udef{join-semilattice} and $a\vee b$ the \udef{join} of $a$ and $b$;
\item $\sSet{L,\wedge}$ the \udef{meet-semilattice} and $a\wedge b$ the \udef{meet} of $a$ and $b$.
\end{itemize}
We call a lattice \udef{bounded} if both the join- and the meet-semilattice are bounded. We denote
\begin{itemize}
\item the identity of the join-semilattice by $\bot$;
\item the identity of the meet-semilattice by $\top$.
\end{itemize}
We denote the bounded lattice $\sSet{L, \vee, \wedge, \bot, \top}$.
\end{definition}
By \ref{absorptionIdempotency} the absortion law renders the axiom of  idempotency of the semilattices redundant. So we just need that $\seq{L,\vee}$ and $\seq{L,\wedge}$ are commutative semigroups that are linked by the absorption law.

\begin{proposition}
Observations from universal algebra:
\begin{enumerate}
\item Subset closed under $\vee,\wedge$ is sublattice.
\item Product lattices
\item Inverse of homomorphism is homomorphism
\end{enumerate}
\end{proposition}

\begin{example}
\begin{itemize}
\item Let $X$ be a set. Then $\mathcal{P}(X)$ ordered by inclusion is a lattice and $\cup, \cap$ are the corresponding join and meet operations.

In particular, for all $A,B\in \mathcal{P}(X)$:
\begin{enumerate}
\item $\inf\{A,B\} = A\cap B$;
\item $\sup\{A,B\} = A\cup B$.
\end{enumerate}
\item The natural numbers forms a lattice if ordered by division. The meet and join are given by
\[ m\vee n = \lcm\{m,n\} \qquad \text{and}\qquad m\wedge n = \gcd\{m,n\}. \]
\end{itemize}
\end{example}

\section{Lattices and order}
As for semilattices, we can equivalently characterise lattices as posets with certain conditions.
\begin{proposition}
Let $L$ be a set.
\begin{enumerate}
\item If $\seq{L,\vee, \wedge}$ is a lattice, then $\seq{L,\leq}$ is a poset such that every two element set has a supremum and an infimum, where
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\vee y = y \]
or, equivalently,
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\wedge y = x. \]
\item If $\seq{L,\leq}$ is a poset such that every two element set has a supremum and an infimum, then $\seq{L,\vee, \wedge}$ is a lattice, where
\[ \forall x,y\in L: \; x\vee y = \sup\{x,y\} \quad \text{and} \quad x\wedge y = \inf\{x,y\}. \]
\end{enumerate}
The order can also be defined by
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\wedge y = x. \]
\end{proposition}
\begin{proof}
Mostly this follows from \ref{orderSemilattice}. We just need to show the two definitions of order are equivalent. This follows from the absorption law:
\begin{align*}
x\vee y &= y \implies x\wedge y = x\wedge (x\vee y) = x \\
x\wedge y &= x \implies x\vee y = (x\wedge y) \vee y = y.
\end{align*}
\end{proof}

\begin{lemma} \label{orderLatticeLemma}
Let $L$ be a lattice and $a,b,c,d\in L$. If $a\leq b$ and $c\leq d$, then
\[ a\vee c\leq b\vee d \qquad\text{and}\qquad a\wedge c \leq b\wedge d. \]
\end{lemma}
\begin{proof}
If $a\leq b$ and $c\leq d$, then we have
\[ \begin{cases}
a = a\wedge b \\ c = c\wedge d
\end{cases} \quad \text{and} \quad \begin{cases}
b = a\vee b \\ d = c\vee d.
\end{cases}\]
We calculate
\[ (a\vee c)\wedge (b\vee d) = (a\vee c)\wedge (a\vee b\vee c\vee d) = (a\vee c)\wedge \big((a\vee c)\vee (b\vee d)\big) = a\vee c, \]
so $a\vee c\leq b\vee d$.
Similarly
\[ (a\wedge c)\vee (b\wedge d) = (a\wedge b\wedge c\wedge d)\vee (b\wedge d) = \big((a\wedge c)\wedge (b\wedge d)\big)\vee (b\wedge d) = b\wedge d, \]
so $a\wedge c \leq b\wedge d$.
\end{proof}
\begin{corollary} \label{orderLatticeCorollary}
Let $L$ be a lattice and $a,b,c,d\in L$. Then
\begin{enumerate}
\item if $a\leq b$ then $a\vee c \leq b \vee c$ and $a\wedge c \leq b\wedge c$;
\item if $a\leq c$ and $b\leq c$, then $a\vee b \leq c$;
\item if $a\leq b$ and $a\leq c$, then $a\leq b\wedge c$.
\end{enumerate}
\end{corollary}
\begin{corollary} \label{unionIntersectionIntervals}
Let $L$ be a lattice and $a,b,c,d\in L$. Then
\begin{enumerate}
\item $\interval{a, b} \cap \interval{c,d} \subseteq \interval{a\vee c, b\wedge d}$;
\item $\interval{a, b} \cup \interval{c,d} \subseteq \interval{a\wedge c, b\vee d}$.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) Take $x\in \interval{a, b} \cap \interval{c,d}$. Then $a\leq x$ and $c \leq x$, so $a\vee c \leq x$. Similarly $x \leq b\wedge d$.

(2) Take $x\in \interval{a, b} \cup \interval{c,d}$. Then either $a \leq x$ or $c \leq x$. In both cases $a\wedge c \leq x$. Similarly $x  \leq b \vee d$.
\end{proof}
\begin{corollary} \label{boundsSetsClosedUnderLatticeOperations}
Let $L$ be a lattice and $A\subseteq L$. Then $A^\leq$ and $A^\geq$ are closed under meets and joins.
\end{corollary}
\begin{proof}
First consider $A^\leq$ and take $x,y\in A^\leq$. Then $x\vee y \in A^\leq$, since $A^\leq$ is upwards closed. To prove $x\wedge y \in A^\leq$, take arbitrary $a\in A$. Then $a \leq x$ and $a\leq y$ by assumption. By the previous corollary, we have $a \leq x\wedge y$. Since the choice of $a\in A$ was arbitrary, we have $x\wedge y \in A^\leq$.

The argument for $A^\geq$ is dual.
\end{proof}
\begin{corollary} \label{orderPolarOfLatticeOperations}
Let $L$ be a lattice and $A,B\subseteq L$ subsets. Then
\begin{enumerate}
\item $A^\leq \vee B^\leq \subseteq \big(A\vee B\big)^\leq$;
\item $A^\leq \wedge B^\leq \subseteq \big(A\wedge B\big)^\leq$;
\item $A^\geq \vee B^\geq \subseteq \big(A\vee B\big)^\geq$;
\item $A^\geq \wedge B^\geq \subseteq \big(A\wedge B\big)^\geq$.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) Take arbitrary $x\vee y \in A^\leq \vee B^\leq$. Now take arbitrary $a\vee b\in A\vee B$. Then $a \leq x$ and $b\leq y$. By the lemma, we have $a\vee b \leq x\vee y$. Since $a\vee b$ was chosen arbitrarily from $A\vee B$, we have $x\vee y \in \big(A\vee B\big)^\leq$.

(2) Take arbitrary $x\wedge y \in A^\leq \wedge B^\leq$. Now take arbitrary $a\wedge b\in A\vee B$. Then $a \leq x$ and $b\leq y$. By the lemma, we have $a\wedge b \leq x\wedge y$. Since $a\wedge b$ was chosen arbitrarily from $A\wedge B$, we have $x\wedge y \in \big(A\wedge B\big)^\leq$.

(3) Dual to (2).

(4) Dual to (1).
\end{proof}


\begin{lemma} \label{cancellationGeneralLattices}
Let $L$ be a lattice and $a,b\in L$. If for all $x\in L$: $a\vee x = b\vee x$ and $a\wedge x = b\wedge x$, then $a = b$.
\end{lemma}
\begin{proof}
Setting $x = a$ gives $a = a\vee b$ and $a = a\wedge b$. Thus $a \leq b$ and $b \leq a$, meaning $a = b$.
\end{proof}

\begin{proposition}[Mini-max theorem]
Let $L$ be a lattice and let $\seq{a_{i,j}}\subset L$ be indexed by $i,j\in \N$. Then
\[ \bigvee_{j=1}^n \left(\bigwedge_{i=1}^m a_{i,j}\right) \leq \bigwedge_{i=1}^m \left(\bigvee_{j=1}^n a_{i,j}\right). \]
\end{proposition}
\begin{proof}
For all $k,l$ we have $a_{k,l}\leq \bigvee_{j=1}^n a_{k,j}$. This implies $\bigwedge_{i=1}^m a_{i,l} \leq \bigwedge_{i=1}^m \left(\bigvee_{j=1}^n a_{i,j}\right)$ for all $l$. Taking the supremum over $l$ gives the result.
\end{proof}
\begin{corollary} \label{firstMiniMaxCorollary}
Let $L$ be a lattice and $a,b,c,d \in L$, then
\[ (a\wedge b)\vee (c\wedge d) \leq (a\vee c)\wedge (b\vee d). \]
\end{corollary}
\begin{proof}
Use $a_{i,j} = \begin{pmatrix}
a & c \\ b & d
\end{pmatrix}$.
\end{proof}
\begin{corollary}[Median inequality]
Let $L$ be a lattice and $a,b,c \in L$, then
\[ (a\wedge b) \vee (b\wedge c) \vee (c\wedge a) \leq (a\vee b)\wedge (b\vee c) \wedge (c\vee a). \]
\end{corollary}
\begin{proof}
Use $a_{i,j} = \begin{pmatrix}
a & b & a \\ b & b & c \\ a & c & c
\end{pmatrix}$.
\end{proof}
\begin{corollary}[Distributive inequalities] \label{distributiveInequality}
Let $L$ be a lattice and $a,b,c \in L$, then
\begin{align*}
(a\wedge b)\vee (a\wedge c) &\leq a\wedge (b \vee c); \\
(a\vee b)\wedge (a\vee c) &\geq a\vee (b \wedge c).
\end{align*}
In particular this also means
\[ c \leq a \implies (a\wedge b)\vee c \leq a\wedge (b\vee c).  \]
\end{corollary}
\begin{proof}
Use $a_{i,j} = \begin{pmatrix}
a & a \\ b & c 
\end{pmatrix}$ and $a_{i,j} = \begin{pmatrix}
a & b \\ a & c 
\end{pmatrix}$. The particular cases follow because in this case $a\wedge c = c$. This statement is self-dual.
\end{proof}
The distributive inequalities are fairly elementary and do not need to be derived from mini-max theorem. 
In fact they are corollary to the following lemma which can be obtained by more elementary means:
\begin{lemma} \label{UpperLowerBoundsMeetJoin}
Let $L$ be a lattice $x\in L$ and $S\subseteq L$ a subset. Then
\begin{enumerate}
\item $S^u\vee x \subseteq (S\vee x)^u$ and $S^l\vee x \subseteq (S\vee x)^l$;
\item $S^u\wedge x \subseteq (S\wedge x)^u$ and $S^l\wedge x \subseteq (S\wedge x)^l$.
\end{enumerate}
\end{lemma}
\begin{proof}
The maps $y\mapsto y\vee x$ and $y\mapsto y \wedge x$ are order-preserving, so we can use \ref{imagePolars}.
\end{proof}
\begin{corollary}[Infinite distributive inequalities] \label{infiniteDistributiveInequalities}
Let $L$ be a lattice $x\in L$ and $S\subseteq L$ a subset. Assume all relevant suprema exist, then
\begin{enumerate}
\item if $\sup(S)$ exists, then $\sup(S) \wedge x$ is an upper bound of $S\wedge x$;
\item if $\inf(S)$ exists, then $\inf(S) \vee x$ is a lower bound of $S\vee x$.
\end{enumerate}
In particular,
\begin{enumerate} \setcounter{enumi}{2}
\item $\sup(S)\wedge x \geq \sup(S \wedge x)$;
\item $\inf(S)\vee x \leq \inf(S \vee x)$;
\end{enumerate}
if the relevant suprema / infima exist.
\end{corollary}
\begin{proof}
Because $\sup(S)\in S^u$, we have $\sup(S)\wedge x \in S^u\wedge x$, so $\sup(S)\wedge x \in (S\wedge x)^u$. The second part is dual.

Points (3), (4) are then immediate.
\end{proof}
In particular if $S$ has two elements, we recover the distributive inequalities.

\begin{proposition} \label{latticeIntervalIntersection}
Let $L$ be a lattice and $a,b,c,d\in L$. Then
\[ \interval{a,b} \cap \interval{c,d} = \interval{a\vee c, b\wedge d}. \]
\end{proposition}
\begin{proof}
First take $x\in \interval{a,b} \cap \interval{c,d}$. Then $a\leq x$ and $c\leq x$, so $a\vee c \leq x$ by \ref{orderLatticeCorollary}. Similarly $x\leq b\wedge d$, so $x\in\interval{a\vee c, b\wedge d}$.

Now take $x\in\interval{a\vee c, b\wedge d}$. We have
\begin{align*}
a\leq a\vee c &\leq x &  x&\leq b\wedge d \leq b \\
c\leq a\vee c &\leq x &  x&\leq b\wedge d \leq d,
\end{align*}
so $x\in \interval{a,b} \cap \interval{c,d}$.
\end{proof}
\begin{corollary}
Let $L$ be a lattice. Then the set of intervals in $L$ is a $\cap$-subsemilattice of $\sSet{\powerset(L), \subseteq}$.
\end{corollary}

\section{Complete lattices}
\begin{lemma}
Let $L$ be a lattice. For every finite set $S\subset L$, $\sup(S)$ and $\inf(S)$ exist.
\end{lemma}
\begin{definition}
Let $L$ be a lattice. We call $L$ a \udef{complete lattice} if each subset $S\subseteq L$ has both a supremum and an infimum. We write
\[ \sup(S) = \bigvee S \qquad \inf(S) = \bigwedge S. \]
If we want to emphasise that the supremum/infimum of $S$ is taken as a subset of $L$, we write $\bigvee_L S$ and $\bigwedge_L S$.
\end{definition}
Clearly every finite lattice is complete.

\begin{lemma} \label{supInfFiniteSubsetsLattice}
Let $L$ be a lattice and $F\subseteq L$ a finite subset. Then $\bigvee F$ and $\bigwedge F$ exist. 
\end{lemma}

\begin{example}
For any set $X$, $\powerset(X)$ is a complete lattice.
\end{example}

\begin{lemma}
Let $P$ be an ordered set such that all relevant suprema and infima exist and $S,T\subseteq P$. Then
\begin{enumerate}
\item $\bigvee S \leq \bigwedge T$ if and only if $s\leq t$ for all $s\in S,t\in T$;
\item if $S\subseteq T$, then $\bigvee S \leq \bigvee T$ and $\bigwedge S \geq \bigwedge T$;
\item $\bigvee(S\cup T) = \left(\bigvee S\right)\vee \left(\bigvee T\right)$ and $\bigwedge(S\cup T) = \left(\bigwedge S\right)\wedge \left(\bigwedge T\right)$.
\end{enumerate}
\end{lemma}

\begin{proposition}[Mini-max theorem for complete lattices]
Let $L$ be a complete lattice, $I,J$ index sets and $\setbuilder{a_{i,j}\in L}{i\in I, j\in J}$. Then
\[ \bigvee_{j\in J}\bigwedge_{i\in I}a_{i,j} \leq \bigwedge_{i\in I}\bigvee_{j\in J} a_{i,j}. \]
\end{proposition}
\begin{proof}
For all $k,l$ we have $a_{k,l}\leq \bigvee_{j\in J} a_{k,j}$. This implies $\bigwedge_{i\in I} a_{i,l} \leq \bigwedge_{i\in I}\bigvee_{j\in J} a_{i,j}$ for all $l$. Taking the supremum over $l$ gives the result.
\end{proof}

\begin{proposition} \label{completeLatticeBasic}
Let $P$ be a non-empty ordered set. Then the following are equivalent:
\begin{enumerate}
\item $P$ is a complete lattice;
\item $\bigvee S$ exists for all subsets $S\subseteq P$;
\item $\bigwedge S$ exists for all subsets $S\subseteq P$;
\item $P$ has a bottom element $\bot$ and $\bigvee S$ exists for all non-empty $S\subseteq P$;
\item $P$ has a top element $\top$ and $\bigwedge S$ exists for all non-empty $S\subseteq P$;
\item for all $x\in P$ both $\upset x$ and $\downset x$ are complete lattices.
\end{enumerate}
\end{proposition}
\begin{proof}
The only difficult implication is $(5)\Rightarrow (1)$. All infima exist because $\inf(\emptyset) = \top \in P$. New each non-empty set $S$ in $P$ has an upper bound, $\top$, so $\bigvee S$ exists in $P$ by \ref{existenceSupremaInfima}. Finally $\bigvee \emptyset = \bot = \bigwedge P \in P$.
\end{proof}

\begin{theorem}[Knaster-Tarski fixed-point theorem]
Let $L$ be a complete lattice and $f:L\to L$ an order-preserving map. Then 
\[ \bigvee \setbuilder{x\in L}{x\leq f(x)} \qquad\text{and}\qquad \bigwedge \setbuilder{x\in L}{x\geq f(x)} \]
are, resp., the greatest and the least fixed point of $f$.
\end{theorem}
\begin{proof}
This is just two applications of the semilattice formulation of the Knaster-Tarski theorem, \ref{KnasterTarskiSemilattice}, once for the join-semilattice and once for the meet-semilattice.
\end{proof}
\begin{corollary}
The set of fixed points of $f$ forms a complete lattice.
\end{corollary}
\begin{proof}
Let $P$ be the set of fixed points. To show $P$ is a complete lattice, take any subset $S\subset P$.
Set $w = \bigvee S$, where $S$ is considered as a subset of $L$. For all $x\in W$: $x\leq w$, which implies $x=f(x)\leq f(w)$. As $w$ is the least upper bound, we have $w\leq f(w)$. This implies $f[\upset w]\subseteq \upset w$, meaning we can view $f$ as a function on the complete lattice $\upset w$. In particular $f|_{\upset w}$ has a least fixed point by the theorem, so $S$ has a supremum in $P$. The existence of the infimum is dual.
\end{proof}
\begin{corollary}[Banach decomposition theorem]
Let $X,Y$ be sets and $f:X\to Y$ and $g:Y\to X$ functions. There exist partitions $X_1,X_2$ and $Y_1,Y_2$ of $X$ and $Y$ such that
\[ f^\imf(X_1) = Y_1 \qquad\text{and}\qquad g^\imf(Y_2) = X_2. \]
\end{corollary}
\begin{proof}
Consider the map $F: \powerset(X)\to\powerset(X): S\mapsto X\setminus g^\imf\big(Y\setminus f^\imf(S)\big)$. By the theorem this map has a fixed point, which we call $X_1$. We then need to set $Y_1 = f^\imf(X_1), X_2 = X\setminus X_1$ and $Y_2 = Y\setminus Y_1$. The fact $X_1$ is a fixed point means that $X_1 = X\setminus g^\imf\big(Y\setminus f^\imf(X_1)\big) = g^\imf(Y\setminus Y_1) = g^\imf(Y_2)$.
\end{proof}
\begin{corollary}[Schrder-Bernstein]
Let $X,Y$ be sets and $f:X\rightarrowtail Y$ and $g:Y\rightarrowtail X$ injective functions. Then there exists a bijective function $h: X\twoheadrightarrowtail Y$.
\end{corollary}
\begin{proof}
Use the Banach decomposition theorem to obtain partitions $X_1,X_2$ and $Y_1,Y_2$. Then $f|_{X_1}: X_1\twoheadrightarrowtail Y_1$ and $g|_{Y_2}: Y_2 \twoheadrightarrowtail X_2$ are bijective, so we can construct
\[ h: X\twoheadrightarrowtail Y: x \mapsto \begin{cases}
f(x) & x\in X_1 \\ (g|_{Y_2})^{-1}(x) & x\in X_2
\end{cases}. \]
\end{proof}
The Schrder-Bernstein theorem was already proven in \ref{SchroederBernstein}.

\begin{theorem}
Let $L$ be a lattice. Then $L$ is complete \textup{if and only if} all isotone maps $f: L\to L$ have a fixed point.
\end{theorem}
TODO: do we need lattice? Can we use poset?
\begin{proof}
See Nation's lecture notes p.24
\end{proof}

\subsection{Complete subsemilattices}
Let $L$ be a complete lattice and $S\subseteq L$ a subset. Then
\begin{itemize}
\item $S$ is a complete $\wedge$-subsemilattice if it is closed under arbitrary meets;
\item $S$ is a complete $\vee$-subsemilattice if it is closed under arbitrary joins.
\end{itemize}

\begin{lemma}
Let $L$ be a complete lattice and $S\subseteq L$ a subset. Then
\begin{enumerate}
\item $S$ is a complete $\wedge$-subsemilattice \textup{if and only if} $\incl_S: S\hookrightarrow L$ is an upper adjoint;
\item $S$ is a complete $\vee$-subsemilattice \textup{if and only if} $\incl_S: S\hookrightarrow L$ is a lower adjoint.
\end{enumerate}
\end{lemma}

\begin{proposition} \label{completeSubsemilatticeClosure}
Let $L$ be a complete lattice and $S\subseteq L$ a subset.
\begin{enumerate}
\item If $S$ is closed under arbitrary meets, then
\begin{enumerate}
\item $\incl_S: S\hookrightarrow L$ is an upper adjoint;
\item its lower adjoint is given by $L\to S: x\mapsto \bigwedge (\upset \{x\} \cap S)$;
\item $S$ with the subset ordering is a complete lattice.
\end{enumerate}
\item If $S$ is closed under arbitrary joins, then
\begin{enumerate}
\item $\incl_S: S\hookrightarrow L$ is a lower adjoint;
\item its upper adjoint is given by $L\to S: x\mapsto \bigvee (\downset \{x\} \cap S)$;
\item $S$ with the subset ordering is a complete lattice.
\end{enumerate}
\end{enumerate}
\end{proposition}
\begin{proof}
TODO

note: $\incl^{\preimf}(A) = A\cap S$ and compare \ref{GaloisConnectionLatticePreservation}.
\end{proof}

\begin{note}
Note:
Closure under arbitrary meets means having the same top and closure under arbitrary joins means habing the same bottom!! This is because $\bigwedge \emptyset = \top$ and $\bigvee \emptyset = \bot$.
\end{note}

\begin{proposition}
Every complete lattice $L$ is isomorphic to
\begin{enumerate}
\item a complete $\wedge$-subsemilattice of $\powerset(A)$ for some set $A$;
\item a complete $\vee$-subsemilattice of $\powerset(A)$ for some set $A$.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO. By \ref{orderedSetPowerset} $L$ is isomorphic to some subposet of $\powerset(A)$. Compare \ref{MooreFamily}.
\end{proof}

\begin{proposition} \label{intersectionCompleteSemilatticesCompleteSemilattice}
Let $P$ be a poset and $L_1, L_2 \subseteq P$ two complete $\wedge$-subsemilattices. Then $L_1\cap L_2$ is a complete $\wedge$-subsemilattice.
\end{proposition}
\begin{proof}
Take $A \subseteq L_1\cap L_2$. Then $\bigwedge_{P}A = \bigwedge_{L_1}A = \bigwedge_{L_2}A$, which is an element of both $L_1$ and $L_2$. Thus $\bigwedge_{P}A \in L_1\cap L_2$.
\end{proof}

\subsection{Chain conditions}
TODO: move!

The following requires dependent choice:
\begin{proposition} \label{ascendingDescendingChainLattice}
Let $L$ be a lattice. Then
\begin{enumerate}
\item if $L$ satisfies the ascending chain condition, then for all non-empty subsets $S\subset L$ there exists a finite set $F\subset L$ such that $\bigvee S = \bigvee F$;
\item if $L$ satisfies the descending chain condition, then for all non-empty subsets $S\subset L$ there exists a finite set $F\subset L$ such that $\bigwedge S = \bigwedge F$;
\item if $L$ has a bottom element and satisfies the ascending chain condition, then $L$ is complete;
\item if $L$ has a top element and satisfies the descending chain condition, then $L$ is complete;
\item if $L$ has no infinite chains, then $L$ is complete.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Assume $L$ satisfies the ascending chain condition and let $S\subset L$ be non-empty. Define
\[ B = \setbuilder{\bigvee G}{\text{$G$ is a finite, non-empty subset of $S$}}. \]
This is well-defined by \ref{supInfFiniteSubsetsLattice}. Then $B$ has a maximal element $m = \bigvee F$ for some finite $F$ by \ref{welfoundedACC}.

Now $m$ is an upper bound of $S$. Indeed, let $x\in S$. Then $m= \bigvee F \leq \bigvee (F\cup\{x\})$ because $F\subseteq (F\cup \{x\})$. Since $m$ is maximal in $B$, we have $m = \bigvee (F\cup\{x\}) \geq x$. It is clearly also the least upper bound, otherwise it was not the least upper bound of $F$.

(2) Dual of 1.

(3) This follows from 1. and \ref{completeLatticeBasic}.

(4) Dual of 3.

(5) A lattice with no infinite chains satisfies the ascending chain condition. Also a lattice
with no infinite chains has a bottom element. (TODO: need dependent/countable choice?)
\end{proof}

\begin{proposition} \label{joinIrreducibilityDescendingChainLattice}
Let $L$ be a lattice satisfing the descending chain condition. Then
\begin{enumerate}
\item $\forall a,b\in L:\; a\nleq b \implies \exists x\in \joinIr(L): \; x\leq a$ and $x\nleq b$;
\item $\forall a\in L:\; a = \bigvee\setbuilder{x\in\joinIr(L)}{x\leq a}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Set $S = \setbuilder{x\in L}{\text{$x\leq a$ and $x\nleq b$}}$, which is non-empty and thus contains a minimal element $m$ by \ref{welfoundedACC}. We claim $m$ is join-irreducible. Assume, towards a contradiction, $x = c\vee d$ and $c < x > d$. By minimality of $x$, $c,d\notin S$. As $c,d< x \leq a$, we must have $c,d\leq b$. But this means $x\leq b$, so $x\notin S$ which is a contradiction.

(2) Set $T = \setbuilder{x\in\joinIr(L)}{x\leq a}$. Clearly $a$ is an upper bound of $T$. To see that it is the least upper bound, take a different upper bound $c$. Assume, towards a contradiction, that $a\nleq c$. Then $a\nleq a\wedge c$. By point 1. there exists an $x\in\joinIr(L)$ such that $x\leq a$ (meaning $x\in T$) and $x\nleq a\wedge c$. But if $c$ were an upper bound of $T$, then $x\leq a\wedge c$, which is a contradiction.
\end{proof}

\begin{proposition}
Let $L$ be a lattice.
\begin{enumerate}
\item If $L$ satisfies the descending chain condition, then any subset $Q\supseteq \joinIr(L)$ is join-dense in $L$.
\item If $L$ satisfies the ascending chain condition and $Q$ is join-dense in $L$, then for all $a\in L$ there exists a finite subset $F$ of $Q$ such that $a = \bigvee F$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) is a corollary of \ref{joinIrreducibilityDescendingChainLattice}. (2) is a corollary of \ref{ascendingDescendingChainLattice}.
\end{proof}
\begin{corollary}
Let $L$ be a lattice with no infinite chains. Then
\begin{enumerate}
\item for each $a \in L$, there exists a finite subset $F$ of $\joinIr(L)$ such that $a = F$.
\item $Q\subseteq L$ is join-dense in $L$ if and only if $Q \supseteq \joinIr(L)$.
\end{enumerate}
\end{corollary}
\begin{proof}
If $L$ has no finite chains, then it satisfies the ascending and descending chain conditions.

Only the $\Rightarrow$ direction of (2) is not immediately obvious. Assume $Q$ is join-dense and let $x\in \joinIr(L)$. By the proposition there exists a finite $F\subseteq Q$ such that $x = \bigvee F$. Since $x$ is join-irreducible, we have $x \in F$ and hence $x \in Q$. Thus, $\joinIr(L) \subseteq Q$.
\end{proof}

\section{Moore closures and dual closures}

\begin{lemma} \label{completeSubsemilattices}
Let $L$ be a lattice and $A\subseteq L$ a subposet that is a complete lattice. Then
\begin{enumerate}
\item the following are equivalent:
\begin{enumerate}
\item $A$ is a complete $\wedge$-subsemilattice;
\item $\incl_A: A\hookrightarrow L$ preserves arbitrary meets;
\item the inclusion function $\incl_A: A\hookrightarrow L$ has a lower adjoint;
\end{enumerate}
in this case, the lower adjoint is the function
\[ L \to A: x \mapsto \bigwedge \setbuilder{y\in A}{x\leq y}; \]
\item the following are equivalent:
\begin{enumerate}
\item $A$ is a complete $\vee$-subsemilattice;
\item $\incl_A: A\hookrightarrow L$ preserves arbitrary joins;
\item the inclusion function $\incl_A: A\hookrightarrow L$ has an upper adjoint;
\end{enumerate}
in this case, the upper adjoint is the function
\[ L \to A: x \mapsto \bigvee \setbuilder{y\in A}{y\leq x}. \]
\end{enumerate}
\end{lemma}
Note that the meet and join in the adjoints can be taken either in $A$ or in $L$ (due to points (a)).
\begin{proof}
(1) Take $B\subseteq A$. We have $\bigwedge_A B = \incl_A\Big(\bigwedge_A B\Big)$ and $\bigwedge_L B = \bigwedge_L \incl_A^{\imf}(B)$. Consider
\[ \begin{tikzcd}
\bigwedge_A B \ar[r, equal, "{?}"] \ar[d, equal] & \bigwedge_L B \ar[d, equal] \\
\incl_A\Big(\bigwedge_A B\Big) \ar[r, equal, "{?}"] & \bigwedge_L \incl_A^{\imf}(B)
\end{tikzcd}. \]
It is clear that the top equality holds if and only if the bottom equality holds.

The top equality holding for all $B\subseteq A$ is equivalent to $A$ being a complete $\vee$-subsemilattice. The botting equality holding for all $B\subseteq A$ is equivalent to $\incl_A: A\hookrightarrow L$ preserving arbitrary meets. Thus $(a)$ and $(b)$ are equivalent.

We have that $(b)$ and $(c)$ are equivalent by \ref{GaloisConnectionLatticePreservation}.


The form of the adjoint is given by \ref{GaloisConnectionLatticePreservation} and the fact that $\incl_A^\preimf(B) = A\cap B$.

(2) Dual.
\end{proof}

\begin{note}
Let $P$ be a poset and $A\subseteq P$ a complete $\wedge$-subsemilattice. Then $P$ has a top $\top$ and $\top \in A$. This follows because $\emptyset \subset A$. Thus $\bigwedge_A \emptyset = \bigwedge_P \emptyset = \top$.

Similarly $\bot\in A$ if $A\subseteq P$ is a complete $\vee$-subsemilattice.
\end{note}

\begin{definition}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ a function. We call $f$
\begin{itemize}
\item a \udef{Moore closure operator} if $f$ is
\begin{itemize}
\item order-preserving;
\item expansive, i.e.\ $x \leq f(x)$ for all $x\in P$;
\item idempotent, i.e.\ $f = f^2$;
\end{itemize}
\item \udef{Moore dual closure operator} if $f$ is
\begin{itemize}
\item order-preserving;
\item contractive, i.e.\ $f(x) \leq x$ for all $x\in P$;
\item idempotent, i.e.\ $f = f^2$.
\end{itemize}
\end{itemize}
A pairing $\sSet{P,f}$ of a poset $P$ and a Moore closure $f$ on $P$ is called a \udef{(Moore) closure space}. A \udef{(Moore) dual closure space} is defined similarly.
\end{definition}

\begin{lemma} \label{idempotencyMooreClosureLemma}
Let $P$ be a poset, $f: P\to \im(f)$ a Moore closure or Moore dual closure and $x\in P$. Then $f(x) = x$ \textup{if and only if} $x\in \im(f)$.
\end{lemma}
\begin{proof}
Immediate consequence of idempotency.
\end{proof}

\begin{proposition} \label{MooreClosureGaloisConnection}
Let $P$ be a poset and $f: P\to \im(f)\subseteq P$ a function. Then
\begin{enumerate}
\item $f$ is a Moore closure operator \textup{if and only if}
$\big(f|^{\im(f)}:P\to \im(f),\, \incl_{\im(f)}: \im(f)\to P\big)$ is a Galois connection;
\item $f$ is a Moore dual closure operator \textup{if and only if} $\big(\incl_{\im(f)}: \im(f)\to P,\, f|^{\im(f)}:P\to \im(f)\big)$ is a Galois connection.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Suppose $f$ is a Moore closure operator. Take $x\in P$ and $y\in \im(f)$. Then, using \ref{idempotencyMooreClosureLemma},
\[ x\leq y \implies f(x)\leq f(y) \implies f(x) \leq y \implies x\leq f(x)\leq y \implies x\leq y. \]
Since $x\leq y \iff x\leq \iota_{\im(f)}(y)$, this implies $x\leq \iota_{\im(f)}(y) \iff f(x) \leq y$.

Now suppose $\big(f|^{\im(f)}, \incl_{\im(f)}\big)$ is a Galois connection. Then $f$ is order-preserving by definition.

We have $x \leq (\iota_{\im(f)}\circ f)(x) = f(x)$ for all $x\in P$ by \ref{preorderGaloisCondition}.

Finally we have $f|^{\im(f)}\circ \iota_{\im(f)}\circ f|^{\im(f)} = f|^{\im(f)}$ by \ref{preorderGaloisCondition}, so, for all $x\in P$, we have
\[ f(x) = f|^{\im(f)}(x) = \big(f|^{\im(f)}\circ \iota_{\im(f)}\circ f|^{\im(f)}\big)(x) = f^2(x). \]

(2) Dual.
\end{proof}

\begin{lemma} \label{closureContinuityJoin}
Let $P$ be a poset, $f: P\to \im(f)\subseteq P$ a Moore closure and $A\subseteq P$ such that both $\bigvee_P A$ and $\bigvee_P f^\imf(A)$ exist. Then
\[ f\Big(\bigvee_P A\Big) = f\Big(\bigvee_P f^\imf(A)\Big). \]
\end{lemma}
\begin{proof}
Clearly $\bigvee_P A \leq \bigvee_P f^\imf(A)$, so $f\Big(\bigvee_P A\Big) \leq f\Big(\bigvee_P f^\imf(A)\Big)$.

For the other inequality, take arbitrary $a\in A$. Then $a\leq \bigvee_P A$, so $f(a) \leq f\Big(\bigvee_P A\Big)$. Since this holds for all $a\in A$, we have that $f\Big(\bigvee_P A\Big)$ is an upper bound of $f^\imf(A)$ and thus $\bigvee_P f^\imf(A) \leq f\Big(\bigvee_P A\Big)$. This implies
\[ f\Big(\bigvee_P f^\imf(A)\Big) \leq f^2\Big(\bigvee_P A\Big) = f\Big(\bigvee_P A\Big). \]
\end{proof}

\begin{proposition} \label{meetJoinImageMooreClosure}
Let $P$ be a poset, $f: P\to \im(f)\subseteq P$ a function and $A\subseteq \im(f)$. Then
\begin{enumerate}
\item if $f$ is a Moore closure, then
\begin{enumerate}
\item if $\bigvee_P A$ exists, then $\bigvee_{\im(f)}A$ exists and $\bigvee_{\im(f)}A = f\Big(\bigvee_P A\Big)$;
\item $\bigwedge_P A$ exists \textup{if and only if} $\bigwedge_{\im(f)} A$ exists, and in this case $\bigwedge_{\im(f)} A = \bigwedge_P A$;
\end{enumerate}
\item if $f$ is a dual Moore closure, then
\begin{enumerate}
\item $\bigvee_P A$ exists \textup{if and only if} $\bigvee_{\im(f)}A$ exists, and in this case $\bigvee_{\im(f)}A = \bigvee_P A$;
\item if $\bigwedge_P A$ exists, then $\bigwedge_{\im(f)} A$ exists and $\bigwedge_{\im(f)} A = f\Big(\bigwedge_P A\Big)$.
\end{enumerate}
\end{enumerate}
In both cases,
\begin{enumerate} \setcounter{enumi}{2}
\item if $P$ is a lattice, then $\im(f)$ is a lattice;
\item if $P$ is a complete lattice, then $\im(f)$ is a complete lattice.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have that $f$ preserves joins by \ref{MooreClosureGaloisConnection} and \ref{residuationPreservesSupInf}. Thus, if $\bigvee_P A$ exists, we have that $\bigvee_{\im(f)}f^{\imf}(A)$ exists and
\[ f\Big(\bigvee_P A\Big) = \bigvee_{\im(f)}f^{\imf}(A) = \bigvee_{\im(f)}A. \]
The last equality follows since $A\subseteq \im(f)$, and thus $A = f^\imf(A)$.

Now assume $\bigwedge_P A$ exists. Since $A = f^\imf(A)$, we have that $\bigwedge_P f^{\imf}(A)$ exists. Then, by \ref{mappingJoinsMeets}, we have
\[ \bigwedge_P A \leq f^\imf\Big(\bigwedge_P A\Big) \leq \bigwedge_P f^{\imf}(A) = \bigwedge_P A. \]
This implies that $\bigwedge_P A\in\im(f)$. We claim that $\bigwedge_P A$ is the meet of $A$ in $\im(f)$. Indeed, it is clearly a lower bound. Let $x$ be some other lower bound of $A$ in $\im(f)$, then it is a lower bound of $A$ in $P$ and so $x\leq \bigwedge_P A$. So $\bigwedge_{\im(f)} A = \bigwedge_P A$.

Finally, assume $\bigwedge_{\im(f)} A$ exists. We have that $\incl_{\im(f)}$ preserves meets by \ref{MooreClosureGaloisConnection}, so if $\bigwedge_{\im(f)} A$ exists, then
\[ \bigwedge_{\im(f)} A = \incl_{\im(f)}\Big(\bigwedge_{\im(f)} A\Big) = \bigwedge_P \incl_{\im(f)}^\imf(A) = \bigwedge_P A. \]

(2) Dual.

(3, 4) Immediate. 
\end{proof}
\begin{corollary} \label{antitoneCorrespondenceMooreClosuresCompleteSubsemilattices}
Let $L$ be a complete lattice. Then there exists an antitone similarity between the set of surjective Moore closures on $L$, ordered pointwise, and the set of complete $\wedge$-subsemilattices, ordered by inclusion. This similarity is given by
\[ \Phi: \{\text{complete $\wedge$-subsemilattices}\} \to \{\text{Moore closures on $L$}\}: A \mapsto \Big(L\to A: x\mapsto \bigwedge\setbuilder{y\in A}{x\leq y}\Big), \]
with inverse
\[ \Phi^{-1}: \{\text{Moore closures on $L$}\} \to \{\text{complete $\wedge$-subsemilattices}\}: f \mapsto \im(f). \]
\end{corollary}
\begin{proof}
If $A \subseteq L$ is a complete $\wedge$-subsemilattice. Then $\Phi(A)$ is a Moore closure by \ref{completeSubsemilattices} and \ref{MooreClosureGaloisConnection}. It is surjective by construction.
Suppose $f$ is a Moore closure, then $\Phi^{-1}(f) = \im(f)$ is a complete $\wedge$-subsemilattice by \ref{meetJoinImageMooreClosure}.

We now show that $\Phi^{-1}$ is really the inverse of $\Phi$. Let $f$ be a Moore closure and $A \subseteq L$ a complete $\wedge$-subsemilattice. 
Suppose $\Phi^{-1}(f) = A$. Then $(f, \incl_{A})$ is a Galois connection by \ref{MooreClosureGaloisConnection}, so $f = \Phi(A)$ by \ref{completeSubsemilattices} and uniqueness of the adjoint. 

Conversely, suppose $f = \Phi(A)$. Then $\im(f) = A$ by construction, so $\Phi^{-1}(f) = A$.

To show that $\Phi$ preserves and reflects the order, we can show that $\Phi^{-1}$ does. Take Moore closures $f,g$. First suppose $f \leq g$ pointwise. Take $x\in \im(g)$. Then $x\leq f(x) \leq g(x) = x$ by \ref{idempotencyMooreClosureLemma}. This implies $f(x) = x$ and thus that $x\in \im(f)$. So $\im(g) \subseteq \im(f)$.

Now suppose $\im(g) \subseteq \im(f)$ and take $x\in L$. Then we have $x\leq f(x)$, so $f(x) \leq (f\circ g)(x) = g(x)$, by \ref{idempotencyMooreClosureLemma} since $g(x) \in \im(f)$.
\end{proof}

\begin{example}
In point (1a) of \ref{meetJoinImageMooreClosure}, we do not have that the existence of $\bigvee_{\im(f)}A$ implies the existence of $\bigvee_P A$.

Let $P = \R\setminus\{0\}$ and
\[ f: \R\setminus\{0\} \to \interval[o]{-\infty, 0}\cup \interval[co]{1,+\infty}: x\mapsto \begin{cases}
x & \big(x\in \interval[o]{-\infty, 0}\cup \interval[co]{1,+\infty}\big) \\
1 & \big(x\in \interval[o]{0,1}\big).
\end{cases} \]
Then $f$ is a Moore closure and $\bigvee_{\im(f)}\interval[o]{-\infty, 0}$ exists and is equal to $1$. Clearly $\bigvee_{\R\setminus\{0\}}\interval[o]{-\infty, 0}$ does not exist.
\end{example}

\begin{proposition} \label{MooreClosureIntersectionCompleteSublattices}
Let $P$ be a poset and $L_1, L_2$ complete $\wedge$-subsemilattices with Moore closures $f_1$ and $f_2$. Suppose $f_1 \circ f_2 \circ f_1 = f_2\circ f_1$. Then $f_2\circ f_1$ is the Moore closure of $L_1\cap L_2$.
\end{proposition}
We know that $L_1\cap L_2$ is a complete $\wedge$-subsemilattice by \ref{intersectionCompleteSemilatticesCompleteSemilattice}.
\begin{proof}
We first check that $f_2\circ f_1$ is a Moore closure. Since it is a composition of order-preserving functions, it is order preserving.

Next we check that $f_2\circ f_1$ is expansive. Since $f_1$ is expansive and $f_2$ order-preserving, we have $x \leq f_1(x)$ and $f_2(x)\leq (f_2\circ f_1)(x)$. Since $f_2$ is expansive, we have $x \leq f_2(x) \leq (f_2\circ f_1)(x)$.

For the idempotency of $f_2\circ f_1$, we calculate
\[ (f_2\circ f_1)^2 = f_2\circ (f_1\circ f_2\circ f_1) = f_2 \circ (f_2 \circ f_1) = f_2^2 \circ f_1 = f_2 \circ f_1. \]

Finally we check $\im(f_2\circ f_1) = L_1\cap L_2$. Clearly $\im(f_2\circ f_1) \subseteq \im(f_2) = L_2$. Also $\im(f_2\circ f_1) = \im(f_1\circ f_2\circ f_1) \subseteq \im(f_1) = L_1$. So $\im(f_2\circ f_1) \subseteq L_1\cap L_2$. For the other inclusion, take $x\in L_1\cap L_2$. By \ref{idempotencyMooreClosureLemma}, we have $f_1(x) = x$ and $f_2(x) = x$, so $(f_2\circ f_1)(x) = x$ and $x\in \im(f_2\circ f_1)$.
\end{proof}

\begin{example}
Let $P$ be a poset and $L_1, L_2$ complete $\wedge$-subsemilattices with Moore closures $f_1$ and $f_2$. In general it is difficult to give an expression for the Moore closure of $L_1\cap L_2$ in terms of $f_1$ and $f_2$.

We might think that
\[ g: P \to \im(g): x\mapsto \bigvee_{n\in \N}(f_2\circ f_1)^n(x) \]
is the Moore closure into $L_1\cap L_2$. For a counterexample. consider the poset
\[ \begin{tikzcd}
& \top \ar[dl, dash] \ar[dr, dash] & \\
a \ar[dr, dash] & & b \ar[dl, dash] \\
& \vdots \ar[d, dash] & \\
& 2 \ar[d, dash] & \\
& 1 \ar[d, dash] & \\
& 0 & 
\end{tikzcd} \]
with $L_1 = \setbuilder{n}{\text{$n$ is even}} \cup \{a, \top\}$ and $L_2 = \setbuilder{n}{\text{$n$ is odd}} \cup \{b, \top\}$. Even if we consider the join in either $L_1$ or $L_2$, we have a problem.
\end{example}


\begin{lemma} \label{continuousFunctionsBetweenClosureSpaces}
Let $\sSet{P,f}$, $\sSet{Q,g}$ be Moore closure spaces and $\varphi: P\to Q$ an isotone function. Then the following are equivalent:
\begin{enumerate}
\item $(\varphi \circ f)(x) \leq (g\circ \varphi)(x)$ for all $x\in P$;
\item $g\circ \varphi = g\circ \varphi\circ f$.
\end{enumerate}
The following are also equivalent:
\begin{enumerate} \setcounter{enumi}{2}
\item $(g\circ \varphi)(x) \leq (\varphi\circ f)(x)$ for all $x\in P$;
\item $\varphi\circ f = g\circ \varphi\circ f$;
\item $\varphi^\imf(\im(f)) \subseteq \im(g)$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $x\in P$. We have $x \leq f(x)$, so $\varphi(x) \leq (\varphi\circ f)(x)$ and thus
\[ (g\circ \varphi)(x) \leq (g\circ \varphi \circ f)(x) = g\big((\varphi\circ f)(x)\big) \leq g\big((g\circ \varphi)(x)\big) = (g\circ \varphi)(x). \]
This implies that all the inequalities are in fact equalities.

$(2) \Rightarrow (1)$ Take arbitrary $x\in P$. Since $g$ is expansive, we have
\[ (\varphi \circ f)(x) \leq (g\circ \varphi\circ f)(x) = (g\circ \varphi)(x) \]
for all $x\in P$.

$(3) \Rightarrow (4)$ Take arbitrary $x\in P$. Since $g$ is expansive, we have
\[ (\varphi\circ f)(x) \leq (g\circ \varphi \circ f)(x) = (g\circ \varphi)\big(f(x)\big) \leq (\varphi\circ f)\big(f(x)\big) = (\varphi\circ f)(x). \]
This implies that all the inequalities are in fact equalities.

$(4) \Rightarrow (3)$ Take arbitrary $x\in P$. Since $f$ is expansive, we have $x\leq f(x)$. Since $g\circ \varphi$ is isotone, we have $(g\circ \varphi)(x) \leq (g\circ \varphi\circ f)(x) = (\varphi\circ f)(x)$.

$(4) \Leftrightarrow (5)$ Take arbitrary $x\in P$. By \ref{idempotencyMooreClosureLemma} we have $\big((\varphi\circ f)(x)\big) \in \im(g)$ iff $(\varphi\circ f)(x) = (g\circ \varphi\circ f)(x)$.
\end{proof}

\begin{lemma} \label{continuousGaloisConnectionBetweenClosureSpaces}
Let $\sSet{P,f}$, $\sSet{Q,g}$ be Moore closure spaces and $\big(\varphi: P\to Q, \psi: Q\to P\big)$ a Galois connection. Then the following are equivalent:
\begin{enumerate}
\item $(\varphi \circ f)(x) \leq (g\circ \varphi)(x)$ for all $x\in P$;
\item $(f\circ \psi)(y) \leq (\psi \circ g)(y)$ for all $y\in Q$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $y\in Q$. Then, since $(\varphi\circ \psi)(y) \leq y$, we have
\[ (\varphi \circ f \circ \psi)(y) \leq (g\circ \varphi \circ \psi)(y) \leq g(y). \]
Since $\varphi$ is the lower adjoint, we have $(f\circ \psi)(y) \leq (\psi\circ g)(y)$.

$(2) \Rightarrow (1)$ Take arbitrary $x\in P$. Then, since $x \leq (\psi\circ \varphi)(x)$, we have
\[ f(x) \leq (f\circ\psi\circ \varphi)(x) \leq (\psi \circ g\circ \varphi)(x). \]
Since $\psi$ is the upper adjoint, we have $(\varphi \circ f)(x) \leq (g\circ \varphi)(x)$.
\end{proof}

\subsection{Closure-continuous functions}
\begin{definition}
Let $X,Y$ be sets, $c: \powerset(X)\to \im(c)$ a Moore closure on $\powerset(X)$ and $d: \powerset(Y)\to \im(d)$ a Moore closure on $\powerset(Y)$. A function $f: \sSet{X, c}\to \sSet{Y, d}$ is called \udef{(closure) continuous} if $f^\preimf(B)$ is $c$-closed for all $d$-closed subsets $B\subseteq Y$.
\end{definition}

\begin{lemma} \label{closureContinuousEquivalents}
Let $X,Y$ be sets, $c: \powerset(X)\to \im(c)$ a Moore closure on $\powerset(X)$, $d: \powerset(Y)\to \im(d)$ a Moore closure on $\powerset(Y)$ and function $f: \sSet{X, c}\to \sSet{Y, d}$ a function. Then the following are equivalent:
\begin{enumerate}
\item $f$ is closure continuous;
\item $f^\preimf\circ d = c\circ f^\preimf\circ d$;
\item $(c\circ f^\preimf)(B) \subseteq (f^\preimf \circ d)(B)$ for all $B\subseteq Y$;
\item $d\circ f^\imf = d\circ f^\imf\circ c$;
\item $(f^\imf\circ c)(A) \subseteq (d\circ f^\imf)(A)$ for all $A\subseteq X$.
\end{enumerate}
\end{lemma}
\begin{proof}
This is an immediate consequence of \ref{continuousFunctionsBetweenClosureSpaces} and \ref{continuousGaloisConnectionBetweenClosureSpaces}.
\end{proof}

\subsubsection{Downwards closure}
TODO: preorder makes downwards closure (i.e.\ image set under order relation) a closure. TODO: sort out definitions!!

TODO: has the following been proved somewhere else??
\begin{lemma}
Let $P$ be a preordered set and $A\subseteq P$. Then
\begin{enumerate}
\item $A^\precsim = (\downset A)^\precsim$;
\item $A^\succsim = (\upset A)^\succsim$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By monotonicity of the polar, we have $(\downset A)^\precsim \subseteq A^\precsim$. For the other inclusion, take $b \in A^\precsim$. Take arbitrary $x\in \downset A$. Then there exists $a\in A$ such that $x \precsim a$. Since $a \precsim b$, we have $x\precsim b$. Since $x$ was chosen arbitrarily, we have $x\in (\downset A)^\precsim$.

(2) Dual.
\end{proof}
\begin{corollary} \label{extremaAfterOrderClosure}
Let $P$ be a preordered set and $A\subseteq P$. Then
\begin{enumerate}
\item $\sup(A) = \sup(\downset A)$;
\item $\inf(A) = \inf(\upset A)$.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{isotoneIffDownsetContinuous}
Let $P,Q$ be preordered sets and $f: P\to Q$ a function. The following are equivalent:
\begin{enumerate}
\item $f$ is isotone;
\item $f$ is $\downset$-continuous;
\item $f^{\preimf}\big(\downset\{y\}\big)$ is downwards closed for all $y\in Q$;
\item $f^\imf\big(\downset\{x\}\big) \subseteq \downset\{f(x)\}$ for all $x\in P$;
\item $\downset f^\imf\big(\downset\{x\}\big) = \downset\{f(x)\}$ for all $x\in P$.
\end{enumerate}
If $P,Q$ are posets, then these points are also equivalent to the following:
\begin{enumerate} \setcounter{enumi}{5}
\item $f$ preserves principal joins:
\[ \forall x\in P: \quad f(x) = f\Big(\bigvee \downset x\Big) = \bigvee f^\imf(\downset \{x\}); \]
\item $\bigvee f^\imf(\downset \{x\}) \leq f(x)$ for all $x\in P$.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Suppose $f$ is isotone and $B\subseteq Q$ a downwards closed set. Take $x\in \downset f^\preimf(B)$, so there exists $y\in P$ such that $f(y) \in B$ and $x\precsim y$. Then $f(x) \precsim f(y)$ and, since $B$ is downwards closed, $f(x) \in B$. Thus $x\in f^\preimf(B)$.

$(2) \Rightarrow (3)$ Immediate since $\downset\{y\}$ is downwards closed.

$(3) \Rightarrow (4)$ We have $\{x\} \subseteq f^\preimf\big(\downset\{f(x)\}\big)$. By assumption, we then have $\downset \{x\} \subseteq f^\preimf\big(\downset\{f(x)\}\big)$. By \ref{functionImagePreimageGaloisConnection}, this implies $f^\imf\big(\downset \{x\}\big) \subseteq \downset\{f(x)\}$.

$(4) \Rightarrow (5)$ Since $\{f(x)\} \subseteq f^\imf\big(\downset \{x\}\big) \subseteq \downset\{f(x)\}$, taking the downwards closude yields the result.

$(5) \Rightarrow (1)$ Take $x\precsim y \in P$. Then $x\in \downset \{y\}$, so
\[ f(x) \in f^\imf\big(\downset \{y\}\big) \subseteq \downset f^\imf\big(\downset \{y\}\big) = \downset f^\imf\big(\{y\}\big) = \downset \{f(y)\}, \]
which implies that $f(x) \precsim f(y)$.

$(5) \Rightarrow (6)$ By \ref{extremaAfterOrderClosure}, we have
\[ f(x) = \bigvee \downset \{f(x)\} = \bigvee \downset f^\imf\big(\downset\{x\}\big) = \bigvee f^\imf\big(\downset\{x\}\big). \]

$(6) \Rightarrow (7)$ Immediate.

$(7) \Rightarrow (4)$ This follows immediately from the Galois connection \ref{upsetDownsetConnections}.
\end{proof}

\subsection{Dedekind-MacNeille completion}
\begin{definition}
Let $\sSet{P, \leq}$ be a poset. Then the set $\DM(P) = \setbuilder{B^\geq}{B\subseteq P}$ together with the order embedding
\[ m: P \to \DM(P): x\mapsto \downset\{x\} \]
is called the \udef{Dedekind-MacNeille completion} of $P$.
\end{definition}
Note that $m$ is an order embedding by \ref{principalDownSetEmbedding}.

\begin{proposition} \label{DedekindMacNeilleCompletionComplete}
Let $\sSet{P, \leq}$ be a poset. Then
\begin{enumerate}
\item $\DM(P)$ is a complete $\wedge$-subsemilattice of $\sSet{\powerset(P), \subseteq}$;
\item the associated Moore closure is $(-)^{\leq\geq}: \powerset(P) \to \DM(P)$.
\end{enumerate}
\end{proposition}
\begin{proof}
By \ref{MooreClosureGaloisConnection} and \ref{completeSubsemilattices}, we need to show that $(-)^{\leq\geq}: \powerset(P) \to \DM(P)$ is a surjective Moore closure operator.

From \ref{polarsGaloisConnection} and \ref{preorderGaloisCondition}, we get that $(-)^{\leq\geq}$ is a Moore closure operator. For surjectivity, note that $B^\geq = B^{\geq\leq\geq} = (B^{\geq})^{\leq\geq}$.
\end{proof}
We can also prove that $(-)^{\leq\geq}: \powerset(P) \to \DM(P)$ is adjoint to the inclusion by noting that every set in $\DM(P)$ is of the form $B^\geq$ and $\incl_{\DM(P)}(B^\geq) = B^\geq$, so
\[ A\subseteq \incl_{\DM(P)}(B^\geq) \iff A\subseteq B^\geq \iff B\subseteq A^\leq \iff B \subseteq A^{\leq\geq\leq} \iff A^{\leq\geq} \subseteq B^\geq \iff A^{\leq\geq} \subseteq \incl_{\DM(P)}(B^\geq). \]

\begin{lemma} \label{joinMeetDMImage}
Let $\sSet{P, \leq}$ be a poset and $A\subseteq P$ a subset. Then
\begin{enumerate}
\item $\bigwedge_{\DM(P)} m^\imf(A) = A^\geq$;
\item $\bigvee_{\DM(P)} m^\imf(A) = A^{\leq\geq}$;
\item $\bigvee_{\DM(P)} m^\imf(A^\geq) = A^{\geq}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We have, by \ref{boundsFromPrincipalImages},
\[ \bigwedge_{\DM(P)}m^\imf(A) = \bigcap m^\imf(A) = \bigcap_{a\in A}m(a) = \bigcap_{a\in A}\downset\{a\} = A^\geq. \]

(2) We have, by \ref{imagesFromPrincipalImages}, \ref{meetJoinImageMooreClosure} and \ref{DedekindMacNeilleCompletionComplete},
\[ \bigvee_{\DM(P)} m^{\imf}(A) = \Big(\bigcup m^\imf(A)\Big)^{\leq\geq} = \Big(\bigcup_{x\in A} \downset\{x\}\Big)^{\leq\geq} = (\downset A)^{\leq\geq} = A^{\leq\geq}. \]

(3) Immediate from (2) and the fact that $A^{\geq\leq\geq} = A^\geq$.
\end{proof}
\begin{corollary}
The image $\im(P)$ is both join-dense and meet-dense in $\DM(P)$.
\end{corollary}
\begin{proof}
Every $A^\geq$ can clearly be expressed as both the meet and the join of a set in $\im(m)$.
\end{proof}

\begin{proposition}
Let $\sSet{P, \leq}$ be a poset. Then $m: P \to \DM(P)$ preserves arbitrary meets and joins.
\end{proposition}
\begin{proof}
Let $A\subseteq P$ be a subset such that the meet $\bigwedge A$ exists. Then, by \ref{boundsOnSetWithLeastBoundIsPrincipalIdeal}, \ref{joinMeetDMImage} and \ref{DedekindMacNeilleCompletionComplete},
\[ m\Big(\bigwedge A\Big) = \downset\Big\{\bigwedge A\Big\} = A^\geq = \bigwedge_{\DM(P)}m^\imf(A). \]

Now let $B\subseteq P$ be a subset such that the meet $\bigvee B$ exists. Then we calculate, using \ref{supInfConnection}, \ref{boundsOnSetWithLeastBoundIsPrincipalIdeal} and \ref{joinMeetDMImage},
\begin{align*}
m\Big(\bigvee A\Big) &= \downset\Big\{\bigvee A\Big\} \\
&= \downset \sup(A) \\
&= \downset \inf(A^\leq) \\
&= A^{\leq\geq} \\
&= \bigvee_{\DM(P)} m^{\imf}(A).
\end{align*}
\end{proof}

\begin{lemma}
Let $L$ be a complete lattice. Then $m: L\to \DM(L)$ is an order similarity.
\end{lemma}

\begin{proposition}[Universal property of the Dedekind-MacNeille completion]
Let $\sSet{P, \leq}$ be a poset, $L$ a complete lattice and $f: P\to L$ a residuated function. Then there exists a unique residuated function $\tilde{f}: \DM(P) \to L$ such that
\[ \begin{tikzcd}
P \ar[r, "m"] \ar[dr, "f"] & \DM(P) \ar[d, dashed, "{\tilde{f}}"] \\
{} & L
\end{tikzcd} \qquad \text{commutes.} \]
This $\tilde{f}$ is defined by $\tilde{f}(A^\geq) = \bigvee_L f^\imf(A^\geq)$.
\end{proposition}
Note that the residuation of $\tilde{f}$ is equivalent to join preservation, by \ref{GaloisConnectionLatticePreservation}. For $f$ this is not the case, since $P$ may not contain enough joins.
\begin{proof}
First we show the diagram commutes. Take arbitrary $x\in P$. Then we calculate
\[ (\tilde{f}\circ m)(x) = \tilde{f}\big(\{x\}^\geq\big) = \bigvee_L f^\imf\big(\downset\{x\}\big) = \bigvee_L \downset\{f(x)\} = f(x). \]
Next we show that $\tilde{f}$ preserves joins, which implies it is residuated by \ref{GaloisConnectionLatticePreservation}. First note that, for all $A\subseteq P$, we have $f^\imf(A^{\leq \geq}) \subseteq f^\imf(A^\leq)^\geq = f^\imf(A)^{\leq\geq}$, by \ref{residuationPreservesSupInf}. Since $A\subseteq A^{\leq\geq}$, we have
\[ f^\imf(A)^{\leq\geq} \subseteq f^\imf(A^{\leq \geq})^{\leq\geq} \subseteq f^\imf(A)^{\leq\geq\leq\geq} = f^\imf(A)^{\leq\geq}, \]
and so $f^\imf(A)^{\leq\geq} = f^\imf(A^{\leq \geq})^{\leq\geq}$.

To show preservation of joins, take some $\mathcal{A}\subseteq \DM(P)$. We calculate
\begin{align*}
\tilde{f}\Big(\bigvee_{\DM(P)}\mathcal{A}\Big) &= \bigvee_Lf^\imf\bigg(\Big(\bigcup_{A^\geq \in \mathcal{A}}A^\geq\Big)^{\leq\geq}\bigg) \\
&= \bigvee_Lf^\imf\bigg(\Big(\bigcup_{A^\geq \in \mathcal{A}}A^\geq\Big)^{\leq\geq}\bigg)^{\leq\geq} \\
&= \bigvee_Lf^\imf\Big(\bigcup_{A^\geq \in \mathcal{A}}A^\geq\Big)^{\leq\geq} \\
&= \bigvee_L\bigcup_{A^\geq \in \mathcal{A}} f^\imf(A^\geq) \\
&= \bigvee_{A^\geq \in \mathcal{A}}\bigvee_L f^\imf(A^\geq) \\
&= \bigvee_{A^\geq \in \mathcal{A}}\tilde{f}(A^\geq),
\end{align*}
where we have used the general identity $\bigvee A = \bigvee A^{\leq\geq}$ and \ref{joinMeetUnion}.

Finally, we show uniqueness. Assume $g: \DM(P)\to L$ is some other function that preserves joins and satisfies $f = g\circ m$. We then calculate, using \ref{joinMeetDMImage},
\[ g(A^\geq) = g\Big(\bigvee_{\DM(P)}m^\imf(A^\geq)\Big) = \bigvee_L (g\circ m)^\imf(A^\geq) = \bigvee_L f^\imf(A^\geq) = \tilde{f}(A^\geq). \]
\end{proof}

\begin{proposition} \label{DMCompletionDedekindCompleteLattice}
Let $L$ be a Dedekind-complete lattice that does not have a bottom. Then $\DM(L) = \setbuilder{\downset\{x\}}{x\in L}\cup \{\emptyset, L\}$.
\end{proposition}
Thus $\DM(L) \cong L \{\bot\} \oplus L \oplus \{\top\}$, if $L$ has neither top nor bottom. If $L$ has either a top, a bottom or both, we do not need to add them.
\begin{proof}
Since $\downset \{x\} = \{x\}^\geq$, $\emptyset = L^\geq$ (because any element of $L^\geq$ would be a bottom, which does not exist) and $L = \emptyset^\geq$, we have $\DM(L) \supseteq \setbuilder{\downset\{x\}}{x\in L}\cup \{\emptyset, L\}$.

For the other inclusion, take $B\subseteq L$. First suppose $B = \emptyset$. Then $B^\geq = L$. Now suppose $B$ is non-empty and has a lower bound. Then $\bigwedge B$ exists and $B^\geq = \downset\{\bigwedge B\}$. Finally suppose $B$ has no lower bound. Then $B^\geq = \emptyset$. We conclude that $\DM(L) = \setbuilder{\downset\{x\}}{x\in L}\cup \{\emptyset, L\}$.
\end{proof}

\section{Distributive and modular lattices}
\subsection{Distributive lattices}
For all lattices $L$ the distributive inequalities, \ref{distributiveInequality}, hold: $\forall a,b,c \in L$:
\begin{align*}
a \vee (b\wedge c) &\leq (a\vee b) \wedge (a\vee c); \\
a\wedge (b \vee c) &\geq (a\wedge b)\vee (a\wedge c).
\end{align*}

The two corresponding equalities are equivalent:
\begin{proposition} \label{equivalenceDistributiveLaws}
Let $L$ be a lattice. Then the following are equivalent:
\begin{enumerate}
\item $\forall a,b,c \in L: \; a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c)$;
\item $\forall a,b,c \in L: \; a\wedge (b \vee c) = (a\wedge b)\vee (a\wedge c)$.
\end{enumerate}
\end{proposition}
These equivalent equalities are known as the \udef{distributive laws}.
\begin{proof}
We show $(1)\Rightarrow (2)$. Then other implication follows by duality.

Assume (1). Then, for all $a,b,c \in L$:
\begin{align*}
(a\wedge b)\vee (a\wedge c) &= ((a\wedge b)\vee a) \wedge ((a\wedge b)\vee c) & \text{by (1)}\\
&= (a\wedge (c\vee (a\wedge b))  & \text{by the absorption law}\\
&= (a \wedge ((c\vee b) \wedge (c\vee a))  & \text{by (1)}\\
&= a\wedge (b\vee c) & \text{by the absorption law.}
\end{align*}
\end{proof}
Note that it is \emph{not} true that
\[ \forall a,b,c \in L: \; a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c) \iff a\wedge (b \vee c) = (a\wedge b)\vee (a\wedge c). \]

\begin{definition}
A lattice $L$ is called \udef{distributive} if it satisfies the distributive laws.
\end{definition}

\begin{lemma}
A lattice is distributive \textup{if and only if} its dual is distributive.
\end{lemma}

\begin{example}
\begin{itemize}
\item Any totally ordered set is a distributive lattice.
\item For any set $X$, the poset $\sSet{\powerset(X), \subseteq}$ is a distributive lattice.
\end{itemize}
\end{example}

\begin{lemma}
Let $L$ be a lattice. The following are equivalent:
\begin{enumerate}
\item $L$ is distributive;
\item for all $x,y,z,w\in L: \quad x\wedge y \leq w \;\text{and}\; x\wedge z\leq w \implies x\wedge (y\vee z) \leq w;$
\item for all $x,y,z,w\in L: \quad x\vee y \geq w \;\text{and}\; x\vee z\geq w \implies x\vee (y\wedge z) \geq w$.
\end{enumerate}
\end{lemma}
\begin{proof}
Point (1) is self-dual and points (2) and (3) are dual, so it is enough to show that (1) and (2) are equivalent.

Assume $L$ distributive. By \ref{orderLatticeCorollary}, $ x\vee y \geq w$ and $x\vee z\geq w$ imply $(x\wedge y)\vee (x\wedge z) \leq w$. By distributivity, we get (2).

Conversely, we can take $w = (x\wedge y)\vee (x\wedge z)$. Then (2) gives $x\wedge (y\vee z) \leq (x\wedge y)\vee (x\wedge z)$ and the distributive inequality \ref{distributiveInequality} gives the other inequality. 
\end{proof}

\begin{proposition}[Cancellation law for distributive lattices] \label{cancellationDistributiveLattices}
Let $L$ be a distributive lattice and $a,b,c\in L$. Then
\[ \text{$a\vee c = b \vee c$ and $a\wedge c = b \wedge c$ implies $a = b$.} \]
\end{proposition}
Note that we only assume the equalities hold for some $c$, not all $c$. If these equalities hold for all $c$, then we have cancellation in all lattices, not just distributive ones. See \ref{cancellationGeneralLattices}.
\begin{proof}
We calculate, using the absorption law and distributivity,
\[ a = a\vee (a\wedge c) = a \vee (b\wedge c) = (a\vee b)\wedge (a\vee c) = (a\vee b) \wedge (b\vee c) = b \vee (a \wedge c) = b \vee (b\wedge c) = b. \]
\end{proof}

\begin{lemma} \label{disjointComplementIdeal}
Let $L$ be a distributive lattice with a bottom $\bot$ and $S\subset L$. Then $S^\perp$ is an ideal.
\end{lemma}
\begin{proof}
Let $a,b\in S^\perp$. Then for all $x\in S$, we have
\[ (a\vee b)\wedge x = (a\wedge x)\vee (b\wedge x) = \bot\vee \bot = \bot, \]
so $a\vee b\in S^\perp$.

It is also clear $S^\perp$ must be a down set by \ref{orderLatticeCorollary}.
\end{proof}

\subsection{Modular lattices}
For all lattices $L$ the modular inequality holds: $\forall a,b,c \in L$:
\[ a\leq c \implies a \vee (b\wedge c) \leq (a\vee b) \wedge c. \]
See \ref{distributiveInequality}.

\begin{proposition} \label{modularEquivalences}
Let $L$ be a lattice. Then the following are equivalent:
\begin{enumerate}
\item $\forall a,b,c\in L$: $a \vee (b\wedge c) = (a\vee b) \wedge c$ if $a\leq c$;
\item $\forall a,b,c\in L$: $a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c)$ if $a\leq b$ or $a\leq c$; the dual of (2);
\item $\forall a,b,c\in L$: $a\vee (b\wedge (a\vee c)) = (a\vee b)\wedge (a\vee c)$; the dual of (3);
\item \textup{Shearing identity}: $\forall a,b,c\in L$: $(a\vee b) \wedge c = (a\vee (b\wedge (a\vee c)))\wedge c$; the dual of the shearing identity.
\end{enumerate}
\end{proposition}
The first of these is referred to as the \udef{modular law}. Notice that it is self-dual.
\begin{proof}
(1) is equivalent to its dual by replacing $a\leftrightarrow c$. This will imply all statements are equivalent to their duals once the equivalence with (1) has been established. 

$\boxed{(1)\Rightarrow (2)}$ Assume (1). Assume $a\leq b$ or $a\leq c$. By relabelling we can assume $a\leq c$.  Then $a\vee c = c$ and (2) clearly follows from (1).


$\boxed{(2)\Rightarrow (3)}$ Apply (2) to $a\leq a\vee c$.

$\boxed{(3)\Rightarrow (1)}$ Assume $a\leq c$. Then $a\vee c = c$ and $a\vee (b\wedge (a\vee c)) = (a\vee b)\wedge (a\vee c)$ reduces to $a \vee (b\wedge c) = (a\vee b) \wedge c$.

$\boxed{(3)\Rightarrow (4)}$ We calculate, using (3),
\[ (a\vee (b\wedge (a\vee c)))\wedge c = ((a\vee b)\wedge (a\vee c))\wedge c = (a\vee b) \wedge (a\vee c) \wedge c = (a\vee b) \wedge c. \]

$\boxed{(4)\Rightarrow (3)}$ TODO????
\end{proof}

\begin{definition}
A lattice $L$ is called \udef{modular} if it satisfies the modular law.
\end{definition}

\begin{lemma}
If a lattice is distributive, it is also modular.
\end{lemma}
\begin{proof}
If the lattice is distributive, point (2) of \ref{modularEquivalences} holds unconditionally, and so in particular also conditionally.
\end{proof}

\subsubsection{Semimodular lattices}


\subsection{Derived lattices}
\begin{proposition}
(i) If L is a modular (distributive) lattice, then every sublattice of L
is modular (distributive).

(ii) If L and K are modular (distributive) lattices, then L  K is
modular (distributive).

(iii) If L is modular (distributive) and K is the image of L under a
homomorphism, then K is modular (distributive).
\end{proposition}
\begin{corollary}
If a lattice is isomorphic to a sublattice of a product
of distributive (modular) lattices,then it is distributive (modular).
\end{corollary}

\begin{figure}
     \centering
     \begin{subfigure}[b]{0.4\textwidth}
     \centering
\begin{tikzcd}
{} & \ar[dl, dash] \ar[d, dash] \ar[dr, dash] \top & {} \\
a \ar[dr, dash] & b \ar[d, dash] & c \ar[dl, dash] \\
{} & \bot & {} 
\end{tikzcd}
\caption{$\mathbf{M}_3$}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.4\textwidth}
         \centering
\begin{tikzcd}[row sep=tiny, column sep=small]
{} & \ar[dl, dash] \ar[ddr, dash] \top & {} \\
c \ar[dd, dash] & {} & {} \\
{} & {} & b \ar[ddl, dash] \\
a \ar[dr, dash] & {} & {} \\
{} & \bot & {} 
\end{tikzcd}
         \caption{$\mathbf{N}_5$}
     \end{subfigure}
\end{figure}

\begin{theorem}[$\mathbf{M}_3-\mathbf{N}_5$ theorem]
Let $L$ be a lattice.
\begin{enumerate}
\item $L$ is non-modular \textup{if and only if} $L$ has no sublattice isomorphic to $\mathbf{N}_5$;
\item $L$ is non-distributive \textup{if and only if} $L$ has no sublattice isomorphic to either $\mathbf{N}_5$ or $\mathbf{M}_3$.
\end{enumerate}
\end{theorem}
\begin{proof}
(1) First we note that $\mathbf{N}_5$ is not modular. Indeed, we have
\begin{align*}
a\vee (b\wedge c) &= a\vee \bot = a \\
(a\vee b) \wedge c &= \top \wedge c = c.
\end{align*}
Since $a\leq c$, modularity would imply $a = c$, which is false.

Now, suppose $L$ is modular. Then every sublattice is modular, so no sublattice is isomorphic to $\mathbf{N}_5$.

Finally, suppose $L$ is not modular. Then there exist $a,b,c\in L$ such that $a\leq c$, but $a\vee (b\wedge c) \neq (a\vee b)\wedge c$ (and so $a\vee (b\wedge c) < (a\vee b)\wedge c$ by \ref{distributiveInequality}). Now set $a' \defeq a\vee (b\wedge c)$ and $c'\defeq (a\vee b)\wedge c$, so $a'<c'$. Consider the set $\{a',c',b, a'\wedge b, c'\vee b\}$. We claim this set is a sublattice isomorphic to $\mathbf{N}_5$
\[ \begin{tikzcd}[row sep=tiny, column sep=tiny]
{} & \ar[dl, dash] \ar[ddr, dash] c'\vee b & {} \\
c' \ar[dd, dash] & {} & {} \\
{} & {} & b \ar[ddl, dash] \\
a' \ar[dr, dash] & {} & {} \\
{} & a'\wedge b & {} 
\end{tikzcd} \]
In order to see this, we calculate
\begin{align*}
a'\vee b &= \big(a\vee (b\wedge c)\big)\vee b & c'\wedge b &= \big((a\vee b)\wedge c\big)\wedge b \\
&= a\vee \big((b\wedge c)\vee b \big) &  &= \big((a\vee b)\wedge b\big)\wedge c \\
&= a\vee b &  &= b\wedge c,
\end{align*}
so $a'\vee b = c'\vee b$ and $c'\wedge b = a'\wedge b$ because
\begin{align*}
a\vee b &= a'\vee b \leq c'\vee b = \big((a\vee b)\wedge c\big)\vee b \leq (a\vee b)\vee b = a\vee b \\
c\wedge b &= c'\wedge b \geq a'\wedge b = \big(a\vee (b\wedge c)\big)\wedge b \geq (b\wedge c)\wedge b = c\wedge b.
\end{align*}
This means that the set is closed under lattice operations and thus is a sublattice. To see that it is $\mathbf{N}_5$, we need to observe that all points are distinct. It is enough to show that $b$ is incomparable with both $a'$ and $c'$.

Suppose either $a'\leq b$ or $c'\leq b$. In both cases $a'\leq b$ and $a\vee (b\wedge c) = a' = a'\wedge b = c\wedge b$, so $b\wedge c \geq a$ and thus $b\geq a$. Then $c' = (a\vee b)\wedge c = b\wedge c \leq a\vee(b\wedge c) = a'$, which is false by assumption.

Suppose either $a'\geq b$ or $c'\geq b$. In both cases $c'\geq b$ and $(a\vee b)\wedge c = c' = c'\vee b = a\vee b$, so $a\vee b \leq c$ and thus $b\leq c$. Then $a' = a\vee (b\wedge c) = a\vee b \geq (a\vee b)\wedge c = c'$, which is false by assumption.

(2) TODO Burris/Sankappanavar
\end{proof}

\begin{example}
Consider the following lattice lattice:
\[ \begin{tikzcd}[row sep=tiny, column sep=tiny]
 & & \times \ar[dl, dash] \ar[dr, dash] & & \\
 & \bullet \ar[dl, dash] \ar[dr, dash] && \times \ar[dl, dash] \ar[dr, dash] & \\
\times \ar[dr, dash] & & \bullet \ar[dl, dash] \ar[dr, dash] & & \times \ar[dl, dash] \\
 & \bullet \ar[dr, dash] && \bullet \ar[dl, dash] & \\
 & & \times & & 
\end{tikzcd} \]
It is neither distributive nor modular, since the subset indicated by crosses is a sublattice isomorphic to $\mathbf{N}_5$.
\end{example}

\subsection{Infinitely distributive lattices}
\begin{definition}
Let $L$ be a lattice. We call $L$
\begin{itemize}
\item \udef{infinitely join-distributive} if, for all $x\in L$ and $A\subseteq L$ such that $\bigvee A$ exists, we have $x\wedge \bigvee A = \bigvee\setbuilder{x\wedge y}{y\in A}$;
\item \udef{infinitely meet-distributive} if, for all $x\in L$ and $A\subseteq L$ such that $\bigwedge A$ exists, we have $x\vee \bigwedge A = \bigwedge\setbuilder{x\vee y}{y\in A}$;
\item \udef{infinitely distributive} if $L$ is both infinitely join-distributive and infinitely meet-distributive.
\end{itemize}
\end{definition}
TODO cfr Heyting algebras

The inequalities $x\wedge \bigvee D \geq \bigvee x\wedge D$ and $x\vee \bigwedge D \leq \bigwedge x\vee D$ hold in any lattice, see \ref{infiniteDistributiveInequalities}.

\begin{lemma}
Let $L$ be a lattice and $x\in L$. Then
\begin{enumerate}
\item if $L$ is both infinitely join-distributive and a complete $\vee$-semilattice, then $x\wedge -$ has an upper adjoint;
\item if $L$ is both infinitely meet-distributive and a complete $\wedge$-semilattice, then $x\vee -$ has a  lower adjoint.
\end{enumerate}
\end{lemma}
\begin{proof}
Immediate from \ref{GaloisConnectionLatticePreservation}.
\end{proof}

\subsection{Completely distributive lattices}

\section{Complementation}
\subsection{Complementation}
\begin{definition}
Let $L$ be a bounded lattice and $x\in L$. We call $y$ a \udef{complement} of $x$ if
\[ x \vee y = \top \qquad \text{and} \qquad x\wedge y = \bot. \]
\end{definition}

\begin{proposition} \label{distributiveComplementUnique}
Let $L$ be a bounded lattice. If $L$ is distributive, then any $x\in L$ has at most one complement.
\end{proposition}
\begin{proof}
This follows from the cancellation law \ref{cancellationDistributiveLattices}. Let $y,y'$ be complements of $x$. Then $y\vee x = \top = y'\vee x$ and $y\wedge x = \bot = y'\wedge x$, so $y=y'$.
\end{proof}

A lattice element may also have no complements.
\begin{example}
The only elements with a complement in a bounded chain are $\top$ and $\bot$.
\end{example}

\subsubsection{Complemented lattices}
\begin{definition}
A \udef{complemented lattice} is a bounded lattice with a function $c:L\to L$, called the \udef{complementation}, such that $c(x)$ is a complement of $x$ for all $x\in L$.

A lattice in which every element has exactly one complement is called a \udef{uniquely complemented lattice}.

A lattice with the property that every interval (viewed as a sublattice) is complemented is called a \udef{relatively complemented lattice}.
\end{definition}
A distributive complemented lattice is uniquely complemented.

\begin{lemma}
Let $L$ be a complemented lattice with complementation $c:L\to L$. Then $c(\top) = \bot$ and $c(\bot) = \top$.
\end{lemma}
\begin{proof}
For $c(\top)$ to be a complement of $\top$, we need $\top \wedge c(\top) = \bot$. But for all $x\in L$ we have $x\leq \top$, so $\top\wedge x = x$. This means we have $c(\top) = \bot$.
\end{proof}

\begin{lemma} \label{uniqueComplementInvolution}
Let $L$ be a uniquely complemented lattice. Then the complementation $c:L\to L$ is an involution.
\end{lemma}
\begin{proof}
Clearly if $c(x)$ is a complement of $x$, then $x$ is a complement of $c(x)$. By uniqueness $c(c(x)) = x$.
\end{proof}

\subsubsection{Orthocomplemented lattices}
\begin{definition}
Let $L$ be a bounded lattice. An \udef{orthocomplementation} is a function $L \to L: x \to \overline{x}$ that maps each element $x\in L$ to an \udef{orthocomplement} $\overline{x}$ such that
\begin{itemize}
\item $x$ and $\overline{x}$ are complements;
\item $x\mapsto \overline{x}$ is an involution: $\overline{\overline{x}} = x$;
\item $x\mapsto \overline{x}$ is order-reversing: $x\leq y \implies \overline{y} \leq \overline{x}$.
\end{itemize}
An \udef{orthocomplemented lattice} or \udef{ortholattice} is a bounded lattice equipped with an orthocomplementation.
\end{definition}
An orthocomplemented lattice is not necessarily uniquely complemented.

\begin{lemma}
Let $L$ be an ortholattice with completement $c$. Then $c: L \to L$ is a reverse order-isomorphism.
\end{lemma}
\begin{corollary}
The dual lattice of an ortholattice is an ortholattice. We can view an orthocomplementation as an isomorphism between an ortholattice and its dual.
\end{corollary}
\begin{corollary}
Let $A\subseteq L$. Then
\begin{enumerate}
\item $c\left[\bigvee A\right] = \bigwedge c[A]$;
\item $c\left[\bigwedge A\right] = \bigvee c[A]$.
\end{enumerate}
\end{corollary}
\begin{proof}
See \ref{orderSimilarityPreservesJoinsMeets}.
\end{proof}

\begin{proposition}
The cardinality of any finite ortholattice is either even or $1$.
\end{proposition}
\begin{proof}
Let $L$ be a finite ortholattice.
The orthocomplementation pairs elements $x,y$ such that $\overline{x} = y$ and $\overline{y} = x$. If for all such pairs we have $x\neq y$, then the cardinality of $L$ is even. Now assume there exists an $x\in L$ such that $\overline{x} = x$. Then 
\[ \bot = x\wedge \overline{x} = x\wedge x = x = x\vee x = x\vee \overline{x} = \top. \]
So $\bot = \top$, which is only possible if $L = \{\bot\}$.
\end{proof}

\begin{example}
\begin{itemize}
\item The lattice $\mathbf{M}_2 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\circ \ar[ld, dash] \ar[rd, dash] & \\ \circ \ar[rd, dash] && \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd}$ admits a unique orthocomplementation.
\item The lattice $\mathbf{M}_3 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\circ \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ \circ \ar[rd, dash]& \circ \ar[d, dash] & \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd}$ admits no orthocomplementations.
\item The lattice $\mathbf{M}_4 = \begin{tikzcd}[column sep={1em,between origins},row sep={2em,between origins}]
&&&\circ \ar[llld, dash] \ar[ld,dash] \ar[rd, dash] \ar[rrrd, dash] &&&\\ \circ \ar[rrrd, dash]&& \circ \ar[rd, dash] && \circ \ar[ld, dash] && \circ \ar[llld, dash] \\ &&&\circ &&&
\end{tikzcd}$ admits three orthocomplementations.
\item The hexagon lattice $\begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] & & b \ar[d, dash] \\
c \ar[rd, dash] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ admits a unique orthocomplementation, but it is not uniquely complemented. Indeed both of the functions $f: \begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] \ar[rr, leftrightarrow] & & b \ar[d, dash] \\
c \ar[rd, dash] \ar[rr, leftrightarrow] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ and $g: \begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] \ar[rrd, leftrightarrow] & & b \ar[d, dash] \\
c \ar[rd, dash] \ar[rru, leftrightarrow] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ are complementations. Only $g$ is an orthocomplementation, because $f$ does not reverse order: $a \geq c$  and $f(a) = b \geq d = f(c)$.
\end{itemize}
\end{example}

\begin{theorem}[De Morgan's laws] \label{deMorganLaws}
Let $L$ be an ortholattice, then for all $x,y\in L$
\begin{enumerate}
\item $\overline{(x\vee y)} = \overline{x} \wedge \overline{y}$;
\item $\overline{(x\wedge y)} = \overline{x} \vee \overline{y}$.
\end{enumerate}
\end{theorem}
\begin{proof}
From $x\leq x\vee y$ and $y\leq x\vee b$, we have $\overline{(x\vee b)} \leq \overline{x}$ and $\overline{(x\vee b)} \leq \overline{y}$. By \ref{orderLatticeCorollary} we have $\overline{(x\vee y)}\leq \overline{x} \wedge \overline{y}$. For the other inequality we start with $\overline{x} \geq \overline{x} \wedge \overline{y}$ and $\overline{y} \geq \overline{x} \wedge \overline{y}$ to obtain $x\vee y \leq \overline{(\overline{x} \wedge \overline{y})}$, which implies $\overline{x} \wedge \overline{y} \leq \overline{(x\vee y)}$.
\end{proof}

\begin{proposition}
Let $L$ be a complemented lattice.

If the complement is an involution and satisfies either of the de Morgan laws, then $L$ is an ortholattice.
\end{proposition}
\begin{proof}
Assume the de Morgan law $\overline{(x\vee y)} = \overline{x} \wedge \overline{y}$ holds. Assume $x\leq y$. Then $x\vee y = y$, so
\[ \overline{y} = \overline{(x\vee y)} = \overline{x} \wedge \overline{y} \]
meaning $\overline{y} \leq \overline{x}$.
\end{proof}
\begin{corollary}
An ortholattice $L$ is a variety with signature $\seq{\vee, \wedge, \overline{\cdot}, \bot,\top}$ satisfying
\begin{itemize}
\item $\sSet{L, \vee, \wedge, \bot, \top}$ is a bounded lattice;
\item $x\vee\overline{x} = \top$;
\item $x\wedge\overline{x} = \bot$;
\item $\overline{\overline{x}} = x$;
\item $\overline{x\wedge y} = \overline{x}\vee \overline{y}$.
\end{itemize}
\end{corollary}
We can substitute the last equation with $\overline{x\vee y} = \overline{x}\wedge \overline{y}$.
\begin{proof}
TODO
\end{proof}

The requirement that the complement be an involution is important. There are lattices in which the de Morgan laws hold that are not ortholattices.

\begin{example}
The lattice $\mathbf{M}_3 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\top \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ a \ar[rd, dash]& b \ar[d, dash] & c \ar[ld, dash] \\ &\bot &
\end{tikzcd}$ admits a complementation $'$ such that $a' = b$, $b' = c$ and $c' = a$ that is clearly not an orthocomplementation, but does satisfy the de Morgan laws.
\end{example}

TODO Ockham algebras, De Morgan algebras, Kleene algebras, Stone algebras.

\subsection{Boolean lattices}
\begin{definition}
A distributive complemented lattice is called a \udef{Boolean lattice} or \udef{Boolean algebra}.
\end{definition}
We will use $\overline{x}$ to denote the (necessarily unique, \ref{distributiveComplementUnique}) completement of $x$.

\begin{example}
An algebra of sets is a Boolean algebra with as top the unit $\Omega$, as bottom the empty set $\emptyset$ and as complement $A\mapsto A^c = \Omega\setminus A$.
\end{example}

\begin{lemma} \label{BooleanComplementLargestDisjoint}
Let $L$ be a Boolean lattice and $x,y\in L$. Then
\begin{enumerate}
\item $\{x\}^\perp = \downset \{\overline{x}\}$;
\item $x\perp y \iff y\leq \overline{x}$.
\end{enumerate}
\end{lemma}
The complement $\overline{x}$ is the largest element disjoint from $x$.
\begin{proof}
(1) From the requirement $x\wedge \overline{x} = \bot$, we see that $\overline{x}\in \{x\}^\perp$. Now $\{\overline{x}\} \subseteq \{x\}^\perp$ implies $\downset \{\overline{x}\} \subseteq \downset\{x\}^\perp$. Then $\{x\}^\perp$ is downwards closed (in fact even an ideal), see \ref{disjointComplementIdeal}. Thus $\downset \{\overline{x}\} \subseteq \downset\{x\}^\perp = \{x\}^\perp$.

Now we prove the other inclusion: $\{x\}^\perp \subseteq \downset \{\overline{x}\}$.
Take $y\in \{x\}^\perp$. We just need to show that $y\leq \overline{x}$, or, equivalently, $y = y\wedge \overline{x}$. Indeed
\[ y = y \wedge \top = y\wedge (x\vee \overline{x}) = (y\wedge x)\vee (y\wedge \overline{x}) = \bot \vee (y\wedge \overline{x}) = y\wedge \overline{x}. \]

(2) Reformulation of (1).
\end{proof}
\begin{corollary}
Every Boolean lattice is an ortholattice.
\end{corollary}
\begin{proof}
By \ref{distributiveComplementUnique} we know that a Boolean lattice is uniquely complemented, so its complement is an involution by \ref{uniqueComplementInvolution}. We just need to check the complementation reverses order.

Let $x\leq y$. Then $\overline{y} \wedge x \leq \overline{y} \wedge y = \bot$, so $\overline{y} \wedge x = \bot$ and thus $\overline{y}$ is disjoint from $x$. Then $\overline{y} \leq \overline{x}$ follows from \ref{BooleanComplementLargestDisjoint}.
\end{proof}
\begin{corollary}
The laws of de Morgan hold in Boolean lattices.
\end{corollary}
\begin{corollary} \label{BooleanInequalities}
Let $L$ be a Boolean lattice and $x,y\in L$. Then the following are equivalent:
\begin{enumerate}
\item $x \leq y$;
\item $x\wedge \overline{y} = \bot$;
\item $\overline{x} \vee y = \top$.
\end{enumerate}
This can also be expressed as $x\leq y \iff x\perp \overline{y}$.
\end{corollary}
\begin{proof}
We calculate
\[ x \leq y \iff x\in\downset\{y\} \iff x\in\{\overline{y}\}^\perp \iff x\wedge \overline{y} = \bot. \]
For the equivalence $(2) \Leftrightarrow (3)$ we use a law of de Morgan.
\end{proof}

\begin{lemma} \label{BooleanLatticesLemma}
Let $L$ be a Boolean lattice and $x,y\in L$. Then
\begin{enumerate}
\item $y = (x\vee y) \wedge (\overline{x}\vee y)$;
\item $y = (x\wedge y) \vee (\overline{x}\wedge y)$;
\item $x \wedge y = x\wedge (\overline{x}\vee y)$;
\item $x \vee y = x\vee (\overline{x}\wedge y)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1, 2) We calculate
\[ y = y \wedge \top = y \wedge (x\vee \overline{x}) = (x\vee y) \wedge (\overline{x}\vee y). \]
The second statement is dual.

(3, 4) We calculate $x\wedge (\overline{x}\vee y) = (x\wedge \overline{x})\vee (x\wedge y) = \bot \vee (x\wedge y) = x\wedge y$. The fourth statement is dual.
\end{proof}

\begin{lemma} \label{atomsJoinIrriducibleBoolean}
Let $L$ be a Boolean lattice. Then
\begin{enumerate}
\item $\atoms(L) = \joinIr(L)$;
\item $\coatoms(L) = \meetIr(L)$;
\end{enumerate}
\end{lemma}
\begin{proof}
We have the inclusion $\subseteq$ from \ref{atomsJoinIrriducible}. Assume $x$ is an atom. Take $y\in \downset x\setminus\{x\}$, which is non-empty due to the existence of $\bot \neq x$. In fact we need to prove $y = \bot$. By \ref{BooleanLatticesLemma} we have $x = x\vee y = (x\wedge \overline{y})\vee y$. By join-irreducibility this means that $x = x\wedge \overline{y}$ (because $x\neq y$ by assumption). So $x\leq \overline{y}$, meaning $y = x\wedge y \leq \overline{y}\wedge y = \bot$.
\end{proof}

\begin{lemma}
Let $L$ be a Boolean lattice, $x\in L$ and $A\subseteq L$. Then
\begin{enumerate}
\item $\upset x\wedge A^u = (x\wedge A)^u$;
\item $\downset x\vee A^l = (x\vee A)^l$.
\end{enumerate}
\end{lemma}
In any lattice we have the inclusions $x\wedge A^u \subseteq (x\wedge A)^u, \;x\wedge A^l \subseteq (x\wedge A)^l, \;x\vee A^u \subseteq (x\vee A)^u$ and $x\vee A^l \subseteq (x\vee A)^l$. See \ref{UpperLowerBoundsMeetJoin}.
\begin{proof}
Because of \ref{UpperLowerBoundsMeetJoin}, we have $x\wedge A^u \subseteq (x\wedge A)^u$, so $\upset x\wedge A^u \subseteq \upset(x\wedge A)^u = (x\wedge A)^u$.

We just need to prove $\upset x\wedge A^u \supseteq (x\wedge A)^u$. Take some $z\in (x\wedge A)^u$, we need to find a $y\in x\wedge A^u$ such that $y \leq z$. We claim that $y = x\wedge (\overline{x}\vee z)$ is such a $y$. We just need to verify that $y \leq z$ and $\overline{x}\vee z \in A^u$.

The first claim is immediate from $y = x\wedge (\overline{x}\vee z) = x\wedge z$, using \ref{BooleanLatticesLemma}.

For the second claim, take an arbitrary $a\in A$. Then $x\wedge a \leq z$ by definition and so $\overline{x}\vee z \geq \overline{x}\vee (x\wedge a) = \overline{x}\vee a \geq a$.
\end{proof}
\begin{corollary}[Infinite distributive laws] \label{infiniteDistributiveLawsBooleanLattices}
Let $L$ be a Boolean lattice. Then for all $x\in L$ and all $A\subseteq L$:
\begin{enumerate}
\item if $\bigvee A$ exists, then $x\wedge \bigvee A = \bigvee x\wedge A$;
\item if $\bigwedge A$ exists, then $x\vee \bigwedge A = \bigwedge x\vee A$.
\end{enumerate}
Thus any complete Boolean lattice is infinitely distributive.
\end{corollary}
The inequalities $x\wedge \bigvee A \geq \bigvee x\wedge A$ and $x\vee \bigwedge A \leq \bigwedge x\vee A$ hold in any lattice, see \ref{infiniteDistributiveInequalities}. Note that this still does not mean that $L$ is complete.
\begin{proof}
We calculate
\begin{align*}
x\wedge \sup(A) &= x\wedge (A^u\cap A^{ul}) \\
&\subseteq (x\wedge A^u)\cap (x\wedge A^{ul}) \\
&\subseteq (x\wedge A)^u\cap (x\wedge A^{u})^l = (x\wedge A)^u\cap (\upset(x\wedge A^{u}))^l = (x\wedge A)^u\cap (x\wedge A))^{ul} = \sup(x\wedge A).
\end{align*}
We have used that $x\wedge (A^\cap A^{ul})$ is an image of the function $y\mapsto x\wedge y$ for the first inclusion and \ref{UpperLowerBoundsMeetJoin} for the second. We have also used \ref{upperBoundUpsetLowerBoundDownset} for $(x\wedge A^{u})^l = (\upset(x\wedge A^{u}))^l$.

The left-hand set is a singleton. The right is either a singleton or empty. Thus both sets are singletons with the same content.

Point (2) is dual.
\end{proof}

\begin{proposition}
Let $L$ be a Boolean lattice with complement and $a,b\in L$. Then $[a,b]$ is a Boolean lattice with complementation $x\mapsto \widetilde{x} = (\overline{x} \wedge b)\vee a$. 
\end{proposition}
\begin{proof}
Clearly $[a,b]$ inherits distributivity from $L$. All we need to show is that for all $x\in [a,b]$ the complement of $x$ in $[a,b]$ is $\widetilde{x}$. We calculate, using distributivity,
\begin{align*}
x \wedge \widetilde{x} &= x\wedge \big((\overline{x} \wedge b)\vee a\big) \\
&= \big(x\wedge(\overline{x} \wedge b)\big)\vee (x\wedge a) \\
&= \big(( x\wedge \overline{x}) \wedge b\big)\vee (x\wedge a) \\
&= (\bot \wedge b)\vee a = \bot \vee a = a \\
x \vee \widetilde{x} &= x\vee \big((\overline{x} \wedge b)\vee a\big) \\
&= \big((x\vee \overline{x}) \wedge (x\vee b)\big)\vee a \\
&= (\top \wedge b) \vee a = b\vee a = b.
\end{align*}
\end{proof}



\subsubsection{Duality and complementation}
TODO: dual expression can be obtained by taking the complement? Dual statement of equality is equality of complements?

TODO: general for ortholattices?

\subsubsection{Boolean rings}
TODO: define ring above!
\begin{definition}
Let $\sSet{R,+,\cdot, 0, 1}$ be a ring. We call $R$ a \udef{Boolean ring} if each $x\in R$ is idempotent: $x^2 = x$.
\end{definition}

\begin{lemma}
Let $\sSet{R,+,\cdot, 0, 1}$ be a Boolean ring. Then
\begin{enumerate}
\item $x = -x$ for all $x\in R$;
\item $R$ is commutative.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We calculate
\[ x+x = (x+x)^2 = x^2 + x^2 + x^2 + x^2 = x+x+x+x. \]
Subtracting $x+x$ from both sides gives $x+x = 0$.

(2) Let $x,y\in R$. We then have
\[ x+y = (x+y)^2 = x^2 + xy + yx + y^2 = x + xy + yx + y. \]
So $xy = -yx = yx$, using point (1).
\end{proof}

\begin{lemma}
Every subring of a Boolean ring is a Boolean ring.
\end{lemma}

\begin{proposition}
Let $R$ be a set and $0,1\in R$.
\begin{enumerate}
\item If $\sSet{R, \vee, \wedge, 0, 1, c}$ is a Boolean algebra, then $\sSet{R, +, \cdot, 0 , 1}$ is a Boolean ring with operations defined by
\begin{align*}
&+: (x,y) \mapsto (x\wedge y^c)\vee (x^c \wedge y) \\
&\cdot: (x,y) \mapsto x \wedge y.
\end{align*}
\item If $\sSet{R, +, \cdot, 0 , 1}$ is a Boolean ring, then $\sSet{R, \vee, \wedge, 0, 1, c}$ is a Boolean algebra with operations defined by
\begin{align*}
&\vee: (x,y) \mapsto x+y - x\cdot y \\
&\wedge: (x,y) \mapsto x \cdot y \\
&c: x\mapsto x^c = 1 + x
\end{align*}
\end{enumerate}
\end{proposition}
Note we need the existence of $1$ to define the complement.
\begin{proof}
TODO
\end{proof}

TODO: \url{https://en.wikipedia.org/wiki/Boolean_ring} (Maybe later in ring section?)

\subsubsection{Identities in Boolean algebras}
TODO rewrite!!!!

Given any set $U$ we can form the family $\powerset(U)$ for which $U$ is a universe set.

The set theoretic operations of union, intersection, difference, symmetric difference and complementation can be restricted to $\powerset(U)$. In other words $\powerset(U)$ is closed w.r.t. these operations.

\begin{proposition} \label{setBooleanAlgebra}
Given a set $U$, the operations $\cap, \cup, ^c$ form a Boolean algebra with bottom $\emptyset$ and top $U$: $\forall A,B,C\subset U$: $\powerset(U)$ is closed under $\cap, \cup, ^c$ and
\[ \begin{array}{l c c}
\text{\textbf{Commutativity}} & A\cup B= B\cup A & A\cap B = B\cap A \\
\text{\textbf{Identity}} & A\cup\emptyset = A & A\cap U = A \\
\text{\textbf{Distributivity}} & A\cup(B\cap C) = (A\cup B)\cap(A\cup C) & A\cap(B\cup C) = (A\cap B)\cup(A\cap C) \\
\text{\textbf{Complements}} & A\cup A^c = U & A\cap A^c = \emptyset
\end{array} \]
\end{proposition}
The two columns are duals of each other.

TODO: distributivity for arbitrary union and intersection.

\begin{corollary} \label{BooleanConsequences}
Let $A,B\subseteq U$ be sets. Then
\[ \begin{array}{l c c}
\text{\textbf{Idempotency}} & A\cup A = A & A\cap A = A \\
\text{\textbf{Domination}} & A\cup U = U & A\cap \emptyset = \emptyset \\
\text{\textbf{Absorption}} & A\cup(A\cap B) = A & A\cap(A\cup B) = A \\
\text{\textbf{Associativity}} & A\cup(B\cup C) = (A\cup B)\cup C & A\cap(B\cap C) = (A\cap B)\cap C
\end{array} \]
\end{corollary}
\begin{proof}
Using set theory the proof of these statements is simple. It is also possible to prove the equalities using only the properties of Boolean algebras listed in lemma \ref{setBooleanAlgebra} and the properties derived here. We only prove the first column. The proof of the second column can be obtained easily by duality.

(1) $A = A\cup(A\cap A^c) = (A\cup A)\cap (A\cup A^c) = (A\cup A)\cap U = A\cup A$.

(2) $U = U\cup (U\cap A) = (U\cup U)\cap (U\cup A) = U\cap (U\cup A) = (A\cup U)\cap U = (A\cup U)$.

(3) $A\cup(A\cap B) = (A\cap U)\cup(A\cap B) = A\cap(U\cup B) = A\cap U = A$.

(4) TODO \url{https://proofwiki.org/wiki/Operations_of_Boolean_Algebra_are_Associative}
\end{proof}

\begin{definition}
\udef{Sheffer stroke} $|$
\end{definition}

\begin{proposition}
Let $B$ be a Boolean lattice.
\begin{enumerate}
\item $\overline{x} = x|x$;
\item $x\wedge y = (x|y)|(x|y)$;
\item $x\vee y = (x|x)|(y|y)$;
\item $x\to y = x|(y|y)$;
\item $x\leftrightarrow y = ((x|(y|y))|(y|(x|x)))|((x|(y|y))|(y|(x|x)))$.
\end{enumerate}
\end{proposition}

\subsubsection{Grills}
\begin{definition}
Let $L$ be a Boolean lattice. Let $A \subseteq L$ be a subset. The \udef{grill} of $A$ is defined as the polar $A^{\mesh}$.
\end{definition}
Note that all grills are upwards closed, see \ref{grillUpwardsClosed}.

\begin{proposition} \label{complementInIsotoneGrill}
Let $L$ be a Boolean lattice. Let $A \subseteq L$ be upwards closed. Then
\[ a \notin A \quad\iff\quad \overline{a} \in A^\mesh. \]
In this case we also have $A = A^{\mesh\mesh}$.
\end{proposition}
\begin{proof}
First assume $\overline{a} \in A^\mesh$. If $a$ were and element of $A$, then $a\mesh \overline{a}$ and so $\neg(a\leq a)$ by \ref{BooleanInequalities}, which is a contradiction.

Now assume $a \notin A$. Take arbitrary $b\in A$. Now $a\wedge b \notin A$ (if $a\wedge b\in A$, then $a\in A$ by upwards closure and this was assumed not the case).

Then we have the implications, using \ref{BooleanInequalities},
\begin{align*}
a\wedge b\notin A &\implies a\wedge b \neq b \\
&\iff \neg(a\wedge b = b) \\
&\iff \neg(b\leq a) \\
&\iff \neg(\overline{a}\perp b) \\
&\iff \overline{a}\mesh b.
\end{align*}

To show $A = A^{\mesh\mesh}$, we observe the equivalences
\[ a\in A \quad\iff\quad \overline{a} \notin A^\mesh \quad\iff\quad a = \overline{\overline{a}} \in A^{\mesh\mesh}. \]
\end{proof}


\begin{lemma} \label{upwardClosureGrill}
Let $L$ be a Boolean lattice and $A \subseteq L$ a subset. Then
\begin{enumerate}
\item $A^{\mesh\mesh} = \upset A$;
\item if $B,C$ are upwards closed, then $B\subseteq C \iff C^\mesh \subseteq B^\mesh$.
\end{enumerate}
\end{lemma}
In particular, $A^\mesh = A^{\mesh\mesh\mesh} = (\upset A)^\mesh$.
\begin{proof}
(1) Because $\big((-)^\mesh, (-)^\mesh\big)$ is a Galois connection (\ref{polarsGaloisConnection}), we have $A \subseteq A^{\mesh\mesh}$ by \ref{preorderGaloisCondition}. As $A^{\mesh\mesh}$ is upwards closed (from \ref{grillUpwardsClosed}), we have $\upset A \subseteq A^{\mesh\mesh}$.

Now we use the fact that $(-)^{\mesh\mesh}$ is monotone to observe $A^{\mesh\mesh} \subseteq (\upset A)^{\mesh\mesh}$. Also $(\upset A)^{\mesh\mesh} = \upset A$ by
\ref{complementInIsotoneGrill}. So $A^{\mesh\mesh} \subseteq \upset A$.

(2) Since $B^{\mesh\mesh} = B$ and $C^{\mesh\mesh} = C$, we have
\[B\subseteq C \implies C^\mesh \subseteq B^\mesh \implies B^{\mesh\mesh} \subseteq C^{\mesh\mesh} \implies B\subseteq C, \]
and the result follows.
\end{proof}
\begin{corollary} \label{grillUpsetOrderSimilarity}
Let $L$ be a Boolean lattice.
Then $(-)^\mesh$ is an antitone bijection between upwards closed sets of subsets of $L$ and its inverse is itself.
\end{corollary}
\begin{proof}
We use \ref{relationPreservingGeneralisedInversesEmbeddings}. It is enough to note that $\im\big((-)^\mesh\big)$ is the set of upwards closed sets, which follows straight from the lemma. (The first point shows that $\im\big((-)^\mesh\big)$ consists of upwards closed sets. The second shows that every upwards closed set is in $\im\big((-)^\mesh\big)$.)
\end{proof}
\begin{corollary} \label{grillIntersectionUnion}
Let $L$ be a Boolean lattice and $\mathcal{E}\subseteq\powerset(L)$ such that each element of $\mathcal{E}$ is upwards closed. Then
\[ \Big(\bigcap\mathcal{E}\Big)^\mesh = \bigcup_{G\in\mathcal{E}}G^\mesh \qquad\text{and}\qquad \Big(\bigcup\mathcal{E}\Big)^\mesh = \bigcap_{G\in\mathcal{E}}G^\mesh. \]
\end{corollary}
\begin{proof}
It is enough to note that the intersection of upwards closed sets is closed and the union of upwards closed sets is closed, so the meet and join in the lattice of upwards closed sets are just the intersection and union.
\end{proof}
\begin{corollary} \label{ameshUpwardClosure}
Let $L$ be a Boolean lattice and $A, B \subseteq L$. Then $A \amesh B$ \textup{if and only if} $(\upset A) \amesh B$.
\end{corollary}
\begin{proof}
We have
\[ A\amesh B \iff A\subseteq B^\mesh \iff \upset A\subseteq B^\mesh \iff (\upset A)\amesh B. \]
\end{proof}

\subsection{Pseudocomplementation}
\begin{definition}
Let $S$ be a bounded $\wedge$-semilattice and $x\in S$. A \udef{pseudocomplement} of $x$ in $S$ is an element $x^*\in S$ such that
\[ y \perp x \quad\iff\quad y\leq x^* \qquad \forall y\in S. \]
If a pseudocomplement $x^*$ exists for all $x\in S$, we say $S$ is a \udef{pseudocomplemented} semilattice.
\end{definition}
Note that any $x\in S$ has at most one pseudocomplement.
We have
\[ x^* = \max\setbuilder{y\in S}{x\wedge y = \bot}, \]
if the maximum exists.

\begin{lemma}
Let $S$ be a pseudocomplemented semilattice and $x,y\in S$. Then
\begin{enumerate}
\item $x^* \perp x$;
\item $x \leq x^{**}$;
\item $x \leq y$ implies $y^* \leq x^*$;
\item $x^{***} = x^*$
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By reflexivity, we have $x^*\leq x^*$, so $x\perp x^*$.

(2) From (1) we get $x^*\perp x$. This implies $x\leq x^{**}$.

(3)  Assume $x\leq y$. Since $y\perp y^*$, by (1), we have $\bot \leq x\wedge y^* \leq y\wedge y^* = \bot$, so $x\perp y^*$ and thus $y^* \leq x^*$.

(4) Combining (2) and (3) gives $x^{***} \leq x^*$. For the converse, note that (1) gives $x^*\perp x^{**}$, so $x^* \leq x^{***}$.
\end{proof}

\begin{proposition} \label{weakDeMorganPseudocomplement}
Let $L$ be a pseudocomplemented lattice and $x,y\in L$. Then
\begin{enumerate}
\item $(x\vee y)^* = x^* \wedge y^*$;
\item $(x\wedge y)^* = (x^* \wedge y^*)^{**}$
\end{enumerate}
\end{proposition}
The dual of the first statement is not true in general. The lattices in which it is true are called Stone lattices.
\begin{proof}
(1) TODO Blyth.

(2) TODO Is this correct outside a Heyting algebra?
\end{proof}

\subsubsection{Skeleton}
Forms a Boolean lattice (see Blyth)

\subsubsection{Stone lattices}
\begin{definition}
A pseudocomplemented distributive lattice $L$ that satisfies
\[ \forall x,y\in L: \; (x\wedge y)^* = x^* \vee y^* \]
is called a \udef{Stone lattice}.
\end{definition}
See also \ref{weakDeMorganPseudocomplement}.

\section{Residuation in lattices}
\subsection{Heyting algebras}
\begin{definition}
A \udef{Heyting algebra} is a lattice $H$ in which the function $x\wedge -: H\to H: y\mapsto x\wedge y$ is residuated.

The residual is denoted $x \imp -$. We call the function
\[ \imp\;: H\times H \to H: \; (x,y) \; \mapsto \; x\imp y = (x\imp -)(y) \]
the \udef{implication}.
\end{definition}
For all $x,y,z\in H$ we have
\[ x\wedge y \leq z \qquad\iff\qquad y\leq x\imp z. \]

TODO: do we require a Heyting algebra to be bounded??

\begin{lemma}
A Heyting algebra $H$ is a variety with signature $\seq{\vee, \wedge, \imp, \bot,\top}$ satisfying
\begin{itemize}
\item $\sSet{H, \vee, \wedge, \bot, \top}$ is a bounded lattice;
\item $x\imp x = \top$;
\item $(x\imp y)\wedge y = y$;
\item $x\wedge (x\imp y) = x\wedge y$;
\item $x\imp (y\wedge z) = (x\imp y)\wedge(x\imp z)$;
\item $(x\vee y)\imp z = (x\imp z)\wedge(y\imp z)$.
\end{itemize}
\end{lemma}
\begin{proof}
TODO
\end{proof}

We have
\[ x\leq x \iff x\wedge \top \leq x \iff \top \leq x\imp x \iff \top = x\imp x. \]

\begin{lemma}
Every finite distributive lattice is a Heyting algebra.
\end{lemma}


\begin{proposition}
A lattice $H$ is a Heyting algebra \textup{if and only if} the sublattice $\interval{a,b}$ is pseudocomplemented for all $a,b\in H$.
\end{proposition}
The pseudocomplement of $x$ in $\interval{a,b}$ is given by $(x\imp a)\wedge b$.
\begin{proof}
TODO see Blyth.
\end{proof}

\begin{lemma}
Let $H$ be a Heyting algebra and $x,y,z\in H$. Then
\begin{enumerate}
\item the implication $\imp$ is antitone in the first argument and isotone in the second argument;
\item \textbf{Modus ponens} $x\wedge (x\imp y) \leq y$;
\item $y\leq x \imp (x\wedge y)$;
\item \textbf{Transitivity} $(x\imp y)\wedge (y\imp z) \leq (x\imp z)$;
\item \textbf{Currying} $(x\wedge y) \imp z = x \imp (y\imp z)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) TODO

(2, 3) Immediate by closure properties of Galois connection.

(4) Applying modus ponens twice gives
\[ x \wedge (x\imp y) \wedge (y\imp z) \;\leq\; y \wedge (y\imp z) \;\leq\; z. \]
Using the Galois connection gives $\big((x\imp y) \wedge (y\imp z)\big) \leq (x\imp z)$.

(5) First by modus ponens, and then using the Galois connection, we have
\begin{align*}
(x\wedge y) \wedge \big((x\wedge y)\imp z\big) \leq z &\iff x\wedge (x\wedge y)\imp z \leq (y\imp z) \\
&\iff (x\wedge y)\imp z \leq \big(x\imp (y\imp z)\big)
\end{align*}
Now, by modus ponens, we have
\[ x\wedge y\wedge \big(x \imp (y\imp z)\big) \quad\leq\quad y\wedge (y\imp z) \quad\leq\quad z. \]
Using the Galois connection gives $\big(x \imp (y\imp z)\big) \leq \big((x\wedge y)\imp z\big)$. Combining the two inequalities gives the result.
\end{proof}

\subsubsection{Negation}

\subsection{Frames and locales}
\begin{definition}
A \udef{frame} is a complete Heyting algebra.
\end{definition}

\subsection{Quantales}
Complete lattice such that $x\cdot -$ is residuated.

\subsection{Residuated lattices}
Both $x \cdot -$ and $-\cdot x$ residuated.


\section{Completions}
TODO: Dedekind-MacNeille completion.

\section{Formal concept analysis}
\url{file:///C:/Users/user/Downloads/978-3-540-31881-1.pdf}
\url{file:///C:/Users/user/Downloads/978-3-662-49291-8.pdf}

\begin{definition}
A \udef{context} is a triple $\seq{G,M,I}$ where $G$ is a set of \udef{objects}, $M$ is a set of \udef{attributes} and $I\subseteq G\times M$ is a binary relation.

For $g\in G, m\in M$ we interpret $gIm$ as ``the object $g$ has the attribute $m$''.



A \udef{concept} is a pair $\seq{A,B}$ where $A\subset G$ is a set of objects and $B\subset M$ is a set of attributes such that
\begin{itemize}
\item $A = \setbuilder{g\in G}{\forall m\in B: gIm}$;
\item $B = \setbuilder{m\in M}{\forall g\in A: gIm}$
\end{itemize}
\end{definition}
The letters $G$ and $M$ come from the German: Gegenstnde and Merkmale. The $I$ is for ``incidence relation'' (I think).

\chapter{Filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set. A subset $A\subseteq P$ is called
\begin{itemize}
\item an \udef{order filter} if
\begin{itemize}
\item $A$ is downward directed;
\item $A$ is an up set in $P$;
\end{itemize}
\item an \udef{order ideal} if
\begin{itemize}
\item $A$ is upward directed;
\item $A$ is a down set in $P$.
\end{itemize}
\end{itemize}
The set of ideals on $P$ is denoted $\ideals(P)$ and the set of filters on $P$ is denoted $\filters(P)$.
\end{definition}
Many authors also require filters and ideals to be non-empty.

\begin{lemma}
Let $P$ be an ordered set and $x\in P$.
\begin{enumerate}
\item The principal up set $\upset \{x\}$ is an order filter.
\item The principal down set $\downset \{x\}$ is an order ideal.
\end{enumerate}
\end{lemma}
If the order is not a preorder, then a principal filter/ideal may be empty.

\begin{example}
Let $X$ be a set.
\begin{itemize}
\item The set of finite subsets of $X$ is an ideal.
\item The set of countable subsets $X$ is an ideal.
\item A subset $A$ of $X$ is called \udef{cofinite} if $X\setminus A$ is finite. The set of cofinite subsets of $X$ is a filter.
\item A subset $A$ of $X$ is called \udef{cocountable} if $X\setminus A$ is countable. The set of cocountable subsets of $X$ is a filter.
\end{itemize}
\end{example}

\begin{lemma}
Let $P$ be an ordered set.
\begin{enumerate}
\item If $P$ has a least element $l$, then a filter $F$ is proper \textup{if and only if} $F\neq P$.
\item If $P$ has a greatest element $g$, then an ideal $I$ is proper \textup{if and only if} $F\neq P$.
\end{enumerate}
\end{lemma}


\begin{lemma}
Let $\sSet{S,\leq}$ be a poset $J\subseteq S$ a subset.
\begin{enumerate}
\item If $S$ is a $\wedge$-semilattice, then the following are equivalent:
\begin{enumerate}
\item $J$ is a filter;
\item \begin{enumerate}
\item $J$ is an up set;
\item $J$ is a $\wedge$-subsemilattice;
\end{enumerate}
\item $\forall a,b\in S: a\wedge b\in J \iff a,b\in J$;
\end{enumerate}
\item If $S$ is a $\vee$-semilattice, then the following are equivalent:
\begin{enumerate}
\item $J$ is an ideal;
\item \begin{enumerate}
\item $J$ is a down set;
\item $J$ is a $\vee$-subsemilattice.
\end{enumerate}
\item $\forall a,b\in S: a\vee b\in J \iff a,b\in J$.
\end{enumerate}
\end{enumerate}
TODO compare (c) with filter-grill.
\end{lemma}
\begin{proof}
TODO
\end{proof}
\begin{corollary} \label{filterSetIdealSetWedgeSemilattice}
Let $S$ be a poset. Then
\begin{enumerate}
\item if $S$ is a $\wedge$-semilattice, then $\filters(S)$ is a complete $\wedge$-semilattice;
\item if $S$ is a $\vee$-semilattice, then $\ideals(S)$ is a complete $\wedge$-semilattice.
\end{enumerate}
\end{corollary}
\begin{proof}
TODO
\end{proof}

\begin{example}
Consider the poset $P = \{a,b,c,d\}$ with the order determined by
\[ \begin{tikzcd}
a \ar[d, dash] \ar[dr, dash] & b \ar[d, dash] \ar[dl, dash] \\
c & d
\end{tikzcd} \]
Then
\begin{itemize}
\item $\upset \{c\}$ and $\upset \{d\}$ are filters, but $\upset \{c\} \cap \upset \{d\} = \{a,b\}$ is not a filter because it is not downwards directed;
\item $\downset \{a\}$ and $\downset \{b\}$ are ideals, but $\downset \{a\} \cap \downset \{b\} = \{c,d\}$ is not an ideal because it is not upwards directed.
\end{itemize}
Thus neither $\filters{P}$ nor $\ideals{P}$ is a $\wedge$-semilattice.
\end{example}

\begin{lemma}
Let $S$ be a $\wedge$-semilattice. If $D\subseteq S$ is a $\wedge$-subsemilattice, then $D$ is downward directed.
\end{lemma}
The converse is not true!



\begin{lemma}
Let $L$ be a lattice and $J\subseteq L$ a subset. Then
\begin{enumerate}
\item $J$ is a filter \textup{if and only if}
\begin{enumerate}
\item $\forall a,b\in J: \qquad a\wedge b\in J$;
\item $\forall x\in L, \forall b\in J: \quad x\vee b \in J$;
\end{enumerate}
\item $J$ is an ideal \textup{if and only if}
\begin{enumerate}
\item $\forall a,b\in J: \qquad a\vee b\in J$;
\item $\forall x\in L, \forall b\in J: \quad x\wedge b \in J$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{lemma} \label{properFiltersSelfMesh}
Let $S$ be a bounded $\wedge$-semilattice and $F\in\filters(S)$. Then the following are equivalent:
\begin{enumerate}
\item $F$ is proper;
\item $F\amesh F$;
\item $F\subseteq F^\mesh$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1)\Rightarrow (2)$ Assume $F$ is proper and take $a, b\in F$. If $a\wedge b = \bot$, then $\bot\in F$, which is a contradiction, so $a\mesh b$.

$(2) \Rightarrow (1)$ Now assume $F \amesh F$. Then $\bot \notin F$ (as $\bot$ does not mesh with any element of $F$), so $F$ is proper.

$(2) \Leftrightarrow (3)$ Immediate.
\end{proof}



\section{Frink ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set. A subset $A\subseteq P$ is called\footnote{TODO: Frink, Orrin (1954), "Ideals In Partially Ordered Sets", Am. Math. Mon., 61: 223-234, doi:10.1080/00029890.1954.11988449}
\begin{itemize}
\item a \udef{Frink filter} if $F^{\Yright\Yleft} \subseteq A$ for all finite $F\subseteq A$;
\item a \udef{Frink ideal} if $F^{\Yleft\Yright} \subseteq A$ for all finite $F\subseteq A$.
\end{itemize}
\end{definition}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set. Every order filter is a Frink filter and every order ideal is a Frink ideal.
\end{proposition}
\begin{proof}
First assume $A$ is an order filter and take arbitrary finite $F\subseteq A$. In order to prove $F^{\Yright\Yleft} \subseteq A$, we take an arbitrary $x\in F^{\Yright\Yleft}$. Then
\[ x\in F^{\Yright\Yleft} \;\iff\; \{x\}\subseteq (F^\Yright)^\Yleft \;\iff\; F^\Yright \subseteq \{x\}^\Yright = x{\Yright}. \]
As $A$ is an order filter, there exists $y\in F^\Yright \cap A$. By the calculation this means $y\Yleft x$ and so $x\in A$ by upwards closure.

The case for ideals is dual.
\end{proof}


\section{Filter bases and subbases}

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $\{F_i\}_{i\in I}$ a family of subsets.
\begin{enumerate}
\item If $F_i$ is a filter for all $i\in I$, then $\bigcap_{i\in I}F_i$ is a filter;
\item If $F_i$ is an ideal for all $i\in I$, then $\bigcap_{i\in I}F_i$ is an ideal.
\end{enumerate}
\end{lemma}

\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set and $B\subseteq P$ a subset. Then
\begin{itemize}
\item the \emph{filter generated by $B$} is
\[ \mathfrak{F}\{B\} \defeq \bigcap\setbuilder{B \subseteq S\subseteq P}{\text{$S$ is a filter}} \]
we call $B$ a \udef{filter subbasis} of $\mathfrak{F}\{B\}$. If $B$ is downward directed, it is called a \udef{filter base} of $\mathfrak{F}\{B\}$;
\item the \emph{filter base generated by $B$} as
\[ \mathfrak{FB}\{B\} \defeq \bigcap\setbuilder{B \subseteq S\subseteq P}{\text{$S$ is downward directed}}. \]
\end{itemize}
Let $E\subseteq P$ be some set and $F\in \filters(P)$. If $F$ has a base $B$ that is a subset of $E$, then $F$ is said to be \udef{based in} $E$.  
\end{definition}

If $P$ is not downward directed, there may not exists any $S \supseteq B$ that is downward directed, in which case $\mathfrak{FB}\{B\} =$ TODO.

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set and $B\subseteq P$ a subset. Then
\begin{enumerate}
\item if $P$ is downward directed, then $\mathfrak{FB}\{B\}$ is a filter base;
\item $\mathfrak{F}\{B\} = \upset\mathfrak{FB}\{B\}$.
\end{enumerate}
\end{proposition}
In particular, if $S$ is a filter base, then $\upset S$ is a filter.

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set.

If $P$ is downward directed and $\exists \bot \in \min(P)$ and $B \subseteq P$ a filter base, then $\mathfrak{F}\{B\}$ is a proper filter \textup{if and only if} $\bot \notin B$; 
\end{lemma}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set. Then for all filter bases $B,C$ in $P$: $B$ is finer than $C$ \textup{if and only if} $\mathfrak{F}\{B\} \supseteq \mathfrak{F}\{C\}$.
\end{proposition}

\begin{proposition} \label{filterGenerationSemilattice}
Let $S$ be a $\wedge$-semilattice and $B\subseteq S$ a subset. Then
\begin{enumerate}
\item $\mathfrak{FB}\{B\} = \Closure_\wedge(B)$;
\item $\mathfrak{F}\{B\} = \upset\Closure_\wedge(B)$.
\end{enumerate}
\end{proposition}

\begin{lemma} \label{decreasingCountableBaseFilter}
Let $S$ be a $\wedge$-semilattice and $F\subseteq S$ a countably based filter. Then we can find a decreasing sequence $\seq{b_n}$ in $S$ such that $\setbuilder{b_n}{n\in \N}$ is a base of $F$.
\end{lemma}
\begin{proof}
By assumption, we can find an enumeration $f: \N\to S$ of a base of $F$. Now we define the sequence $\seq{b_n}$ recursively by
\[ b_n = \begin{cases}
f(0) & (n = 0) \\
f(n) \wedge b_{n-1} & (\text{otherwise}).
\end{cases} \]
It is clear that $b$ is decreasing (TODO recursion invariant).

To see that $b$ is a base, first note that each $b_n$ is in $F$ (as $F$ is a $\wedge$-subsemilattice and all meets are finite). Also $b_n \leq f(n)$ for all $n\in\N$.
\end{proof}

\section{Ordering filters and ideals}
\url{https://ncatlab.org/nlab/show/filter}

\begin{proposition}[The lattices of filters and ideals] \label{latticeFiltersIdeals}
Let $P$ be an ordered set and $I$ an index set.
\begin{enumerate}
\item If $P$ is a $\wedge$-semilattice, the set $\filters(P)$ of filters on $P$ is a complete bounded sublattice of $\sSet{\powerset(P), \subseteq}$, with top $P$ and bottom $\{\top\}$. Let $\{F_i\}_{i\in I} \in \filters(L)^I$ be a set of filters. Then
\begin{align*}
\bigwedge \{F_i\}_{i\in I} &= \bigcap_{i\in I}F_i \\
\bigvee \{F_i\}_{i\in I} &= \upset \Closure_\wedge\left(\bigcup_{i\in I}F_i\right) = \setbuilder{\bigwedge_{j\in J}A_j}{\forall J\subseteq I \text{finite}: \forall j\in J: A_j\in F_j}.
\end{align*}
\item If $P$ is a $\vee$-semilattice, the set $\ideals(P)$ of ideals on $P$ is a complete bounded sublattice of $\sSet{\powerset(P), \subseteq}$, with top $P$ and bottom $\{\bot\}$. Let $\{J_i\}_{i\in I} \in \filters(L)^I$ be a set of ideals. Then
\[ \bigwedge \{J_i\}_{i\in I} = \bigcap_{i\in I}J_i \qquad\text{and}\qquad
\bigvee \{J_i\}_{i\in I} = \downset \Closure_\vee\left(\bigcup_{i\in I}J_i\right). \]
\end{enumerate}
\end{proposition}
\begin{proof}
This is an application of \ref{completeSublattice} to \ref{filterGenerationSemilattice} (TODO show this is the correct residual). We just need to prove that $\upset\Closure_\wedge \left(\bigcup_{i\in I}F_i\right) = \Closure_\wedge \left(\bigcup_{i\in I}F_i\right)$ TODO is distributive
\end{proof}
\begin{corollary} \label{joinProperFilter}
Let $S$ be a $\wedge$-semilattice and $\{F_i\}_{i\in I} \in \filters(S)^I$ be set of filters. Then $\bigvee \{F_i\}_{i\in I}$ is a proper filter \textup{if and only if} $\Big(\bigcup_{i\in I}F_i\Big)\amesh \Big(\bigcup_{i\in I}F_i\Big)$.
\end{corollary}
In particular, for $F, G\in\filters(L)$, we have that $F\vee G$ is a proper filter if and only if $F\amesh G$.

\begin{lemma} \label{baseMeetJoinFilters}
Let $L$ be a lattice and $F,G$ filters in $\filters(L)$. If $\mathcal{A}$ is a base of $F$ and $\mathcal{B}$ a base of $G$, then
\begin{enumerate}
\item $\setbuilder{a\vee b}{a\in \mathcal{A}, b\in \mathcal{B}}$ is a base of $F\wedge G$;
\item $\setbuilder{a\wedge b}{a\in \mathcal{A}, b\in \mathcal{B}}$ is a base of $F\vee G$.
\end{enumerate}
\end{lemma}
Note that the analogue result does \emph{not} hold for infinite meets and joins of filters.



\begin{lemma}
Let $L$ be a lattice and $a,b\in L$. Then
\begin{enumerate}
\item $\upset\{a\} \vee \upset\{b\} = \upset\{a\wedge b\}$;
\item $\upset\{a\} \wedge \upset\{b\} = \upset\{a\vee b\}$.
\end{enumerate}
\end{lemma}

\subsection{Maximal filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{itemize}
\item A \udef{maximal filter} or \udef{ultrafilter} is a coatom in $\filters(P)$.
\item A \udef{maximal ideal} is a coatom in $\ideals(P)$.
\end{itemize}
We denote the set of ultrafilters on $P$ as $\ultrafilters(P)$.
\end{definition}

\begin{proposition} \label{ultrafilterCriteria}
Let $S$ be a bounded $\wedge$-semilattice and $F\in \filters(S)$. The following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item $\forall x\in S: x\notin F \iff \exists y\in F: x\wedge y = \bot$;
\item $F = F^\mesh$;
\item $F$ is proper and $F^\mesh \subseteq F$.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO

$(1)\Rightarrow (2)$ Assume $F$ is an ultrafilter. Then for all $x\in F$, the filter $\mathfrak{F}\big\{F\cup \{x\}\big\}$ is either $F$ or $S$. In other words, $x\notin F$ is equivalent to $\mathfrak{F}\big\{F\cup \{x\}\big\} = S$. Now a filter is equal to $S$ iff $\bot$ is an element and, by \ref{filterGenerationSemilattice} we have that $\bot \in \mathfrak{F}\big\{F\cup \{x\}\big\}$ iff it is the intersection of $x$ and some $y\in F$. This concludes the forward direction.

$(2)\Rightarrow (1)$ Take some filter $F$ satisfying the condition. Then $F$ is automatically proper ($\bot$ is not in $F$). Assume $G\supseteq F$ is another proper filter. Assume, towards a contradiction, that $G\setminus F \neq \emptyset$. Then take $x\in G\setminus F$. By hypothesis there exists a $y\in F$ (and thus also in $G$) such that $x\wedge y = \bot$, meaning $\bot \in G$ by $\wedge$-closure. Thus $G$ is not proper.

$(3) \Leftrightarrow (4)$ By \ref{properSubsemilatticeLemma}.
\end{proof}
\begin{corollary} \label{BooleanUltrafilterDisjunction}
Let $B$ be a Boolean lattice and $F\in \filters(B)$. The following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item either $x\in F$ or $\overline{x}\in F$ for all $x\in B$.
\end{enumerate}
\end{corollary}
\begin{proof}
It is enough to prove that $\exists y\in F: x\wedge y = \bot$ is equivalent to $\overline{x}\in F$. Indeed it is equivalent to $\exists y\in F: y \leq \overline{x}$ by \ref{BooleanInequalities} and thus equivalent to $\overline{x}\in F$ by upwards closure.
\end{proof}

\begin{proposition}[Ultrafilter lemma] \label{ultrafilterLemma}
Every proper filter is contained in an ultrafilter.
\end{proposition}
In other words, the lattice of ultrafilters on a poset is coatomic. (TODO do we need to assume Boolean? In which case this remark is redundant.)
\begin{corollary} \label{filtersCoatomistic}
Let $B$ be a Boolean lattice. Then $\filters(B)$ is a coatomistic lattice.
\end{corollary}
In other words, for every $F\in \filters(B)$: we have
\[ F = \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U. \]
\begin{proof}
We clearly have
\[ F \subseteq \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U. \]
We need to show the opposite inclusion. Assume, towards a contradiction, that to opposite inclusion does not hold. Then there exists $a\in \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U$ such that $a\notin F$. Then for all $b\in F$ we have $b\not\leq a$, which implies $b\wedge \overline{a} \neq \bot$ by \ref{BooleanInequalities}. Thus $\overline{a} \in F^\mesh$, so $F\vee \upset\{\overline{a}\}$ is a proper filter by \ref{joinProperFilter}. It is contained in an ultrafilter $U$ that also contains $F$. By hypothesis $U$ must contain $a$, which means it is not proper because $a\perp \overline{a}$. This is a contradiction.
\end{proof}
The hypothesis of Booleanness is necessary.
\begin{example}
Consider the lattice $\sSet{\{0,1,2,3\},\leq}$. It contains only one ultrafilter: $\{1,2,3\}$. The filter $\{3,4\}$ is clearly not the intersection of its containing ultrafilters.
\end{example}

\begin{lemma} \label{finiteUltrafilterFactorisation}
Let $S$ be a bounded $\wedge$-semilattice, $F, G\in \filters(S)$ and $U\in\ultrafilters(S)$. Then $F\cap G \subseteq U$ \textup{if and only if} $F\subseteq U$ or $G\subseteq U$.
\end{lemma}
\begin{proof}
The direction $\Leftarrow$ is immediate.

For the direction $\Rightarrow$, assume $F\cap G \subseteq U$. Then
\[ U = U\vee U \supseteq U\vee (F\cap G) = (U\vee F)\cap (U\vee G) \supseteq U \]
by distributivity in \ref{latticeFiltersIdeals}. Then either $U = U\vee F$ or $U = U\vee G$, because $U$ is meet-irriducible by \ref{atomsJoinIrriducible}. Thus either $F\subseteq U$ or $G\subseteq U$.
\end{proof}
Note this does not work for arbitrary intersections!

\subsection{Prime filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{itemize}
\item A \udef{prime filter} is a meet-irreducible element in $\filters(L)$.
\item A \udef{prime ideal} is a meet-irreducible element in $\ideals(L)$.
\end{itemize}
\end{definition}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{enumerate}
\item A filter $F$ is prime \textup{if and only if} $F^c$ is an ideal.
\item An ideal $I$ is prime \textup{if and only if} $I^c$ is a filter.
\end{enumerate}
\end{proposition}
\begin{proof}

\end{proof}

\begin{lemma} \label{maximalPrimeFiltersIdeals}
Every maximal is prime. If Boolean, then every prime is maximal.
\end{lemma}
\begin{proof}
TODO \ref{atomsJoinIrriducible}
\end{proof}


\begin{proposition}
Let $L$ be a lattice.
\begin{enumerate}
\item A filter $F\in \filters(L)$ is prime \textup{if and only if}
\begin{enumerate}
\item $F$ is proper;
\item $\forall x,y\in L$: $x\vee y \in F \implies x\in F$ or $y\in F$.
\end{enumerate}
\item An ideal $I\in \ideals(L)$ is prime \textup{if and only if}
\begin{enumerate}
\item $I$ is proper;
\item $\forall x,y\in L$: $x\wedge y \in I \implies x\in I$ or $y\in I$.
\end{enumerate}
\end{enumerate}
\end{proposition}
If $L$ is only a $\wedge$-semilattice (resp. $\vee$-semilattice), then only the direction $\Rightarrow$ holds in general.
\begin{proof}
(1) Assume $F$ is a prime filter. Then $F \neq \top = \powerset(L)$, so it is proper. Now assume $x\vee y\in F$, meaning $\upset x\vee y \subseteq F$. Thus
\[ F = \Closure_\wedge (F\cup \upset(x\vee y)) = (F\vee \upset x) \cap (F\vee \upset y). \]
Because $F$ is prime, we have $F = F\vee \upset x$ or $F\vee \upset y$.

Now assume TODO \url{http://www.ascent-journals.com/IJPEM/Vol3No3/1-sagi.pdf} using \ref{joinIrreducibleLemma}.
\end{proof}

\section{Image filters}
\begin{lemma} \label{imageFilter}
Let $\sSet{P,\Yleft_P}$, $\sSet{Q, \Yleft_Q}$ be ordered sets, $f: P\to Q$ an order-preserving function and $F\subseteq P$ a filter. Then $\upset f^{\imf}(F)$ is a filter.
\end{lemma}
\begin{proof}
The set $\upset f^{\imf}(F)$ is downwards directed by \ref{imageDirectedSet}. It is upwards closed by construction.
\end{proof}
\begin{definition}
We call $\upset f^\imf[F]$ the \udef{image filter} of $F$ under $f$.
\end{definition}

\begin{proposition} \label{imageFilterSubbasis}
Let $P,Q$ be ordered sets, $f: P\to Q$ an order-preserving function and $\mathcal{B}\subseteq \powerset(P)$. Then
\begin{enumerate}
\item $\mathfrak{F}\big(f^{\imf}(\mathcal{B})\big) \subseteq \upset f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big)$;
\item if $\mathcal{B}$ is downward directed, then $\mathfrak{F}\big(f^{\imf}(\mathcal{B})\big) = \upset f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Since $\upset f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big)$ is a filter by \ref{imageFilter}, we have
\[ \upset f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big) = \mathfrak{F}\Big(f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big)\Big) \supseteq \mathfrak{F}\big(f^{\imf}(\mathcal{B})\big). \]

(2) One inclusion has already been proven. For the other direction, note that if $\mathcal{B}$ is downwards directed, then $\mathfrak{F}(\mathcal{B}) = \upset \mathcal{B}$, so
\[ \upset f^{\imf}\big(\mathfrak{F}(\mathcal{B})\big) = \upset f^{\imf}(\upset\mathcal{B}) = \upset f^{\imf}(\mathcal{B}) \subseteq \mathfrak{F}\big(f^{\imf}(\mathcal{B})\big). \]
\end{proof}

\section{Filters and ideals on a Boolean algebra}
\begin{proposition} \label{booleanMaximalFiltersIdeals}
Let $L$ be a Boolean lattice and $F\subseteq L$ an upwards closed subset. Then the following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item $F$ is a prime filter;
\item for all $x\in L$, exactly one of either $x\in F$ or $\overline{x}\in F$ holds.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO \ref{atomsJoinIrriducible} and \ref{BooleanUltrafilterDisjunction}. TODO: is upwards closure enough?
\end{proof}

TODO: compare with \ref{complementInIsotoneGrill} and \ref{complementUltrafilterIsIdeal}!


\begin{proposition}\label{filterGrillIsPrime}
Let $L$ be a Boolean lattice, $a,b\in L$ and $F \in \filters(L)$ a filter. If $a\vee b\in F^\mesh$, then either $a\in F^\mesh$ or $b\in F^\mesh$.
\end{proposition}
TODO: cfr. ultrafilters.
\begin{proof}
We have the implications, by \ref{deMorganLaws} and \ref{complementInIsotoneGrill},
\begin{align*}
a \vee b\in F^\mesh \iff& \overline{a\vee b} = \overline{a}\wedge\overline{b} \notin F \\
\implies& \big(\overline{a} \notin F\big)\lor \big(\overline{b} \notin F\big) \\
\iff& \big(a \in F^\mesh\big)\lor \big(b \in F^\mesh\big).
\end{align*}
\end{proof}

\begin{lemma} \label{subsetsFilterGrillIntersectionPrime}
Let $L$ be a Boolean lattice, $F,G\subseteq L$ upwards closed and $H\in \filters(L)$. Then $(F\cap G)\amesh H$ \textup{if and only if} $F\amesh H$ or $G \amesh H$.
\end{lemma}
\begin{proof}
The direction $\Leftarrow$ is straightforward: suppose $F\amesh H$, so $F\subseteq H^\mesh$, then $(F\cap G) \subseteq F \subseteq H^\mesh$ and thus $(F\cap G)\amesh H$. If $G\amesh H$, then the argument is similar.

For the other direction we prove the contrapositive. Suppose
$\neg(F\amesh H)$ and $\neg(G \amesh H)$. Then there exists $a\in F \setminus H^\mesh$ and $b\in G \setminus H^\mesh$. Thus $a\vee b\in (F\cap G)$ by upwards closure, but $a\vee b\notin H^\mesh$ by \ref{filterGrillIsPrime} and modus tollens. This means that $\neg\big((F\cap G)\subset H^\mesh\big)$ or $\neg\big((F\cap G)\amesh H\big)$.
\end{proof}

\subsection{Filter dualities}
\subsubsection{Filter filter-grill duality}
\begin{definition}
Let $L$ be a Boolean lattice. A subset $G\subseteq L$ is called a \udef{filter-grill} if it is the grill of a filter.
\end{definition}

\begin{proposition} \label{filterGrillEquivalences}
Let $L$ be a Boolean lattice and $G\subseteq L$ a subset. Then the following are equivalent:
\begin{enumerate}
\item $G$ is a filter-grill;
\item $G$ is upwards closed and $a\vee b\in G$ implies $a\in G$ or $b\in G$ for all $a,b\in G$;
\item $G$ is upwards closed and $G^\mesh$ is a filter.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Immediate from \ref{grillUpwardsClosed} and \ref{filterGrillIsPrime}.

$(2) \Rightarrow (3)$ We have that $G^\mesh$ is upwards closed by \ref{grillUpwardsClosed}. Now take $a,b\in G^\mesh$. Assume, towards a contradiction, that $a\wedge b\notin G^\mesh$. Then, by \ref{deMorganLaws} and \ref{complementInIsotoneGrill}, $\overline{a\wedge b} = \overline{a}\vee\overline{b} \in G$. By assumption, this means that either $\overline{a}\in G$ or $\overline{b}\in G$. In the first case, \ref{complementInIsotoneGrill} gives $a\notin G^\mesh$, a constradiction. In the second case, \ref{complementInIsotoneGrill} gives $b\notin G^\mesh$, also a constradiction.

$(3) \Rightarrow (1)$ In this case $G = G^{\mesh\mesh}$, by \ref{upwardClosureGrill}, so $G$ is a filter-grill.
\end{proof}

\subsubsection{Filter ideal duality}
\begin{proposition} \label{filterIdealDuality}
Let $L$ be a Boolean lattice and $F,I\subseteq L$. Then
\begin{enumerate}
\item if $F$ is a (proper) filter, then $I_F \defeq \setbuilder{\overline{x}}{x\in F}$ is a (proper) ideal;
\item if $I$ is a (proper) ideal, then $F_I \defeq \setbuilder{\overline{x}}{x\in I}$ is a (proper) filter;
\item the folowing are equivalent:
\begin{enumerate}
\item $I \mesh F$;
\item $F_I \vee F = L$;
\item $I_F \vee I = L$.
\end{enumerate}
\end{enumerate}
\end{proposition}

\begin{lemma} \label{complementUltrafilterIsIdeal}
Let $L$ be a Boolean lattice and $U\subseteq L$ an ultrafilter. Then
\[ U^c = \setbuilder{\overline{x}}{x\in U} \]
and this is an ideal.
\end{lemma}
\begin{proof}
By \ref{complementInIsotoneGrill} and \ref{ultrafilterCriteria}, we have
\begin{align*}
x \in U^c &\iff x \notin U \\
&\iff \overline{x} \in U^\mesh \\
&\iff \overline{x} \in U.
\end{align*}
That this is an ideal follows from \ref{filterIdealDuality}.
\end{proof}

\begin{lemma} \label{idealFromUltrafilter}
Let $L$ be a Boolean lattice, $F\in \filters(L)$ and $I\in \ideals(L)$. Then
\[ I \subseteq F^c \quad\iff\quad \exists U\in \ultrafilters(L): \; I \subseteq U^c \subseteq F^c. \]
\end{lemma}
\begin{proof}
The direction $\Leftarrow$ is immediate by transitivity of the inclusion.

Now assume $I \subseteq F^c$, then for all $a\in I$ we have $a\notin F$, which is equivalent to $\overline{a}\in F^\mesh$ by \ref{complementInIsotoneGrill}. Thus, setting $F_I \defeq \setbuilder{\overline{a}}{a\in I}$, which is a filter by \ref{filterIdealDuality}, we have $F \amesh F_I$. Thus $F\vee F_I$ is proper by \ref{joinProperFilter} and contained in an ultrafilter $U$ by \ref{ultrafilterLemma}.

Now this $U$ satisfies the requirements. Clearly $U^c\subseteq F^c$ and $I \subseteq \setbuilder{\overline{b}}{b\in U} = U^c$ by \ref{complementUltrafilterIsIdeal}.
\end{proof}

\begin{lemma} \label{compactnessEquivalentsLemma}
Let $L$ be a Boolean lattice, $F\in \filters(L)$ and $C\in \powerset(L)\setminus\{\emptyset\}$ Then
\[ C\in \big(\ultrafilters(L) \cap \upset \{F\}\big)^\mesh \qquad\iff\qquad F \mesh \mathfrak{I}(C). \]
\end{lemma}
\begin{proof}
We calculate
\begin{align*}
C\in \big(\ultrafilters(L) \cap \upset \{F\}\big)^\mesh &\iff C\in \Big(\big(\ultrafilters(L) \cap \upset \{F\}\big)\cup\{L\}\Big)^\mesh \\
&\iff C\in \Big(\upset\big(\ultrafilters(L) \cap \upset \{F\}\big)\Big)^\mesh \\
&\iff C^c \notin \big(\upset \ultrafilters(L) \cap \upset \{F\}\big) \\
&\iff C^c \notin \big(\ultrafilters(L) \cap \upset \{F\}\big)\cup \{L\} \\
&\iff \neg \Big(\exists U\in \ultrafilters(L): \; (U\subseteq C^c) \land (F \subseteq U)\Big) \land (C\neq \emptyset) \\
&\iff \neg \Big(\exists U\in \ultrafilters(L): \; (C\subseteq U^c) \land (U^c \subseteq F^c)\Big) \\
&\iff \neg \Big(\exists U\in \ultrafilters(L): \; (\mathfrak{I}(C)\subseteq U^c) \land (U^c \subseteq F^c)\Big) \\
&\iff \neg \big(\mathfrak{I}(C) \subseteq F^c\big) \\
&\iff F \mesh \mathfrak{I}(C),
\end{align*}
where we have used \ref{complementInIsotoneGrill}, the fact that $U^c$ is an ideal (\ref{complementUltrafilterIsIdeal}) and \ref{idealFromUltrafilter}.
\end{proof}

\begin{proposition} \label{ChoquetModificationFilterSet}
Let $L$ be a Boolean lattice and $\mathcal{F}$ an upwards closed set of filters and $F\in \filters(L)$. Then the following are equivalent:
\begin{enumerate}
\item $U\in \mathcal{F}$ for all ultrafilters $U\supseteq F$;
\item for all $C\in \mathcal{F}^\mesh$, there exist finitely many $c_0,\ldots, c_n \in C$ such that $c_0 \vee \ldots \vee c_n \in F$;
\item $F\in \mathfrak{I}^\imf(\mathcal{F}^\mesh)^\mesh$;
\end{enumerate}
\end{proposition}
\begin{proof}
We can restate (1) as $\big(\ultrafilters(L) \cap \upset\{F\}\big) \subseteq \mathcal{F}$. By \ref{upwardClosureGrill}, this is equivalent to $\mathcal{F}^\mesh \subseteq \big(\ultrafilters(L) \cap \upset\{F\}\big)^\mesh$. By \ref{compactnessEquivalentsLemma} it is equivalent to $F\mesh \mathfrak{I}(C)$ for all $C\in \mathcal{F}^\mesh$. This is a restatement of (2).

We can also restate this as
\[ F \in \bigcap_{C\in \mathcal{F}^\mesh} \{\mathfrak{I}(C)\}^\mesh = \Big(\bigcup_{C\in \mathcal{F}^\mesh}\{\mathfrak{I}(C)\}\Big)^\mesh = \mathfrak{I}^\imf(\mathcal{F}^\mesh)^\mesh. \]
This is (3).
\end{proof}

\subsection{Image filters and ideals}
Cfr. \ref{imageFilter}.

\begin{lemma} \label{filterInImageIsImageFilter}
Let $X, Y$ be sets, $f: X\to Y$ and $F\in \powerfilters(Y)$. If $\im(f)\in F$, then 
\begin{enumerate}
\item $\upset f^{\preimf\imf}(F)$ is proper;
\item $\upset f^{\imf\imf}\circ f^{\preimf\imf}(F) = F$.
\end{enumerate}
\end{lemma}
\begin{proof}
Point (1) follows from point (2).

From \ref{upsetPreimageImageGaloisConnection}, we have that $F\subseteq \upset f^{\imf\imf}\circ f^{\preimf\imf}(F)$. For the other inclusion, take $A\in f^{\imf\imf}\circ f^{\preimf\imf}(F)$. Then there exists $B\in F$ such that $A = (f^\imf\circ f^\preimf)(B)$. Now $B\cap \im(f)\in F$ and there exists $C\subseteq X$ such that $B\cap \im(f) = f^\imf(C)$. Thus
\[ B\cap \im(f) = f^\imf(C) = (f^\imf\circ f^\preimf\circ f^\imf)(C) = (f^\imf\circ f^\preimf)\big(B\cap \im(f)\big) \subseteq (f^\imf\circ f^\preimf)(B) = A. \]
This implies that $A\in F$.
\end{proof}

\begin{proposition} \label{imageFilterProperties}
Let $X, Y$ be sets, $f: X\to Y$ a function, $F\in\powerfilters(X)$ and $G\in\powerfilters(Y)$. Then
\begin{enumerate}
\item if $F$ is proper, then $\upset f^{\imf\imf}[F]$ is proper;
\item if $F$ is an ultrafilter, then $\upset f^{\imf\imf}[F]$ is also an ultrafilter;
\item if $G$ is an ultrafilter, $\im(f)\in G^\mesh$ and $f$ is injective, then $\upset f^{\preimf\imf}[G]$ is also an ultrafilter.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have
\[ \emptyset \in \upset f^{\imf\imf}[F] \iff \emptyset\in f^{\imf\imf}[F] \iff \emptyset\in F. \]

(2) We verify $\upset f^{\imf\imf}[F]$ is an ultrafilter with \ref{ultrafilterCriteria}. As $F$ is proper, $\upset f^{\imf\imf}[F]$ is proper by the first point. Now take $B\subseteq Y$ and assume $B\in \upset f^{\imf\imf}[F]^\mesh$. Then, by \ref{meshConnectionSetsOfSets},
\[ B\in \upset f^{\imf\imf}[F]^\mesh \iff \upset f^{\imf\imf}[F] \amesh \{B\} \iff f^{\imf\imf}[F] \amesh \{B\} \iff F \amesh f^{\preimf\imf}[\{B\}] = \{f^\preimf(B)\}. \]
As $F$ is an ultrafilter, we have $f^\preimf(B) \in F$ by \ref{ultrafilterCriteria}. Then $f^{\imf\imf}[F] \ni f^\imf(f^\preimf)(B) \subseteq B$, so $B\in \upset f^{\imf\imf}[F]$.

(3) As before, we verify $\upset f^{\preimf\imf}[G]$ is an ultrafilter with \ref{ultrafilterCriteria}. If $\im(f)\in G^\mesh$, then $\upset f^{\preimf\imf}[G]$ is proper. Now take $A\subseteq X$ and assume $A\in (\upset f^{\preimf\imf}[G])^\mesh$. Then, by \ref{meshConnectionSetsOfSets},
\[ A\in (\upset f^{\preimf\imf}[G])^\mesh \iff \upset f^{\preimf\imf}[G] \amesh \{A\} \iff f^{\preimf\imf}[G] \amesh \{A\} \iff G \amesh f^{\imf\imf}[\{A\}] = \{f^\imf(A)\}. \]
As $G$ is an ultrafilter, we have $f^\imf(A) \in G$ by \ref{ultrafilterCriteria}. As $f$ is injective, we have $A = f^{\preimf}\big(f^\imf(A)\big) \in f^{\preimf\imf}(G)$.
\end{proof}
\begin{corollary} \label{imageFilterUltraIffUltra}
Let $X, Y$ be sets, $f: X\to Y$ an injective function and $F\in\powerfilters(X)$. Then $\upset f^{\imf\imf}[F]$ is an ultrafilter \textup{if and only if} $F$ is an ultrafilter.
\end{corollary}
\begin{proof}
One direction was shown in (2) of the proposition. For the other, assume $\upset f^{\imf\imf}[F]$ is an ultrafilter. Then $F$ is proper by point (1) and $\upset f^{\preimf\imf}\big[\upset f^{\imf\imf}[F]\big]$ is ultra by point (3) of the proposition and because $f^{\preimf\imf}\big[\upset f^{\imf\imf}[F]\big] \subseteq F$ by \ref{upsetPreimageImageGaloisConnection}, $F$ must also be ultra.  
\end{proof}

\begin{lemma}
Let $X, Y$ be sets, $f: X\to Y$ a function and $G\in\powerfilters(Y)$. If $f$ is injective and $\im(f)\in G$, then $f^{\preimf\imf}(G)$ is upwards closed. In particular $f^{\preimf\imf}(G)$ is a filter.
\end{lemma}
\begin{proof}
Take $B\in G$ ans suppose $A\subseteq X$ is such that $f^\preimf(B)\subseteq A$, then we need to show that $A\in f^{\preimf\imf}(G)$. Then
\[ f^\preimf(B)\subseteq A = f^{\preimf}\big(f^\imf(A)\big) \iff f^\imf\big(f^\preimf(B)\big) \subseteq f^\imf(A) \iff B\cap \im(f) \subseteq f^\imf(A).  \]
As $\im(f)\in G$, we have $B\cap \im(f)\in G$ and thus $f^{\imf}(A)\in G$ by upwards closure. Then $A = f^{\preimf}\big(f^\imf(A)\big) \in G^{\preimf\imf}$.
\end{proof}

\begin{lemma} \label{mappingUltrafiltersLemma}
Let $X,Y$ be sets, $f: X\to Y$ a function, $F\in\powerfilters(X)$, $V\in \powerultrafilters(Y)$ and $A\subseteq X$. Then
\begin{enumerate}
\item if $\im(f)\in V^\mesh$, then $V = \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big)$;
\item if $\upset f^{\imf\imf}(F)\subseteq V$, then there exists $U\in \powerultrafilters(X)$ such that $\upset f^{\imf\imf}(U) = V$ and $F\subseteq U$;
\item if $f^{\imf}(A)\in V$, then there exists $U\in \powerultrafilters(X)$ such that $\upset f^{\imf\imf}(U) = V$ and $A\in U$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We have that $V \subseteq \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big)$ by \ref{upsetPreimageImageGaloisConnection} and $\upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big)$ is proper (since $\im(f)\in V^\mesh$), so the equality follows because $V$ is ultra.

Alternatively, we can observe that $V = V^\mesh$, by \ref{ultrafilterCriteria}. Then $V = \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big)$ follows from \ref{filterInImageIsImageFilter}.

(2) By \ref{ultrafilterCriteria}, we have $\upset f^{\imf\imf}(F)\subseteq V = V^\mesh$, so by \ref{meshConnectionSetsOfSets}
\[ f^{\imf\imf}(F) \amesh V \iff F\amesh f^{\preimf\imf}(V). \]
Thus $F\vee f^{\preimf\imf}(V)$ is proper by \ref{joinProperFilter}.

Now we can find an ultrafilter $U$ larger than $F\vee f^{\preimf\imf}(V)$ by \ref{ultrafilterLemma}. Clearly $F\subseteq U$. Also $V \subseteq \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big) \subseteq \upset f^{\imf\imf}(U)$. As the last filter is still proper, we have $V = \upset f^{\imf\imf}(U)$.

(3) An application of (2) where $F = \upset \{A\}$.
\end{proof}

\section{Free and principal filters}
\begin{definition}
Let $L$ be a complete lattice and $F\subseteq L$ a filter.
\begin{itemize}
\item The \udef{kernel} of the filter $F$ is $\ker F \defeq \bigwedge F$.
\item A filter is called \udef{principal} if $\ker F \in F$;
\item A filter is called \udef{free} if $\ker F = \bot$.
\end{itemize}
The set of principal filters in $P$ is denoted $\filters_*(P)$ and the set of free filters in $P$ is denoted $\filters_0(P)$.
\end{definition}
The only filter that is both principal and free is $L$. A proper filter cannot be both principal and free.

\begin{lemma}
Let $L$ be a lattice and $F$ a filter in $L$. Then $F$ is principal \textup{if and only if} $F = \upset \{\ker F\}$.
\end{lemma}
\begin{proof}
First assume $F$ is principal. Then $\upset \{\ker F\}\subseteq F$ by upwards closure. To show the other inclusion, take $a\in F$. Then $\ker(F)\leq a$ by definition, so $F = \upset \{\ker F\}$.

The other direction is immediate.
\end{proof}

\begin{lemma} \label{kernelFilterBase}
Let $L$ be a complete lattice, $F\in\filters(L)$ and $\mathcal{B}$ a base of $F$. Then $\ker(F) = \bigwedge \mathcal{B}$.
\end{lemma}

\begin{proposition} \label{principalUltrafilters}
Let $L$ be a complete lattice and $a\in L$ an atom. Then
\begin{enumerate}
\item $\upset\{a\}$ is a principal ultrafilter;
\item every principal ultrafilter is of this form.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) The filter $\upset\{a\}$ is principal by construction. To show it is an ultrafilter, assume, towards a contradiction, that there exists a strictly larger proper filter $F$ and take $x\in F\setminus \upset\{a\}$. Then $x\wedge a\in F$. Because $x\wedge a \in L$ is smaller than $a$, we have $x\wedge a = \bot$ by atomicity. Thus $\bot \in F$, so $F$ is not proper, which is a contradiction.

(2) Let $\upset\{b\}$ be a principal ultrafilter. Assume, towards a contradiction, that there exists $c\in L$ such that $\bot < c < b$. Then $\upset\{c\}$ is a larger proper filter and thus $\upset\{b\}$ is not an ultrafilter. This is a contradiction.
\end{proof}

\begin{lemma}
Let $L$ be a lattice and $F$ a free filter in $L$. Then
\begin{enumerate}
\item if $G\supseteq F$, then $G$ is also free.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{finiteFiltersPrincipal}
Let $L$ be a lattice. If $L$ is finite, then every filter in $L$ is principal.
\end{lemma}
In particular, every ultrafilter is a principal ultrafilter.
\begin{proof}
Every filter $F$ in a finite lattice is finite, so $\bigwedge F$ is a finite meet, and thus must be in $F$.
\end{proof}

\begin{proposition}
Let $L$ be a lattice and $\mathcal{F}$ a set of filters. Then
\begin{enumerate}
\item $\ker\Big(\bigcap\mathcal{F}\Big) \geq \bigvee_{F\in\mathcal{F}} \ker(F)$;
\end{enumerate}
\end{proposition}
\begin{proof}
(1) As $\ker$ is order-reversing, we can apply \ref{orderPreservingFunctionLatticeOperations}. 
\end{proof}

\begin{proposition} \label{freePrincipalDecomposition}
Let $L$ be a complete Boolean lattice and $F\subseteq L$ a filter. Then there exists a unique pair of filters $F_*$ and $F_0$ such that $F_*$ is principal, $F_0$ is free and
\[ F = F_* \wedge F_0 \qquad L = F_* \vee F_0. \]
These filters are given by
\[ F_* = \upset\left\{\ker(F)\right\} \quad\text{and}\quad F_0 = F\vee \upset\left\{\overline{\ker(F)}\right\}.  \]
\end{proposition}
We call $F_*$ the \udef{principal part} and $F_0$ the \udef{free part} of the filter.
\begin{proof}
We first verify that the given $F_*$ and $F_0$ satisfy the requirements of the decomposition.

We have that $F_0$ is free, because by \ref{kernelFilterBase} and \ref{baseMeetJoinFilters}, we have
\[ \ker(F_0) = \bigwedge_{a\in F} \overline{\ker(F)}\wedge a = \overline{\ker(F)}\wedge \bigwedge_{a\in F} A = \overline{\ker(F)}\wedge \ker(F) = \bot. \]
It is clear that $F_*$ and $F_0$ do not mesh, so $L = F_* \vee F_0$.

Now $F_* \wedge F_0$ has a base $\setbuilder{\left(a\wedge \overline{\ker(F)}\right)\vee \ker(F)}{a\in F}$ by \ref{baseMeetJoinFilters}. We have
\begin{align*}
\left(a\wedge \overline{\ker(F)}\right)\vee \ker(F) &= \left(a\vee \ker(F)\right)\wedge \left(\ker(F) \vee \overline{\ker(F)}\right) \\
&= \left(a\vee \ker(F)\right)\wedge \top = a\vee \ker(F) = a,
\end{align*}
where the last step follows because $\ker(F)\leq a$. Thus $F_* \wedge F_0 = F$ because they have the same base.

Finaly we need to show that the decomposition is unique. We have
\begin{align*}
\ker(F) &= \ker(F_* \wedge F_0) \\
&= \bigwedge_{a\in F_0} \ker(F_*) \vee a \\
&= \ker(F^*) \vee \bigwedge_{a\in F_0}a \\
&= \ker(F_*)\vee \ker(F_0) \\
&= \ker(F_*)\vee \bot = \ker(F_*),
\end{align*}
using \ref{kernelFilterBase}, \ref{baseMeetJoinFilters} and \ref{infiniteDistributiveLawsBooleanLattices}. This uniquely determines the principal filter $F_*$.

In order for $L = F_* \vee F_0$ to hold, we must have some $x\in F_0$ such that $x\wedge \ker(F) = \bot$. This implies $x\leq \overline{\ker(F)}$ by \ref{BooleanComplementLargestDisjoint}, so $F\vee \upset\left\{\overline{\ker(F)}\right\} \subseteq F_0$.

Conversely, take $x\in F_0$. Then $F = F_*\wedge F_0$ implies $x\vee \ker(F) \in F$ and thus
\begin{align*}
x \geq x\wedge \overline{\ker(F)} &= \big(x\wedge \overline{\ker(F)}\big) \vee \bot \\
&= \big(x\wedge \overline{\ker(F)}\big) \vee \big(\ker(F) \wedge \overline{\ker(F)}\big) \\
&= \big(x\vee \ker(F)\big)\wedge \overline{\ker(F)} \in F\vee \upset\left\{\overline{\ker(F)}\right\}.
\end{align*}
This completes the proof of unicity.
\end{proof}
\begin{corollary} \label{ultrafilterPrincipalOrFree}
An ultrafilter is either principal or free.
\end{corollary}
\begin{proof}
Suppose the ultrafilter is neither principal nor free, then is is contained in both its principal and free parts, which are necessarily non-trivial.
\end{proof}


\subsection{Trace filters}
\begin{definition}
Let $S$ be a bounded $\wedge$-semilattice, $a\in S$ and $F\in\filters(S)$ such that $a\in F^\mesh$.
Then
\[ F|_a \defeq F\vee \upset\{a\} = \upset\setbuilder{x\wedge a}{x\in F} \]
is a proper filter, called the \udef{trace filter} of $F$ on $a$.
\end{definition}

\begin{lemma} \label{traceFilterLemma}
Let $S$ be a bounded $\wedge$-semilattice, $a\in S$ and $F\in\filters(S)$. Then
\begin{enumerate}
\item $a\in F|_a$;
\item $a\in F$ \textup{if and only if} $F = F|_a$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We have $\top \in F$, so $\top\wedge a = a \in F|_a$.

(2) If $a\in F$, then $\setbuilder{x\wedge a}{x\in F} \subseteq F$ and thus
\[ F \subseteq \upset\setbuilder{x\wedge a}{x\in F} \subseteq F. \]

If $F = F|_a$, then $F$ is a filter on $a$ by point (1).
\end{proof}

\chapter{Domain theory}
\section{Finiteness or compactness}
\subsection{The way-below relation}
\begin{definition}
Let $P$ be a poset and $x,y\in P$. We say $x$ is \udef{way below} $y$ or $x$ \udef{approximates} $y$ if for all non-empty directed $D\subseteq P$ that has a supremum, we have
\[ y\leq \dirvee D \quad\implies\quad x\in \downset D. \]
This is denoted $x\ll y$.

For all $A\subseteq P$ we define
\begin{align*}
\uupset A &\defeq \setbuilder{y\in P}{\exists x\in A: \; x \ll y} \\
\ddownset A &\defeq \setbuilder{x\in P}{\exists y\in A: \; x \ll y}.
\end{align*}
\end{definition}
If we do not specify that $D$ must be non-empty, then $\bot$ is not finite.

\begin{lemma} \label{wayBelowEquivalents}
Let $P$ be a poset and $x,y\in P$. Then
\begin{enumerate}
\item $x \ll y$ \textup{if and only if} for every order ideal $I\subseteq P$ such that $\dirvee I$ exists, $y\leq \dirvee I$ implies $x\in I$;
\item if \emph{$P$ is a $\vee$-semilattice}, then $x \ll y$ \textup{if and only if} for every subset $A\subseteq P$ such that $\bigvee A$ exists, $y\leq \bigvee A$ implies $x\leq \bigvee B$ for some finite $B\subseteq A$.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{principalDdownsetInclusionProperty}
Let $P$ be a poset, $x\in P$ and $I\subseteq P$ an order ideal. Then
\begin{enumerate}
\item if $x\leq \dirvee I$, then $\ddownset\{x\} \subseteq I$;
\item $\ddownset\{x\} = \bigcap \setbuilder{I\in\ideals(P)}{\text{$\dirvee I$ exists and $x\leq \dirvee I$}}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Suppose $x\leq \dirvee I$ and take $a \in\ddownset\{x\}$, so $a \ll x$. Then $a\in I$ by \ref{wayBelowEquivalents}.

(2) Reformulation of \ref{wayBelowEquivalents}.
\end{proof}

\begin{lemma} \label{wayBelowImpliesLessThan}
Let $P$ be a poset and $x,y\in P$ such that $x\ll y$. Then $x\leq y$.
\end{lemma}
\begin{proof}
The singleton $\{y\}$ is directed and $y = \dirvee \{y\}$, so $x\in \downset\{y\}$, i.e.\ $x\leq y$.
\end{proof}

\begin{lemma}
Let $X$ be a set and consider the poset $\powerset(X)$. Let $A,B\in\powerset(X)$ such that $B\subseteq A$. Then $B \ll A$ \textup{if and only if} $B$ is finite.
\end{lemma}
\begin{proof}
First, suppose $B\subseteq A$ is finite. Let $\mathcal{D}\subseteq \powerset(X)$ be directed. Then $\bigcup \mathcal{D}$ exists in $\powerset(X)$. If $A\subseteq \bigcup \mathcal{D}$, then for all $b\in B$, there exists $D_b\in \mathcal{D}$ such that $b\in D_b$. Since $\mathcal{D}$ is directed, it contains an upper bound $C$ of $\{D_b\}_{b\in B}$, so $\bigcup_{b\in B}D_b \subseteq C$. Then $B\subseteq C$ and so $B\in \downset \mathcal{D}$.

Now suppose $B\subseteq A$ is not finite. Let $\mathcal{D}$ be the set of all finite subsets of $A$, which is directed. Clearly $A = \dirvee \mathcal{D}$, but $B\notin \downset \mathcal{D} = \mathcal{D}$.
\end{proof}

\begin{lemma} \label{wayBelowAbsorbsLessThan}
Let $P$ be a poset. Then
\begin{enumerate}
\item $\leq;\ll \;\subseteq\; \ll$;
\item $\ll;\leq \;\subseteq\; \ll$.
\end{enumerate}
In particular,
\begin{enumerate} \setcounter{enumi}{2}
\item $\ll$ is transitive;
\item $\ddownset A$ is downwards closed for all subsets $A\subseteq P$.
\end{enumerate}
\end{lemma}
In other words, for all $x,y,z\in P$,
\begin{itemize}
\item $x\leq y$ and $y\ll z$ imply $x\ll z$;
\item $x\ll y$ and $y\leq z$ imply $x\ll z$.
\end{itemize} 
\begin{proof}
(1) Suppose $x,y,z\in P$ are such that $x\leq y$ and $y\ll z$. Suppose $D$ is a non-empty directed set with supremum such that $z\leq \dirvee D$. Then $y\in \downset D$. Since $x\leq y$, we have $x\in \downset D$.

(2) Suppose $x,y,z\in P$ are such that $x\ll y$ and $y\leq z$. Suppose $D$ is a non-empty directed set with supremum such that $z\leq \dirvee D$. Then $y \leq z\leq \dirvee D$, so $x\in \downset D$.

(3) From (1) and \ref{wayBelowImpliesLessThan}, we have $\ll;\ll \;\subseteq\; \leq;\ll \;\subseteq\; \ll$.

(4) We calculate
\[ \downset(\ddownset A) = (A \cup A_\gg)_{\geq} \subseteq (A \cup A_\gg)_{\geq} \subseteq (A_{\gg})_\geq = A_{(\gg;\geq)} \subseteq A_\gg \subseteq A\cup A_\gg = \ddownset A. \]
\end{proof}

\begin{lemma} \label{joinWayBelow}
Let $P$ be a poset and $x,y,z\in P$ such that $x\vee y$ exists. If $x\ll z$ and $y \ll z$, then $x\vee y \ll z$.
\end{lemma}
\begin{proof}
Suppose $D$ is a non-empty directed set with supremum such that $z\leq \dirvee D$. Then $x, y\in \downset D$, so there exist $d,e\in D$ such that $x\leq d$ and $y\leq e$. Now $\{d,e\}$ has an upper bound in $D$ since it is directed, say $f$. Then $f$ is also an upper bound of $\{x,y\}$, so $x\vee y \leq f$ by definition. This implies $x\vee y \in \downset D$ and so $x\vee y \ll z$.
\end{proof}
\begin{corollary} \label{ddownsetOrderIdealInJoinSemilattice}
Let $S$ be a $\vee$-semilattice and $A\subseteq P$ a directed subset. Then $\ddownset A$ is an order ideal in $P$.
\end{corollary}
\begin{proof}
The set $\ddownset A$ is downwards closed by \ref{wayBelowAbsorbsLessThan}.

To show that it is directed, take $x_1,x_2 \in \ddownset A$. Then there exist $y_1, y_2\in A$ such that $x_1 \ll y_1$ and $x_2 \ll y_2$. Since $A$ is directed, there exists $z\in A$ such that $y_1\leq z$ and $y_2\leq z$. By \ref{wayBelowAbsorbsLessThan}, this implies $x_1 \ll z$ and $x_2 \ll z$. By the lemma $x_1\vee x_2 \in \ddownset A$.
\end{proof}

\begin{lemma}
Let $P$ be a poset with minimum $\bot$. Then $\bot \ll x$ for all $x\in P$.
\end{lemma}
In particular, $\bot$ is compact.
\begin{proof}
Suppose $D$ is a non-empty directed set with supremum such that $x\leq \dirvee D$. Then there exists $d\in D$. Since $\bot \leq d$, we have $\bot \in\downset D$. 
\end{proof}

\begin{lemma} \label{wayBelowDirectedSup}
Let $P$ be a poset, $x\in P$ and $D\subseteq P$ a non-empty directed subset with supremum. Then $x \ll \dirvee D$ implies $x\in \downset D$.
\end{lemma}
We can restate this as $\ddownset\{\dirvee D\} \subseteq \downset D$.
\begin{proof}
This follows immediately from $\dirvee D \leq \dirvee D$ and the definition of $\ll$.
\end{proof}

\begin{example}
Let $\sSet{X,\mathcal{T}}$ be a topological space. Then $\mathcal{T}$ is a complete sublattice of $\powerset(X)$ and for $A,B\in \mathcal{T}$ we have $A \ll B$ if and only if there exists a compact set $C$ such that $A\subseteq C\subseteq B$. 
\end{example}

\subsection{Finite or compact elements}
\begin{definition}
Let $P$ be a poset and $x\in P$. Then $x$ is called \udef{compact} or \udef{finite} if $x\ll x$. We denote the set of compact elements in $P$ by $\compacts(P)$.
\end{definition}

\begin{example}
Consider the interval $\interval{0,1}$ with the usual order and $x,y\in \interval{0,1}$. Then $x\ll y$ if and only if $x < y$ or $x=0=y$.

Thus the only finite element is $0$.
\end{example}

\begin{lemma} \label{downsetCompactElement}
Let $P$ be a poset, $x\in \compacts(P)$ a compact element and $y\in P$. Then
\begin{enumerate}
\item $\ddownset\{x\} = \downset\{x\}$;
\item $\ddownset\{y\} \cap \compacts(P) = \downset\{y\} \cap \compacts(P)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) First suppose $y\in \ddownset\{x\}$, so $y \ll x$. Then $y\leq x$ by \ref{wayBelowImpliesLessThan}, so $y\in \downset\{x\}$.

Now suppose $y\in \downset\{x\}$. Then $y \leq x \ll x$, so $y \ll x$ by \ref{wayBelowAbsorbsLessThan} and $y\in \ddownset\{x\}$.

(2) We have $\ddownset\{y\} \cap \compacts(P) \subseteq \downset\{y\} \cap \compacts(P)$ by \ref{wayBelowImpliesLessThan}.

Now take $a\in \downset\{y\} \cap \compacts(P)$. Then $a \ll a \leq y$, so $a\ll y$ by \ref{wayBelowImpliesLessThan} and $a\in \ddownset\{y\} \cap \compacts(P)$.
\end{proof}

\begin{proposition} \label{compactsDirected}
Let $S$ be a $\vee$-semilattice. The set $\compacts(S)$ of compact elements is closed under finite joins.
\end{proposition}
In particular, the set $\compacts(S)$ of compact elements is directed.
\begin{proof}
Take $x,y\in \compacts(S)$. Since $x \ll x \leq x \vee y$, we have $x \ll x\vee y$ by \ref{wayBelowAbsorbsLessThan}. Similarly $y \ll x\vee y$, so $x\vee y \ll x\vee y$ by \ref{joinWayBelow}. Thus $x\vee y\in \compacts(S)$.
\end{proof}

\begin{example}
Even in a lattice, the set $\compacts(S)$ of compact elements is not generally closed under finite meets. For example, consider
\[ \begin{tikzcd}
& \top \ar[dl, dash] \ar[dr, dash] & \\
x \ar[dr, dash] & {} & y \ar[dl, dash] \\
{} & x\wedge y \ar[d, dash, dotted] & {} \\
{} & \bullet \ar[d, dash] & {} \\
{} & \bullet & {}
\end{tikzcd} \]
Both $x$ and $y$ are compact, but $x\wedge y$ is not.
\end{example}

\begin{example}
The set of compact elements is not generally downwards closed, even in a lattice, and so not an order ideal.

Let $\sSet{X,\mathcal{T}}$ be a compact topological space. Then $X \ll X$ in $\mathcal{T}$, but it is not true that all open sets are finite.
\end{example}

\subsection{Continuous and algebraic posets}
\begin{definition}
Let $P$ be a poset. Then $P$ is called a \udef{continuous poset} if, for all $x\in P$,
\begin{itemize}
\item $\ddownset \{x\}$ is an ideal;
\item $x = \dirvee\; \ddownset \{x\}$.
\end{itemize}
The second property is also called the \udef{approximation property}.

A \udef{continuous lattice} is a \emph{complete} lattice that is a continuous poset.
\end{definition}
Note that the first point is automatically satisfied in $\vee$-semilattices, see \ref{ddownsetOrderIdealInJoinSemilattice}. In a general poset $\ddownset \{x\}$ is downwards closed, so we only need to verify that it is directed.

For us, a continuous lattice is a lattice that is continuous. Many authors define a continuous lattice as a complete lattice that is continuous.

\begin{lemma} \label{downsetEmbeddingContinuousPosets}
Let $P$ be a poset and $x,y\in P$. Then 
\begin{enumerate}
\item $x\leq y$ implies $\ddownset \{x\} \subseteq \ddownset \{y\}$;
\item if $P$ is continuous, then the converse also holds.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take $a\in \ddownset\{x\}$, so $a \ll x \leq y$. Then $a \ll y$ and thus $a\in \ddownset\{y\}$ by \ref{wayBelowAbsorbsLessThan}.

(2) We have $x = \dirvee \ddownset\{x\} \leq \dirvee \ddownset\{y\} = y$.
\end{proof}

\begin{proposition}
Let $P$ be a poset. Then the following are equivalent:
\begin{enumerate}
\item $P$ is a continuous poset;
\item for all $x\in P$, the set $\ddownset \{x\}$ is the smallest order ideal $I$ with $x\leq \bigvee I$;
\item for all $x\in P$, there exists a smallest order ideal $I$ with $x\leq \bigvee I$.
\end{enumerate}
If $P$ is a $\vee$-semilattice, then the above are also equivalent to
\begin{enumerate} \setcounter{enumi}{3}
\item the supremum map $s: \ideals(P)\to P: I\mapsto \bigvee I$ has a lower adjoint;
\item the supremum map $s: \ideals(P)\to P: I\mapsto \bigvee I$ preserves infima and suprema.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ For all ideals $I\subseteq L$ such that $x\leq \bigvee I$, we have $\ddownset \{x\} \subseteq I$ by \ref{principalDdownsetInclusionProperty}. Since $\ddownset \{x\}$ is such an ideal by hypothesis of continuity, the result follows.

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (1)$ If there exists a smallest such ideal, then it is equal to $\bigcap \setbuilder{I\in\ideals{P}}{\text{$\dirvee I$ exists and $x\leq \dirvee I$}}$. By \ref{principalDdownsetInclusionProperty} this is equal to $\ddownset\{x\}$.

$(3) \Leftrightarrow (4) \Leftrightarrow (5)$ We have
\[ s^\preimf(\upset x) = \setbuilder{I\in\ideals{P}}{\text{$\dirvee I$ exists and $x\leq \dirvee I$}}, \]
which is a principal up set iff it has a minimum, which is exactly the statement (3). The equivalences then follow from \ref{GaloisConnectionLatticePreservation}, since in this case $\ideals(P)$ is a complete $\wedge$-semilattice by \ref{filterSetIdealSetWedgeSemilattice}.
\end{proof}
\begin{corollary}
Every completely distributive complete lattice is continuous.
\end{corollary}
\begin{proof}
In a completely distributive complete lattice, the supremum map $\powerset(L)\to L: A\mapsto \bigvee A$ preserves infima and suprema. Thus, in particular, the restriction $\ideals(L)\to L: I\mapsto \bigvee I$ preserves infima and suprema.
\end{proof}

\subsubsection{Base of a poset}
\begin{definition}
Let $P$ be a poset. A \udef{base} of the poset is a subset $B\subseteq P$ such that for all $x\in P$, there exists a directed set $D\subseteq B$ such that
\begin{itemize}
\item $x\in D^\ll$ (or, equivalently, $D\subseteq \ddownset\{x\}$);
\item $x = \dirvee D$.
\end{itemize}
\end{definition}

\begin{lemma} \label{posetBaseInclusionLemma}
Let $P$ be a poset with base $B$ and $B'\subseteq P$. If $B\subseteq B'$, then $B'$ is a base.
\end{lemma}
\begin{proof}
Immediate from the definition.
\end{proof}

\begin{lemma} \label{approximatingSetDirected}
Let $P$ be a poset, $x\in P$ and $A\subseteq P$ a subset. If there exists a directed set $D\subseteq P$ such that $D\subseteq A \subseteq \ddownset\{x\}$ and $x = \dirvee D$, then
\begin{enumerate}
\item $A$ is directed;
\item $\dirvee A = x$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take $a, b\in A$. Since $A\subseteq \ddownset\{x\}$, we have $a \ll x$ and $b\ll x$. By definition of the way-below relation, we have $a,b\in \downset D$. Thus there exist $a',b'\in D$ such that $a\leq a'$ and $b\leq b'$. Now $\{a',b'\}$ has an upper bound in $D$ by directedness. This upper bound is also an upper bound of $\{a,b\}$ and is an element of $A$ because $D\subseteq A$.

(2) We have $\ddownset\{x\}\subseteq \downset \{x\}$, so $\big(\downset \{x\}\big)^\leq \subseteq \big(\ddownset\{x\}\big)^\leq$. Since $x\in \big(\downset \{x\}\big)^\leq$ and $\big(\downset \{x\}\big)^\leq$ is upwards closed, we calculate
\[ \upset \{x\} \subseteq \big(\downset \{x\}\big)^\leq \subseteq \big(\ddownset\{x\}\big)^\leq \subseteq A^\leq \subseteq D^\leq = \upset \{\dirvee D\} = \upset \{x\}. \] 
Cfr. \ref{boundsOnSetWithLeastBoundIsPrincipalIdeal}. This implies $\dirvee A = x$.
\end{proof}

\begin{proposition} \label{posetContinuousIffHasBase}
Let $P$ be a poset. Then the following are equivalent:
\begin{enumerate}
\item $P$ is continuous;
\item for all $x\in P$ there exists a directed $D\subseteq \ddownset\{x\}$ such that $x = \dirvee D$;
\item $P$ is a base of itself;
\item $P$ has a base.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ For all $x\in P$ we can set $D = \ddownset \{x\}$.

$(2) \Rightarrow (3) \Rightarrow (4)$ Immediate.

$(4) \Rightarrow (1)$ Suppose $B$ is a base of $P$. Take arbitrary $x\in P$. Then there exists a directed subset $D\subseteq B$ such that $D\subseteq \ddownset\{x\}$ and $x = \dirvee D$.

First we observe that $\ddownset\{x\}$ is an ideal. Directedness is given by \ref{approximatingSetDirected}. We have that $\ddownset\{x\}$ is downwards closed by \ref{wayBelowAbsorbsLessThan}. The approximation property also follows from \ref{approximatingSetDirected}.
\end{proof}

\begin{lemma} \label{compactsInPosetBase}
Let $P$ be a poset with a base $B$. Then $\compacts(P)\subseteq B$.
\end{lemma}
\begin{proof}
Take $x\in \compacts(P)$, so $x\ll x$. Suppose $D$ is a directed subset of both $B$ and $\ddownset\{x\}$ such that $x = \dirvee D$. Then $x\in \downset D$, so there exists $d\in D$ such that $x\leq d$. Since $d\ll x$, we also have $d\leq x$, which implies $d = x$. Thus $x\in D\subseteq B$.
\end{proof}

\begin{proposition} \label{finiteRemovalNonCompactElementsFromBase}
Let $P$ be a poset with base $B$ and $b\in B$. If $b$ is not compact, then $P\setminus\{b\}$ is a base of $P$.
\end{proposition}
\begin{proof}
By definition of a base, there exists $D\subseteq B$ such that $D\subseteq \ddownset\{b\}$ and $b = \dirvee D$. Since $b$ is not compact, we have $b \notin \ddownset\{b\}$ and so $b\notin D$. Thus $D\subseteq B\setminus\{b\}$.

Now take arbitrary $x\in P\setminus\{b\}$. Then take $D_x \subseteq B$ such that $D_x\subseteq \ddownset\{x\}$ and $x = \dirvee D_x$. If $b\notin D_x$, then $D_x\subseteq B\setminus \{b\}$.

Suppose $b\in D_x$, then consider $D_x'\defeq \big(D_x\setminus \{b\}\big)\cup D \subseteq B\setminus \{b\}$. We claim this satisfies the requirements.

Since $\dirvee D_x = x \neq b$, $b$ is not maximal in $D_x$ and there exists $c\in D_x$ such that $c\nleq b$. Then $D_x$ contains a $d$ that upper bounds $\{b,c\}$ by directedness and $d\neq b$ by construction.
To show $D_x'$ is directed, take $\{y,z\}\subseteq D_x'$. If either $y\in D$ or $z\in D$, then they are less than $d$ and it is enough to find an upper bound of $\{y,z,d\}\cap D_x$ in $D_x$. This can be found since $D_x$ is directed and this upper bound is not $b$, so it is in $D_x'$.

Since $b\in D_x$, we have $b \ll x$, so $D\subseteq \ddownset\{b\} \subseteq \ddownset\{x\}$ by the transitivity of $\ll$, \ref{wayBelowAbsorbsLessThan}. Since also $\big(D_x\setminus \{b\}\big) \subseteq \ddownset\{x\}$, we have $D_x'\subseteq \ddownset\{x\}$.

We also calculate
\[ x = \dirvee D_x = b \vee \bigvee \big(D_x\setminus b\big) = \bigvee D \vee \bigvee \big(D_x\setminus b\big) = \bigvee \Big(D \cup \big(D_x\setminus b\big)\Big), \]
using \ref{joinMeetUnion}.
\end{proof}


\subsubsection{Algebraic posets}
\begin{definition}
A poset $P$ is called \udef{algebraic} if it has a base of compact elements.
\end{definition}
For us, an algebraic lattice is a lattice that is algebraic. Many authors define an algebraic lattice as a complete lattice that is algebraic.

\begin{example}
\begin{itemize}
\item Let $X$ be a set. Then $\sSet{\powerset(X), \subseteq}$ is an algebraic lattice.
\item Let $L$ be a lattice. Then the set of ideals in $L$, $\ideals(L)$ is an algebraic lattice when ordered by inclusion. An ideal is compact in $\ideals(L)$ if and only if it is principal.
\end{itemize}
\end{example}

\begin{lemma} \label{algebraicPosetLemma}
Let $P$ be a poset. Then $P$ is algebraic \textup{if and only if} for all $x\in P$,
\begin{itemize}
\item $\ddownset \{x\}\cap \compacts(P)$ is directed;
\item $x = \dirvee\big(\ddownset \{x\}\cap \compacts(P)\big)$.
\end{itemize}
\end{lemma}
Note that $\ddownset \{x\}\cap \compacts(P) = \downset \{x\}\cap \compacts(P)$ by \ref{downsetCompactElement}.
\begin{proof}
First, suppose $P$ is algebraic and take arbitrary $x\in P$. Then there exists a directed set $D$ such that $D\subseteq \compacts(P)$. By definition of base, we have $D\subseteq \ddownset\{x\}$, so $D\subseteq \big(\ddownset \{x\}\cap \compacts(P)\big)\subseteq \ddownset\{x\}$. Then both points follow from \ref{approximatingSetDirected}.

The converse is immediate, since for all $x\in P$ we can set $D = \ddownset \{x\}\cap \compacts(P)$.
\end{proof}

A continuous poset always has a largest base by \ref{posetContinuousIffHasBase}: $P$ itself.
\begin{proposition}
Let $P$ be a poset. Then the following are equivalent:
\begin{enumerate}
\item $P$ is algebraic;
\item $\compacts(P)$ is a base of $P$;
\item $\compacts(P)$ is the smallest base of $P$;
\item $P$ has a smallest base.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Immediate from \ref{posetBaseInclusionLemma}.

$(2) \Rightarrow (3)$ Immediate from \ref{compactsInPosetBase}.

$(3) \Rightarrow (4)$ Immediate.

$(4) \Rightarrow (1)$ Let $B$ be the smallest base of $P$. By \ref{finiteRemovalNonCompactElementsFromBase} it must consist solely of compact elements.
\end{proof}

\begin{proposition} \label{algebraicJoinSemilattice}
Let $S$ be a $\vee$-semilattice. Then the following are equivalent:
\begin{enumerate}
\item $S$ is algebraic;
\item $x = \dirvee\big(\ddownset \{x\}\cap \compacts(P)\big)$ for all $x\in S$;
\item every element is the supremum of a set of compact elements.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ By \ref{algebraicPosetLemma}.

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (1)$ Take arbitrary $x\in S$. Then $x = \bigvee A$ for some $A\subseteq \compacts(S)$. Consider $D\defeq \Closure_\vee(A)$. Clearly $D$ is directed.

We claim that $x = \dirvee D$. Indeed it is an upper bound: any $y\in D$ is a finite join of elements in $A$, which must be less than the join of $A$, i.e.\ $x$. So $y\leq x$. Now let $z$ be another upper bound of $D$. It is also an upper bound of $A$ and so $x\leq z$.

Finally, $D\subseteq \downset\{x\}$ and $\downset\{x\} = \ddownset\{x\}$ by \ref{downsetCompactElement}, so $x\in D^\ll$.
\end{proof}

\begin{lemma} \label{AlgebraicSemilatticeSetSimilarity}
Let $S$ be an algebraic $\vee$-semilattice. Consider $f: S\to \powerset\big(\compacts(S)\big): x \mapsto \downset\{x\}\cap \compacts(S)$. Then $f: S\to\im(f)$ is an order similarity.
\end{lemma}
\begin{proof}
Take $x,y\in S$ such that $x\leq y$. Then $\downset\{x\}\subseteq \downset \{y\}$, so $\downset\{x\}\cap\compacts(S)\subseteq \downset \{y\}\cap \compacts(S)$.

Now suppose $\downset\{x\}\cap\compacts(S)\subseteq \downset \{y\}\cap \compacts(S)$, so $\bigvee $. By \ref{algebraicJoinSemilattice}, we have that
\[ x = \bigvee \downset \{x\}\cap \compacts(S) \leq \bigvee \downset \{y\}\cap \compacts(S) = y. \]
Thus $f$ preserves and reflects the order. We just need to show that $f$ is bijective. It is surjective by construction.

Then, we just need to show that $f$ is injective. Suppose $\downset \{x\}\cap \compacts(S) = \downset \{y\}\cap \compacts(S)$, then, by \ref{algebraicJoinSemilattice},
\[ x = \bigvee \downset \{x\}\cap \compacts(S) = \bigvee \downset \{y\}\cap \compacts(S) = y. \]
\end{proof}

\subsubsection{Continuous closure}
\begin{definition}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ a function. We call $f$ a \udef{continuous closure operator} if $f$ is a Moore closure that preserves to way below relation.
\end{definition}

\begin{lemma}
Let $P$ be a poset, $f: P\to \im(f) \subseteq P$ a continuous closure and $x,y\in \im(f)$. If $x \ll_P y$, then $x \ll y$.
\end{lemma}
\begin{proof}
Suppose $x\ll_P y$, then $x = f(x) \ll f(y) = y$, by \ref{idempotencyMooreClosureLemma}.
\end{proof}

\begin{proposition} \label{continuousClosureCriterion}
Let $P$ be a continuous, directed-complete poset and $f: P\to \im(f) \subseteq P$ a Moore closure. If $\bigvee_{P} f^\imf\big(\ddownset\{x\}\big)$ exists and $f(x) \leq \bigvee_{P} f^\imf\big(\ddownset\{x\}\big)$ for all $x\in P$, then $f$ is a continuous closure.
\end{proposition}
\begin{proof}
First we note that the condition is well-defined, i.e.\ that $\bigvee_{P} f^\imf\big(\ddownset\{x\}\big)$ exists. Since $P$ is continuous, $\ddownset\{x\}$ is an ideal, and, in particular, directed. This means that $(\incl_{\im(f)}\circ f)^\imf\big(\ddownset\{x\}\big)$ is directed and thus that $\bigvee_{P} f^\imf\big(\ddownset\{x\}\big)$ exists, since $P$ is directed-complete.

We now just need to show that $f$ preserves to way-below relation. To that end, suppose $x,y\in P$ are such that $x\ll_P y$. We want to prove that $f(x) \ll f(y)$. To that end, let $D\subseteq \im(f)$ be a non-empty directed set with supremum such that $f(y) \leq \dirvee_{\im(f)}D$. Since $D$ is also directed in $P$, $\dirvee_P D$ exists. By \ref{meetJoinImageMooreClosure} and the assumption, we have
\[ y \leq f(y) \leq \dirvee_{\im(f)}D = f\Big(\dirvee_{P}D\Big) \leq \bigvee_P f^\imf\Big(\ddownset_P\big\{\dirvee_{P} D\big\}\Big). \]
Since $x\ll_P y$ and $f^\imf\Big(\ddownset_P\big\{\dirvee_{\im(f)} D\big\}\Big)$ is directed (using \ref{imageDirectedSet} and the fact that $P$ is continuous), this implies $x\in \downset f^\imf\Big(\ddownset_P\big\{\dirvee_{P} D\big\}\Big)$. Thus there exists $x'\in \ddownset_P\big\{\dirvee_{P} D\big\}$ such that $x\leq f(x')$. Since $x'\ll_P \dirvee_{P} D$, we have $x'\in \downset D$ by \ref{wayBelowDirectedSup}. This means that there exists $x''\in D\subseteq \im(f)$ such that $x'\leq x''$. Now $f(x) \leq f^2(x') = f(x') \leq f(x'') = x''$, by \ref{idempotencyMooreClosureLemma} and so $f(x) \in \downset D$.
\end{proof}

\begin{proposition}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ a continuous closure. Then
\begin{enumerate}
\item if $P$ is continuous, then $\im(f)$ is continuous;
\item if $P$ is algebraic, then $\im(f)$ is algebraic.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) By \ref{posetContinuousIffHasBase}, it is enough, for all $x\in \im(f)$, to find a directed $D\subseteq \im(f)$ such that $D\subseteq \ddownset\{x\}$ and $x= \dirvee_{\im(f)} D$. We claim that we can take $D = f^\imf\big(\ddownset_P\{x\}\big)$.

Since $P$ is continuous, $\ddownset_P\{x\}$ is directed and thus $D$ is directed by \ref{imageDirectedSet}.

Since $f$ preserves the way-below relation, we have, by \ref{idempotencyMooreClosureLemma},
\[ D = f^\imf\big(\ddownset_P\{x\}\big) \subseteq \ddownset\{f(x)\} = \ddownset\{x\}. \]

Finally, $\dirvee_P \ddownset_P\{x\}$ exists and is equal to $x$ by continuity of $P$, so
\[ x = f(x) = f\Big(\dirvee_P \ddownset_P\{x\}\Big) = \dirvee_{\im(f)}f^\imf\big(\ddownset_P\{x\}\big) = \dirvee_{\im(f)}D \]
by \ref{idempotencyMooreClosureLemma} and \ref{residuationPreservesSupInf}.

(2) It is enough, for all $x\in \im(f)$, to find a directed $D\subseteq \compacts\big(\im(f)\big)$ such that $D\subseteq \ddownset\{x\}$ and $x= \dirvee_{\im(f)} D$. We claim that we can take $D = f^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big)$.

First we note that $D\subseteq \compacts\big(\im(f)\big)$. Indeed, suppose $x\in D$. Then there exists $x'\in \ddownset_P\{x\} \cap \compacts(P)$ such that $x = f(x')$. Now $x'\ll_P x'$, so $x = f(x') \ll f(x') = x$, which means that $x\in \compacts\big(\im(f)\big)$.

We have that $D$ is directed by \ref{algebraicPosetLemma} and \ref{imageDirectedSet}.

We have $D \subseteq  f^\imf\big(\ddownset_P\{x\}\big) \subseteq \ddownset\{x\}$ by the calculations in (1).

Finally, $\dirvee_P \ddownset_P\{x\} \cap \compacts(P)$ exists and is equal to $x$ by \ref{algebraicPosetLemma}, so
\[ x = f(x) = f\Big(\dirvee_P \ddownset_P\{x\}\cap \compacts(P)\Big) = \dirvee_{\im(f)}f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big) = \dirvee_{\im(f)}D \]
by \ref{idempotencyMooreClosureLemma} and \ref{residuationPreservesSupInf}.
\end{proof}

\subsubsection{Algebraic closure}
\begin{definition}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ a function. We call $f$ an \udef{algebraic closure operator} if
\begin{itemize}
\item $x \leq f(x)$ for all $x\in P$;
\item $f = f^2$;
\item $\bigvee_{P} f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big)$ exists and $f(x) \leq \bigvee_{P} f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big)$ for all $x\in P$.
\end{itemize}
\end{definition}

\begin{lemma} \label{algebraicClosureEqualityLemma}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ a function.
If $f$ is an algebraic closure operator, then $f(x) = \bigvee_{P} f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big)$.
\end{lemma}
\begin{proof}
One inequality is given by the definition. For the other, note that
\[ \downset f^\imf\big(\ddownset_P \{x\}\cap \compacts(P)\big) \subseteq \downset f^\imf\big(\ddownset_P \{x\}\big) \subseteq \downset f^\imf\big(\downset \{x\}\big) = \downset \{f(x)\}, \]
so $\bigvee_P f^\imf\big(\ddownset_P \{x\}\cap \compacts(P)\big) \leq \bigvee \downset\{f(x)\} = f(x)$.
\end{proof}

\begin{lemma} \label{algebraicClosureIsotone}
Let $P$ be a poset and $f: P\to \im(f) \subseteq P$ an algebraic closure operator. Then $f$ is isotone.
\end{lemma}
\begin{proof}
Suppose $x,y\in P$ are such that $x\leq y$. Then $\ddownset\{x\} \subseteq \ddownset\{y\}$ by \ref{downsetEmbeddingContinuousPosets} and thus $\ddownset \{x\}\cap \compacts(P) \subseteq \ddownset \{y\}\cap \compacts(P)$. This implies, by \ref{algebraicClosureEqualityLemma},
\[ f(x) = \bigvee \bigvee_{P} f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big) \leq \bigvee_{P} f^\imf\big(\ddownset_P\{y\}\cap \compacts(P)\big) = f(y). \]
\end{proof}
\begin{corollary} \label{algebraicClosureMooreClosure}
Every algebraic closure is a Moore closure.
\end{corollary}

\begin{lemma} \label{algebraicClosureIsContinuous}
Every algebraic closure operator on a continuous, directed-complete poset is a continuous closure operator.
\end{lemma}
\begin{proof}
Let $f: P\to \im(f)\subseteq P$ be an algebraic closure operator and $x\in P$ an arbitrary element. Then
\[ f(x) \leq \bigvee_{P} f^\imf\big(\ddownset_P\{x\}\cap \compacts(P)\big) \leq \bigvee_{P} f^\imf\big(\ddownset_P\{x\}\big), \]
so we can apply \ref{continuousClosureCriterion}.
\end{proof}

\begin{proposition} \label{imageAlgebraicClosureAlgebraicLattice}
Let $L$ be a continuous $\vee$-semilattice and $f: L\to \im(f)\subseteq L$ an algebraic closure operator. Then $\im(f)$ is an algebraic $\vee$-semilattice.
\end{proposition}
\begin{proof}
By \ref{meetJoinImageMooreClosure}, $\im(f)$ is a $\vee$-semilattice. 

Since $f$ preserves the way-below relation, by \ref{algebraicClosureIsContinuous}, $f^\imf\big(\ddownset\{x\}\cap \compacts(L)\big)$ is a set of compact elements. Thus $\im(f)$ is algebraic by \ref{algebraicJoinSemilattice}.
\end{proof}

\begin{proposition} \label{compositionOfAlgebraicClosuresAlgebraic}
Let $P$ be an algebraic DCPO $f_1, f_2$ algebraic closures on $P$ such that $f_1\circ f_2 \circ f_1 = f_2\circ f_1$. Then $f_2\circ f_1$ is an algebraic closure with $\im(f_2\circ f_1) = \im(f_2) \cap \im(f_1)$.
\end{proposition}
\begin{proof}
We have that $f_2\circ f_1$ is a Moore closure by \ref{MooreClosureIntersectionCompleteSublattices} and \ref{algebraicClosureMooreClosure}. By \ref{algebraicClosureIsContinuous}, $f_1$ preserves the way-below relation.

Take arbitrary $x\in P$. By \ref{algebraicPosetLemma}, $\ddownset_P\{x\} \cap \compacts(P)$ is directed, so $(f_2\circ f_1)^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big)$ is directed and $\bigvee_P (f_2\circ f_1)^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big)$ exists because $P$ is a DCPO.

Now we calculate
\begin{align*}
(f_2\circ f_1)(x) &= \dirvee_P f_2^\imf\Big(\ddownset_P\{f_1(x)\} \cap \compacts(P)\Big) \\
&\leq \dirvee_P f_2^\imf\Big(\ddownset_P\{f_1(x)\}\Big) \\
&= \dirvee_P f_2^\imf\Big(\ddownset_P\big\{\dirvee_P f_1^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big)\big\}\Big) \\
&\leq \dirvee_P f_2^\imf\Big(\downset_P f_1^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big)\Big) \\
&= \dirvee_P \downset_P(f_2\circ f_1)^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big) \\
& \dirvee_P (f_2\circ f_1)^\imf\big(\ddownset_P\{x\} \cap \compacts(P)\big),
\end{align*}
where the second join exist because $P$ is continuous, and thus $\ddownset_P\{f_1(x)\}$ is directed, by \ref{posetContinuousIffHasBase}. We have used \ref{wayBelowDirectedSup}.
\end{proof}

\section{Consistency}
\begin{definition}
Let $P$ be a poset, $S\subseteq P$ and $x,y\in P$. Then
\begin{itemize}
\item $S$ is called \udef{consistent} if $S$ has an upper bound;
\item $x$ is said to be \udef{consistent} with $y$ if $\{x,y\}$ is consistent. We denote this $x \cons y$.
\end{itemize}
\end{definition}

Suppose $x$ is a partial (i.e.\ not maximal) element that approximates some true element $y$. Then any $x'$ that is consistent with $x$ could be an approximation of $y$.

\begin{lemma} \label{consistencyInclusionFromInequality}
Let $P$ be a poset and $x,y\in P$. Then
\begin{enumerate}
\item $\{x\}^\cons$ is downwards closed;
\item if $x \leq y$, then $\{y\}^\cons \subseteq \{x\}^\cons$;
\item if $x \leq y$, then $x\in \{y\}^{\cons\cons}$;
\item $\downset \{x\} \subseteq \{x\}^{\cons\cons}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take $y \leq z \in \{x\}^\cons$. Any upper bound of $\{x,z\}$ is also an upper bound of $\{x,y\}$, so $y\in \{x\}^\cons$.

(2) Take $a\in \{y\}^\cons$, then there exists $b\in P$ such that $a,y \leq b$.

Now $x\leq y\leq b$, so $b$ is an upper bound of $\{x,a\}$ and thus $x\cons a$, which means that $a\in \{x\}^\cons$.

(3) Immediate from (2), using \ref{polarsGaloisConnection}.

(4) Immediate from (3).
\end{proof}

\subsection{Consistent extensions}
For any two elements $x,y$, the intuition is that $x$ and $y$ contain as much information as each other if $\{x\}^\cons = \{y\}^\cons$.

\begin{definition}
Let $P$ be a poset and $x\in P$. Then
\[ \tilde{x} \defeq \max \setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons } \]
is called the \udef{consistent extension} of $x$ if the maximum exists.
\end{definition}

\begin{lemma} \label{consistentExtensionLemma}
Let $P$ be a poset and $x\in P$. Then
\begin{enumerate}
\item $\setbuilder[\big]{y \in P}{ \{y\}^\cons = \{x\}^\cons } \subseteq \{x\}^{\cons\cons}$.
\item $\max \big(\{x\}^{\cons\cons}\big) \subseteq \max \setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$;
\item $\max \big(\{x\}^{\cons\cons}\big) = \max \setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$ if $P$ is 3-pairwise-consistent-complete.
\end{enumerate}
\end{lemma}
The property 3-pairwise-consistent-complete means that if $A\subseteq P$ is such that every pair of elements of $A$ is consistent and contains fewer than $3$ elements, then $\bigvee A$ exists. This notion might still be slightly too strong.
\begin{proof}
(1) Take $y\in \setbuilder[\big]{y\in P}{\{y\}^\cons = \{x\}^\cons}$. In particular, $\{x\}^\cons \subseteq \{y\}^\cons$, so $y\in \{y\} \subseteq \{x\}^{\cons\cons}$.

(2) Let $\tilde{x}$ be the maximum of $\{x\}^{\cons\cons}$, assuming it exists. By (1), we have that $\tilde{x}$ is an upper bound of $\setbuilder[\big]{y\in P}{\{y\}^\cons = \{x\}^\cons}$.

We just need to show that $\tilde{x} \in \setbuilder[\big]{y\in P}{\{y\}^\cons = \{x\}^\cons}$. Since $\tilde{x} \in \{x\}^{\cons\cons}$, we have $\{\tilde{x}\} \subseteq \{x\}^{\cons\cons}$, so $\{x\}^\cons \subseteq \{\tilde{x}\}^\cons$.

For the other inclusion, we have $x\in \{x\}^{\cons\cons}$, so $x \leq \tilde{x}$, which implies $\{\tilde{x}\}^\cons \subseteq \{x\}^\cons$ by \ref{consistencyInclusionFromInequality}.

(3) One inclusion is given by (2). For the other inclusion, take $\tilde{x} = \max \setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$, if this exists. From (1) and (2), it is enough to show that $\tilde{x}$ is an upper bound of $\{x\}^{\cons\cons}$.

Take $y\in \{x\}^{\cons\cons}$. Since $x\in \{x\}^\cons$, we have $y \cons x$ and so $\{x,y\}$ is $3$-pairwise-consistent. Thus $x\vee y$ exists.

We claim $x\vee y\in \{x\}^{\cons\cons}$. Indeed, take arbitrary $a\in \{x\}^\cons$. Then $x\cons a$ and $y \cons a$. Since also $x\cons y$, we have that $\{x,y,a\}$ is $3$-pairwise-consistent, so $a\vee x \vee y$ exists and, in particular, $a \cons (x\vee y)$. Since $a\in \{x\}^\cons$ was chosen arbitrarily, we have $x\vee y \in \{x\}^{\cons\cons}$.

Now this implies $\{x\}^\cons \subseteq \{x\vee y\}^{\cons}$ by \ref{polarsGaloisConnection}. Also $\{x\vee y\}^\cons \subseteq \{x\}^\cons$ by \ref{consistencyInclusionFromInequality}, so $x\vee y \in \setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$. This implies $y \leq x\vee y \leq \tilde{x}$. Since $y\in \{x\}^{\cons\cons}$ was chosen arbitrarily, we have that $\tilde{x}$ is an upper bound of $\{x\}^{\cons\cons}$.
\end{proof}

\begin{example}
Let $P$ be a poset and $x\in P$. The sets $\setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$ and $\{x\}^{\cons\cons}$ are not the same in general. Take, for example,
\[ \begin{tikzcd}[column sep=tiny]
{} & \bullet \ar[dl ,dash] \ar[dr, dash] & {} & \bullet \ar[dl, dash] \\
x & {} & \bullet & {}
\end{tikzcd} \]
Here $\setbuilder[\big]{y\in P}{\{y\}^\cons = \{x\}^\cons}$ consists of $x$ and the $\bullet$ above it. The set $\{x\}^{\cons\cons}$ consists of the left-hand triangle.

Note that in this case both sets have the same maximum. This is not always the case. Take, e.g.\ 
\[ \begin{tikzcd}
\bullet \ar[d, dash] \ar[dr, dash] & \bullet \ar[d, dash] \ar[dl, dash] & \bullet \ar[dl, dash] \\
x & \bullet & {}
\end{tikzcd} \]
Here $\setbuilder[\big]{y\in P}{ \{y\}^\cons = \{x\}^\cons }$ consists of just $x$ and $\{x\}^{\cons\cons}$ consists of the two elements in the lower row.
\end{example}

\subsubsection{Consistent extensions of order-preserving functions}

\begin{lemma} \label{singletonConsistentWithIsotoneFunction}
Let $P$ be a poset, $Q$ a Dedekind-complete poset, $(x,y)\in P\times Q$ and $f\in (P\not\to Q)_\leq$ a partial order-preserving function. Then the following are equivalent:
\begin{enumerate}
\item $\{(x,y)\} \in \{f\}^\cons$;
\item $f\cup \{(x,y)\}$ is an order-preserving function;
\item $ \begin{cases}
\forall x'\in \downset\{x\} \cap \dom(f): \; f(x') \leq y \\
\forall x'\in \upset\{x\} \cap \dom(f): \; f(x') \geq y.
\end{cases}$;
\item $y \in f^\imf\big(\downset \{x\}\cap \dom(f)\big)^\leq \cap f^\imf\big(\upset \{x\}\cap \dom(f)\big)^\geq$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Assume $\{(x,y)\} \cons f$. Then there exists an order-preserving partial function $h$ such that $\{(x,y)\} \subseteq h$ and $f\subseteq h$. Thus $f\cup \{(x,y)\} \subseteq h$. Since any restriction of an order-preserving function is order-preserving, we have that $f\cup \{(x,y)\}$ is order-preserving.

$(2) \Rightarrow (1)$ This is immediate since $f\cup \{(x,y)\}$ is an upper bound of $\big\{\{(x,y)\}, f\big\}$.

$(2) \Rightarrow (3)$ Take arbitrary $x'\in \downset\{x\} \cap \dom(f)$. Then $x'\leq x$. Since $f\cup \{(x,y)\}$ is order-preserving, we have $f(x') \leq \big(f\cup \{(x,y)\}\big)(x) = y$. The other statement is similar.

$(2) \Leftarrow (3)$ Take $a \leq b\in \dom\big(f\cup \{(x,y)\}\big)$. If $a,b\in \dom(f)$, then $\big(f\cup \{(x,y)\}\big)(a) = f(a) \leq f(b) = \big(f\cup \{(x,y)\}\big)(b)$ since $f$ is order-preserving.

If $a = x = b$, then $\big(f\cup \{(x,y)\}\big)(a) = y = \big(f\cup \{(x,y)\}\big)(b)$.

If $a = x$ and $b\neq x$, then $b\in \upset\{x\} \cap \dom(f)$, so $\big(f\cup \{(x,y)\}\big)(a) = y \leq f(b) = \big(f\cup \{(x,y)\}\big)(b)$.

If $b = x$ and $a\neq x$, then $a\in \downset\{x\} \cap \dom(f)$, so $\big(f\cup \{(x,y)\}\big)(a) \leq y = \big(f\cup \{(x,y)\}\big)(b)$.

$(3) \Leftrightarrow (4)$ Restatement.
\end{proof}
\begin{corollary} \label{consistentExtensionsIsotoneFunctionToDedekindPoset}
Let $P, Q$ be posets, $(x,y)\in P\times Q$ and $f\in (P\not\to Q)_\leq$ a partial order-preserving function. Then
\begin{enumerate}
\item if $\bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big) \leq y \leq \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big)$, then $\{(x,y)\} \in \{f\}^\cons$;
\item if $Q$ is Dedekind-complete, then the converse also holds.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) This condition easily implies the condition in \ref{singletonConsistentWithIsotoneFunction}.

(2) By the lemma \ref{singletonConsistentWithIsotoneFunction}, the sets are bounded by $y$, which implies that the extrema exist, since $Q$ is Dedekind-complete.

The inequalities follow immediately.
\end{proof}

\begin{example}
The condition in \ref{consistentExtensionsIsotoneFunctionToDedekindPoset} based on extrema is too restrictive if $Q$ is not Dedekind-complete. Consider the function
\[ \begin{tikzcd}[column sep=tiny]
a \ar[dr, dash] & {} & b \ar[dl, dash] \\
{} & \star & {} \\
c \ar[ur, dash] & {} & d \ar[ul, dash]
\end{tikzcd} \qquad \begin{tikzcd}
{} \ar[r, "f"] & {}
\end{tikzcd} \qquad \begin{tikzcd}[column sep=tiny]
{} & f(a) \ar[d, dash] \ar[dr, dash] & f(b) \ar[dl, dash] \ar[d, dash] \\
\bullet \ar[d, dash] \ar[dr, dash] & \bullet \ar[dl, dash] \ar[d, dash] & \bullet \\
f(c) & f(d) & {}
\end{tikzcd} \]
Suppose $h \in \{f\}^\cons$. Then either $h\subseteq f$ or $h(\star)$ is the central $\bullet$. Thus the consistent extension of $f$ maps $\star$ to the central $\bullet$.

However, $f^\imf\big(\downset\{\star\} \cap \dom(f)\big) = \{f(c), f(d)\}$ does not have a supremum and $f^\imf\big(\upset\{\star\} \cap \dom(f)\big) = \{f(a), f(b)\}$ does not have an infimum.
\end{example}

\begin{lemma} \label{consistencyFromAtomsOrderPreservingPartialFunctions}
Let $P,Q$ be posets and $f,g: P\not\to Q$ order-preserving partial functions in $(P\not\to Q)_{\leq}$. Then
\[ f\cons g \quad\iff\quad \forall x\in \dom(f): \; \{(x, f(x))\} \in \{g\}^\cons. \]
\end{lemma}
\begin{proof}
The direction $\Rightarrow$ is immediate, since $\{g\}^\cons$ is downwards closed, \ref{consistencyInclusionFromInequality}.

For the other direction, suppose $\{(x, f(x))\} \in \{g\}^\cons$ for all $x\in \dom(f)$. We now aim to show that $f\cup g$ is an order-preserving partial function.

First we check that $f\cup g$ is functional. Suppose $x\in \dom(f)\cap \dom(g)$. Then $\{(x, f(x))\} \in \{g\}^\cons$. Let $h$ be an upper bound of $\big\{\{(x, f(x))\}, g\big\}$. Then $f(x) = h(x) = g(x)$. Since $x\in \dom(f)\cap \dom(g)$ was chosen arbitrarily, we have that $f\cup g$ is functional.

Finally, we check that $f\cup g$ is order preserving. Take arbitrary $x,y\in \dom(f\cup g)$ such that $x\leq y$. If $x,y\in \dom(f)$, then $(f\cup g)(x) = f(x) \leq f(y) = (f\cup g)(y)$. Similarly $(f\cup g)(x) \leq (f\cup g)(y)$ if $x,y\in \dom(f)$.

Now assume $x\in \dom(f)$ and $y\in \dom(g)$. Then $\{(x,f(x))\} \cons g$, so we can find an upper bound $h$ of $\big\{\{(x, f(x))\}, g\big\}$. We have
\[ (f\cup g)(x) = f(x) = h(x) \leq h(y) = g(y) = (f\cup g)(y). \]
If $x\in \dom(g)$ and $y\in \dom(f)$, then the argument is similar.
\end{proof}

\begin{proposition} \label{consistentExtensionIsotoneFunctionToDedekindCompletePoset}
Let $P$ be a poset, $Q$ a Dedekind-complete poset and $f: P\not\to Q$ a partial order-preserving function. Then consider the function $\tilde{f}: P\not\to Q$ defined by
\[ \tilde{f}(x) = y \defequiv \bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big) = y = \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big). \]
Then
\begin{enumerate}
\item for all $x\in P$, we have
\[ \bigvee \tilde{f}^\imf\big(\downset \{x\} \cap \dom(\tilde{f})\big) = \bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big); \]
\item for all $x\in P$, we have
\[ \bigwedge \tilde{f}^\imf\big(\upset \{x\} \cap \dom(\tilde{f})\big) = \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big); \]
\item $\tilde{f}$ is the consistent extension of $f$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We show that $\tilde{f}^\imf\big(\downset \{x\} \cap \dom(\tilde{f})\big)^\leq = f^\imf\big(\downset \{x\} \cap \dom(f)\big)^\leq$. The inclusion $\subseteq$ follows because $f\subseteq \tilde{f}$.

For the other inclusion, take arbitrary $u \in f^\imf\big(\downset \{x\} \cap \dom(f)\big)^\leq$. Take arbitrary $y\in \downset\{x\} \cup \dom(\tilde{f})$. Then
\begin{align*}
\tilde{f}(y) &= \bigvee f^\imf\big(\downset\{y\} \cap \dom(f)\big) \\
&\leq \bigvee f^\imf\big(\downset\{x\} \cap \dom(f)\big) \leq u,
\end{align*}
so $u\in \tilde{f}^\imf\big(\downset \{x\} \cap \dom(\tilde{f})\big)^\leq$.

(2) Dual to (1).

(3) We first show that $\tilde{f} \in \setbuilder{g\in (P\not\to Q)_\leq}{\{g\}^\cons = \{f\}^\cons}$. Indeed, take arbitrary $h\in (P\not\to Q)_\leq$. Then
\begin{align*}
h\in \{f\}^\cons &\iff \forall x\in \dom(h): \; \{(x, h(x))\} \in \{f\}^\cons \\
&\iff \forall x\in \dom(h): \; \bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big) \leq h(x) \leq \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big) \\
&\iff \forall x\in \dom(h): \; \bigvee \tilde{f}^\imf\big(\downset \{x\} \cap \dom(\tilde{f})\big) \leq h(x) \leq \bigwedge \tilde{f}^\imf\big(\upset \{x\} \cap \dom(\tilde{f})\big) \\
&\iff \forall x\in \dom(h): \; \{(x, h(x))\} \in \{\tilde{f}\}^\cons \\
&\iff h\in \{\tilde{f}\}^\cons,
\end{align*}
where we have used \ref{consistencyFromAtomsOrderPreservingPartialFunctions}, \ref{consistentExtensionsIsotoneFunctionToDedekindPoset} and points (1) and (2).

Now we show that $\tilde{f}$ is an upper bound of $\setbuilder{g\in (P\not\to Q)_\leq}{\{g\}^\cons = \{f\}^\cons}$. Take arbitrary $g \in \setbuilder{g\in (P\not\to Q)_\leq}{\{g\}^\cons = \{f\}^\cons}$. We want to show that $g\subseteq \tilde{f}$. To that end, take arbitrary $(x,g(x))\in g$.

Since $f\in \{f\}^\cons = \{g\}^\cons$, we have that $g' \defeq g\cup f$ is order-preserving, so
\[ g(x) = g'(x) \in g^{\prime\imf}\big(\downset\{x\} \cap \dom(f)\big)^\leq = f^\imf\big(\downset\{x\} \cap \dom(f)\big)^\leq. \]
Similarly, $g(x) \in f^\imf\big(\upset\{x\} \cap \dom(f)\big)^\geq$. Thus
\[ \bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big) \leq g(x) \leq \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big). \]
Now define
\[ a \defeq \bigvee f^\imf\big(\downset \{x\} \cap \dom(f)\big) \quad\text{and}\quad b \defeq  \bigwedge f^\imf\big(\upset \{x\} \cap \dom(f)\big). \] 
By \ref{consistentExtensionsIsotoneFunctionToDedekindPoset}, we have $\{(x,a)\} \in \{f\}^\cons = \{g\}^\cons$ and $\{(x,b)\}\in \{f\}^\cons = \{g\}^\cons$. Since $x\in \dom(g)$, this implies $a = g(x) = b$ and so $x\in\dom(\tilde{f})$, with $g(x) = \tilde{f}(x)$.
\end{proof}

\subsubsection{Preserving linearity}

\begin{lemma}
Let $V,W$ be ordered vector spaces and $f\in (V\not\to W)_\leq$. Suppose $\dom(f)$ is a subspace of $V$ and $f$ is linear. Let $x_1,x_2\in V$ and $y_1,y_2\in W$ be such that $\{(x_1, y_1), (x_2, y_2)\} \in \{f\}^\cons$ and $\lambda \in \R$. Then $\{(x_1 +\lambda x_2, y_1 + \lambda y_2)\} \in \{f\}^\cons$.
\end{lemma}
\begin{proof}
We aim to use \ref{singletonConsistentWithIsotoneFunction}. To that end, take arbitrary $x'\in \downset\{x_1 +\lambda x_2\} \cap \dom(f)$. Then
\[ f(x') =  \]
\end{proof}


\section{Domains}
\begin{definition}
Let $\sSet{P,\Yleft}$ be a poset and $x\in P$. Then
\begin{itemize}
\item $x$ is called \udef{total} if it is maximal and
\item \udef{partial} if not.
\end{itemize}
\end{definition}


\subsection{Finitary bases and domains}
\begin{definition}
Let $\sSet{B,\leq}$ be a poset. Then $B$ is called a \udef{finitary basis} if
\begin{itemize}
\item $P$ is a countable;
\item $P$ is Dedekind complete.
\end{itemize}
Elements of $P$ are called \udef{propositions}.

The \udef{domain} $\domain_B$ generated by $B$ is the set of ideals in $B$.
\end{definition}
Dedekind completeness is equivalent to saying every non-empty, consistent subset has a least upper bound, see \ref{existenceSupremaInfima}.

\begin{lemma}
Let $\sSet{B,\leq}$ be a non-empty finitary basis. Then $B$ has a least element $\bot$.
\end{lemma}
\begin{proof}
The empty set $\emptyset$ is consistent (because every element of $B$ is an upper bound) and thus has a least upper bound (which is exactly a least element in $B$).
\end{proof}

\begin{proposition} \label{directedJoinDomain}
Let $B$ be a finitary basis and $\{A_i\}_{i\in I} \subseteq \domain_B$ be a directed set of ideals of $B$. Then
\[ \dirvee_{i\in I} A_i = \bigcup_{i\in I}A_i \;\in \domain_B. \]
In particular this means that $\sSet{\domain_B, \subseteq}$ is a DCPO.
\end{proposition}
\begin{proof}
It is enough to show that $\bigcup_{i\in I}A_i$ is an ideal. It is downwards closed by \ref{meetJoinRClosedSets}.

Now take $x,y\in \bigcup_{i\in I}A_i$. Then there exists $j,k\in I$ such that $x\in A_j$ and $y\in A_k$. By directedness of $\{A_i\}_{i\in I}$, there exists $m\in I$ such that $A_j\subseteq A_m$ and $A_k \subseteq A_m$. Now by directness of $A_m$, there exists $z\in A_m$ such that $x\leq z$ and $y\leq z$. As $z\in \bigcup_{i\in I}A_i$, we have shown that $\bigcup_{i\in I}A_i$ is directed.
\end{proof}

\begin{proposition}
Let $B$ be a finitary basis. Then an ideal $I\in\domain_B$ is principal \textup{if and only if} it is finite.
\end{proposition}
\begin{proof}
$\boxed{\Rightarrow}$ Assume $I = \downset\{x\}$ is a principal ideal and suppose $I = \dirvee A$ for some directed $A\subseteq \domain_B$. Then, by \ref{directedJoinDomain}, there exists $a\in A$ such that $x\in a$. Then $a = \downset\{x\}$. Indeed, $a \supseteq \downset\{x\}$ by downward closure of $a$ and  $a\subseteq\dirvee A = \downset\{x\}$.

$\boxed{\Leftarrow}$ Assume $I$ is a finite ideal. Then $\setbuilder{\downset\{x\}}{x\in I}$ is a directed set of ideals in $\domain_B$ and $\dirvee\setbuilder{\downset\{x\}}{x\in I} = I$. By finiteness, $I\in \setbuilder{\downset\{x\}}{x\in I}$. In particular, $I$ is principal.
\end{proof}
\begin{corollary} \label{finiteDecompositionIdeal}
Let $B$ be a finitary basis and $I\in\domain_B$ an ideal. Then
\[ I = \dirvee \setbuilder{I'\in \domain_B}{\text{$I'$ is finite and $I'\subseteq I$}}. \]
\end{corollary}

\begin{definition}
In general we call a poset $D$ a \udef{domain} if it is isomorphic to the domain $\domain_B$ generated by some finitary basis $B$.
\end{definition}

\begin{lemma}
Let $D$ be a domain and $\{x_i\}_{i\in I}\subseteq D$. Then
\begin{enumerate}
\item $\bigwedge_{i\in I} x_i$ exists in $D$;
\item if $\{x_i\}_{i\in I}$ is directed, then $\dirvee_{i\in I} x_i$ exists in $D$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Arbitrary intersection of ideals is ideal.

(2) Restatement of \ref{directedJoinDomain}.
\end{proof}

\subsection{The Scott topology}


\begin{proposition}
Let $P$ be a DCPO, then the Scott topology on $P$ is a topology.
\end{proposition}
\begin{proof}
We show that the set of Scott-closed sets is closed under binary unions. Let $A,B \subseteq P$ be Scott closed. It is clear that $A\cup B$ is downwards closed. Take some non-empty, directed $D\subseteq A\cup B$. If $D\subseteq A$, then $\dirvee D \in A \subseteq A\cup B$ by closedness of $A$. If $D\subseteq B$, then $\dirvee D \in B \subseteq A\cup B$ by closedness of $B$. If neither of these cases holds, then $D\mesh A$ and $D\mesh B$. Take $a\in D\setminus B$ and $b\in D\setminus A$. By directedness of $D$, there must exist some $c\in D\subseteq A\cup B$ such that $a,b\leq c$. But, this yields a contradiction: either $c\in A$, in which case $b\in A$ by downwards closure, of $c\in B$, in which case $a\in B$ by downwards closure. Thus, one of the previous cases must have held and we can conclude.
\end{proof}

\subsection{Functions on domains}
\subsubsection{Extending functions on bases}
\begin{proposition}
Let $B$ be a finitary basis, $D$ a DCPO and $f: B \to D$ a monotone function. Then there exists a unique Scott-continuous function $f': \domain_B\to D$ such that $f'(\downset x) = f(x)$ for all $x\in B$.
\end{proposition}
\begin{proof}
To show existence, we take
\[ f': \domain_B \to D: \; A \mapsto \dirvee_{x\in A} f(x). \]
Note that $f^\imf(A)$ is directed since the directed sets form a $\mathrm{Z}$-system.

By \ref{isotoneIffDownsetContinuous}, this function satisfies $f'(\downset x) = \dirvee f^\imf(\downset x) = f(x)$ for all $x\in B$.

For Scott-continuity, take a directed set of ideals $\{A_i\}_{i\in I}$ and calculate
\begin{align*}
f'\Big(\dirvee_{i\in I} A_i\Big) &= \dirvee f^\imf\Big(\dirvee_{i\in I}A_i \Big) \\
&= \dirvee f^\imf\Big(\bigcup_{i\in I}A_i \Big) \\
&= \dirvee \bigcup_{i\in I} f^\imf(A_i) \\
&= \dirvee_{i\in I} \dirvee f^\imf(A_i) \\
&= \dirvee_{i\in I} f'(A_i),
\end{align*}
by \ref{joinMeetUnion}.

Uniqueness follows straight from \ref{finiteDecompositionIdeal} and Scott-continuity.
\end{proof}

\subsubsection{Approximable relations}
\begin{definition}
Let $B,C$ be finitary bases. An \udef{approximable relation} is a relation $R$ on $(B,C)$ such that
\begin{itemize}
\item $bR$ is an ideal in $\domain_C$ for all $b\in B$;
\item $Rc$ is upwards closed for all $c\in C$.
\end{itemize}
\end{definition}

\begin{lemma} \label{approximableRelationLemma}
Let $B,C,D$ be finitary bases, $R$ an approximable relation on $(B,C)$ and $S$ an approximable relation on $(C,D)$. Then
\begin{enumerate}
\item $x\leq y \implies xR \subseteq yR$ for all $x,y\in B$;
\item for any ideal $A\in\domain_B$, the set $\{xR\}_{x\in A}$ is directed;
\item $R;S$ is an approximable relation on $(B,D)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take $z\in xR$. Then $x\in Rz$ and so $y\in Rz$ by upwards closure. This means $z\in yR$ and thus $xR \subseteq yR$.

(2) Take $xR, yR \in \{xR\}_{x\in A}$. Then there exists $z\in A$ such that $x\leq z$ and $y\leq z$. Then $xR\subseteq zR$ and $yR \subseteq zR$ by point (1).

(3) Take $b\in B$. Then $b(R;S) = \bigcup _{c\in bR}cS$. This join is directed by point (2) and thus an ideal by \ref{directedJoinDomain}.

Take $d\in D$. Then $(R;S)d = \bigcup_{c\in Sd}Rc$ is a union of downwards closed sets and thus downwards closed.
\end{proof}

\begin{proposition}
Let $B,C$ be finitary bases. Then the set of approximable relations on $(B,C)$, ordered by inclusion, and the set of Scott-continuous functions in $(\domain_B \to \domain_C)$, ordered pointwise, are isomorphic with an isomorphism given by
\[ R\mapsto \big(A\mapsto AR\big) \]
and inverse
\[ f \mapsto \setbuilder{(b,c)\in B\times C}{c \in f(\downset b)}. \]
These maps are functorial (i.e.\ preserve composition).
\end{proposition}
\begin{proof}
We first show that these maps are well-defined. Let $R$ be an approximable relation on $(B,C)$ and $A\in\domain_B$. Then, by \ref{approximableRelationLemma} and \ref{directedJoinDomain}, we have that $AR = \dirvee_{x\in A}xR$ is an ideal in $\domain_C$.

To show Scott continuity, let $\{A_i\}_{i\in I}$ be a directed subset of $\domain_B$. Then Scott continuity follows from
\[ \Big(\dirvee_{i\in I}A_i\Big)R = \Big(\bigcup_{i\in I}A_i\Big)R = \bigcup_{i\in I}A_iR \]
and the fact that $\{A_iR\}_{i\in I}$ is directed (since the directed sets form a $\mathrm{Z}$-system).

Let $f: \domain_B\to\domain_C$ be a Scott-continuous function. Then, for all $x\in B$,
\[ x\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} = \setbuilder{c\in C}{c\in f(\downset x)} = f(\downset x) \]
is clearly an ideal in $\domain_C$.
Now take arbitrary $y\in C$ and $x\in B$ such that
\[ x \in \setbuilder{(b,c)\in B\times C}{c \in f(\downset b)}y \quad \iff\quad y\in f(\downset x). \]
Then, for all $x'\geq x$, we have $\downset x \subseteq \downset x'$, so
\[ y\in f(\downset x) \subseteq f(\downset x') \]
by monotonicity of $f$. This shows that the preimage of $y$ is upwards closed.

To show that the maps are mutual inverses, we observe
\[ \setbuilder{(b,c)\in B\times C}{c \in (\downset b)R} = \setbuilder{(b,c)\in B\times C}{c \in bR} = \setbuilder{(b,c)\in B\times C}{bRc} = R \]
where the first equality is due to \ref{approximableRelationLemma}: if $c\in xR$ for some $x\leq b$, then $c\in bR$ as $xR\subseteq bR$.

Next, we observe that for all $A\in \domain_B$,
\begin{align*}
A\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} &=\dirvee_{x\in A}x\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} \\
&= \dirvee_{x\in A}\setbuilder{c\in C}{c \in f(\downset x)} \\
&= \dirvee_{x\in A}f(\downset x) \\
&= f\Big(\dirvee_{x\in A}\downset x\Big) = f(A).
\end{align*}

We need to verify that both maps are monotonic. Take $R\subseteq S$ approximable relations on $(B,C)$. Then $AR \subseteq AS$ for all $A\in \domain_B$.

Now take Scott-continuous $f,g: \domain_B\to \domain_C$ such that $f(A)\subseteq g(A)$ for all $A\in \domain_B$. Then
\[ \setbuilder{(b,c)\in B\times C}{c\in f(\downset b)} \subseteq \setbuilder{(b,c)\in B\times C}{c\in g(\downset b)} \]
from $f(\downset b) \subseteq g(\downset b)$.

Finally we prove the maps preserve composition. By \ref{inverseHomomorphism} it is enough to show that one of the two maps preserves composition. Indeed $A(R;S) = (AR)S$.
\end{proof}
\begin{corollary}
Let $B$ be a finitary basis. The relation $\geq$ is the approximable relations associated to the identity function.
\end{corollary}
\begin{corollary}
The Scott-continuous functions between domains and approximable relations between finitary bases are isomorphic categories.
\end{corollary}

\subsubsection{Products}
\begin{lemma}
The product of two finitary bases in the category of relational structures (i.e.\ the Cartesian product with pointwise order) is again a finitary basis.
\end{lemma}
\begin{proof}
Let $B,C$ be finitary bases and $S\subseteq B\times C$ a consistent subset bounded by $(b,c)\in B\times C$. Now consider $A_1 = p_1^{\imf}(S)$ and $A_2 = p_1^{\imf}(S)$, which are consistent sets bounded by $b$ and $c$, respectively. Then $x = \bigvee A_1$ and $y = \bigvee A_2$ exist. It is easy to see that $\bigvee S = (x,y)$.
\end{proof}

\begin{lemma} \label{domainProductLemma}
Let $B,C$ be finitary bases. Then $\domain_{B\times C} \cong \domain_B\times\domain_C$ and the isomorphism is given by
\begin{align*}
F&: \domain_B\times\domain_C \to \domain_{B\times C}: & \hspace{-6em} (A_1,A_2) &\mapsto A_1\times A_2 \\
F^{-1}&: \domain_{B\times C} \to \domain_B\times\domain_C: & \hspace{-6em} A&\mapsto \big(p_1^\imf(A), p_2^\imf(A)\big).
\end{align*}
In particular: the product of two domains is again a domain.
\end{lemma}
\begin{proof}
We first verify these maps are mutual inverses. Clearly we have $(A_1, A_2) = \big(p_1^\imf(A_1\times A_2), p_2^\imf(A_1\times A_2)\big)$. Also it is clear that $A \subseteq p_1^\imf(A)\times p_2^\imf(A)$. To show the other inclusion, take $(x,y) \in p_1^\imf(A)\times p_2^\imf(A)$. Then there exist $(x,y')\in A$ and $(x',y)\in A$. By directedness of $A$, we can find $(x^{\prime\prime}, y^{\prime\prime})\in A$ such that
\[ x \leq x^{\prime\prime},\; y' \leq y^{\prime\prime},\; x'\leq x^{\prime\prime} \quad\text{and}\quad y \leq y^{\prime\prime}. \]
Then $(x,y) \leq (x^{\prime\prime}, y^{\prime\prime})$, so $(x,y)\in A$ by downwards closure.

It is easy to see that both maps are monotonic w.r.t. inclusion, so we are done.
\end{proof}

\begin{proposition} \label{productApproximableRelations}
Let $B,C,D$ be finitary bases and $f: \domain_B\to \domain_C$, $g: \domain_B\to \domain_C$ two Scott-continuous functions. Then the functions
\[ p_1: \domain_C\times \domain_D \to \domain_C, \quad p_2: \domain_C\times \domain_D \to \domain_D\,\quad\text{and}\quad (f,g): \domain_B \to \domain_C\times \domain_D \]
are Scott-continuous and
\begin{enumerate}
\item the approximable relation $P_1$ on $(C\times D)\times C$ associated to $p_1: \domain_C\times \domain_D \to \domain_C$ is defined by $(x,y)P_1 z \iff z\leq x$;
\item the approximable relation $P_2$ on $(C\times D)\times D$ associated to $p_2: \domain_C\times \domain_D \to \domain_D$ is defined by $(x,y)P_2 z \iff z\leq y$;
\item the approximable relation $(F,G)$ on $B\times (C\times D)$ associated to $(f,g): \domain_B \to \domain_C\times \domain_D$ is defined by $x \big(F,G\big) (y,z) \iff \big(xFy \land xGz\big)$, where $F$ and $G$ are the approximable relations determined by $f$ and $g$, respectively.
\end{enumerate}
\end{proposition}
In particular this means that the category of Scott-continuous functions between domains (or, equivalently, the category of approximable relations between finitary bases) contains binary products.
\begin{proof}
It is clear (using \ref{domainProductLemma}) that these functions are Scott-continuous.

(1) We calculate $P_1$ as the approximable relation determined by $p_1 \circ \big(p_1^\imf(-), p_2^\imf(-)\big) = p_1^\imf: \domain_{C\times D}\to \domain_C$:
\[ P_1 = \setbuilder{\big((x,y),z\big)\in (C\times D)\times C}{z\in p_1^\imf\big(\downset (x,y)\big)} = \setbuilder{\big((x,y),z\big)\in (C\times D)\times C}{z\leq x}. \]

(2) Similar to (1).

(3) We calculate $(F,G)$ as the approximable relation determined by $(\times)\circ (f,g): \domain_B\to \domain_{C\times D}$:
\begin{align*}
(F,G) &= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{(y,z) \in f(\downset x)\times g(\downset x)} \\
&= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{\big(y \in f(\downset x)\big)\land\big(z\in g(\downset x)\big)} \\
&= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{xFy\land xGy}.
\end{align*}
\end{proof}

\begin{proposition}
Let $B,C,D$ be finitary bases and $f: \domain_B\times \domain_C\to \domain_D$ a function and $F$ the relation on $(B\times C)\times D$ defined by
\[ (x,y)Fz \;\defequiv\; z\in f\big(\downset (x,y)\big). \]
Then the following are equivalent:
\begin{enumerate}
\item $f$ is Scott-continuous;
\item $f(x,-)$ and $f(-,y)$ are Scott-continuous for all $x\in \domain_B$ and $y\in \domain_C$;
\item $f(\downset b,-)$ and $f(-,\downset c)$ are Scott-continuous for all $b\in B$ and $c\in C$;
\item the relations $F_{b,*}$ and $F_{*,c}$ defined by
\begin{align*}
xF_{b,*}z \quad &\defequiv \quad (b,x)Fz \\
xF_{*,c}z \quad &\defequiv \quad (x,c)Fz
\end{align*}
are approximable.
\end{enumerate}
In this case, $F_{b,*}$ is the approximable relation associated to $f(\downset b,-)$ and $F_{*,c}$ the approximable relation associated to $f(-,\downset c)$.
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ This follows from \ref{productApproximableRelations} and the fact that $\id_{\domain_B}, \id_{\domain_C}, \underline{x}$ and $\underline{y}$ are Scott-continuous:
\[ f(x, -) = f \circ (\underline{x}, \id_{\domain_C}) \qquad\text{and}\qquad f(-, y) = f \circ (\id_{\domain_B}, \underline{y}). \]

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (4)$ If $f(\downset b,-)$ is Scott-continuous, then seeing that $F_{b,*}$ is the associated approximable relation is straightforward:
\[ xF_{b,*}z \iff (b,x)Fz \iff z \in f\big(\downset (b,x)\big) = f\big(\downset b \times \downset x\big). \]
The other part is similar.

$(4) \Rightarrow (1)$ It is enough to show that $F$ is approximable, in which case it is the approximable relation associated to the Scott-continuous function $f$.

Take $(x,y)\in B\times C$ and $z\in D$. Clearly $(x,y)F = yF_{x,*}$ is an ideal. Now take $(x',y')\geq (x,y)\in B\times C$, so $x'\geq x$ and $y'\geq y$. Then $y'F_{x,*}z$ by upwards closure of $F_{x,*}$ and we have the implications
\[ y'F_{x,*}z \implies (x,y')Fz \implies xF_{*,y'}z \implies x'F_{*,y'}z \implies (x',y')Fz. \]
We conclude that $Fz$ is upwards closed.
\end{proof}



\chapter{The poset of subsets}
\begin{definition}
Let $U$ be a set. Then $\sSet{\powerset(U), \subseteq}$ is a partially ordered set. We call $U$ the \udef{universe} of this poset.
\end{definition}

Any family of sets $\mathcal{F}$ may be seen as a subset of the poset with universe $\bigcup \mathcal{F}$.


\begin{lemma}
Let $U$ be a set and consider the poset $\sSet{\powerset(U), \subseteq}$. For all $A\subseteq U$ we have $\powerset(A) = \downset\{A\}$.
\end{lemma}
So powersets are principal ideals.

\begin{proposition} \label{posetPowerset}
Let $\mathcal{F}$ be a family of sets. Then $\sSet{\mathcal{F}, \subseteq}$ is a poset.

Conversely, every poset $(P,\preceq)$ is isomorphic to $\sSet{\mathcal{F}, \subseteq}$ for some family of sets $\mathcal{F}$ with universe $P$.
\end{proposition}
\begin{proof}
This is just a reformulation of \ref{orderedSetPowerset}.
\end{proof}
\begin{corollary} \label{MooreFamily}
Let $\mathcal{F}$ be a family of subsets of $U$. If
\begin{itemize}
\item $\mathcal{F}$ is closed under arbitrary intersections; and
\item $U \in \mathcal{F}$;
\end{itemize}
then $\sSet{\mathcal{F},\subseteq}$ is a complete lattice.

Conversely, every complete lattice is isomorphic to such a lattice.
\end{corollary}
Note that in general the join in such a lattice is \emph{not} given by the union, $\bigvee \neq \bigcup$!
\begin{proof}
Such a family of sets is a complete lattice by \ref{completeLatticeBasic}.

For the converse, the isomorphism is given by $x\mapsto \downset x$, as in \ref{principalDownsetEmbedding}. We just need to show that the meet translates to the intersection, i.e.\ $\downset \bigwedge Q = \bigcap_{x\in Q}\downset x$. We calculate, using \ref{minMaxUpsetDownset} and \ref{boundsFromPrincipalImages}:
\[ \downset \bigwedge Q = \downset \max(Q^l) = \downset Q^l = \downset \bigcap_{x\in Q} \downset x \subseteq \bigcap_{x\in Q} \downset x. \]
For the other inclusion we just note that a lattice order is in particular a  preorder and so we can use \ref{TODO}.
\end{proof}

\section{Moore families}
\begin{definition}
A family of sets $\mathcal{F}$ satisfying the hypothesis of \ref{MooreFamily}, i.e.\
\begin{itemize}
\item $\mathcal{F}$ is closed under arbitrary intersections; and
\item $U \in \mathcal{F}$;
\end{itemize}
is called a \udef{Moore family} or \udef{closure system}.
\end{definition}

TODO: join is given by union if directed?? (+CPO)??

\subsection{Closure rules}
\begin{definition}
Let $X$ be a set. A set $\Gamma \subseteq \powerset(X)\times X$ is called a set of \udef{closure rules}.
\end{definition}

Let $f: \powerset(X) \to \powerset(X)$ be a Moore closure. Then
\[ \setbuilder{(A,x) \in \powerset(X)\times X}{x\in f(A)} \]
is the set of associated closure rules.

Let $\Gamma$ be a set of closure rules. Then
\[ \setbuilder{B\subseteq X}{\big(A\subseteq B \land (A,x)\in \Gamma\big) \implies x\in B} \]
is the associated Moore family.

The Moore family is algebraic iff it is generated by a (possibly infinite) set of finitary rules.

\section{The complete Boolean lattice of subsets}
\begin{lemma}
Let $U$ be a universe set. Consider the poset $\sSet{\powerset(U), \subseteq}$ and let $\mathcal{F}\subseteq \powerset(U)$. Then
\begin{enumerate}
\item $\sup(\mathcal{F}) = \bigcup \mathcal{F}$;
\item $\inf(\mathcal{F}) = \bigcap \mathcal{F}$.
\end{enumerate}
(Assuming relativised intersection TODO!)
\end{lemma}
\begin{corollary}
Let $U$ be a universe set. Then $\sSet{\powerset(U), \subseteq}$ is a bounded, complete, distributive lattice with top $U$ and bottom $\emptyset$.
\end{corollary}
\begin{proof}
TODO ref distributivity.
\end{proof}

\subsection{Complementation}
\begin{definition}
Let $U$ be a universe and $A\subseteq U$. The \udef{complement} of $A$ w.r.t. $U$ is
\[ A^c \defeq U\setminus A. \]
\end{definition}

\begin{lemma}
The complement $^c$ is a lattice-theoretical complement.
\end{lemma}
\begin{proof}
For all $A\subseteq U$ we have $A\cup A^c = U$ and $A\cap A^c = \emptyset$ from \ref{differenceProperties}.
\end{proof}
\begin{corollary}
Let $U$ be a universe set. Then $\sSet{\powerset(U), \subseteq}$ is a Boolean lattice.
\end{corollary}

In particular de Morgan's laws can be formulated in this context as:
\begin{proposition}
Let $U,A,B$ be sets, then
\begin{align*}
(A\cup B)^c &= (A^c)\cap (B^c); \\
(A\cap B)^c &= (A^c)\cup (B^c).
\end{align*}
Where complementation is with respect to $U$.

This can be extended to arbitrary families of sets:
\begin{align*}
\left(\bigcup \mathcal{E}\right)^c &= \bigcap\setbuilder{A^c}{A\in\mathcal{E}} \\
\left(\bigcap \mathcal{E}\right)^c &= \bigcup\setbuilder{A^c}{A\in\mathcal{E}}
\end{align*}
where $\mathcal{E}$ is a family of sets.
\end{proposition}

\subsection{Expressing set theoretic operations with $\cup,\cap, ^c$}
\begin{proposition}
Let $A,B\subseteq U$ be sets. Then
\begin{enumerate}
\item $A\setminus B = A \cap B^c$;
\item $A\symdiff B = (A\cup B)\cap (A^c\cup B^c)$.
\end{enumerate}
\end{proposition}
\begin{corollary}
Let $A,B \subseteq U$ be sets. Then
\begin{enumerate}
\item $A\setminus B = B^c\setminus A^c$;
\item $A \symdiff B = A^c \symdiff B^c$;
\item $A \symdiff A^c = U$.
\end{enumerate}
\end{corollary}

\section{Filters, ideals and grills}

\subsection{Mesh Galois connection}
\begin{proposition} \label{meshConnection}
Let $X,Y$ be sets and $R$ a relation on $(X,Y)$. For all $A\subseteq X$ and $B\subseteq Y$,
\[ R^{\imf}(A)\mesh B \iff A\mesh R^\preimf(B). \]
\end{proposition}
\begin{proof}
We have
\begin{align*}
R^\imf(A) \mesh B &\iff R^\imf(A)\cap B \neq \emptyset \\
&\iff \exists y\in B: \; y\in R^\imf(A) \\
&\iff \exists x\in A, y\in B: \; xRy \\
&\iff \exists x\in A: \; x\in R^\preimf(y) \\
&\iff A\cap R^\preimf(y) \neq \emptyset \\
&\iff A\mesh R^\preimf(B).
\end{align*}
\end{proof}
\begin{corollary} \label{meshConnectionSetsOfSets}
Let $f:X \to Y$ be a function between sets, $F \subseteq \powerset(X)$, $A\subseteq X$ and $G\subseteq \powerset(Y)$. Then
\begin{enumerate}
\item $f^{\imf\imf}(F) \amesh G \iff F \amesh f^{\preimf\imf}(G)$;
\item $f^{\imf\imf}(F)^\mesh = \upset f^{\imf\imf}(F^\mesh)$;
\item $f^\imf(A)\in G^\mesh \iff A \in f^{\preimf\imf}(G)^\mesh$;
\item if $G$ is a filter, then $f^\imf(A)\in G \implies A \in f^{\preimf\imf}(G)^\mesh$;
\item if $G$ is an ultrafilter, then $f^\imf(A)\in G \iff A \in f^{\preimf\imf}(G)^\mesh$.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) We have
\begin{align*}
f^{\imf\imf}(F) \amesh G &\iff \forall A\in F, B\in G:\; f^{\imf}(A) \mesh B \\
&\iff \forall A\in F, B\in G:\; A \mesh f^\preimf(B) \\
&\iff F \amesh f^{\preimf\imf}(G).
\end{align*}

(2) For any $H\subseteq \powerset(Y)$, we have
\begin{align*}
G\subseteq f^{\imf\imf}(F)^\mesh &\iff G \amesh f^{\imf\imf}(F) \\
&\iff f^{\preimf\imf}(G)\amesh F \\
&\iff f^{\preimf\imf}(G) \subseteq F^\mesh \\
&\iff \upset f^{\preimf\imf}(G) \subseteq F^\mesh \\
&\iff G \subseteq \upset f^{\imf\imf}(F^\mesh),
\end{align*}
where we have used point (1), the fact that $F^\mesh$ is upwards closed (\ref{grillUpwardsClosed}) and the Galois connection in \ref{upsetPreimageImageGaloisConnection}.

(3) By point (1), we have
\begin{align*}
f^\imf(A)\in G^\mesh \iff& f^{\imf\imf}\big(\{A\}\big)\amesh G \\
\iff& \{A\} \amesh f^{\preimf\imf}(G) \\
\iff& A \in f^{\preimf\imf}(G)^\mesh.
\end{align*}

(3) By \ref{properFiltersSelfMesh} and point (3), we have
\[ f^\imf(A)\in G \quad\implies\quad  f^\imf(A)\in G^\mesh \quad\implies\quad  A \in f^{\preimf\imf}(G)^\mesh. \]

(4) In the previous proof the implication becomes an equivalence by \ref{ultrafilterCriteria}.
\end{proof}

\begin{lemma} \label{meshProductIsotoneSets}
Let $X,Y$ be sets and $F\subseteq \powerset(X), G\subseteq \powerset(Y), H\subseteq \powerset(X\times Y)$ upwards closed. Then
\[ F\otimes G \amesh H \iff \begin{cases}
F \amesh \pi_1^{\imf\imf}(H) \\ G \amesh \pi_2^{\imf\imf}(H)
\end{cases} \]
\end{lemma}
\begin{proof}
First assume $F\otimes G \amesh H$, which is equivalent to $F\otimes G\subseteq H^\mesh$.
By \ref{projectionsOfProductFilter} and \ref{meshConnectionSetsOfSets}, we have
\[ F = \upset\pi_1^{\imf\imf}(F\otimes G) \subseteq \upset\pi_1^{\imf\imf}(H^\mesh) = \pi_1^{\imf\imf}(H)^\mesh. \]
Similarly $G\subseteq \pi_1^{\imf\imf}(H)^\mesh$. Thus $F \amesh \pi_1^{\imf\imf}(H)$ and $G \amesh \pi_2^{\imf\imf}(H)$.

Now assume the right-hand side.
By \ref{meshConnectionSetsOfSets} and \ref{filterFactorisationInequality}, we have
\[ F\otimes G \subseteq \pi_1^{\imf\imf}(H)^\mesh\otimes \pi_2^{\imf\imf}(H)^\mesh = \pi_1^{\imf\imf}(H^\mesh)\otimes \pi_2^{\imf\imf}(H^\mesh) \subseteq H^\mesh, \]
so $F\otimes G \amesh H$.
\end{proof}

\subsection{Cofinite filters}
TODO extend to any filter with infinite atoms.
\begin{definition}
Let $X$ be a set and $A\subseteq X$. The \udef{cofinite filter} of $A$ is the filter
\[ (A)_0 \quad\defeq\quad \setbuilder{B\subseteq X}{\text{$A\setminus B$ if finite}}. \]
\end{definition}

\begin{lemma}
Let $X$ be a set and $A\subseteq X$. Then $(A)_0$ is a filter.
\end{lemma}
\begin{proof}
Upwards closure is immediate from the definition. To show closure under finite intersections, take $B,C\in (A)^0$. Then
\begin{align*}
A\setminus (B\cap C) &= A \cap (B\cap C)^c \\
&= A \cap (B^c\cup C^c) \\
&= (A\cap B^c) \cup (A\cap C^c) \\
&= (A\setminus B) \cup (A\setminus C).
\end{align*}
Since $A\setminus B$ and $A\setminus C$ are both finite, $A\setminus(B\cap C)$ is finite and thus $B\cap C\in (A)_0$.
\end{proof}

\begin{lemma} \label{cofiniteFilterInclusion}
Let $X$ be a set. If $A\subseteq B\subseteq X$, then $(B)_0 \subseteq (A)_0$.
\end{lemma}

\begin{proposition} \label{freeFilterContainsCofiniteFilters}
Let $X$ be a set and $F$ a free filter in $\filters_0(\powerset(X))$. If $A\in F$, then $F$ contains $(A)_0$.
\end{proposition}
\begin{proof}
Take some cofinite subset $C$ of $A$, such that $A\setminus C = \{x_1, \ldots, x_n\}$ is finite. Now for each $x_i$ we can find a set $f_i\in F$ such that $x_i\notin f_i$, because if this was not possible, then $x_i \in \bigcap F$, but $\bigcap F = \emptyset$ due to $F$ being free. Also $\bigcap_{i=1}^n f_i \in F$, because $F$ is closed under finite intersections.

So $(A\setminus C)\cap (\bigcap_{i=1}^n f_i) = \emptyset$, or equivalently $\bigcap_{i=1}^n f_i \subseteq X\setminus (A\setminus C)$, meaning $X\setminus (A\setminus C) \in F$ and thus $C = A\cap (X\setminus (A\setminus C)) \in F$.
\end{proof}
\begin{corollary} \label{filterFreeIFFfinerThanCofinite}
A filter $F\in\powerfilters(X)$ is free \textup{if and only if} it contains $(X)_0$.
\end{corollary}
\begin{proof}
The direction $\Rightarrow$ is immediate from the proposition.

For the other direction, note that for any $x\in X$, we have $X\setminus\{x\} \in (X)_0 \subseteq F$, so $x\notin \ker(F)$. Thus $\ker(F) = \emptyset$.
\end{proof}
\begin{corollary} \label{cofiniteFiltersSameIffDifferenceFinite}
Let $X$ be a set and $A,B\subseteq X$. Then $(A)_0 = (B)_0$ \textup{if and only if} $A\symdiff B$ is finite.
\end{corollary}
\begin{proof}
First assume $(A)_0 = (B)_0$. Then $A$ is an element of the cofinite filter of $B$ and vice versa. Thus there exist finite sets $C, C'\subseteq X$ such that $A\setminus C \subseteq B$ and $B\setminus C' \subseteq A$.
By \ref{residuationSetBooleanLattice} this implies $A\setminus B \subseteq C$ and $B\setminus A \subseteq C'$, so $A\symdiff B \subseteq C\cup C'$, which is finite.

Now assume $A\symdiff B$ is finite. It is enough to show that $(A)_0\subseteq (B)_0$ (the other inclusion follows by symmetry). By the proposition it is enough to show that $A$ is an element of the cofinite filter of $B$. This is immediate from $B\setminus (A\symdiff B) \subseteq A$ (which follows from $B\setminus A\subseteq A\symdiff B$ by \ref{residuationSetBooleanLattice}).
\end{proof}

\begin{lemma} \label{cofiniteFilterNotUltra}
Cofinite filters are never ultrafilters.
\end{lemma}
\begin{proof}
Assume, towards a contradiction, that $(A)_0$ is an ultrafilter.

If $A$ is finite, then $(A)_0$ is not proper and thus not an ultrafilter.

If $A$ is infinite, then we can partition $A$ into two disjoint infinite sets (TODO ref) $A_1$ and $A_2$.

Then $(A)_0 \subseteq (A_1)_0$ by \ref{cofiniteFilterInclusion}, but $(A)_0 \neq (A_1)_0$ by \ref{cofiniteFiltersSameIffDifferenceFinite}, because $A\setminus A_1$ is infinite.
\end{proof}

\begin{proposition} \label{cofiniteBaseFreePart}
Let $X$ be a set, $F\in \powerfilters(X)$ and $\mathcal{B}$ a base of $F$. The free part of $F$, $F_0$, is given by
\[ F_0 = \bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0. \]
\end{proposition}
\begin{proof}
By \ref{freePrincipalDecomposition} the free part $F_0$ has base
\[ \setbuilder{\ker(F)^c\cap B}{B\in \mathcal{B}} = \setbuilder{B\setminus \ker(F)}{B\in \mathcal{B}}. \]

By \ref{freeFilterContainsCofiniteFilters}, we have $\big(B\setminus \ker(F)\big)_0 \subseteq F_0$ for all $B\in\mathcal{B}$, so $\bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0 \subseteq F_0$.

For the other inclusion, we note that each element $A\in F_0$ contains $B\setminus\ker(F)$ for some $B\in\mathcal{B}$, so
\[ A\in \big(B\setminus\ker(F)\big)_0 \subseteq \bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0. \]
\end{proof}

\begin{proposition}
Let $X,Y$ be sets, $A, A'\subseteq X$ and $B\subseteq Y$. Then
\begin{enumerate}
\item $(A\cup A')_0 = (A)_0 \cap (A')_0$;
\item $(A)_0 \vee (A')_0 \subseteq (A\cap A')_0$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $C\subseteq X$. Then
\[ (A\cup A')\setminus C = (A\cup A')\cap C^c = (A\cap C^c) \cup (A'\cap C^c) = (A\setminus C)\cup (A'\setminus C). \]
Thus $(A\cup A')\setminus C$ is finite iff $A\setminus C$ is finite and $A'\setminus C$ is finite. So $C\in (A\cup A')$ iff $C\in (A)_0$ and $C\in (A')_0$ iff $C\in (A)_0\cap (A')_0$.

(2) Let $C\subseteq X$. Then
\[ (A\cap A')\setminus C = (A\cap A')\cap C^c = (A\cap C^c) \cap (A'\cap C^c) = (A\setminus C)\cap (A'\setminus C). \]
If either $A\setminus C$ or $A'\setminus C$ is finite, then the intersection is finite and $C\in (A\cap A')_0$. Thus $(A)_0 \cup (A')_0 \subseteq (A\cap A')_0$. Since $(A\cap A')_0$ is a filter, we have $(A)_0 \vee (A')_0 \subseteq (A\cap A')_0$. 
\end{proof}

\subsection{Principal ultrafilters}
Let $X$ be a set. The atoms in $\powerset(X)$ are the singletons $\{x\}$ for $x\in X$. By \ref{principalUltrafilters}, the principal ultrafilters in $\powerfilters(X)$ are of the form $\upset\big\{\{x\}\big\}$ for some $x\in X$.

\begin{definition}
Let $X$ be a set and $x\in X$. We denote the principal ultrafilter as
\[ \pfilter{x} \quad \defeq \quad \upset\big\{\{x\}\big\}. \]
\end{definition}


\begin{proposition}
Let $X$ be a set. If $X$ is infinite, then there exists a non-principal ultrafilter in $\powerfilters(X)$.
\end{proposition}
This proposition assumes the ultrafilter lemma \ref{ultrafilterLemma}.
\begin{proof}
Consider the cofinite filter $F = \setbuilder{A\subseteq X}{X\setminus A\;\text{is finite}}$. By the ultrafilter lemma, \ref{ultrafilterLemma}, we can extend $F$ to an ultrafilter $\mathcal{U}$. Now $\mathcal{U}$ does not contain any sets of the form $\{x\}$ with $x\in X$. If it did, then it would contain both $\{x\}$ and $X\setminus\{x\}$, meaning it would also contain $\emptyset$ and thus would not be proper and in particular not an ultrafilter.
\end{proof}

\subsection{Covers}
\begin{definition}
Let $X$ be a set. A \udef{cover} of $X$ is a family of filters $\mathcal{F}\subseteq \powerfilters(X)$ such that $\bigcap \mathcal{F} = \{X\}$.
\end{definition}

\begin{lemma} \label{principalUltrafilterInCover}
Let $X$ be a set and $\mathcal{F}$ a cover of $X$. Then for all $x\in X$ there exists $F\in \mathcal{F}$ such that $F\subseteq \pfilter{x}$.
\end{lemma}
\begin{proof}
Because $\{x\}^c \notin \{X\} = \bigcap \mathcal{F}$, there must be $F\in \mathcal{F}$ such that $\{x\}^c \notin F$. Then $\{x\} \in F^\mesh$ by \ref{complementInIsotoneGrill}, so $x$ is in all elements of $F$, i.e. $F\subseteq \pfilter{x}$.
\end{proof}
Similar idea: the meet of a set of free filters is a least the cofinite filter $(X)_0$ by \ref{filterFreeIFFfinerThanCofinite}.

\subsection{Relations on filters}
\begin{definition}
Let $X,Y$ be sets and $R$ a relation on $(X,Y)$. We define
\begin{itemize}
\item $F \mathrel{R_w} G \quad \defequiv\quad \forall A\in F, B\in G: \exists x\in A, y\in B: \; xRy$;
\item $F \mathrel{R_s} G \quad \defequiv\quad \exists A\in F, B\in G: \forall x\in A, y\in B: \; xRy$;
\end{itemize}
for all $F\in \powerfilters(X), G\in \powerfilters(Y)$.

We call $R_w$ the weak relation and $R_s$ the strong relation on filters.
\end{definition}

\begin{lemma} \label{filterRelationsLemma}
Let $X,Y$ be sets and $R$ a relation on $(X,Y)$. Then
\begin{enumerate}
\item $R_w^\transp = (R^\transp)_w$ and $R_w^\transp = (R^\transp)_w$;
\item $\overline{R_w} = \overline{R}_s$ and $\overline{R_s} = \overline{R}_w$.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{filterInequalityCriterion}
Let $\sSet{X,\leq}$ be a complete lattice and $F,G\in\powerfilters(X)$. Then
\begin{align*}
F \leq_w G \qquad &\implies\qquad \liminf F \leq \limsup G; \\
F \leq_s G \qquad &\implies\qquad \limsup F \leq \liminf G.
\end{align*}
\end{lemma}
\begin{proof}
(1) We have
\begin{align*}
F \leq_w G &\iff \forall A\in F, B\in G: \exists x\in A, y\in B: \; x \leq y \\
&\implies \forall A\in F, B\in G: \bigwedge A \leq \bigvee B \\
&\iff \bigvee_{A\in F}\bigwedge A \leq \bigwedge_{B\in G}\bigvee B \\
&\iff \liminf F \leq \limsup G.
\end{align*}

(2) We have
\begin{align*}
F \leq_s G &\iff \exists A\in F, B\in G: \forall x\in A, y\in B: \; x \leq y \\
&\iff \exists A\in F, B\in G: \forall x\in A: x \leq \bigwedge B \\
&\iff \exists A\in F, B\in G: \bigvee A \leq \bigwedge B \\
&\implies \bigvee_{A\in F}\bigwedge A \leq \bigwedge_{B\in G}\bigvee B \\
&\iff \liminf F \leq \limsup G.
\end{align*}
\end{proof}

\begin{lemma} \label{weakRelationPrincipalFilter}
Let $\sSet{X,\leq}$ be a poset, $x\in X$ and $F\in\powerfilters(X)$. Then
\begin{enumerate}
\item $F\leq_w \pfilter{x}$ \textup{if and only if} $x\in \bigcap_{A\in F}\upset A$;
\item $\pfilter{x} \leq_w F$ \textup{if and only if} $x\in \bigcap_{A\in F}\downset A$.
\end{enumerate}
In particular $\pfilter{x}\leq_w \pfilter{y}$ \textup{if and only if} $x\leq y$.
\end{lemma}
\begin{proof}
(1) We have
\begin{align*}
F\leq_w \pfilter{x} &\iff \forall A\in F: \exists y\in A: \; y\leq x \\
&\iff \forall A\in F: x\in \upset A \\
&\iff x\in \bigcap_{A\in F}\upset A.
\end{align*}

(2) Dual.
\end{proof}

\begin{lemma} \label{relationsOnFiltersRestated}
Let $X$ be a set, $R$ a homogeneous relation on $X$ and $F,G\in\powerfilters(X)$. Then
\begin{align*}
F \mathrel{R_w} G \qquad &\iff\qquad \forall C\in F\otimes G: \exists (x,y) \in C: \; x \mathrel{R} y; \\
&\iff\qquad \graph(R) \in (F\otimes G)^\mesh; \\
F \mathrel{R_s} G \qquad &\iff\qquad \exists C\in F\otimes G: \forall (x,y) \in C: \; x \mathrel{R} y; \\
&\iff\qquad \graph(R) \in F\otimes G.
\end{align*}
\end{lemma}
\begin{proof}
$\boxed{F \mathrel{R_w} G}$ First assume $F \mathrel{R_w} G$. Take $C\in F\otimes G$. Then there exist $A\in F, B\in G$ such that $A\times B \subseteq C$. By assumption, we can find $x\in A$ and $y\in B$ such that $x \mathrel{R} y$. In this case $(x,y)\in C$.

For the converse, take $A\in F$ and $B\in G$. Then $A\times B\in F\otimes G$ and by assumption there exists $(x,y)\in A\times B$ such that $x \mathrel{R} y$.

The second equivalence is immediate.

$\boxed{F \mathrel{R_s} G}$ First assume $F \mathrel{R_s} G$. Then there exist $A\in F$ and $B\in G$
such that $\forall (x,y) \in A\times B$, we have $ x \mathrel{R} y$. We can take $C = A\times B \in F\otimes G$.

For the converse, take such a $C\in F\otimes G$. Then there exist $A\in F$ and $B\in G$ such that $A\times B \subseteq C$. For all $x\in A$ and $y\in B$ we have $(x,y)\in C$, so $x\mathrel{R}y$.

Then $A\times B\in F\otimes G$ and by assumption there exists $(x,y)\in A\times B$ such that $x \mathrel{R} y$.

Since $F\otimes G$ is upwards closed, we have the final equivalence.
\end{proof}
TODO contours for propositions.


\begin{proposition} \label{pointwisefunctionToFilterInequality}
Let $X,Y,Z$ be sets, $R$ a relation on $(Y,Z)$ and $f: X\to Y, g: X\to Z$ functions. Then $f\mathrel{R} g$ pointwise \textup{if and only if} $\upset f^{\imf\imf}(F) \mathrel{R_w} \upset g^{\imf\imf}(F)$ for all proper filters $F\in \powerfilters(X)$.
\end{proposition}
\begin{proof}
First suppose $f\mathrel{R} g$ pointwise and pick a proper filter $F\in \powerfilters(X)$. Pick arbitrary $A\in \upset f^{\imf\imf}(F)$ and $B\in \upset g^{\imf\imf}(F)$. Thus there exist $A',B'\in F$ such that $f^{\imf}(A')\subseteq A$ and $g^{\imf}(B')\subseteq B$. Set $C = A'\cap B' \neq \emptyset$. We can pick $x\in C$ and by the pointwise inequality $f(x) \mathrel{R} g(x)$. Thus the weak inequality holds because $f(x)\in A$ and $g(x)\in B$.

For the converse, it is enough to note that $\upset f^{\imf\imf}(\pfilter{x}) \mathrel{R_w} \upset g^{\imf\imf}(\pfilter{x})$ implies $f(x)\mathrel{R} g(x)$.
\end{proof}

\begin{proposition} \label{relationPreservingfunctionToFilterInequality}
Let $\sSet{X, R},\sSet{Y, S}$ be relational structures and $f: X\to Y$ a function. Then $f$ is relation preserving \textup{if and only if} $F\mathrel{R_w}G$ implies $\upset f^{\imf\imf}(F) \mathrel{R_w} \upset f^{\imf\imf}(G)$ for all proper filters $F, G\in \powerfilters(X)$.
\end{proposition}
\begin{proof}
First suppose $f$ is relation preserving and pick proper filters $F,G\in \powerfilters(X)$ such that $F\mathrel{R_w}G$. Take arbitrary $A\in \upset f^{\imf\imf}(F)$ and $B\in \upset f^{\imf\imf}(G)$. Thus there exist $A'\in F$ and $B'\in G$ such that $f^{\imf}(A')\subseteq A$ and $f^{\imf}(B')\subseteq B$. 
By assumption there exist $x\in A', y\in B'$ such that $xRy$. Since $f$ is relation-preserving, we have $f(x)Rf(y)$. Also $f(x)\in A$ and $f(y)\in B$. Thus $\upset f^{\imf\imf}(F) \mathrel{R_w} \upset f^{\imf\imf}(G)$.

For the converse, it is enough to note that $\upset f^{\imf\imf}(\pfilter{x}) \mathrel{R_w} \upset f^{\imf\imf}(\pfilter{y})$ implies $f(x)Rf(y)$.
\end{proof}

\begin{proposition} \label{upDownClosureWeakStrongRelation}
Let $X,Y$ be sets and $R$ a relation on $(X,Y)$. Then
\begin{enumerate}
\item $F\mathrel{R_w} \subseteq \powerfilters(Y)$ is downwards closed for all $F\in\powerfilters(X)$;
\item $\mathrel{R_w}G  \subseteq \powerfilters(X)$ is downwards closed for all $G\in\powerfilters(Y)$.
\item $F\mathrel{R_s} \subseteq \powerfilters(Y)$ is upwards closed for all $F\in\powerfilters(X)$;
\item $\mathrel{R_s}G  \subseteq \powerfilters(X)$ is upwards closed for all $G\in\powerfilters(Y)$.
\end{enumerate}
\end{proposition}

\subsubsection{Reflexivity}
\begin{lemma}
Let $\sSet{X,R}$ be a relational structure and $F\in \powerfilters(X)$. Then
\begin{enumerate}
\item $F\mathrel{R_w}F$ \textup{if and only if} $\forall A\in F: \exists x,y\in A: xRy$;
\item $F\mathrel{R_s}F$ \textup{if and only if} $\exists A\in F: \forall x,y\in A: xRy$.
\end{enumerate}
\end{lemma}
\begin{corollary} \label{reflexivityFilterRelations}
Let $\sSet{X,R}$ be a relational structure. Then
\begin{enumerate}
\item $R_w$ is reflexive \textup{if and only if} $R$ is reflexive;
\item $R_s$ is reflexive \textup{if and only if} $R = U_X$.
\end{enumerate}
\end{corollary}


\section{Multisets and annotated sets}
\begin{definition}
Let $U, X$ be sets.
\begin{itemize}
\item An \udef{$X$-annotation} of $U$ is a function $U\to X$.
\item A \udef{multiset} over $U$ is an $\N$-annotation of $U$, i.e.\ a function $M: U\to \N$.
\end{itemize}
\end{definition}

\subsection{Relations and operations with multisets}
\subsubsection{Relations with multisets}
\begin{definition}
Let $U$ be a set, $M,N: U\to \N$ multisets and $x\in U$. We define
\begin{itemize}
\item $x\in M \defequiv m(x) \neq 0$;
\item $M\subseteq N \defequiv M \leq N$.
\end{itemize}
\end{definition}

\subsubsection{Operations on multisets}
\begin{definition}
Let $U$ be a set, $M,N: U\to \N$ multisets and $x\in U$. We define
\begin{itemize}
\item $M\cup N \defeq \max(M,N)$;
\item $M\cap N \defeq \min(M,N)$;
\item $M\uplus N \defeq M+N$;
\item $M\setminus N \defeq x\mapsto\begin{cases}
M(x) - N(x) & \big(M(x) \geq N(x)\big) \\
0 & (\text{otherwise}).
\end{cases}$
\end{itemize}
\end{definition}

\subsection{Dershowitz-Manna ordering}
\begin{definition}
Let $\sSet{U,\Yleft}$ be an ordered set. The TODO
\end{definition}

\subsection{Indicator functions}
\begin{definition}
Let $U$ be a set and $A\subseteq U$. The \udef{indicator function} or \udef{characteristic function} of $A$ as an element of $\powerset(U)$ is defined as
\[ \charFunc{A}: U\to \{0,1\}: x\mapsto \begin{cases}
1 & x\in A \\ 0 & x\notin A.
\end{cases} \]
\end{definition}

\begin{lemma}
Let $U$ be a set. The characteristic function $\chi$ determines a bijection between the subsets of $U$ and the multisets $M$ with $\im(M)\subseteq \{0,1\}$.
\end{lemma}

\begin{lemma}
Let $A,B$ be elements of $\powerset(U)$. Then
\begin{enumerate}
\item $\chi_{A\cap B} = \min\{\chi_A,\chi_B\} = \chi_A\cdot \chi_B$;
\item $\chi_{A\cup B} = \max\{\chi_A,\chi_B\} = \chi_A + \chi_B - \chi_A\cdot \chi_B$;
\item $\chi_{A\uplus B} = \chi_A + \chi_B$;
\item $\chi_{A^c} = \underline{1}-\chi_A$; and thus $\chi_A + \chi_{A^c} = \underline{1}$;
\item $\chi_{A\Delta B} \begin{aligned}[t] &= \chi_A + \chi_B - \underline{2}\cdot\chi_A\cdot \chi_B \\
&= |\chi_A - \chi_B| \\
&= \chi_A + \chi_B \mod 2 \defeq \begin{cases}
1 & (\chi_A + \chi_B = 1) \\
0 & \text{(else)}
\end{cases}
\end{aligned}$.
\end{enumerate}
Where all operations are defined point-wise.
\end{lemma}

\begin{proposition}
The indicator functions define a bijection between $\powerset(U)$ and $(U\to \{0,1\})$.
\end{proposition}

\subsection{Iverson bracket}
\begin{definition}
Let $P$ be some proposition. Then we define the \udef{Iverson bracket} of $P$ as
\[ \Iverson{P} \;\defeq\; \begin{cases}
0 & (\text{$P$ is false}) \\
1 & (\text{$P$ is true}).
\end{cases} \]
\end{definition}

TODO properties \url{https://en.wikipedia.org/wiki/Iverson_bracket}.

\section{Families of sets}
\subsection{Subset algebraic structures}
\begin{definition}
Let $U$ be a set.
\begin{itemize}
\item A \udef{family of subsets} of $U$ is an element $\mathcal{F}\subseteq\powerset(U)$, i.e.\ $\mathcal{F}\in\powerset^2(U)$.
\item A \udef{type of (partial) subsetalgebra} $\boldsymbol{T}$ is a set of set theoretical operations.
\item A \udef{$\boldsymbol{T}$-subsetalgebra} on $U$ is a family of subsets of $U$ that is closed under all operations of $\boldsymbol{T}$.
\end{itemize}
A \udef{$\boldsymbol{T}$-space} is a pair $\sSet{U,\mathcal{F}}$, where $U$ is a set and $\mathcal{F}$ is a $\boldsymbol{T}$-subsetalgebra on $U$.
\end{definition}
Most commonly we have
\[ \boldsymbol{T} \subseteq \{\cup,\; \cap,\; \bigcup_\omega,\; \bigcap_\omega,\; \bigcup,\; \bigcap,\; \biguplus,\; \dirvee,\; \bigcup_\text{monotone}, \bigcap_\text{monotone}, \setminus,\; ^c,\; \symdiff \} \]

\begin{proposition}
Let $U$ be a set and $\boldsymbol{T}$ a type of (partial) subsetalgebra. Then the $\boldsymbol{T}$-subalgebras of $\powerset(U)$ form a $\wedge$-subsemilattice of $\powerset^2(U)$.
\end{proposition}

\subsubsection{Compatible functions}
\begin{definition}
Let $\sSet{X, \mathcal{X}}$, $\sSet{Y, \mathcal{Y}}$ be $\boldsymbol{T}$-spaces. A function $f: X\to Y$ is called \udef{$\boldsymbol{T}$-compatible} if
\[ f^{\preimf\imf}(\mathcal{Y}) \subseteq \mathcal{X}. \]
\end{definition}

\begin{proposition} \label{compositionCompatibleFunctions}
Composition of compatible functions is compatible.
\end{proposition}
\begin{proof}
Let $f: \sSet{X,\mathcal{X}} \to \sSet{Y,\mathcal{Y}}$ and $g: \sSet{Y,\mathcal{Y}} \to \sSet{Z,\mathcal{Z}}$ be compatable functions. Then
\[ \mathcal{X} \supseteq f^{\preimf\imf}(\mathcal{Y}) \supseteq f^{\preimf\imf}\big(g^{\preimf\imf}(\mathcal{Z})\big) = (f^{\preimf} \circ g^{\preimf})^{\imf}(\mathcal{Z}) = (g\circ f)^{\preimf\imf}(\mathcal{Z}), \]
so $g \circ f$ is compatable.
\end{proof}

\begin{lemma} \label{commutationTclosure}
Let $f: X\to Y$ be a function and $\mathcal{F}\subseteq \powerset(Y)$ some set of subsets. Then $f^{\preimf\imf}\big(\boldsymbol{T}(\mathcal{F})\big) = \boldsymbol{T}\big(f^{\preimf\imf}(\mathcal{F})\big)$.
\end{lemma}
\begin{proof}
TODO
\end{proof}

We want to show $t$ commutes with operations iff $t^{\imf}$ commutes with closure.

TODO $T$-algebras! Monad $\powerset$ + multiple partially defined functions $\powerset(\mathcal{F}) \to \mathcal{F}$.

Then (for $t\in \boldsymbol{T}$):
\[ t(t(A)\cup B) = t(A\cup B). \]

\subsubsection{Initial and final subsetalgebras}
\begin{definition}
Let $Y$ be a set.
\begin{itemize}
\item Given a set of $\boldsymbol{T}$-spaces $\{\sSet{Z_i,\mathcal{Z}_i}\}_{i\in I}$ and a set of functions $\{f_i: Y\to Z_i\}_{i\in I}$, we define the \udef{initial $\boldsymbol{T}$-subsetalgebra} $\mathcal{F}$ on $Y$ w.r.t. $\{f_i: Y\to Z_i\}$ as the greatest $\boldsymbol{T}$-subsetalgebra on $Y$ that makes all functions in $\{f_i: Y\to Z_i\}$ compatible:
\[ \mathcal{F} = \bigvee \setbuilder{\mathcal{Y}}{\forall i\in I: \;\text{$f_i: \sSet{Y,\mathcal{Y}} \to \sSet{Z_i, \mathcal{Z}_i}$ compatible}}. \]
\item Given a set of $\boldsymbol{T}$-spaces $\{\sSet{X_i,\mathcal{X}_i}\}_{i\in I}$ and a set of functions $\{g_i: X_i \to Y\}_{i\in I}$, we define the \udef{final $\boldsymbol{T}$-subsetalgebra} $\mathcal{G}$ on $Y$ w.r.t. $\{g_i: X_i\to Y\}$ as the smallest $\boldsymbol{T}$-subsetalgebra on $Y$ that makes all functions in $\{g_i: X_i \to Y\}$ compatible:
\[ \mathcal{G} = \bigwedge \setbuilder{\mathcal{Y}}{\forall i\in I: \;\text{$g_i: \sSet{X_i,\mathcal{X}_i} \to \sSet{Y, \mathcal{Y}}$ compatible}}. \]
\end{itemize}
\end{definition}

\begin{proposition}
Let $Y$ be a set, $\{\sSet{Z_i,\mathcal{Z}_i}\}_{i\in I}$ a set of $\boldsymbol{T}$-spaces and $\{f_i: Y\to Z_i\}_{i\in I}$ a set of functions. Then the initial $\boldsymbol{T}$-subsetalgebra on $Y$ is given by
\[ \boldsymbol{T}\Big( \bigcup_{i\in I}f_i^{\preimf\imf}(\mathcal{Z}_i). \Big) \]
\end{proposition}
\begin{corollary}
A function $g: \sSet{X,\mathcal{X}}\to Y$ from some $\boldsymbol{T}$-space to $Y$ is compatible \textup{if and only if} $f_i\circ g$ is compatible for all $i\in I$.
\[ \begin{tikzcd}
Y \rar["f_i"] & Z_i \\
X \uar["g"] \arrow[ur, swap, "{f_i\circ g}"]
\end{tikzcd} \]
\end{corollary}
\begin{proof}
The direction $\Rightarrow$ is given by \ref{compositionCompatibleFunctions}.

For the other direction, we note that the compatibility of $g$ is equivalent to
\[ g^{\preimf\imf}\bigg(\boldsymbol{T}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big)\bigg) \subseteq \mathcal{X}. \]
By \ref{commutationTclosure}, this is equivalent to
\[ \boldsymbol{T}\bigg(g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big)\bigg) \subseteq \mathcal{X}. \]
This is equivalent to the $g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big) \subseteq \mathcal{X}$, by $\boldsymbol{T}$-closure of $\mathcal{X}$. Finally we note
\[ g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big) = \bigcup_{i\in I}g^{\preimf\imf}\big(f_i^{\preimf \imf}(\mathcal{Z}_i)\big) = \bigcup_{i\in I}(f_{i}\circ g)^{\preimf\imf}(\mathcal{Z}_i). \]
So the compatibility of $g$ is implied by  the compatability of all $f_i\circ g$.
\end{proof}

\subsubsection{Subset subsetalgebras}
\begin{definition}
Let $\sSet{X,\mathcal{X}}$ be a $\boldsymbol{T}$-algebra and $A\subseteq X$ a subset. Then the \udef{subset $\boldsymbol{T}$-algebra} on $A$ is the initial $\boldsymbol{T}$-algebra on $A$ w.r.t. the inclusion map $A\hookrightarrow X$.
\end{definition}

\subsubsection{Product subsetalgebras}
\begin{definition}
Let $\{\sSet{X_i,\mathcal{X}_i}\}_{i\in I}$ be a set of $\boldsymbol{T}$-algebras. Then the \udef{product $\boldsymbol{T}$-algebra} is the initial $\boldsymbol{T}$-algebra on $\bigtimes X_i$ w.r.t. the projection maps $\{p_j: \bigtimes_{i\in I}X_i\to X_j\}_{j\in I}$.
\end{definition}



\subsection{Closure under set operations}
We say a family of sets $\mathcal{F}$ is closed under an operation if the result of this operation acting on sets in $\mathcal{F}$ is again in $\mathcal{F}$.

\begin{definition}
A family of sets $\mathcal{F}\subseteq\powerset(U)$ is called
\begin{itemize}
\item \udef{closed under complementation} if $A^c\in\mathcal{F}$ for all $A\in\mathcal{F}$;
\item \udef{closed under relative complements} if $A\setminus B\in\mathcal{F}$ for all $A \supset B\in\mathcal{F}$;
\item \udef{closed under set difference} if $A\setminus B\in\mathcal{F}$ for all $A, B\in\mathcal{F}$;
\end{itemize}
and
\begin{itemize}
\item \udef{closed under finite unions} if $A\cup B \in\mathcal{F}$ for all $A,B\in\mathcal{F}$;
\item \udef{closed under finite intersections} if $A\cap B \in\mathcal{F}$ for all $A,B\in\mathcal{F}$;
\item \udef{closed under disjoint unions} if $\biguplus_{i\in I}A_i \in\mathcal{F}$ for any indexed family of disjoint sets $\{A_i\}_{i\in I}$;
\item \udef{closed under countable monotone unions} if $\bigcup_{i=1}^\infty A_i \in\mathcal{F}$ for any indexed family of sets $\{A_i\}_{i\in \N}$ such that $i\leq j \implies A_i \subseteq A_j$;
\item \udef{closed under countable monotone intersections} if $\bigcap_{i=1}^\infty A_i \in\mathcal{F}$ for any indexed family of sets $\{A_i\}_{i\in \N}$ such that $i\leq j \implies A_i \supseteq A_j$.
\end{itemize}
Our definition of closure under relative complements is \emph{not} the same as closure under set difference! Our definition is non-standard as they are usually taken to be the same thing.
\end{definition}

For all these set-theoretical operations, ``closed under X'' is the same as ``being X-subalgebra''.

\subsubsection{Complementation, relative complementation and set difference}
In general the notions of closure under complementation, relative complementation and set difference are distinct, the only implication being from set difference to relative complementation.

\begin{lemma} \label{complementTypesUnionClosure}
Let $\mathcal{F}$ be a family of sets that is closed under finite (disjoint) unions. Then
\[ \begin{tikzcd}[row sep=0]
\text{$\mathcal{F}$ is closed under set differences} \arrow[dr, Rightarrow] & \\
\text{$\mathcal{F}$ is closed under complementation} \arrow[r,Rightarrow] & \text{$\mathcal{F}$ is closed under relative complements.}
\end{tikzcd} \]
\end{lemma}
\begin{proof}
Assume $A\supset B$, then $A\setminus B = A^c \uplus B$. This is a disjoint union.
\end{proof}

\begin{lemma}
Let $\mathcal{F}$ be a family of sets that is closed under finite intersections. Then
\[ \text{closure under complements} \quad\implies\quad \text{closure under set difference} \quad\iff\quad \text{closure under relative complements.} \]
All three are equivalent if $\mathcal{F}$ contains the universe set.
\end{lemma}
\begin{proof}
$A\setminus B = A\cap B^c$ and $A\setminus B = A\setminus (B\cap A)$.
\end{proof}

\begin{lemma} \label{closureSetDifference}
Let $\mathcal{F}$ be a family of sets. Then
\[ \text{closure under set differences} \quad\implies\quad \text{closure under finite intersections.} \]
\end{lemma}
\begin{proof}
$A\cap B = A\setminus (A\setminus B)$.
\end{proof}

Any non-empty family of sets that is closed under set differences is also an order-theoretic ring.

\subsubsection{Types of closure for unions and intersections}
\begin{lemma} \label{unionsIntersectionClosureImplications}
Let $\mathcal{F}$ be a family of sets. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=tiny]
&& \text{countable disjoint $\uplus$} \\
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[ur, Rightarrow] \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable monotone $\cup$} \\
&& \text{finite $\cup$}
\end{tikzcd} \]
and for closure under intersections:
\[ \begin{tikzcd}[row sep=0em]
&& \text{countable monotone $\cap$} \\
\text{arbitrary $\cap$} \arrow[r, Rightarrow] & \text{countable $\cap$} \arrow[ur, Rightarrow] \arrow[dr, Rightarrow] &  \\
&& \text{finite $\cap$}
\end{tikzcd} \]
\end{lemma}


The implications in \ref{unionsIntersectionClosureImplications} for unions can be simplified, if $\mathcal{F}$ is closed under relative complementation:
\begin{lemma} \label{typesOfUnionsRelativeComplementation}
Let $\mathcal{F}$ be a family of sets that is closed under relative complementation. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=0em]
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable disjoint $\uplus$} \arrow[r, Rightarrow] & \text{countable monotone $\cup$} \\
&& \text{finite $\cup$} &
\end{tikzcd} \]
\end{lemma}
\begin{proof}
We need to prove that closure under countable disjoint unions implies closure under countable monotone unions.

Assume $\mathcal{F}$ closed under countable disjoint unions. Let $\{A_i\}_{i\in \N}$ be a monotonically increasing family of sets. Then we can recursively define a family $\{D_i\}_{i\in \N}$ by $D_0=\emptyset$ and
\[ D_{i+1} = A_{i+1}\setminus D_i. \]
This is allowed because $A_{i+1}\supset A_i \supset D_i$. By induction we see that $\{D_i\}_{i\in \N}$ is a disjoint family and has the same union as $\{A_i\}_{i\in \N}$.
\end{proof}

These implications can be further simplified, if $\mathcal{F}$ is closed under set differences:
\begin{lemma}
Let $\mathcal{F}$ be a family of sets that is closed under set differences. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=0em]
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[r, Leftrightarrow] & \text{countable disjoint $\uplus$} \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable monotone $\cup$} \\
&&& \text{finite $\cup$}
\end{tikzcd} \]
\end{lemma}
\begin{proof}
We just need to prove that closure under countable disjoint unions implies closure under countable unions.

This can be done with the same construction of $\{D_i\}_{i\in \N}$ as before because now the assignment $D_{i+1} = A_{i+1}\setminus D_i$ works for arbitrary families $\{A_i\}_{i\in \N}$, not just monotone ones.
\end{proof}

\subsubsection{Countable unions and intersections: Summe $\sigma$ and Durchsnitt $\delta$}
TODO move?

\begin{definition}
Let $\Omega$ be a set and $\mathcal{F}\subseteq \powerset(\Omega)$ a family of subsets. Then
\begin{itemize}
\item $\mathcal{F}_\sigma$ is the closure of $\mathcal{F}$ under countable unions;
\item $\mathcal{F}_\delta$ is the closure of $\mathcal{F}$ under countable intersections.
\end{itemize}
\end{definition}

TODO Borel hierarchy and Descriptive set theory.

\subsection{Monotone classes}
\begin{definition}
A family of sets $\mathcal{F}$ is called a \udef{monotone class} if it is closed under both countable monotone unions and countable monotone intersections.
\end{definition}

\subsubsection{Dynkin systems}
\begin{definition}
A \udef{Dynkin system} of sets (also known as a \udef{$\lambda$-system} or \udef{d-system}) is a pair of a set $\Omega$ and a collection of sets $D\subset\powerset(\Omega)$ such that
\begin{itemize}
\item $\Omega\in D$;
\item if $A\in D$, then $A^c\in D$;
\item if $(A_i)_{i\in\N}$ is a countable sequence of pairwise disjoint sets in $D$, then $\biguplus_{i=1}^\infty A_i\in D$.
\end{itemize}
\end{definition}

\begin{lemma}
A pair of a set $\Omega$ and a family of subsets $D$ is a Dynkin system \textup{if and only if}
\begin{itemize}
\item $\Omega\in D$;
\item $D$ is closed under relative complements: if $A,B\in D$ and $A\supset B$, then $A\setminus B\in D$;
\item $D$ is closed under countable monotone unions.
\end{itemize}
\end{lemma}
\begin{proof}
Call the original set of axioms Ax1 and this set of axioms Ax2.

$\boxed{\text{Ax1}\implies\text{Ax2}}$ Point (2) follows from \ref{complementTypesUnionClosure} and point (3) follows from \ref{typesOfUnionsRelativeComplementation}.

$\boxed{\text{Ax2}\implies\text{Ax1}}$ Point (2) follows immediately. For point (3): let $A,B$ be disjoint sets. Then $A^c \supset B$ and so $A\cup B = (A^c\setminus B)^c \in D$, meaning $D$ is closed under finite unions of disjoint sets. Now let $(A_i)_{i\in\N}$ be a countable sequence of pairwise disjoint sets. Then
\[ \biguplus_{i=1}^\infty A_i = \bigcup_{i=1}^\infty \left(\biguplus_{j=1}^i A_j\right) \]
which is a countable monotone union.
\end{proof}

\begin{lemma}
A Dynkin system is a monotone class.
\end{lemma}
\begin{proof}
If $\bigcap_{i=1}^\infty A_i$ is a countable monotone intersection, then $\left(\bigcap_{i=1}^\infty A_i\right)^c = \bigcup_{i=1}^\infty A_i^c$ is a countable monotone union.
\end{proof}

\subsection{$\pi$-systems}
TODO: directed set!
\begin{definition}
A \udef{$\pi$-system} is a collection of sets $P$ such that
\begin{itemize}
\item $P$ is not empty;
\item if $A,B\in P$, then $A\cap B\in P$.
\end{itemize}
\end{definition}

TODO $\{\cap\}$-subalgebra of $\powerset(U)$.

\begin{lemma}
Let $\mathcal{F}$ be a collection of sets. If $\mathcal{F}$ is closed under set differences, then it is a $\pi$-system.
\end{lemma}
\begin{proof}
By \ref{closureSetDifference}.
\end{proof}

For $\pi$-systems the intersection implications in \ref{unionsIntersectionClosureImplications} reduce to:
\begin{lemma} \label{piSystemunionsIntersectionClosureImplications}
Let $\mathcal{F}$ be a $\pi$-system. Then we have the following implications for closure under intersections:
\[ \text{arbitrary $\cap$} \quad\implies\quad \text{countable $\cap$} \quad\iff\quad \text{countable monotone $\cap$} \]
\end{lemma}
\begin{proof}
We need to prove that closure under countable monotone intersections implies closure under countable intersections.

Assume $\mathcal{F}$ is a $\pi$-system closed under countable monotone intersections. Let $\{A_i\}_{i\in \N}$ be an indexed family of sets. Then we can define the family $\{B_i\}_{i\in \N}$ recursively by $B_1 = A_1$ and
\[ B_{i+1} = B_i \cap A_{i+1}. \]
By induction we see that $\{B_i\}_{i\in \N}$ is monotone and has the same intersection as $\{A_i\}_{i\in \N}$.
\end{proof}

\subsubsection{Intersections structures}
\begin{definition}
Let $\mathcal{F} \subseteq \powerset(U)$ be a family of sets. We call $\mathcal{F}$ an \udef{intersection structure} if it is closed under arbitrary intersections.

If an intersection structure contains the universe set, it is called a \udef{topped intersection structure} or \udef{closure system}.
\end{definition}

TODO $\{\cap_{\omega}\}$-subalgebra of $\powerset(U)$.

\subsubsection{Rings}
\begin{definition}
Let $U$ be a set. Then
\begin{itemize}
\item an \udef{order-theoretic ring} on $U$ is a $\{\cup,\cap\}$-subalgebra of $\powerset(U)$;
\item a \udef{measure-theoretic ring} on $U$ is a $\{\cap,\setminus\}$-subalgebra of $\powerset(U)$;
\item a \udef{$\sigma$-ring} in $U$ is a $\{\cap, \cup_\omega,\setminus\}$-subalgebra of $\powerset(U)$;
\item a \udef{$\delta$-ring} in $U$ is a $\{\cap_\omega,\setminus\}$-subalgebra of $\powerset(U)$.
\end{itemize}
\end{definition}

\paragraph{Order-theoretic ring}
TODO: sublattice!
\begin{definition}
An \udef{order-theoretic ring} of sets is a non-empty collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{R}$, then $A\cup B\in \mathcal{R}$;
\item if $A,B\in \mathcal{R}$, then $A\cap B\in \mathcal{R}$.
\end{itemize}
\end{definition}

\paragraph{Semi-rings}
\begin{definition}
A \udef{semi-ring} is a non-empty collection of sets $\mathcal{S}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{S}$, then $A\cap B\in \mathcal{S}$;
\item if $A,B\in \mathcal{S}$, then $A\setminus B$ is a finite disjoint union of sets in $\mathcal{S}$.
\end{itemize}
\end{definition}

\begin{lemma} \label{emptysetElementSemiring}
Let $\mathcal{S}$ be a semi-ring. Then $\emptyset \in \mathcal{S}$.
\end{lemma}
\begin{proof}
Because $\mathcal{S}$ is non-empty, we can take $A\in \mathcal{S}$. Then $A\setminus A = \emptyset$ is a finite disjoint union of sets in $\mathcal{S}$, so $\emptyset \in \mathcal{S}$.
\end{proof}

\begin{proposition} \label{productSemiring}
Let $\mathcal{R}$ and $\mathcal{S}$ be semi-rings. Then
\[ \setbuilder{A\times B}{A\in\mathcal{R}, B\in\mathcal{S}} \]
is a semi-ring.
\end{proposition}
\begin{proof}
Closure under intersection follows from
\[ (A_1\times B_1) \cap (A_2\times B_2) = (A_1\cap A_2)\times(B_1\cap B_2). \]
We also have
\[ (A_1\times B_1) \setminus (A_2\times B_2) = \big((A_1\setminus A_2)\times(B_1\setminus B_2)\big) \uplus \big((A_1\setminus A_2)\times(B_1\cap B_2)\big) \uplus \big((A_1\cap A_2)\times(B_1\setminus B_2)\big), \]
which verifies the other requirement.
\end{proof}

\paragraph{Measure-theoretic rings}
\begin{definition}
A \udef{(measure-theoretic) ring} of sets is a non-empty collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{R}$, then $A\cup B\in \mathcal{R}$;
\item if $A,B\in \mathcal{R}$, then $A\setminus B\in \mathcal{R}$.
\end{itemize}
\end{definition}
By \ref{closureSetDifference} a measure-theoretic ring is in particular a $\pi$-system and an order-theoretic ring.

\begin{lemma}
A non-empty collection of sets $\mathcal{R}$ is a measure-theoretic ring \textup{if and only if}
\begin{itemize}
\item it is closed under finite intersections;
\item it is closed under symmetric differences.
\end{itemize}
\end{lemma}
\begin{proof}
By the identities $A\cup B = (A\symdiff B)\symdiff (A\cap B)$ and $A\setminus B = A\symdiff (A\cap B)$.
\end{proof}

\begin{lemma} \label{ringFromSemiRing}
Let $\mathcal{S}$ be a semi-ring. Then the smallest ring $\mathcal{R}$ containing $\mathcal{S}$ is
\[ \mathfrak{R}\{\mathcal{S}\} = \setbuilder{E_1\uplus\ldots\uplus E_n}{\text{$E_i\in \mathcal{S}$ are pairwise disjoint}}. \]
We call this the ring \udef{generated} by $\mathcal{S}$.
\end{lemma}
\begin{proof}
Every ring containing $\mathcal{S}$ must contain $\mathfrak{R}\{\mathcal{S}\}$, so if it is a ring it is automatically the smallest. We just need to show it is a ring. Let $E,F$ be arbitrary elements of $\mathfrak{R}\{\mathcal{S}\}$. We need to show that both $E\setminus F$ and $E\cup F$ are in $\mathfrak{R}\{\mathcal{S}\}$.

Now $E\cup F = (E\setminus F) \uplus F$ can be written as a disjoint union, so we just need to write $E\setminus F$ as a pairwise disjoint union of elements of $\mathcal{S}$. To that end write $E = \biguplus_{i=0}^nE_i$ and $\biguplus_{j= 0}^mF_j$. Then
\[ E\setminus F = \biguplus_{i=0}^n \left[ \Big(\big((E_j\setminus F_1)\setminus F_2\big)\setminus \ldots\Big)\setminus F_m \right]. \]
By induction and using the semi-ring property we can see that this is expressible as a finite pairwise disjoint union of elements of $\mathcal{S}$, and thus is an element of $\mathfrak{R}\{\mathcal{S}\}$.
\end{proof}

\paragraph{$\sigma$- and $\delta$-rings}
\begin{definition}
A \udef{$\sigma$-ring} of sets is a collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item $\mathcal{R}$ is a measure-theoretic ring;
\item $\mathcal{R}$ is closed under countable unions.
\end{itemize}
A \udef{$\delta$-ring} of sets is a collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item $\mathcal{R}$ is a measure-theoretic ring;
\item $\mathcal{R}$ is closed under countable intersections.
\end{itemize}
\end{definition}

\subsubsection{Algebras of sets}
\begin{definition}
An \udef{algebra of sets} on a set $\Omega$ (also known as a \udef{field of sets}) is a ring that contains $\Omega$.
\end{definition}

In principle we can thus define
\begin{itemize}
\item order-theoretic algebra;
\item semi-algebra;
\item measure-theoretic algebra;
\item $\sigma$-algebra;
\item $\delta$-algebra.
\end{itemize}

Some of these notions coincide.

\begin{lemma} \label{setAlgebraCoincidence}
Let $\mathcal{A}$ be a family of sets. Then
\begin{enumerate}
\item $\mathcal{A}$ is an order-theoretic algebra \textup{if and only if} it is a measure-theoretic algebra;
\item $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} it is a $\delta$-algebra.
\end{enumerate}
\end{lemma}

So we define define \udef{semi-algebra}, \udef{algebra} and \udef{$\sigma$-algebra}.

\begin{lemma} \label{setAlgebraCriteria}
A family of sets $\mathcal{A}$ is a semi-algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A,B\in \mathcal{A}$, then $A\cap B\in \mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c$ is a finite disjoint union of sets in $\mathcal{A}$.
\end{itemize}
A family of sets $\mathcal{A}$ is an algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c\in \mathcal{A}$;
\item if $A,B\in \mathcal{A}$, then $A\cup B\in \mathcal{A}$.
\end{itemize}
A family of sets $\mathcal{A}$ is a $\sigma$-algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c\in \mathcal{A}$;
\item if $(A_i)_{i\in\N}$ is a countable sequence of sets in $\mathcal{A}$, then $\bigcup_{i=1}^\infty A_i\in \mathcal{A}$.
\end{itemize}
\end{lemma}

\begin{example}
Let $\Omega$ be a set.
\begin{itemize}
    \item The power set $\powerset(\Omega)$ is a $\sigma$-algebra on $\Omega$.
    \item The set of finite and cofinite subsets of $\Omega$ is an algebra.
    \item The set of countable and cocountable subsets of $\Omega$ is a $\sigma$-algebra.
\end{itemize}
\end{example}

\begin{lemma} \label{algebraFromSemiAlgebra}
The ring generated by a semi-algebra is an algebra. Thus for a semi-algebra, the following closures coincide:
\begin{enumerate}
\item closure under finite disjoint union;
\item closure in the lattice of algebras;
\item closure in the lattice of rings.
\end{enumerate}
\end{lemma}
\begin{proof}
The ring generated by a semi-ring containing $\Omega$, still contains $\Omega$ and thus is an algebra.

See \ref{ringFromSemiRing} for the coincidence of (1) and (3).

By definition we must have $(3) \subseteq (2)$. By the first statement we have $(2) \subseteq (3)$.
\end{proof}

\begin{lemma} \label{algebraMonotoneClass}
An algebra $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} $\mathcal{A}$ is a monotone class.
\end{lemma}
\begin{lemma} \label{DynkinPiSystem}
A Dynkin system is a $\sigma$-algebra \textup{if and only if} it is a $\pi$-system.
\end{lemma}


\begin{lemma}
\begin{enumerate}
\item The countable monotone union of a sequence of $\sigma$-algebras is an algebra, but not necessarily a $\sigma$-algebra.
\item Any arbitrary intersection of $\sigma$-algebras is a $\sigma$-algebra.
\end{enumerate}
\end{lemma}

\begin{lemma}
Let $\mathcal{A}$ be a $\sigma$-algebra on $\Omega$ and $B\subset \Omega$. Then $B\cap \mathcal{A} = \setbuilder{B\cap A}{A\in\mathcal{A}}$ is a $\sigma$-algebra on $B$.
\end{lemma}

\subsection{Generators}
TODO: $\boldsymbol{T}$-generators, denoted $\boldsymbol{T}\{\mathcal{F}\}$.
\begin{definition}
Let $\mathcal{F}$ be a family of subsets of $\Omega$. Then we define
\begin{itemize}
\item the $\sigma$-algebra generated by $\mathcal{F}$, $\sigma\{\mathcal{F}\}$;
\item the monotone class generated by $\mathcal{F}$, $\mathfrak{M}\{\mathcal{F}\}$; and
\item the Dynkin system generated by $\mathcal{F}$, $\mathfrak{D}\{\mathcal{F}\}$;
\end{itemize}
the intersection of all such families $\subseteq \powerset(\Omega)$ that contain $\mathcal{F}$.

In each case we call $\mathcal{F}$ the \udef{generator} of the system.
\end{definition}
These intersections are again $\sigma$-algebras, monotone classes and Dynkin systems, respectively. So these generated families are the smallest such families containing $\mathcal{F}$.

\begin{example}
\begin{itemize}
\item If $\mathcal{A}$ is a $\sigma$-algebra, then $\sigma\{\mathcal{A}\} = \mathcal{A}$.
\item If $\mathcal{A} = \{A\}$, a single set, then $\sigma\{\mathcal{A}\} = \{\emptyset, A,A^c,\Omega\}$.
\end{itemize}
\end{example}

\begin{lemma} \label{unitGeneratedSets}
A universe set for $\mathcal{F}$ is also a universe set for $\sigma\{\mathcal{F}\}$, $\mathfrak{M}\{\mathcal{F}\}$ and $\mathfrak{D}\{\mathcal{F}\}$.
\end{lemma}

\begin{proposition}[Monotone class theorem] \label{monotoneClassTheorem}
Let $\mathcal{A}$ be an algebra. Then
\[ \mathfrak{M}\{\mathcal{A}\} = \sigma\{\mathcal{A}\}. \]
\end{proposition}
\begin{proof}
Every $\sigma$-algebra is a monotone class, so $\mathfrak{M}\{\mathcal{A}\} \subset \sigma\{\mathcal{A}\}$.

For the other inclusion it is enough to show that $\mathfrak{M}\{\mathcal{A}\}$ is an algebra: using \ref{algebraMonotoneClass} we have
\[ \text{$\mathfrak{M}\{\mathcal{A}\}$ is an algebra} \implies \text{$\mathfrak{M}\{\mathcal{A}\}$ is a $\sigma$-algebra} \implies \sigma\{\mathcal{A}\}\subset\mathfrak{M}\{\mathcal{A}\}. \]
In particular, due to \ref{setAlgebraCriteria}, we verify $\Omega\in \mathfrak{M}\{\mathcal{A}\}$, $B^c \in \mathfrak{M}\{\mathcal{A}\}$ and $B\cup C \in \mathfrak{M}\{\mathcal{A}\}$.

$\boxed{\Omega\in \mathfrak{M}\{\mathcal{A}\}}$ By \ref{unitGeneratedSets}.

$\boxed{B^c \in \mathfrak{M}\{\mathcal{A}\}}$ Define
\[ \mathcal{E}_1 = \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{B^c\in\mathfrak{M}\{\mathcal{A}\}} \]
which is a monotone class by De Morgan's laws:
\[ (B_i)_{i=1}^\infty\subset \mathcal{E}_1 \implies (B_i^c)_{i=1}^\infty\subset \mathfrak{M}\{\mathcal{A}\} \implies \bigcup_{i=1}^\infty B_i^c = \left(\bigcap_{i=1}^\infty B_i\right)^c \in\mathfrak{M}\{\mathcal{A}\} \implies \bigcap_{i=1}^\infty B_i \in \mathcal{E}_1. \]
Also $\mathcal{E}_1\subset \mathfrak{M}\{\mathcal{A}\}$, so $\mathcal{E}_1 = \mathfrak{M}\{\mathcal{A}\}$ by minimality, so
\[ B\in\mathfrak{M}\{\mathcal{A}\} \iff B\in\mathcal{E}_1 \implies B^c\in\mathfrak{M}\{\mathcal{A}\}. \]

$\boxed{B\cup C \in \mathfrak{M}\{\mathcal{A}\}}$ Define
\begin{align*}
\mathcal{E}_2 &= \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{\forall C\in\mathcal{A}: B\cup C \in\mathfrak{M}\{\mathcal{A}\}} \\
\mathcal{E}_3 &= \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{\forall C\in\mathfrak{M}\{\mathcal{A}\}: B\cup C \in\mathfrak{M}\{\mathcal{A}\}}.
\end{align*}
Now $\mathcal{E}_2$ and $\mathcal{E}_3$ are monotone classes: by \ref{setAssociativityCommutativity} and \ref{setDistributivity}, for $k=1,2$
\[ (B_i)_{i=1}^\infty\subset \mathcal{E}_k \implies \forall C: (B_i\cup C)_{i=1}^\infty\subset \mathfrak{M}\{\mathcal{A}\} \implies \forall C: \bigcup_{i=1}^\infty B_i\cup C = \left(\bigcup_{i=1}^\infty B_i\right)\cup C \in\mathfrak{M}\{\mathcal{A}\} \implies \bigcup_{i=1}^\infty B_i \in \mathcal{E}_k. \]
Now clearly $\mathcal{A}\subseteq\mathcal{E}_2$, so by minimality $\mathcal{E}_2 = \mathfrak{M}\{\mathcal{A}\}$. Moreover,
\[ D\in\mathcal{A}\implies \forall C\in \mathcal{E}_2: C\cup D\in \mathfrak{M}\{\mathcal{A}\} \implies \forall C\in \mathfrak{M}\{\mathcal{A}\}: D\cup C\in \mathfrak{M}\{\mathcal{A}\} \implies D\in \mathcal{E}_3. \]
So $\mathcal{A}\subseteq\mathcal{E}_3$ and by minimality $\mathcal{E}_3 = \mathfrak{M}\{\mathcal{A}\}$, which means that
\[ B\in\mathfrak{M}\{\mathcal{A}\} \iff B\in\mathcal{E}_3 \implies \forall C\in\mathfrak{M}\{\mathcal{A}\}: B\cup C\in\mathfrak{M}\{\mathcal{A}\}. \]
\end{proof}
\begin{corollary}
Let $\mathcal{A}$ be an algebra and $M$ a monotone class with $\mathcal{A}\subseteq M$, then $\sigma\{\mathcal{A}\}\subseteq M$.
\end{corollary}

\begin{proposition} \label{generatedDynkinSigma}
If $\mathcal{F}$ is a $\pi$-system on $\Omega$, then
\[ \mathfrak{D}\{\mathcal{F}\} = \sigma\{\mathcal{F}\}. \]
In particular a Dynkin system is a $\sigma$-algebra \textup{if and only if} it is closed under finite intersections.
\end{proposition}
\begin{proof}
Every $\sigma$-algebra is a Dynkin system, so $\mathfrak{D}\{\mathcal{F}\} \subset \sigma\{\mathcal{F}\}$.

For the other inclusion it is enough to show that $\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system: using \ref{DynkinPiSystem}, we have
\[ \text{$\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system} \implies \text{$\mathfrak{D}\{\mathcal{F}\}$ is a $\sigma$-algebra} \implies \sigma\{\mathcal{F}\}\subset\mathfrak{D}\{\mathcal{F}\}. \]

To this end we define
\[ \mathcal{D}_B = \setbuilder{A\subset\Omega}{A\cap B\in\mathfrak{D}\{\mathcal{F}\}} \qquad \text{for some $B\in\mathfrak{D}\{\mathcal{F}\}$,} \]
which we claim is a Dynkin system.
\begin{itemize}[leftmargin=2.5cm]
\item[$\boxed{\Omega\in\mathcal{D}_B}$] Because $\Omega\cap B = B$.
\item[$\boxed{A^c\in\mathcal{D}_B}$] Let $A\in\mathcal{D}_B$. Then
\[ A^c\cap B = (\Omega\setminus A)\cap B = (\Omega\cap B)\setminus(A\cap B) \in \mathfrak{D}\{\mathcal{F}\}, \]
so $A^c\in\mathcal{D}_B$.
\item[$\boxed{\biguplus_{i\in \N}A_i \in \mathcal{D}_B}$] Let $(A_i)_{i=1}^\infty$ be a disjoint family of sets in $\mathcal{D}_B$. Then, using \ref{setDistributivity},
\[ \left(\bigcup_{i=1}^\infty A_i\right)\cap B = \bigcup_{i=1}^\infty (A_i\cap B) \in \mathfrak{D}\{\mathcal{F}\}, \]
so $\bigcup_{i=1}^\infty A_i\in\mathcal{D}_B$.
\end{itemize}
Now because $\mathcal{F}$ is a $\pi$-system, we have $\mathcal{F}\subset\mathcal{D}_B$ and thus $\mathcal{D}_B\subset\mathfrak{D}\{\mathcal{F}\}$.

Now for all $B\in\mathcal{F}$, we have
\[ A\in\mathcal{F}\implies A\cap B\in\mathcal{F}\implies A\cap B\in\mathfrak{D}\{\mathcal{F}\} \implies A\in \mathcal{D}_B. \]
So $\mathcal{F}\subset \mathcal{D}_B$ if $B\in\mathcal{F}$. In this case we then also have $\mathfrak{D}\{\mathcal{F}\}\subset \mathcal{D}_B$.

In fact this holds for all $B\in\mathfrak{D}\{\mathcal{F}\}$:
\[ B\in\mathfrak{D}\{\mathcal{F}\} \implies \forall A\in\mathcal{F}: B\in\mathcal{D}_A \implies  \forall A\in\mathcal{F}: B\cap A \in \mathfrak{D}\{\mathcal{F}\} \implies \mathcal{F}\subset\mathcal{D}_B \implies \mathfrak{D}\{\mathcal{F}\}\subset \mathcal{D}_B. \]
Consequently,
\[ B,C\in\mathfrak{D}\{\mathcal{F}\} \implies C\in\mathcal{D}_B \implies C\cap B\in\mathfrak{D}\{\mathcal{F}\}, \]
meaning $\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system.
\end{proof}
\begin{corollary}[$\pi$-$\lambda$ theorem] \label{piLambdaTheorem}
Let $P$ be a $\pi$-system and $D$ a Dynkin system with $P\subseteq D$, then $\sigma\{P\} \subseteq D$.
\end{corollary}
\begin{corollary}
If $\mathcal{A}$ is an algebra, then $\mathfrak{M}\{\mathcal{A}\} = \mathfrak{D}\{\mathcal{A}\} = \sigma\{\mathcal{A}\}$.
\end{corollary}
\begin{corollary} \label{conditionAlgebraIsSigmaAlgebra}
If $\mathcal{A}$ is an algebra, then $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} it is closed under either countable monotone unions or countable disjoint unions.
\end{corollary}
\begin{proof}
Either of these conditions makes $\mathcal{A}$ a Dynkin system. The result follows from the previous corollary.
\end{proof}

\subsubsection{Product structures}
\subsubsection{Finite products}
\begin{definition}
Let $X,Y$ be sets, $\mathcal{A}\subseteq \powerset(X), \mathcal{B}\subseteq\powerset(Y)$ and $\boldsymbol{T}$ the signature of a set-theoretical algebra. Then the \udef{product $\boldsymbol{T}$-algebra} of $\mathcal{A}$ and $\mathcal{B}$ is
\[ \mathcal{A}\otimes\mathcal{B} \defeq \boldsymbol{T}\setbuilder{A\times B}{A\in \mathcal{A}, B\in \mathcal{B}}. \]
\end{definition}
Notice that in general for $\boldsymbol{T}$-algebras $\mathcal{A},\mathcal{B}$, the set $\setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$ is not a $\boldsymbol{T}$-algebra. It is necessary to take the closure.

\begin{example}
Take $\Omega = \{a,b,c\}$. Define the $\sigma$-algebras $\mathcal{A},\mathcal{B}$ on $\Omega$ by
\begin{align*}
\mathcal{A} &= \{\emptyset, \{a\}, \{b,c\}, \Omega\} \\
\mathcal{B} &= \{\emptyset, \{a, b\}, \{c\}, \Omega\}.
\end{align*}
Then $\{a\}\times\{a,b\} \in \setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$, but
\[ (\{a\}\times\{a,b\})^c = \Big(\{b,c\}\times \{a,b,c\}\Big) \cup \Big(\{a, b ,c\}\times\{c\}\Big) \]
is not in $\setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$, so it is not a $\sigma$-algebra.
\end{example}

\begin{lemma}
Let $X,Y$ be sets and $A\subseteq X, B\subseteq Y$ subsets. Then
\[ (A\times B)^c = A^c\times B \uplus A\times B^c \uplus A^c\times B^c = A^c\times Y \cup X\times B^c. \]
\end{lemma}
\begin{proof}
We have $X\times Y = (A\uplus A^c)\times (B\uplus B^c)$ and the lemma follows by \ref{productUnionIntersection}.
\end{proof}

\subsubsection{Infinite products}
\begin{definition}
Let $I$ be an index set, $\{X_i\}_{i\in I}$ a set of sets and $\{\mathcal{A}_i\}_{i\in I}$ a set of $\boldsymbol{T}$-algebras such that for all $i\in I$, $\mathcal{A}_i$ is a $\boldsymbol{T}$-algebra on $X_i$. We define the \udef{product $\boldsymbol{T}$-algebra} $\bigotimes_{i\in I}\mathcal{A}_i$ on $\prod_{i\in I}X_i$ as
\[ \bigotimes_{i\in I}\mathcal{A}_i \defeq \boldsymbol{T}\setbuilder{\prod_{i\in I}A_i}{\forall i\in I: A_i\in\mathcal{A}_i\; \text{and}\; \setbuilder{i\in I}{A_i\neq X_i}\;\text{is finite}}. \]
\end{definition}

\begin{proposition}
We may replace ``is finite'' with ``is countable'' in the definition.
\end{proposition}
\begin{proof}
TODO (can we??)
\end{proof}

\section{Contours of functions $X\to \powerset^2(Y)$}
\begin{definition}
Let $X,Y$ be sets and $f: X\to \powerset^2(Y)$ a function. Then the \udef{contour} of $f$ along $A\in \powerset(X)$ is defined as
\[ f(A) \defeq \bigcap_{a\in A} f(a) \]
and the \udef{contour} of $f$ along $\mathcal{A}\in\powerset^2(X)$ is defined as
\[ f(\mathcal{A}) \defeq \bigcup_{A\in\mathcal{A}}\bigcap_{a\in A} f(a). \]
\end{definition}

\begin{lemma} \label{inclusionPreservantionOfContours}
Let $X,Y$ be sets, $f,g: X\to \powerset^2(Y)$ functions, $A,B\in\powerset(X)$ and $\mathcal{A}, \mathcal{B}\in\powerset^2(X)$. Then
\begin{enumerate}
\item if $f \subseteq g$ pointwise, then $f(A) \subseteq g(A)$;
\item if $A \subseteq B$, then $f(A) \supseteq f(B)$.
\end{enumerate}
Also
\begin{enumerate} \setcounter{enumi}{2}
\item if $f \subseteq g$ pointwise, then $f(\mathcal{A}) \subseteq g(\mathcal{A})$;
\item if $\mathcal{A} \subseteq \mathcal{B}$, then $f(\mathcal{A}) \subseteq f(\mathcal{B})$;
\item if $f \subseteq g$ pointwise and $\mathcal{A} \subseteq \mathcal{B}$, then $f(\mathcal{A}) \subseteq g(\mathcal{B})$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take arbitrary $a\in A$. Then $f(a) \subseteq g(a)$, so $\upset\setbuilder{f(a)}{a\in A} \supseteq \upset\setbuilder{g(a)}{a\in A}$ and thus
\[ f(A) = \bigcap\setbuilder{f(a)}{a\in A} = \bigcap\upset\setbuilder{f(a)}{a\in A} \subseteq \bigcap\upset\setbuilder{g(a)}{a\in A} = g(A). \]

(2) We have $\setbuilder{f(a)}{a\in A} \subseteq \setbuilder{f(b)}{b\in B}$, so
\[ f(A) = \bigcap\setbuilder{f(a)}{a\in A} \supseteq \bigcap\setbuilder{f(b)}{b\in B} = f(B). \]

(3) Take arbitrary $C\in \mathcal{A}$. Then $f(C) \subseteq g(C)$ from (1), so $\downset\setbuilder{f(C)}{C\in \mathcal{A}} \subseteq \downset\setbuilder{g(C)}{C\in \mathcal{A}}$ and thus
\[ f(\mathcal{A}) = \bigcup\setbuilder{f(C)}{C\in \mathcal{A}} = \bigcup\downset\setbuilder{f(C)}{C\in \mathcal{A}} \subseteq \bigcup\downset\setbuilder{g(C)}{C\in \mathcal{A}} = g(\mathcal{A}). \]

(4) We have $\setbuilder{f(C)}{C\in \mathcal{A}} \subseteq \setbuilder{f(D)}{D\in \mathcal{B}}$, so
\[ f(\mathcal{A}) = \bigcup\setbuilder{f(C)}{C\in \mathcal{A}} \subseteq \bigcup\setbuilder{f(D)}{D\in \mathcal{B}} = f(\mathcal{B}). \]

(5) Immediate consequence of (3) and (4).
\end{proof}

\begin{lemma}
Let $X,Y$ be sets, $f: X\to \powerset^2(Y)$ a function, $x\in X$, $A\subseteq X$ and $\mathcal{A}\in\powerset^2(X)$. Then
\begin{enumerate}
\item $f(\mathcal{A}) = f(\upset\mathcal{A})$;
\item $f(A) = f(\{A\}) = f(\upset\{A\})$;
\item $f(x) = f(\{x\}) = f\big(\big\{\{x\}\big\}\big) = f(\pfilter{x})$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take arbitrary $B\in \upset \mathcal{A}$. Then there exists $C\in \mathcal{A}$ such that $C\subseteq B$. From \ref{inclusionPreservantionOfContours}, we have $f(B) \subseteq f(C)$. This implies
\[ \downset \setbuilder{f(B)}{B\in \upset \mathcal{A}} \subseteq \downset \setbuilder{f(C)}{C\in \mathcal{A}} \subseteq \downset \setbuilder{f(B)}{B\in \upset \mathcal{A}}, \]
so $\downset \setbuilder{f(C)}{C\in \mathcal{A}} = \downset \setbuilder{f(B)}{B\in \upset \mathcal{A}}$ and thus
\[ f(\mathcal{A}) = \bigcup\setbuilder{f(C)}{C\in \mathcal{A}} = \bigcup\downset\setbuilder{f(C)}{C\in \mathcal{A}} = \bigcup\downset\setbuilder{f(B)}{B\in \upset\mathcal{A}} = f(\upset\mathcal{A}). \]

(2) The first equality follows from $f(A) = \bigcap_{a\in A} f(a) = \bigcup_{A\in\{A\}}\bigcap_{a\in A} f(a)$ and the second from (1).

(3)The first equality follows from $f(\{x\}) = \bigcap_{a\in \{x\}}f(a) = f(x)$, the second from (2) and the third from (1).
\end{proof}

\begin{lemma} \label{setContourUnionIntersection}
Let $X,Y$ be sets, $f: X\to \powerset^2(Y)$ a function, $A,B \subseteq X$ and $\{A_i\}_{i\in I} \subseteq \powerset(X)$. Then
\begin{enumerate}
\item $f(A \cup B) = f(A) \cup f(B)$;
\item $f\big(\bigcap_{i\in I}A_i\big) = \bigcap_{i\in I}f(A_i)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) From \ref{setDistributivity}.

(2) From \ref{unionIntersectionLabelSet}.
\end{proof}

\begin{proposition} \label{contourOfUpsetsAndFilters}
Let $X,Y$ be sets, $f: X\to \powerset^2(Y)$ a function, $A\subseteq X$ and $\mathcal{A} \in \powerset^2(X)$. Then
\begin{enumerate}
\item if $\im(f) \subseteq \upsetset(\powerset(Y))$, then $f(\mathcal{A})$ is upwards closed;
\item if $\im(f) \subseteq \powerfilters(Y)$, then $f(A)$ is a filter;
\item if $\im(f) \subseteq \powerfilters(Y)$ and $\mathcal{A}$ is a filter, then $f(\mathcal{A})$ is a filter.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) From \ref{completeLatticeUpDownSets}, we know that unions and intersections of upwards closed sets are upwards closed.

(2) From \ref{latticeFiltersIdeals}, we know that intersections of filters are filters.

(3) From (1) and (2), it is enough to show that $\bigcup_{A\in \mathcal{A}}f(A)$ is closed under finite intersections. Take $B_1,B_2 \in \bigcup_{A\in \mathcal{A}}f(A)$. Then there exist $A_1,A_2 \in \mathcal{A}$ such that $B_1 \in f(A_1)$ and $B_2\in f(A_2)$. Then, using \ref{inclusionPreservantionOfContours},
\[ \{B_1,B_2\} \subseteq f(A_1)\cup f(A_2) \subseteq f(A_1\cap A_2). \]
Since $f(A_1 \cap A_2)$ is a filter, using (2), we have $B_1\cap B_2 \in f(A_1\cap A_2) \subseteq \bigcup_{A\in \mathcal{A}}f(A)$, where we have used that $\mathcal{A}$ is closed under finite intersections.
\end{proof}

\begin{lemma} \label{contourOfGrill}
Let $X, Y$ be sets, $f: X\to \powerset^2(Y)$ a function and $\mathcal{A} \in \powerset^2(X)$. Then
\[ f\big(\mathcal{A}^\mesh\big) = \bigcap_{A\in \mathcal{A}}\bigcup_{a\in A}f(a). \]
\end{lemma}
\begin{proof}
We calculate, for arbitrary $C\subseteq Y$,
\begin{align*}
C \in \bigcap_{A\in \mathcal{A}}\bigcup_{a\in A}f(a) &\iff \forall A\in \mathcal{A}: \exists a\in A: \; C\in f(a) \\
&\iff \forall A\in \mathcal{A}: \; A \mesh \setbuilder{x\in X}{C\in f(x)} \\
&\iff \setbuilder{x\in X}{C\in f(x)} \in \mathcal{A}^\mesh \\
&\iff \exists B \in \mathcal{A}^\mesh: \; B = \setbuilder{x\in X}{C\in f(x)} \\
&\iff \exists B \in \mathcal{A}^\mesh: \; B \subseteq \setbuilder{x\in X}{C\in f(x)} \\
&\iff \exists B \in \mathcal{A}^\mesh: \forall x\in B: \; C\in f(x) \\
&\iff C \in \bigcup_{B \in \mathcal{A}^\mesh}\bigcap_{x\in B} f(x) = f\big(\mathcal{A}^\mesh\big).
\end{align*}
Here we have used the fact that $\mathcal{A}^\mesh$ is upwards closed, see \ref{grillUpwardsClosed}.
\end{proof}

\begin{proposition} \label{grillOfContour}
Let $X, Y$ be sets, $f: X\to \powerset^2(Y)$ a function and $\mathcal{A} \in \powerset^2(X)$. Define $f^\mesh \defeq (-)^\mesh\circ f$. Then $\big(f(\mathcal{A})\big)^\mesh = (f^\mesh)(\mathcal{A}^\mesh)$.
\end{proposition}
The function $f^\mesh$ is defined by taking the mesh pointwise, i.e.\ $f^\mesh(x) = \big(f(x)\big)^\mesh$ for all $x\in X$.
\begin{proof}
We calculate, using \ref{grillIntersectionUnion} and \ref{contourOfGrill},
\begin{align*}
\big(f(F)\big)^\mesh &= \Big(\bigcup_{A\in\mathcal{A}}\bigcap_{a\in A} f(a)\Big)^\mesh \\
&= \bigcap_{A\in\mathcal{A}}\bigcup_{a\in A} f^\mesh(a) \\
&= \bigcup_{A\in\mathcal{A}^\mesh}\bigcap_{a\in A} f^\mesh(a) \\
&= f^\mesh(\mathcal{A}^\mesh).
\end{align*}
\end{proof}
\begin{corollary}
Let $X,Y$ be sets, $f: X\to \powerset^2(Y)$ a function and $U \in \powerultrafilters(X)$. If $\im(f) \subseteq \powerultrafilters(Y)$, then $f(U)$ is an ultrafilter.
\end{corollary}
\begin{proof}
From \ref{contourOfUpsetsAndFilters}, we know that $f(U)$ is a filter. Using the proposition and \ref{ultrafilterCriteria}, we have $\big(f(U)\big)^\mesh = f^\mesh(U^\mesh) = f(U)$. Then \ref{ultrafilterCriteria} implies that $f(U)$ is an ultrafilter.
\end{proof}

\begin{proposition} \label{imageContour}
Let $X,Y$ be sets, $f: X\to \powerset^2(Y)$ a function, $g: Y\to Z$ a function and $\mathcal{A}\in \powerset^2(X)$. If $\im(f) \subseteq \upsetset(\powerset(Y))$, then
\[ \upset g^{\imf\imf}\big(f(\mathcal{A})\big) = \big(\upset g^{\imf\imf} \circ f\big)(\mathcal{A}). \]
\end{proposition}
\begin{proof}
We calculate
\begin{align*}
\upset g^{\imf\imf}\big(f(\mathcal{A})\big) &= \upset g^{\imf\imf}\Big(\bigcup_{A\in \mathcal{A}}\bigcap_{a\in A}f(a)\Big) \\
&= \bigcup_{A\in \mathcal{A}}\upset g^{\imf\imf}\Big(\bigcap_{a\in A}f(a)\Big) \\
&= \bigcup_{A\in \mathcal{A}}\bigcap_{a\in A}\upset g^{\imf\imf}\big(f(a)\big) \\
&= \big(\upset g^{\imf\imf} \circ f\big)(\mathcal{A}),
\end{align*}
where we have used \ref{functionImagePreimageGaloisConnection} (together with the fact that the upwards closure commutes with the union, see \ref{completeLatticeUpDownSets}) and \ref{imageUpsetsPreservesIntersection}.
\end{proof}



\subsection{Adherence and inherence}
\begin{definition}
Let $X, Y$ be sets, $f: X\to \upsetset(\powerset(Y))$ a function and $A\subseteq Y$. Then the \udef{adherence} of $A$ w.r.t.\ $f$ is the subset of $X$ defined by
\[ x\in \adh_f(A) \quad\defequiv\quad A\in f(x)^\mesh. \]
The \udef{inherence} of $A$ w.r.t.\ $f$ is the subset of $X$ defined by
\[ x\in \inh_f(A) \quad\defequiv\quad A\in f(x). \]
\end{definition}

\begin{proposition} \label{adherenceContourDuality}
Let $X, Y$ be sets, $f: X\to \upsetset(\powerset(Y))$ a function, $\mathcal{A} \in \upsetset(\powerset(X))$ and $\mathcal{B}\in \upsetset(\powerset(Y))$. Then
\[ f(\mathcal{A}) \amesh \mathcal{B} \quad\iff\quad \mathcal{A} \amesh \adh_f^\imf(\mathcal{B}). \]
\end{proposition}
\begin{proof}
We calculate
\begin{align*}
\mathcal{A} \amesh \adh_f^\imf(\mathcal{B}) &\iff \forall B\in \mathcal{B}: \forall A\in \mathcal{A}: \; A\mesh \adh_f(B) \\
&\iff \forall B\in \mathcal{B}: \forall A\in \mathcal{A}: \exists a\in A: \; a \in \adh_f(B) \\
&\iff \forall B\in \mathcal{B}: \forall A\in \mathcal{A}: \exists a\in A: \; B\in f(a)^\mesh \\
&\iff \forall B\in \mathcal{B}: \; B\in \bigcap_{A\in \mathcal{A}}\bigcup_{\exists a\in A} f^\mesh(a) \\
&\iff \forall B\in \mathcal{B}: \; B\in f^\mesh(\mathcal{A}^\mesh) \\
&\iff \forall B\in \mathcal{B}: \; B\in \big(f(\mathcal{A})\big)^\mesh \\
&\iff \mathcal{B} \subseteq \big(f(\mathcal{A})\big)^\mesh \\
&\iff f(\mathcal{A}) \amesh \mathcal{B},
\end{align*}
where we have used \ref{contourOfGrill} and \ref{grillOfContour}.
\end{proof}

\chapter{Successors and induction}
\section{The successor and predecessor functions}


\begin{definition}
Let $\sSet{X,\Yleft}$ be an ordered set. We define the \udef{successor function}
\[ S_X: X \to \powerset(X): x\mapsto \llmin\big(\upset\{x\}\setminus \downset\{x\}\big). \]
Similarly, we define the \udef{predecessor function}
\[ P_X: X\to \powerset(X): x\mapsto \llmax\big(\downset\{x\}\setminus \upset\{x\}\big). \]
Let $x\in X$. We call
\begin{itemize}
\item $x$ a \udef{successor point} if there exists an $y\in X$ such that $y\in S_X(y)$;
\item $x$ a \udef{predecessor point} if there exists an $y\in X$ such that $y\in P_X(y)$;
\item $x$ a \udef{(forwards) limit point} if it has no predecessor and is not an element of $\min(X)$;
\item $x$ a \udef{backwards limit point} if it has no successor and is not an element of $\max(X)$.
\end{itemize}
\end{definition}

If $\sSet{X,\Yleft}$ is an ordered set, we can always add a point on top of all the rest: We can take, e.g.\ the set
\[ t_X = \setbuilder{x\in X}{x\notin x}. \]
This is guaranteed, by proposition \ref{russellParadox}, not to be in $X$.
The poset $X\cup t_X$ is called the \udef{successor} $\operatorname{Succ}(X)$ of $X$.

\begin{proposition}
Let $\sSet{X,\Yleft}$ be an ordered set and $x,y\in X$. Then
\[ y \in S_X(x) \;\iff\; x\in P_X(y). \]
\end{proposition}
\begin{proof}
We calculate, using \ref{disjointSetDifference} and transitivity (for $\upset\{x\}\setminus \downset\{x\} = xR\setminus Rx$),
\begin{align*}
y \in S_X(x) &\iff y\in \llmin\big(\upset\{x\}\setminus \downset\{x\}\big) \\
&\iff y\in \llmin\big(xR\setminus Rx\big) \\
&\iff Ry \cap \big(xR\setminus Rx\big) \subseteq yR \\
&\iff \big(Ry\setminus yR\big) \perp \big(xR\setminus Rx\big) \\
&\iff xR \cap \big(Ry\setminus yR\big) \subseteq Rx \\
&\iff x\in \llmax\big(Ry\setminus yR\big) \\
&\iff x\in \llmax\big(\downset\{y\}\setminus \upset\{y\}\big) \\
&\iff x \in P_X(y).
\end{align*}
\end{proof}

\begin{lemma}
Let $\sSet{X,\Yleft}$ be an ordered set and $x\in X$. Then for all $y\in \sup\big(\downset\{x\}\setminus \upset\{x\}\big)$ we have either
\begin{itemize}
\item $y\in P_X(x)$; or
\item $y\sim_\Yleft x$.
\end{itemize}
\end{lemma}
\begin{proof}
Take arbitrary $y\in \sup\big(\downset\{x\}\setminus \upset\{x\}\big)$. First suppose $y\in\big(\downset\{x\}\setminus \upset\{x\}\big)$. Then $y\in \max\big(\downset\{x\}\setminus \upset\{x\}\big) \subseteq \llmax\big(\downset\{x\}\setminus \upset\{x\}\big) = P_X(x)$.


Now suppose $y\notin\big(\downset\{x\}\setminus \upset\{x\}\big)$. Then it is enough to show $y\in \downset\{x\}$ because this then implies $y\in \upset\{x\}$. To this end we calculate
\[ x\in \big(\downset\{x\}\setminus \upset\{x\}\big)^\Yleft \subseteq \sup\big(\downset\{x\}\setminus \upset\{x\}\big)^\Yleft \subseteq \{y\}^\Yleft = y{\Yleft}, \]
using \ref{supInfPreserveOrder}. This means that $y \Yleft x$, or $y\in \downset\{x\}$.
\end{proof}
\begin{corollary} \label{supLesserElementsOfLimitPoint}
If $x\in X$ is a limit point, then
\[ \sup\big(\downset\{x\}\setminus \upset\{x\}\big) \subseteq [x]_{\sim_\Yleft}. \]
\end{corollary}


\section{Well-founded and well-ordered sets}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure.
Then $A$ is called
\begin{itemize}
\item \udef{strictly well-founded} if every non-empty subset has a strictly minimal element;
\item \udef{well-founded} if every non-empty subset has a minimal element;
\item \udef{loosely well-founded} if every non-empty subset has a loosely minimal element.
\end{itemize}
Additionally, $A$ is called
\begin{itemize}
\item \udef{well-ordered} if every non-empty subset has a minimum. In this case $R$ is said to be a \udef{well-ordering}.
\end{itemize}
A set is called \udef{well-orderable} if it admits a well-ordering.
\end{definition}
TODO $A$ set? The requirement that $A$ be a set makes it easier to quantify over all subsets.

It turns out well-foundedness is what is needed to do recursion and induction. TODO: equivalence induction principle and well-foundedness!!

Note we do not impose antisymmetry.

\begin{proposition}
A relational structure $\sSet{A,R}$ is (strictly) well-founded \textup{if and only if} $\sSet{A,R^+}$ is (strictly) well-founded.
\end{proposition}
\begin{proof}
Let $S \subseteq A$ be some subset. If $x\in S$ is (strictly) $R^+$-minimal, then $x$ is (strictly) $R$-minimal. Thus (strictly) well-foundedness of $\sSet{A,R^+}$ implies (strictly) well-foundedness of $\sSet{A,R}$.

Now suppose $\sSet{A,R}$ is (strictly) well-founded. Then $\relconvex_R(S)$ has a (strictly) $R$-minimal $x$ and $x\in X$ by \ref{addedElementsRConvexHull}. We have that $x$ is (strictly) $R^+$-minimal in $\relconvex_R(S)$ by \ref{maximalityMinimalityRConvexSets}. It is then also a (strictly) $R^+$-minimal in $X$ by \ref{minimalMaximalSubset}.
\end{proof}

\begin{proposition} \label{wellOrderedCondition}
Let $\sSet{A,R}$ be a relational structure. Then the following are equivalent:
\item $A$ is well-ordered;
\item $A$ is loosely well-founded and connex.
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Assume $A$ well-ordered. Then every non-empty subset has a minimum, which is also loosely minimal by \ref{maximumIsMaximal}. So $A$ is well-founded.

Now take any $x,y\in A$. We need to show $xRy$ or $yRx$. We have that $\{x,y\}$ has a minimum. If $x$ is a minimum, then $xRy$. If $y$ is a minimum, then $yRx$.

$(2) \Rightarrow (1)$ Now assume $A$ is well-founded and connex and take some non-empty subset $S$ of $A$. Now $S$ is also connex, so each minimal element of $S$ is a minimum by \ref{maximumIsMaximal}.
\end{proof}

\begin{proposition}
Every antisymmetric well-ordering is transitive.
\end{proposition}
\begin{proof}
Let $\sSet{A,R}$ be a well-ordered relational structure and take $x,y,z\in A$ such that $xRy$ and $yRz$. We need to prove that $xRz$.

Consider the set $\{x,y,z\}$. It must have a least element. If the least element is $x$, then $xRz$ and we are done. If the least element is $y$, then $yRx$, so $x=y$ by antisymmetry and $yRz$ is the same as $xRz$. Finally if $z$ is the least element, then by a similar argument, $y=z$ and $xRz$.
\end{proof}

\begin{lemma}
Every well-ordering has a least element.
\end{lemma}
\begin{proof}
Every set is a subset of itself.
\end{proof}

\begin{lemma}
Let $\sSet{X,\leq}$ be a well-ordering and $x\in X$. Then $\downset S(x) = \downset\{x\}\cup S(x)$.
\end{lemma}
\begin{proof}

\end{proof}

\begin{lemma} \label{wellOrderingSubsets}
Let $(U,\leq_U)$ be a well-ordered set and $f: W \rightarrowtail U$ an injection. Then $W$ is well-ordered by
\[ \forall x,y\in W: x\leq_W y \defequiv f(x) \leq_U f(y). \]


In particular, if $W\subseteq U$ is a subset, then $\leq_W$ is the left- and right-restriction of $\leq$ to $W$, $\leq|_W^W$.
\end{lemma}
TODO: initial ordering??



\subsection{Succession in well-ordered posets}
\begin{definition}
Let $P$ be a well-ordered poset. We define the \udef{successor function} $\successor_P: P\to $
\end{definition}

Let $U$ be a well-ordered poset. Then the low end of $U$ it looks like $\N$:
\begin{itemize}
\item let $0_U$ denote the (unique) least element of $U$;
\item we can define $S_U(x) \defeq \min\setbuilder{y\in U}{x\leq y \land x\neq y}$.
\end{itemize}
This successor function is defined for all $x\in U$, except the maximum (if it exists).

TODO: picture.

\begin{definition}
The first limit point (i.e.\ the minimum in the set of limit points) is denoted $\omega_U$ or just $\omega$.
\end{definition}
Note that $\omega_U$ exists by definition of well-ordering.


\subsubsection{Indexing well-ordered posets}


\subsection{Initial segments in well-ordered sets}
\begin{proposition}
Let $\sSet{X,\leq}$ be a well-ordered set and $S$ an upwards closed subset. Then $S = \upset\min(S)$.

Thus every upwards closed set is a principal up set.
\end{proposition}
\begin{proof}
We have $\min(S) \neq\emptyset$, so $S = \upset S = \upset\min(S)$ by \ref{minMaxUpsetDownset}.
\end{proof}

\begin{proposition} \label{injectionsExpansive}
Every order-preserving injection $f: U\rightarrowtail U$ of a well-ordered set into itself is expansive.
\end{proposition}
\begin{proof}
Assume $f: U\rightarrowtail U$ injective but not expansive, i.e.\ $\exists x\in U: f(x)<x$ then let
\[ x^* = \min\{x\in U\;|\;f(x)<x\}. \]
Then $f(x^*)<x^*$ and $f(f(x^*)) < f(x^*)$ by order preservation. Then $f(x^*)$ is a smaller element in the set, yielding a contradiction.
\end{proof}
\begin{corollary} \label{properInitialSegmentNotIsomorphic}
No well-ordered set is isomorphic with one of its proper initial
segments, and hence no two distinct initial segments of a well-ordered set are
isomorphic.
\end{corollary}

\section{Transfinite induction and recursion}
The principles of induction and recursion can be generalised to well-founded sets.

Standard induction and recursion use the predecessor to define / prove a property of the successor. In general well-ordered sets there are limit points that have no predecessor. For this reason it is the principles of proof by \textit{complete
induction} and definition by \textit{complete recursion} that generalise to well-founded sets.

\begin{definition}
Let $\sSet{U, R}$ be a relational structure. We say $U$ satisfies
\begin{itemize}
\item the principle of \udef{well-founded induction} if for all subsets $P\subseteq U$, we have the implication
\[ \text{if}\quad  \forall x\in U: \Big(\big(Rx\setminus\{x\}\subseteq P\big)\implies x\in P\Big), \quad \text{then}\quad P=U; \]
\item the principle of \udef{loosely well-founded induction} if for all subsets $P\subseteq U$, we have the implication
\[ \text{if}\quad  \forall x\in U: \Big(\big(Rx\setminus xR\subseteq P\big)\implies x\in P\Big), \quad \text{then}\quad P=U. \]
\end{itemize}
In both cases the antecedent of the implication is called the \udef{induction step}. The antecedent of the induction step is called the \udef{induction hypothesis}.

We say $U$ satisfies
\begin{itemize}
\item the principle of \udef{well-founded recursion} if for all non-empty sets $E$ and functions $h: (U\not\to E)\to E$, there exists exactly one function $f: U\to E$ that satisfies
\[ \forall x\in U: \quad f(x) = h(f|_{Rx\setminus\{x\}}); \]
\item the principle of \udef{loosely well-founded recursion} if for all non-empty sets $E$ and functions $h: (U\not\to E)\to E$, there exists exactly one function $f: U\to E$ that satisfies
\[ \forall x\in U: \quad f(x) = h(f|_{Rx\setminus xR}). \]
\end{itemize}
In these cases we say $f$ is defined recursively by $h$.
\end{definition}

If $U$ is transitive, we write $\downset\{x\}$ instead of $Rx$.

\begin{proposition}
Let $\sSet{U,R}$ be a well-founded set, $E$ a set, $h:(U\not\to E)\to E$ be some function and $f: U\to E$ the functions defined recursively by $h$.

Let $P \subseteq (U\not\to E)$ be a subset such that $f|_{Rx\setminus\{x\}} \in P$ implies $f|_{Rx}\in P$, then $f\in P$
\end{proposition}
\begin{proof}
\[ F \defeq \setbuilder{f\in (U\not\to E)}{\exists u\in U': \dom(f) = Ru\setminus\{u\} \land \big(\forall x\in Ru: f(x) = h(f|_{Rx\setminus \{x\}}) \big)} \]
$F$ well-founded. 
\end{proof}

\begin{theorem}[Well-founded induction and recursion]
Let $\sSet{U, R}$ be an ordered set. Then the following are equivalent:
\begin{enumerate}
\item $U$ is well-founded;
\item $U$ satisfies the principle of well-founded induction;
\item $U$ satisfies the principle of well-founded recursion.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $U$ is loosely well-founded;
\item $U$ satisfies the principle of loosely well-founded induction;
\item $U$ satisfies the principle of loosely well-founded recursion.
\end{enumerate}
\end{theorem}
Notice that there is no need for a ``base step'' in the induction principles, as it is 
contained in the induction step: if $x$ is minimal in $U$, then there is no smaller $y$, so the induction hypothesis is trivially true and the induction step gives $x\in P$.
\begin{proof}
We show the first set of equivalences. The proof of the second set is identical, except with $Rx\setminus xR$ instead of $Rx\setminus\{x\}$.

$\boxed{(1) \Rightarrow (2)}$ Assume $U$ satisfies the principle of induction and let $P$ be some subset of $U$. We apply the principle of induction to $P^c$. The induction step is then
\[ \forall x\in U: \Big(\big(Rx\setminus\{x\}\perp P\big)\implies x\notin P\Big), \]
which by \ref{maximalMinimalEquivalents} implies that $P$ has no minimal elements (as any potentially minimal element is not in $P$).

The consequent $P^c = U$ is equivalent to $P=\emptyset$.

Thus the principle of induction gives that any subset without minimal elements is empty, which is exactly well-foundedness.

$\boxed{(2) \Rightarrow (1)}$ Assume, towards a contradiction, the induction step for some $P\subseteq U$ and $\exists x\in U\setminus P$. Then the set $P^c$ is not empty and by well-foundedness we can find a minimal element $x^*\in P^c$. By minimality $\downset\{x^*\}\setminus\{x^*\}\perp P^c$, so $R{x^*}\setminus\{x^*\}\subseteq P$. By the induction hypothesis $x^*\in P$, which is a contradiction.

$\boxed{(2) \Rightarrow (3)}$ Consider $U' \defeq U\cup \{t_U\}$, where $t_U$ is greater than any element in $U$. Then $U'$ is well-founded and $Rt_U\setminus \{t_U\} = U$.

Consider the set $P\subseteq U'$ that contains $u\in U'$ if and only if there exists exactly one function $f_u:Ru\to E$ which satisfies
\[ f_u(x) = h(f_u|_{Rx\setminus\{x\}}) \qquad \forall x\in Ru. \]
If we can prove the corresponding induction step, then in particular $t_U\in P$. This implies the existence and uniqueness of $f:U\to E = f_{t_U}|_U$.

Fix an arbitrary $u\in U'$ and assume the induction hypothesis, which posits that such a unique function $f_v: Rv\cup\{v\}\to E$ exists for all $v\in Ru\setminus\{u\}$. We show the existence and uniqueness of $f_u:Ru\cup \{u\}\to E$.

Note first that for $w\Yleft v\in Ru\setminus\{u\}$ we have $f_w = f_v|_{Rw\cup\{w\}}$, as both functions satisfy the conditions that give the unique definition.

For existence: first define $f_u' \defeq \bigcup_{v\in Ru\setminus\{u\}} f_v$. 
This is a relation; we show that it is functional and has domain $Ru\setminus\{u\}$.
Indeed
\begin{align*}
\dom(f'_u) &= \bigcup_{v\in Ru\setminus\{u\}} \dom(f_v) \\
&= \bigcup_{v\in Ru\setminus\{u\}} Rv\cup\{v\} \\
&= \bigcup_{v\in Ru\setminus\{u\}} \{v\} \\
&= Ru\setminus\{u\}.
\end{align*}
To show that $f'_u$ is functional, take $v\in Ru\setminus\{u\}$ and let $v\mathrel{(f'_u)}w_1$ and $v\mathrel{(f'_u)}w_2$.

Then there exist $v_1, v_2 \Yright v$ such that $f_{v_1}(v) = w_1$ and $f_{v_2}(v) = w_2$. Now
\[ w_1 = f_{v_1}(v) = f_{v_1}|_{Rv\cup \{v\}}(v) = f_v(v) = f_{v_2}|_{Rv\cup\{v\}}(v) = f_{v_1}(v) = w_2. \]
We conclude that $f'_u$ is functional.

Now let $f_u$ be the function $f'_u$ with the domain extended to $Ru$ by adding $f_u(u) = h(f'_u)$.

(In the case of loosely well-founded recursion, we need to add $f_u(w) = h(f'_u)$ for all $w\in (Ru\cap uR)\cup\{u\}$)

To show $f_u$ satisfies the defining property, take $v\in Ru\cup\{u\}$. If $v\neq u$, then
\[ f_u(v) = f_v(v) = h(f_v|_{Rv\setminus\{v\}}) = h(f_u|_{Rv\setminus\{v\}}). \]
Otherwise $v=u$, in which case $(Ru\cap uR)\cup\{u\} = (Rv\cap vR)\cup\{v\}$ and then
\[ f_u(v) = h(f'_u) = h(f_u|_{Ru\setminus\{u\}}) = h(f_u|_{Rv\setminus\{v\}}). \]
This concludes the existence part of the proof.

For uniqueness, assume that another function $g: Ru\cup \{u\}\to E$ satisfies the property. For $v\neq u$, we have $g|_{Ru\setminus\{u\}} = f'_u = f_u|_{Ru\setminus\{u\}}$. For $v=u$, we have
\[ g(u) = h(g|_{Ru\setminus\{u\}}) = h(f'_u) = f_u(u). \]
This proves uniqueness.

$\boxed{(3) \Rightarrow (2)}$ Take an arbitrary subset $P\subseteq U$. Consider the characteristic function $\chi_P: U\to \{0,1\}$ of $P$.

We may take $E = \{0,1\}$ and the $h$ that maps partial functions $p$ to zero iff $0\in\im(p)$. Then the statement
\[ \forall x\in U: \quad\chi_P(x) = h(\chi_P|_{Rx\setminus\{x\}}) \]
is equivalent to the induction hypothesis.

The function $\underline{1}$ satisfies the recursion relation. By the principle of recursion, this is the unique function, so $\chi_P = \underline{1}$ and thus $P = U$.
\end{proof}
\begin{corollary}
Let $\sSet{U,R}$ be a relational structure.
\begin{enumerate}
\item The well-founded principles imply the loosely well-founded principles.
\item If $U$ is antisymmetric, then these principles are equivalent.
\end{enumerate}
\end{corollary}
If $\sSet{U,\Yleft}$ is a poset, then $\downset\{x\}\setminus\upset\{x\} = \downset\{x\}\setminus\{x\} = \setbuilder{y\in U}{y<x}$.

\begin{corollary} \label{WOSetsUniqueSimilarity}
If $U$, $V$ are well-ordered posets and $U =_o V$, then the order similarity is unique.
\end{corollary}
\begin{proof}
Assume $f,g: U\to V$ are order similarities. By antisymmetry, we may consider $\min$ as a function in $\powerset(U)\to U$. Set $P = \setbuilder{y\in U}{f(y) = g(y)}$. To prove the induction step, take arbitrary $x\in U$ and assume the induction hypothesis ($\setbuilder{y\in U}{y<x} \subseteq P$). Then $\setbuilder{f(y)}{y< x} = \setbuilder{g(y)}{y< x}$ and so
\begin{align*}
f(x) &= f\Big(\min\big(\setbuilder{y}{y\geq x}\big)\Big) \\
&= f\Big(\min\big(\setbuilder{y}{y < x}^c\big)\Big) \\
&= \min\big(\setbuilder{f(y)}{y< x}^c\big) \\
&= \min\big(\setbuilder{g(y)}{y< x}^c\big) \\
&= g\Big(\min\big(\setbuilder{y}{y < x}^c\big)\Big) \\
&= g\Big(\min\big(\setbuilder{y}{y\geq x}\big)\Big) = g(x).
\end{align*}
By induction we conclude that $P=U$ and thus $f(x) = g(x)$ for all $x\in U$.
\end{proof}

Note that the hypotheses of connexity and antisymmetry are necessary: without either there may be multiple minimal elements of subsets and different order similarities have the freedom to choose between them.

\subsection{Mutual recursion}
\begin{definition}
Let $U$ be a (loosely) well-founded set and let $E$ be a set of the form $E = E_1\times E_2$. Suppose some function $h:(U\not\to E)\to E$ and let $f$ be defined recursively by $h$. Then we say $p_1\circ f$ and $p_2 \circ f$ are defined by \udef{mutual recursion}.
\end{definition}


\subsection{Recursion invariants}




TODO recursively defining some function with certain property (+usng this property in recursive definition)


\section{Well-ordered posets}
\begin{definition}
Let $U,V$ be well-ordered posets. We say $U$ is \udef{less than or equal to $V$ in length}, $U\leq_o V$ if $U$ is order isomorphic to an initial segment of $V$.
\[ U\leq_o V \defequiv \exists I\sqsubseteq V: U =_o I. \]
We also write
\[ U <_o V \defequiv U\leq_o V \land U\neq_o V. \]
\end{definition}
Every proper initial segment is of the form $\downset\{x\}$, so using corollary \ref{properInitialSegmentNotIsomorphic} gives
\begin{lemma}
Let $U,V$ be well-ordered sets.
\[ U <_o V \quad \iff \quad \exists x\in V: U =_o \downset\{x\}. \]
\end{lemma}

Clearly $=_o$ and $\leq_o$ imply $=_c$ and $\leq_c$.

\begin{lemma} \label{preorderingWosets}
For all well-ordered posets $U,V,W$:
\begin{enumerate}
\item $U \leq_o U$;
\item $[U\leq_o V \land V\leq_o W] \implies U\leq_o W$;
\item $[U \leq_o V \land V \leq_o U] \implies U =_o V$.
\end{enumerate}
\end{lemma}
\begin{proof}
For point 3., if $U \neq_o V$, then composing the order isomorphisms would yield an isomorphism between $U$ and a proper initial segment of $U$. Because such an isomorphism must be expansive we have a contradiction.
\end{proof}

\begin{theorem}[Comparability of well-ordered sets]\label{comparabilityWosets}
For any two well-ordered posets $U,V$: either $U\leq_o V$ or $V\leq_o U$.
\end{theorem}
TODO revamp using $f = \setbuilder{(x,y)\in U\times V}{\downset\{x\} =_o \downset\{y\}}$. Prove 1-1 and either left- or right-completeness.
\begin{proof}
The result is trivial if $V=\emptyset$, so we may assume the minimum $0_V$ exists.

Define, by transfinite recursion the function $f:U\to V$ such that $f(x) = h(f|_{\downset\{x\}})$ where $h$ sends each partial function to the least element of $V$ not in the image:
\[ h: (U\not\to V) \to V: \sigma \mapsto \begin{cases}
\min_V\{v\in V\;|\; v\notin \sigma[U]\} & (\{v\in V\;|\; v\notin \sigma[U]\} \neq \emptyset) \\
0_V  & (\{v\in V\;|\; v\notin \sigma[U]\} = \emptyset).
\end{cases} \]
We immediately note two properties of $f$:
\begin{enumerate}
\item It is order-preserving. Indeed, assume $x\leq_U y$, which implies
\begin{align*}
\downset\{x\} \sqsubseteq \downset\{y\} &\implies f[\downset\{x\}] \subseteq f[\downset\{y\}] \implies f|_{\downset\{x\}}[U] \subseteq f|_{\downset\{y\}}[U] \\
&\implies \{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} \supset \{v\in V\;|\; v\notin f|_{\downset\{y\}}[U]\} \\
&\implies \min\{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} \leq \min\{v\in V\;|\; v\notin f|_{\downset\{y\}}[U]\} \\ &\implies f(x) \leq f(y).
\end{align*}
\item Every point in $V$, other than $0_V$, can only be the image of at most one point in $U$.
\end{enumerate}
We distinguish three cases for $0_V$: it may be the image of zero, one or multiple points in $U$. If $0_V$ is the image of no points in $U$, there must be no points in $U$ and the result is trivial.
\begin{itemize}
\item If $0_V$ is the image of one point in $U$, then $f$ is injective. Then the function $f: U\to f[U]$ is bijective and order-preserving, so an order isomorphism by lemma \ref{equivalenceOrderPreservingReflecting}. We just need to show $f[U]$ is an initial segment of $V$. Take an arbitrary $x\in V$ and $y\in f[U]$ and assume $x\leq y$. There is a $u$ such that $f(u) = y$. If $x$ were not in $f[U]$, then $x\in\{v\in V\;|\; v\notin f|_{\downset\{u\}}[U]\}$, but $x$ is smaller than the minimum yielding a contradiction. In this case $U\leq_o V$.
\item If $0_V$ is the image of multiple points in $U$, there is an $x\in U$ such that
\[ \{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} = \emptyset. \]
We take the least such $x$ and then $f|_{\downset\{x\}}$ is bijective. In this case $V \leq_o U$.
\end{itemize}
\end{proof}
\begin{corollary}
For all well-ordered poset $U,V$,
\[ U \leq_o V \quad \iff \quad \exists: \text{order-preserving injection} \;U\rightarrowtail V. \]
\end{corollary}
\begin{proof}
If $U \leq_o V$, then $U$ is order isomorphic to an initial segment of $V$; this order isomorphism is an order-preserving injection into $V$.

Conversely, assume there is an order-preserving injection $f:U\rightarrowtail V$. Assume, towards a contradiction that $U \nleq_o V$; by the theorem this means $V <_o U$. Then $V=_o \downset\{x\}$ for some $x\in U$ and composing $f$ with this isomorphism gives an order-preserving injection $U\rightarrowtail \downset\{x\}$. This is obviously not expansive, so by proposition \ref{injectionsExpansive} we have a contradiction.
\end{proof}
\begin{corollary}[Wellfoundedness of $\leq_o$]\label{wellfoundednessOfWosetComparison}
Every non-empty class $\mathcal{E}$ of well-ordered posets has a $\leq_o$-least member.
\end{corollary}
i.e.\ for some $U_0\in \mathcal{E}$ and all $U\in \mathcal{E}$: $U_0\leq_o U$.
\begin{proof}
Because $\mathcal{E}$ is non-empty, we have a $W\in\mathcal{E}$. If $W$ is $\leq_o$-least in $\mathcal{E}$, we are finished. If $W$ is not $\leq_o$-least, there are sets $U$ in $\mathcal{E}$ such that $U\leq_o W$ and the set
\[ J \defeq \{x\in W\;|\;\exists U\in\mathcal{E}: U =_o \downset\{x\}\} \]
is not empty. Take the least element of $J$; it is easy to prove that the corresponding set $U$ is the $\leq_o$-least member of $\mathcal{E}$.
\end{proof}
\begin{corollary} \label{ordinalInequalitiesLemma}
Let $U,V$ be well-ordered posets. Then
\begin{enumerate}
\item $U\nleq_o V \iff V <_o U$;
\item $U <_c V$ implies $U \leq_o V$.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{ordinalInequalityFromInitialSegments}
Let $U,V$ be well-ordered posets. Then
\[ U \leq_o V \qquad\iff\qquad \forall x\in U:\; \downset\{x\} \leq_o V.   \]
\end{proposition}
\begin{proof}
The direction $\Rightarrow$ is immediate.

For the other direction: we need to find an order-preserving injection $U\to V$. For every $x\in U$ we have an order-preserving injection $\downset\{x\} \to V$. The union of all these injections gives the one we want.
\end{proof}

\subsection{Hartogs number}
The Hartogs number of any set $X$ is a bigger well-ordered set.

A set $X$ may not be well-orderable itself, but it definitely has well-orderable subsets. Some subsets may even have inequivalent well-orderings.
\begin{definition}
Let $X$ be a set. Let $\operatorname{WO}(X)$ be the set
\[ \operatorname{WO}(X) = \{ (U,\leq_U) \in \powerset(X)\times\powerset(X\times X) \;|\; \leq_U\; \text{is a well-ordering of $U$}\;  \}. \]
Then \udef{Hartogs number} of $X$ is the set
\[ \aleph(X) \defeq \operatorname{WO}(X)/=_o. \]
Here $=_o$ is restricted to $\powerset(X)$ and thus is an equivalence relation (see lemma \ref{isomorphismEquivalence}).
\end{definition}
If the natural numbers are viewed as Von Neumann ordinals, we have the following:
\[ \aleph(0) = 1, \quad \aleph(1) = 2, \quad \aleph(2) = 3, \quad \ldots \]
This follows because each finite set can be well-ordered exactly one way, up to order isomorphism and well-ordered finite sets of the same size are order isomorphic.

\begin{lemma} \label{wellorderingHartogsNumber}
Let $X$ be a set and $\aleph(X)$ its Hartogs number. Then $\leq$ defined by
\[ \forall \alpha, \beta \in \aleph(X):\quad \alpha \leq \beta \defequiv \alpha = [U] \land \beta = [V] \land U\leq_o V \]
makes $(\aleph(X), \leq)$ a well-ordered set.
\end{lemma}
\begin{proof}
First we show $\leq$ is well-defined: let $[U] = [U']$ and $[V] = [V']$. Then $U =_o U'$ and thus $U'\leq_o U$; also $U \leq_V$ and $V\leq_o V'$. By point 2 of lemma \ref{preorderingWosets} we have $U' \leq_o V'$, showing the definition is well-defined.

A simple application of lemma \ref{preorderingWosets} shows us $(\aleph(X), \leq)$ is a poset.

The order is total by the comparability of well-ordered sets, theorem \ref{comparabilityWosets}, and well-founded by its corollary, corollary \ref{wellfoundednessOfWosetComparison}.
\end{proof}

\begin{lemma} \label{HartogsNumberAsOrdinal}
Let $X$ be a set and $\alpha = [U] \in \aleph(X)$. Then
\[ U =_o \setbuilder{ [\downset\{x\}] }{ x\in U }. \]
\end{lemma}
\begin{proof}
The identity is clear by the previous lemma \ref{wellorderingHartogsNumber}. The isomorphism follows from proposition \ref{principalDownsetEmbedding} and the fact that each $[\downset\{x\}]$ contains exactly one initial segment of $U$, by lemma \ref{orderingInitialSegments}.
\end{proof}

\begin{theorem}[Hartogs' lemma] \label{HartogsLemma}
Let $X$ be a set. There is no injection $\aleph(X) \rightarrowtail X$, i.e.\ $\aleph(X) \nleq_c X$.
\end{theorem}
\begin{proof}
Suppose, towards a contradiction, that there exists an injection
\[ f: \aleph(X) \rightarrowtail X \]
and let $Y = f[\aleph(X)] \subseteq X$ be its image. Then $f: \aleph(X) \to Y$ is a bijection, meaning $Y$ is well-ordered by lemma \ref{wellOrderingSubsets}. So $Y =_o \aleph(X)$.
But also $[Y]\in \aleph(X)$, because $Y\subseteq X$, and by lemma \ref{HartogsNumberAsOrdinal} $Y$ is similar to a proper initial segment of $\aleph(X)$.
So $\aleph(X)$ would seem to be similar to a proper initial segment, but this contradicts the expansiveness of order embeddings on well-ordered sets, see corollary \ref{properInitialSegmentNotIsomorphic}.
\end{proof}

\begin{proposition}[Bourbaki-Witt theorem] \label{BourbakiWitt}
Let $P$ be a non-empty chain-complete poset. Let $f: P \to P$ be a function such that $x\leq f(x)$ for all $x\in P$. Then $f$ has a fixed point.
\end{proposition}
\begin{proof}
TODO \url{https://en.wikipedia.org/wiki/Bourbaki%E2%80%93Witt_theorem}
\end{proof}


\begin{proposition} \label{proposition:HartogsLeast}
Let $X$ be a set. The Hartogs number $\aleph(X)$ is the $\leq_o$-least well-ordered set not smaller than or equal to $X$ in size. i.e.\
\[ \forall \;\text{well-ordered sets $U$}:\quad U \nleq_c X \implies \aleph(X)\leq_o U. \]
\end{proposition}
\begin{proof}
We prove the contrapositive:
\[ W <_o \aleph(X) \implies W \leq_c X. \]
Assume $W <_o \aleph(X)$. Then $W =_o \operatorname{seg}_{\aleph(X)}(\alpha)$ for some $\alpha = [U]\in \aleph(X)$, so $W=_o U$ and thus $W =_c U \subseteq X$. So $W\leq_c X$.
\end{proof}

\subsubsection{Burali-Forti's paradox}
Burali-Forti's paradox is like Cantor's paradox for well-ordered sets. It shows we cannot have a set of well-ordered sets.

One way to put it is as follows: assume we have a set $WO$ of all well ordered sets. Then $\aleph(WO)$, which is a set of well-ordered sets, must be a subset of $WO$, so $\aleph(WO) \leq_c WO$. This contradicts Hartogs' lemma.

A (slightly) more historical\footnote{See \url{https://zenodo.org/record/2362091/files/article.pdf}} approach: let $\Omega \defeq WO/=_o$.
The elements of $\Omega$ are well-ordered by $\leq_o$ (like in lemma \ref{wellorderingHartogsNumber}).
Consider $\Omega+1 \defeq \operatorname{Succ}(\Omega)$. Because $\Omega = \downset\{t_\Omega\}$, we have $[\Omega] < [\Omega +1]$.
On the other hand, by proposition \ref{principalDownsetEmbedding} we see that $\Omega =_o \downset\{\Omega\}$, so that each element of $\Omega$ is comparable to $\Omega$.
Thus all well-ordered sets are $\leq_o \Omega$ and in particular $[\Omega + 1] \leq [\Omega]$. By $[\Omega] < [\Omega +1]$ and $[\Omega + 1] \leq [\Omega]$ we see that the elements of $\Omega$ are not well-ordered, which is a contradiction.

The paradox is nowadays more commonly stated for (von Neumann) ordinals (see later).




\section{Strings and trees}
ATM we do not define strings using tuples. We could do $\seq{a,b,c,d} = (a, (b,(c,d)))$. But
\begin{itemize}
\item we do not have empty pair or singleton pair, while we should have such sequences;
\item type / ontological status of $(a, (b,(c,d)))$ not as clear;
\item should it be $(a, (b,(c,(d))))$?
\end{itemize}

\subsection{Strings}
\begin{definition}
A \udef{string} in an \udef{alphabet} $A$ is a sequence whose domain is a set of the form $\interval[co]{0,n}$ and whose codomain is the set $A$. The elements of $A$ are called \udef{symbols}.

The size $n$ of the domain is the \udef{length} of the sequence, denoted $\len(x)$. Thus $x: \interval[co]{0,\len(x)}\to A$.


We identify $n$ with the corresponding von Neumann ordinal to get
\begin{align*}
A^{n} &\defeq A^{\interval[co]{0,n}} \\
A^* &\defeq \bigcup\setbuilder{ A^{n}}{n\in \N}.
\end{align*}
We call $A^*$ the \udef{Kleene closure} of $A$.

Let $a_0,\ldots, a_{n-1}\in A$. Then we have the string
\[ \seq{a_0,\ldots, a_{n-1}} \defeq \{(0,a_0),\ldots, (n-1,a_{n-1})\} \in A^{n}. \]

Let $u\in A^*$ be a string. We take all indices modulo $\len(x)$. In particular negative indices can be used to count back from the end of the string.

\begin{itemize}
\item We allow the domain of a string to be $\emptyset = \interval[co]{0,0}$. There is a unique string with this domain, the \udef{empty string} $\seq{}$. We have $\seq{}\in A^0 \subseteq A^*$.
\item Let $u\in A^{n}, v\in A^{m}$ be strings. The \udef{concatenation} of $u$ and $v$ is the string
\[ u\star v \defeq \seq{u_0,\ldots, u_{n-1},v_0,\ldots, v_{m-1}} \in A^{n+m}. \]
\item Let $u\in A^{n}$ be a string. The \udef{reverse} string $\reverse{u}$ is defined by
\[ \reverse{u} \defeq \seq{u_{n-1}, \ldots, u_0}. \]
\item Let $u\in A^*$ be a string. The string $u^k$ is defined recursively by
\[ u^{k} = \begin{cases}
\seq{} & (k=0) \\
u^{k-1}\concat u & (k\geq 1)
\end{cases}. \]
\end{itemize}
We call a subsequence a \udef{substring} if its domain is an interval subset.
\begin{itemize}
\item A string is called \udef{simple} if it is injective.
\end{itemize}
\end{definition}
Notice that we can view tuples as strings of length two (i.e.\ there is a bijection $A\times A \leftrightarrow A^{2}$ for all sets $A$). Similarly an $n$-tuple can be seen as a string of length $n$. So sometimes we write
\[ A^* = \bigcup^\infty_{n=0}A^n = A^{<\omega}\]
where $A^{<\omega}$ is just a notational equivalent.

We can think of $A^*$ as a generalisation of $\N$, with $\seq{}$ instead of $0$ and appending operators
\[ S_a(u) = u\concat \seq{a} \]
for all $a\in A$. In this way $\N \cong \{1\}^*$.

TODO: unification of strings and sequences. Also notation for $A^* \cup A^\N$. In this case $\len: A^* \cup A^\N \to \overline{\N} = \N^+$.


\begin{proposition}[String pigeonhole principle] \label{stringPigeonholePrinciple}
Let $A$ be a finite alphabet and $u\in A^*$. If $\#A < \len(u)$, then $u$ is not simple.
\end{proposition}
In other words: if $\#A < \len(u)$, then $u$ has a repeating character.
\begin{proof}
Assume $\#A < \len(u)$. Then we have the inclusion $\interval[co]{0,\#A} \hookrightarrow \interval[co]{0,\len(u)}$ by \ref{naturalNumbersInequalityInclusion}. Also $A =_c \interval[co]{0,\#A}$ by definition.


We need to show that $u$ is not an injection. Assume, towards a contradiction, that it is injective. 
Then $\begin{tikzcd}
A \ar[r, "{=_c}"] &\interval[co]{0,\#A} \ar[r,hook] & \interval[co]{0,\len(u)} \ar[r, "u"] & A
\end{tikzcd}$
is injective. By the pigeonhole principle \ref{pigeonholePrinciple}, this map is bijective. Thus $u$ is surjective, so $\interval[co]{0,\len(u)} =_c A$, which means that $\len(u) = \#A$ by the unicity in \ref{finiteSetNumberOfElements}. This is a contradiction.
\end{proof}

\begin{theorem}[String recursion theorem] \label{stringRecursion}
Let $A,E$ be sets, $a\in E$, and $h:E\times A\to E$ some function.

There is exactly one function $f: A^*\to E$ which satisfies
\[ \begin{cases}
f(\seq{}) = a, \\
f(\seq{x}\concat u) = h(x, f(u)) & (x\in A, u\in A^*).
\end{cases} \]
\end{theorem}
\begin{proof}
Define a function $\phi: \N \times A^*\to E$ recursively such that it satisfies
\begin{align*}
\phi(0,u) &= a \\
\phi(n+1,u) &= h(\phi(n,u), u(n))
\end{align*}
and set $f(u) = \phi(\len(u), u)$. Proving that $f$ satisfies the second equality and the uniqueness of $f$ goes by induction on $\len(u)$.
\end{proof}
Like before, a version of the theorem can also be stated for recursion with parameters. Also recursion with multiple strings.

\subsubsection{Ordering string}
TODO define lexicographic order on sequences.

\begin{definition}
Let $\sSet{A,R}$ be a relational structure. Then
\begin{itemize}
\item the \udef{lexicographic order} $R_l$ on $A^*$ is defined by
\[ u R_l v \quad\defequiv\quad \big(\len(u) = \len(v)\big) \land \big(u_k R v_k\big), \]
where $k = \min\big(\setbuilder{n\in\N}{n < \len(u), u_n \neq v_n}\cup\{\len(u)\}\big)$;
\item the \udef{lexicographic order} $R_{el}$ on $A^*$ is defined by first adjoining a lower bound $\bot$ to $A$ and then
\[ u R_{el} v \quad\defequiv\quad \exists w,w'\in \{\bot\}^*: (u\concat w) \mathrel{R_l} (v\concat w'); \]
\item the \udef{shortlex order} or \udef{strong order} $R_{s}$ on $A^*$ is defined by
\[ u R_{sl} v \qquad\defequiv\qquad \begin{cases}
\len(u) < \len(v) & \text{or} \\
\big(\len(u) = \len(v)\big) \land (u R_l v);
\end{cases}\]
\item the \udef{longlex order} or $R_{ll}$ on $A^*$ is defined by
\[ u R_{ll} v \qquad\defequiv\qquad \begin{cases}
\len(u) > \len(v) & \text{or} \\
\big(\len(u) = \len(v)\big) \land (u R_l v).
\end{cases}\]
\end{itemize}
\end{definition}

\begin{lemma}
Let $\sSet{A,R}$ be a relational structure. Then $R_l, R_{el}, R_{sl}, R_{ll}$ are
\begin{enumerate}
\item reflexive;
\item irreflexive;
\end{enumerate}
\textup{if and only if} $R$ is.
\end{lemma}

\begin{proposition}
If $\sSet{A,R}$ is an terminating relational structure. Then $R_{ll}$ is terminating.
\end{proposition}
\begin{proof}
We prove the contraposition. Assume $R_s$ is not terminating. Then we can find an infinite branch $S\subseteq [T_{R_s}]$. Take the first string $u$ in the branch and set $n = \len(u)$. Then all lengths of strings in $S$ are less than or equal to $n$. If we partition the strings by length, we must have at least one infinite partition (by the contraposition of: finite unions of finite sets are finite).

TODO rest!! ALSO TODO: move after definition termination.
\end{proof}

\begin{example}
A terminating relational structure $\sSet{A,R}$ may induce a non-terminating lexicographical order $R_s$ and a non-terminating shortlex order.

For example, consider the set $\{a,b\}$ and the order defined by $a<b$. Then
\[ a,\; ba,\; bba\,; bbba,\; \ldots \]
determines an infinite chain that is monotone in both $R_l$ and $R_s$.
\end{example}

\subsubsection{Slices and substrings}
\begin{definition}
Let $A$ be an alphabet, $u$ a string in $A$ and $S$ some set. Then the $S$-\udef{slice} of $u$ is the string
\[ u[S] \defeq \begin{tikzcd}
\interval[co]{0,\#\big(S\cap\dom(u)\big)} \ar[r, "\cong"] & S\cap\dom(u) \ar[r, "u|_S"] & A,
\end{tikzcd} \]
where $\interval[co]{0,\#\big(S\cap\dom(u)\big)} \cong S\cap\dom(u)$ is the unique order similarity of \ref{WOSetsUniqueSimilarity} (where $S\cap\dom(u)$ has the subspace order).
\end{definition}

In particular note that $\len(u[S]) = \#\big(S\cap\dom(u)\big)$.

\begin{lemma} \label{initialSliceLemma}
Let $A$ be an alphabet, $u\in A^*$ and $m,n\in \N$. Then
\begin{enumerate}
\item $u[0:n] = u|_{(0:n)}$;
\item $u = u[0:\len(u)]$;
\item $\len(u[0:n]) = \min(n,\len(u))$;
\item $u[0:n][0:m] = u[0:\min(m,n)] = u[0:m][0:n]$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We note that, using \ref{latticeIntervalIntersection},
\begin{align*}
\interval[co]{0,\#\big((0:n)\cap (0:\len(u))\big)} &= \interval[co]{0,\#\big(0:\min(n, \len(u))\big)} \\
&= \interval[co]{0,\min(n,\len(u))} \\
&= \interval[co]{0,n}\cap \interval[co]{0,\len(u)} = (0:n)\cap \dom(u).
\end{align*}
So the order similarity in the definition of $u[0:n]$ is the identity and the result follows.

(2) We have, using point (1), $u = u|_{\dom(u)} = u|_{0:\len(u)} = u[0:\len(u)]$.

(3) We have, using \ref{latticeIntervalIntersection}, that
\[ \len(u[0:n]) = \#\big((0:n)\cap (0:\len(u))\big) = \#\big(0:\min(n,\len(u))\big) = \min(n,\len(u)). \]

(4) We have, using point (1),
\[ u[0:n][0:m] = u|_{0:n}|_{0:m} = u|_{(0:n)\cap(0:m)} = u_{(0:\min(m,n))} = u[0:\min(m,n)]. \]
\end{proof}

TODO: generalise to sequences?? In this case $\len(u[0:n]) = n$.

\subsection{Trees}
\begin{definition}
Let $A$ be an alphabet. We define the \udef{tree order} $\sqsubseteq$ on $A^*$ by
\[ u \sqsubseteq v \qquad\defequiv\qquad \exists n\in \N: \; u = v[0:n]. \]
A \udef{tree} is a downwards closed subset of $\sSet{A^*, \sqsubseteq}$.

We call
\begin{itemize}
\item elements of $T$ \udef{nodes} of the tree;
\item a maximal element of $T$ a \udef{terminal node};
\item a tree without terminal nodes \udef{pruned};
\item a connex subtree of $T$ a \udef{branch} of $T$;
\item the set of all infinite branches of $T$ the \udef{body} of $T$, denoted $[T]$;
\item the tree $T$ is called \udef{terminating} if $[T] = \emptyset$;
\item the tree $T$ is called \udef{simple} if every string in $T$ is simple.
\end{itemize}
\end{definition}

\begin{lemma} \label{treeNodeInequalities}
Let $A$ be an alphabet and $u,v\in A^*$. Then
\begin{enumerate}
\item $u \sqsubseteq v \iff u = v[0:\len(u)]$;
\item $u \sqsubseteq v \implies \len(u) \leq \len(v)$;
\item $u \sqsubseteq v \iff \exists t\in A^*: t\concat u \sqsubseteq t\concat v \iff \forall t\in A^*: t\concat u \sqsubseteq t\concat v$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) The direction $\Leftarrow$ is immediate. For the direction $\Rightarrow$, assume $u \sqsubseteq v$. Then there exists $n\in \N$ such that $u = v[0:n]$. By \ref{initialSliceLemma}, we have
\[ u = u[0:\len(u)] = v[0:n][0:\len(u)] = v[0:\min(n,\len(u))], \]
and so $\len(u) = \len\big(v[0:\min\big(n,\len(u)\big)]\big) = \min\big(n,\len(u), \len(v)\big)$. In particular, this means that $\len(u) = \min\big(n,\len(u)\big)$ and so $u = v[0:\min\big(n,\len(u)\big)] = v[0:\len(u)]$.

(2) We have $u = v[0:\len(u)]$. By \ref{initialSliceLemma}, we have $\len(u) = \len\big(v[0:\len(u)]\big) = \min\big(\len(v), \len(u)\big)$. This implies $\len(u) \leq \len(v)$.

(3) The implication $u \sqsubseteq v \implies \exists t\in A^*: t\concat u \sqsubseteq t\concat v$ clearly holds by taking $t=\seq{}$. Similarly, the implication $\forall t\in A^*: t\concat u \sqsubseteq t\concat v \implies u \sqsubseteq v$, also by taking $t=\seq{}$.

For the last implication, assume there exists $t_0\in A^*$ such that $t_0\concat u \sqsubseteq t_0\concat v$ and pick arbitrary $t_1\in A^*$.
\end{proof}

\begin{lemma}
Let $T$ be a non-empty tree on a set $A$. Then $\seq{}\in T$.
\end{lemma}
\begin{proof}
As $T$ is non-empty, we can find $u\in T$. Now $\seq{} = u[0:0] = u[0:\len(\seq{})]$, so $\seq{}\sqsubseteq u$ by \ref{treeNodeInequalities}. Thus $\seq{}\in T$ by downwards closure.
\end{proof}

\begin{lemma} \label{treeOrderingLemma}
Let $T$ be a tree on an alphabet $A$. Then
\begin{enumerate}
\item $\sqsubseteq$ is a partial order on $T$;
\item $\sSet{T,\sqsubseteq}$ is well-founded;
\item if $\sSet{T,\sqsubseteq}$ is converse well-founded, then $[T] = \emptyset$;
\item if $C\subseteq T$ is a chain, then $\downset C$ is a branch.
\end{enumerate}
\end{lemma}
The converse of (3) requires dependent choice, see \ref{ZornEquivalentsDC}.

Note that (4) implies that if $v\sqsubseteq u$ and $w\sqsubseteq u$, then $v$ and $w$ are comparable.
\begin{proof}
(1) We show that $\sqsubseteq$ is
\begin{itemize}
\item \emph{transitive}: let $u \sqsubseteq v \sqsubseteq w$. Then $u = v[0:m]$ and $v = w[0:n]$, so, by \ref{initialSliceLemma},
\begin{align*}
u &= w[0:n][0:m] = \big(w[0:n]\big)|_{(0:m)} = \big(w|_{(0:n)}\big)|_{(0:m)} \\
&= w|_{(0:n)\cap(0:m)} = w|_{(0:\min\{m,n\})} = w[0:\min\{m,n\}].
\end{align*}
Thus $u \sqsubseteq w$.
\item \emph{reflexive}: $u = u[(0:\len(u))]$, so $u \sqsubseteq u$.
\item \emph{antisymmetric}: assume $u\sqsubseteq v$ and $v\sqsubseteq u$. Then $\len(u) = \len(v)$ by \ref{treeNodeInequalities}. This also gives $u = v[0: \len(u)] = v[0:\len(v)] = v|_{\dom(v)} = v$.
\end{itemize}

(2) Take a non-empty set $S\subseteq T$. We need to show that $S$ has a minimal element. Pick some $u\in S$ and consider the finite set $S' \defeq \setbuilder{u[0:n]}{n\leq \len(u)} \cap S$. Now $S'$ is non-empty and thus contains a minimal element $v$ by \ref{minimalMaximalFiniteSet}. We just need to show that any minimal element of $S'$ is also a minimal element of $S$. 

Assume towards a contradiction, that there exists $w\in S$ such that $w\sqsubsetneq v$. Then $w\in \setbuilder{u[0:n]}{n\leq \len(u)}$, so $w\in S'$. But this would contradict the minimality of $v$ in $S'$.

(3) Assume there exists an infinite branch $B\in [T]$. Then clearly $B$ does not have a maximal element, so $\sSet{T,\sqsubseteq}$ is not converse well-founded.

(4) As $\downset\{u\}$ is downwards closed by definition, we just need to show connexity. Take $v,w\in \downset\{u\}$. Then $v = u[0:n]$ and $w = u[0:m]$. We have either $\interval[co]{0,n} \subseteq \interval[co]{0,m}$ or $\interval[co]{0,n} \supseteq \interval[co]{0,m}$. In the first case $v \sqsubseteq w$ and in the second $w\sqsubseteq v$.

(4) As $\downset C$ is downwards closed by definition, we just need to show connexity. By transitivity and reflexivity, we have $\downset C = {\sqsubseteq}C$. Take $v,w\in \downset C$. Then there exist $u_v, u_w\in C$ such that $v \sqsubseteq u_v$ and $w \sqsubseteq u_w$. By connexity of $C$, we have either $u_v \sqsubseteq u_w$ or $u_w\sqsubseteq u_v$. Set $u = u_w$ in the first case and $u=u_v$ in the second. Thus we have $v\sqsubseteq u$ and $w\sqsubseteq u$ by transitivity.

Now $v = u[0:n]$ and $w = u[0:m]$ for some $m,n\in\N$. We have either $\interval[co]{0,n} \subseteq \interval[co]{0,m}$ or $\interval[co]{0,n} \supseteq \interval[co]{0,m}$. In the first case $v \sqsubseteq w$ and in the second $w\sqsubseteq v$.
\end{proof}

\subsubsection{Branching}
\begin{definition}
Let $T$ be a tree on an alphabet $A$. We say $T$ is
\begin{itemize}
\item \udef{finitely branching} if for all $u\in T\setminus\{\seq{}\}$ the set $\setbuilder{u\concat\seq{a}}{a\in A}$ is finite;
\item \udef{locally finite} if $\setbuilder{u\in T}{\seq{a}\sqsubseteq u}$ is finite for all $a\in A$.
\end{itemize}
\end{definition}

\subsubsection{The tree of a homogeneous binary relation}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure. The tree
\[ T_R \defeq \setbuilder{u\in A^*}{\forall n\in (0:\len(u)): \; u_nRu_{n+1}} \]
is the \udef{associated tree} of $\sSet{A,R}$. We call its elements \udef{$R$-linked} strings.
\end{definition}

\begin{lemma} \label{TransitiveRlinkedStringSequence}
Let $\sSet{A,R}$ be a transitive relational structure and $u\in A^* \cup A^\N$. Then $u$ is $R$-linked \textup{if and only if} it is isotone as a function $u: \sSet{(0:\len(u)), \leq} \to \sSet{A,R}$.
\end{lemma}
\begin{proof}
If $u$ is isotone, then it is clearly $R$-linked. The converse is proved by induction on the length $\len(u)$.
\end{proof}

\begin{lemma} \label{relationalTreeLemma}
Let $\sSet{A,R}$ be a relational structure with associated tree $T_R$. Take $u\in T_R$. Then
\begin{enumerate}
\item $u$ is terminal \textup{if and only if} $u_{-1}R = \emptyset$;
\item $R$ is left-total \textup{if and only if} $T_R$ is pruned.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) If $u_{-1}R = \emptyset$, then there does not exist a string of length $\len(u)+1$ with $u$ as initial segment.

If $u_{-1}R \neq \emptyset$, then we can take $x\in u_{-1}R$, so that $u \sqsubseteq u\concat\seq{x} \in T_R$. This means that $u$ is not terminal.

(2) Follows from (1).
\end{proof}

\begin{lemma} \label{maximalElementNotLeftTotal}
Let $\sSet{A,R}$ be an asymmetric relational structure. Then $A$ contains a maximal element \textup{if and only if} $R$ is not left total.
\end{lemma}
Note that in this case maximality is equivalent to both loose and strict maximality by \ref{symmetricMaximalityMinimality}.
\begin{proof}
We show that the existence of a strictly maximal element in $A$ is equivalent to $R$ not being left total:
\begin{align*}
\exists x\in A: \; \text{$x$ is strictly maximal} \quad&\iff\quad \exists x \in A: \; xR\perp A \\
&\iff\quad \exists x \in A: \; xR = \emptyset \\
&\iff\quad \text{$R$ is not left total}.
\end{align*}
\end{proof}

\begin{lemma} \label{transitiveClosureSequenceLemma}
Let $\sSet{A,R}$ be a relational structure with associated tree $T_R$. Let $a,b\in A$. Then $aR^+b$ \textup{if and only if} exists $u\in T_R$ such that $u_0 = a$ and $u_{-1} = b$.
\end{lemma}
\begin{proof}
TODO!
\end{proof}

\begin{lemma} \label{monotoneFunctionSubAssociatedTree}
Let $\sSet{A,R}$ and $\sSet{B,S}$ be relational structures and $f: A\to B$ a function. Then $f$ is monotone \textup{if and only if} $(\lambda_f)^{\imf}(T_{R})$ is a subtree of $T_S$.
\end{lemma}
\begin{proof}
The set $(\lambda_f)^{\imf}(T_{R})$ is automatically a tree.

$\boxed{\Rightarrow}$ 
Assume $f$ is monotone. We expand
\begin{align*}
(\lambda_f)^{\imf}(T_{R}) \subseteq T_S &\iff T_R \subseteq (\lambda_f)^{\preimf}(T_{R})(T_S) \\
&\iff T_R \subseteq \setbuilder{v \in A^*}{\lambda_f(v) = f\circ v \in T_S} \\ 
&\iff \forall v\in T_R: \forall n\in (0:\len(v)): f(v_n)Sf(v_{n+1}).
\end{align*}
To prove the last statement, take $v\in T_R$ and $n\in (0:\len(v))$. Then $v_nRv_{n+1}$ by definition of $T_R$ and thus $f(v_n)Sf(v_{n+1})$ by monotonicity.

$\boxed{\Leftarrow}$ 
Now assume $(\lambda_f)^{\imf}(T_{R}) \subseteq T_S$ and take $aRb\in A$. Then $\seq{a,b}\in T_R$ and thus $\seq{f(a), f(b)}\in T_S$, which means that $f(a)Sf(b)$ and thus that $f$ is monotone.
\end{proof}

\subsubsection{Branches and sequences}
\begin{proposition}
Let $A$ be an alphabet. Then the following function
\[ \branch: A^\N \to [A^*]: u \mapsto \setbuilder{u[0:n]}{n\in \N}, \]
which maps sequences in $A$ to their initial segments, is a bijection with inverse
\[ \branch^{-1}: [A^*] \to A^\N: S\mapsto \bigcup S. \]
\end{proposition}
\begin{proof}
First we show that both $\branch$ and $\branch^{-1}$ are well-defined.

Take $u\in A^\N$. We need to show that $\branch(u)\in[A^*]$:
\begin{itemize}
\item $\branch(u)$ is a subtree, i.e.\ downwards closed under $\sqsubseteq$: take $s\in \branch(u)$ and $t\sqsubseteq s$. Then 
\[ t = s[0:\len(t)] = u[0:n][0:\len(t)] = u[0:\min(n, \len(t))] \in \branch(u) \]
by (TODO generalisation of \ref{initialSliceLemma}).
\item $\branch(u)$ is connex: take $s,t\in \branch(u)$. Then $s = u[0:m]$ and $t = u[0:n]$ for some $m,n\in \N$. Now either $m\leq n$ or $n\leq m$ by connexity of $\N$. In the first case $m = \min(m,n)$, so
\[ s = u[0:m] = u[0:\min(m,n)] = u[0:n][0:m] = t[0:m], \]
which means that $s\sqsubseteq t$. In the other case $t\sqsubseteq s$.
\item $\branch(u)$ is infinite: the function $\N\to \branch(u): n\mapsto u[0:n]$ is injective, indeed assume $u[0:n] = u[0:m]$, then
\[ n = \len(u[0:n]) = \len(u[0:m]) = m, \]
by TODO ref. Thus $\N\leq_c \branch(u)$ by \ref{injectiveSurjectiveMappingCardinality} and $\branch(u)$ is infinite by \ref{infiniteComparisonWithN}.
\end{itemize}

Take $S\in [A^*]$. We need to show that $\branch^{-1}(S)\in A^\N$:
\begin{itemize}
\item $\branch^{-1}(S)$ is functional: assume $n\in \N$ such that $n\mathrel{\branch^{-1}(S)}a$ and $n\mathrel{\branch^{-1}(S)}b$. Then there exist $v,w\in S$ such that $v_n = a$ and $w_n = b$. Now either $v \sqsubseteq w$ or $w\sqsubseteq v$ by connexity. In the first case we have
\[ a = v(n) = w[0:m](n) = w|_{0:m}(n) = w(n) = b. \]
In the other case we also get $a=b$, by swapping $v$ and $w$.
\item $\branch^{-1}(S)$ is left total. We have that $\len|_S: S\to \N$ is injective: assume there exist $v,w\in S$ such that $\len(v) = \len(w)$. Then either $v\sqsubseteq w$ or $w\sqsubseteq v$. In the first case $v = w[0:\len(v)] = w[0:\len(w)] = w$, using \ref{treeNodeInequalities} and \ref{initialSliceLemma}. In the other case, we also have $v=w$. 

Now take some $n\in \N$. If $\im(\len|_S) \subseteq (0:n)$, then $S \leq_c (0:n)$ and thus $S$ is finite by \ref{finiteComparisonWithInterval}, which is a contradiction. So $\exists m\in \im(\len|_S) \cap \interval[co]{n, \infty}$ and we can find $t \in S$ such that $\len(t) = m$. Then $t_n$ is defined and $\branch^{-1}(S)(n) = t_n$.
\end{itemize}
Finally we show that $\branch$ and $\branch^{-1}$ are mutual inverses.
\begin{itemize}
\item Take $u\in A^\N$ and $n\in \N$. Then
\begin{align*}
\big(n, u(n)\big) &= \big(n, u|_{0:n}(n)\big) = \big(n, u[0:n](n)\big) \\
&\in u[0:n] \subseteq \bigcup_{k\in \N}u[0:k] = (\branch^{-1}\circ\branch)(u).
\end{align*}
Because $(\branch^{-1}\circ\branch)(u)$ is functional, we have $(\branch^{-1}\circ\branch)(u)(n) = u(n)$. 
Because $n$ was chosen arbitrarily, we have $(\branch^{-1}\circ\branch)(u) = u$.
\item Take $S\in [A^*]$ and $v\in S$. Then $v = \left(\bigcup S\right)[0:\len(v)]$. Indeed their domains match (TODO ref) and for all $n\in (0:\len(v))$, we have $\big(n, v(n)\big) \subseteq \bigcup S$. By functionality of $\bigcup S$, we have
\[ v(n) = \left(\bigcup S\right)(n) = \left(\bigcup S\right)|_{(0:\len(v))}(n) = \left(\bigcup S\right)[0:\len(v)](n), \]
for all $n\in (0:\len(v))$, so $v = \left(\bigcup S\right)[0:\len(v)]$. As
\[ (\branch\circ\branch^{-1})(S) = \setbuilder{\left(\bigcup S\right)[0:n]}{n\in \N}, \]
we have that $v\in (\branch\circ\branch^{-1})(S)$. Conversely, take $w\in (\branch\circ\branch^{-1})(S)$. Then $w = \left(\bigcup S\right)[0:k] = \left(\bigcup S\right)[0:\len(w)]$ (TODO ref). 
\end{itemize}
\end{proof}
TODO review with tools for (and generalise to) partial functions.

\begin{corollary} \label{monotoneSequenceBranch}
Let $\sSet{A, R}$ be relational structure and let $M$ be the set of monotone sequences in $A$. Then the following function
\[ \branch: M \to [T_R]: u \mapsto \setbuilder{u[0:n]}{n\in \N}, \]
which maps sequences in $A$ to their initial segments, is a bijection with inverse
\[ \branch^{-1}: [T_R] \to M: S\mapsto \bigcup S. \]
\end{corollary}

\subsubsection{Well-foundedness of $T_R$}
\begin{proposition}
Let $\sSet{A, R}$ be a relational structure. Then $T_R$ is converse well-founded \textup{if and only if} $R$ is strictly converse well-founded.
\end{proposition}
\begin{proof}
$\boxed{\Rightarrow}$ Consider a subset $X\subseteq A$ and the restricted associated tree $T' = T_R\cap{X^*}$. Now $T'$ has a maximal element $u$ by converse-well-foundedness of $T_R$. Then $u\concat\seq{x} \notin T'$ for all $x\in X$. As $u\concat\seq{x} \in X^*$, this must mean $u\concat\seq{x}\notin T_R$ and thus $\neg\big(u_{-1}Rx\big)$. We conclude that $u_{-1}R\cap X = \emptyset$, which means that $u_{-1}$ is strictly maximal in $X$.

$\boxed{\Leftarrow}$ Consider a subset $S\subseteq T_R$ and construct the set $E \defeq \setbuilder{u_n}{u\in S, n<\len(u)}$. This set has a strictly maximal element by assumption and we can thus find a $u\in S$ and $n<\len(u)$ such that $u_{n}$ is maximal in $E$. We claim that $u$ is maximal in $S$. Indeed, take $v\in S$ such that $u\sqsubseteq v$. Then $\len(u) = n = \len(v)$, for if $\len(u) \neq n$, then there exists $u_{n+1}\in E$ such that $u_nRu_{n+1}$, so $u_{n+1}\in u_nR\cap E$, which means that $u_nR\cap E\neq \emptyset$ and $u_n$ is not strictly maximal. The argument for $\len(v) = n$ is similar.

We then have $u = v[0:\len(u)] = v[0:\len(v)] = v$ by \ref{treeNodeInequalities} and \ref{initialSliceLemma}. So $\big(S\cap u{\sqsubseteq}\big) \subseteq \{u\}$, which means that $u$ is maximal in $S$.
\end{proof}
\begin{corollary} \label{welfoundedACC}
Let $\sSet{A, R}$ be a relational structure. Then $T_R$ terminates if $R$ is strictly converse well-founded.

The converse holds under DC.
\end{corollary}
\begin{proof}
By \ref{treeOrderingLemma}. For the converse, see \ref{ZornEquivalentsDC}.
\end{proof}

\subsubsection{Orders on trees}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure and $T\subseteq A^*$ a tree on $A$. We call
\begin{itemize}
\item the lexicographic order on $T$ the \udef{depth-first} ordering of $T$;
\item the shortlex order on $T$ the \udef{breadth-first} ordering of $T$.
\end{itemize}
\end{definition}

\subsection{Functions for string manipulation}
\subsubsection{Functions on strings}
\begin{definition}
Let $A$ be an alphabet.
\begin{itemize}
\item We define the \udef{$\strInterleave$} function $\strInterleave: A^*\times A^* \to A^*$ recursively by
\[ \strInterleave(u,v) = \begin{cases}
\seq{} & (\len(u) = 0 = \len(v)) \\
u & (\len(v) = 0) \\
v & (\len(u) = 0) \\
\seq{u_0}\concat \seq{v_0}\concat \strInterleave(u[1:], v[1:]) & (\len(u) \neq 0 \neq \len(v))
\end{cases} \]
\item We define the \udef{$\strConcat$} function $\strConcat: \big(A^*\big)^* \to A^*$ recursively by
\[ \strConcat(u) = u_0 \concat \big(\strConcat(u[1:])\big). \]
\end{itemize}
\end{definition}
TODO interleave definition works because $\sqsubseteq$ is well-founded on $A^*\times A^*$.

\subsubsection{Functions on sets of strings}
\begin{definition}
Let $A$ be an alphabet.
\begin{itemize}
\item We define the \udef{$\tailsOf$} function
\[ \tailsOf: A^* \times \powerset(A^*) \to A^*: (t, S) \mapsto \setbuilder{u\in A^*}{t\concat u \in S}. \]
\end{itemize}
\end{definition}

\begin{lemma}
Let $T$ be a tree on an alphabet $A$ and $t\in T$, then $\tailsOf(t, T)$ is a tree.
\end{lemma}
\begin{proof}
Take $v \in \tailsOf(t, T)$ and $u\in A^*$ such that $u\sqsubseteq v$. Then we need to prove that $u\in \tailsOf(t, T)$.

We have $t\concat v \in T$ and $t\concat u \sqsubseteq t\concat v$ by 
\end{proof}



\section{Choice}
TODO: Ultrafilter lemma, Szpilrajn extension theorem

\subsection{The axiom and equivalent formulations}
The axiom of choice deals with the following situation: given a family of (non-empty) sets, we want to be able to pick one element from each set. The axiom of choice posits that this is possible.

The function that takes a set in the family and returns our pick is called a choice function:
\begin{definition}
Let $\mathcal{E}$ be a collection of non-empty sets. A \udef{choice function} is any function
\[ f: \mathcal{E} \to \bigcup \mathcal{E} \]
such that $\forall X\in\mathcal{E}: f(X) \in X$.
\end{definition}

If there is a criterion by which to choose the object, then clearly we can find a choice function, without needing to appeal to the axiom of choice.

For example, if all sets in $\mathcal{E}$ are well-ordered, we can choose the least element from each set. The choice function is then
\[ f = \setbuilder{ (X,x)\in \mathcal{E}\times \bigcup \mathcal{E}}{x\in X \land \forall y \in X: x\leq X }. \]
This is a well defined choice function and we did not need the axiom of choice.

For some collections of sets $\mathcal{E}$ we do need the axiom of choice to find a choice function.

There is a well-known analogy due to Russell: if we have a collection $\mathcal{E}$ of pairs of shoes, it is easy to give a choice function, just always take the left shoe for example. If we have a collection $\mathcal{E}'$ of pairs of socks this choice function does not work. We cannot construct a choice function because the socks are indistinguishable. In order to pick one sock from each pair we need to axiom of choice.

We now properly state the axiom:
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item \textbf{Axiom of choice (AC)}: for any non-empty set of sets $\mathcal{E}$ there is a choice function:
\[ \emptyset \notin \mathcal{E} \implies \exists f \in \left(\mathcal{E} \to \bigcup \mathcal{E}\right): \forall X \in \mathcal{E}: f(X)\in X. \]
\end{enumerate}

\begin{definition}
A set $S$ is a \udef{choice set} for a family of sets $\mathcal{E}$ if
\begin{itemize}
\item $S\subseteq \bigcup \mathcal{E}$;
\item $\forall X \in \mathcal{E}: S\cap X$ is a singleton.
\end{itemize}
\end{definition}

\begin{proposition} \label{proposition:choiceEquivalents}
The following statements are equivalent to the axiom of choice:
\begin{enumerate}
\item The Cartesian product of any family of non-empty sets is non-empty.
\item \textup{Zermelo Postulate} Every family $\mathcal{E}$ of non-empty and pairwise disjoint sets admits a choice set.
\item For every set $A$ the family $\powerset(A)\setminus \emptyset$ admits a choice function.
\item For any sets $A,B$ and binary relation $P\subseteq A\times B$,
\[ \left[\forall x\in A: \exists y \in B: P(x,y)\right] \implies \left[ \exists f\in(A\to B): \forall x\in A: P(x,f(x)) \right].  \]
\end{enumerate}
\end{proposition}

\subsection{Some equivalent theorems}

\begin{theorem} \label{choiceEquivalents}
The following results are equivalent to the axiom of choice:
\begin{enumerate}
\item \undline{Zorn's lemma}: If every chain in a poset $P$ has an upper bound, then $P$ has a maximal element.
\item \undline{Zorn's lemma (dual)}: If every chain in a poset $P$ has an lower bound, then $P$ has a minimal element.
\item \undline{Hypothesis of cardinal comparability}: for all sets $A,B$: $A\leq_c B$ or $B\leq_c A$.
\item \undline{Well-ordering theorem}: every set is well-orderable.
\end{enumerate}
\end{theorem}
TODO: rewrite the first point of the proof using \ref{BourbakiWitt}.
\begin{proof}
We proceed round-robin-style:
\begin{itemize}[leftmargin=2cm]
\item[$\boxed{(\text{AC}) \Rightarrow (1)}$] Assume every chain in a poset $P$ has an upper bound. Let $f$ be a choice function on $\powerset(P)\setminus \emptyset$. We define a function $g: \aleph(P) \to P$ by transfinite recursion as follows:
\[ g(x) = \begin{cases}
f\left( \{\text{upper bounds of $g[\downset\{x\}]$}  \} \setminus g[\downset\{x\}] \right) & \text{(if defined, i.e.\ we are not choosing from $\emptyset$)} \\
f\left( \{\text{upper bounds of $g[\downset\{x\}]$}  \} \right) & (\text{else}).
\end{cases} \]
This is well defined because $g[\downset\{x\}]$ is a chain in $P$ and thus $\{\text{upper bounds of $g[\downset\{x\}]$}  \}$ cannot be empty by assumption, so the second case always works.

By Hartogs' lemma, theorem \ref{HartogsLemma}, the function $g$ cannot be injective, so there exists an $m\in P$ that is the image of multiple elements $x_1,x_2\in\aleph(P)$. Assume $x_1 < x_2$, then $g(x_2)$ must have been defined by the second case in the recursion, meaning $m$ is a maximal element of $P$.
\item[$\boxed{(1) \Leftrightarrow (2)}$] By duality.
\item[$\boxed{(1) \Rightarrow (3)}$] Every chain in the set $(A \not\rightarrowtail B)$ of injective partial functions from $A$ to $B$, ordered by inclusion, is inductive by proposition \ref{inductive}, and thus has a maximal element. If this maximal element is a total function, then $A\leq_c B$. If it is not a total function, it is surjective and we have a bijection from a subset of $A$ to be, i.e.\ $B\leq_c A$.
\item[$\boxed{(3) \Rightarrow (4)}$] Let $A$ be a set. By Hartogs' lemma, theorem \ref{HartogsLemma}, $\aleph(A) \nleq_c A$. By cardinal comparability this implies $A \leq_c \aleph(A)$. The bijection between $A$ and a subset of $\aleph(A)$ determines a well-ordering on $A$.
\item[$\boxed{(4) \Rightarrow (\text{AC})}$] Let $A$ be a set. Then we can define a well-ordering $\leq$ on $A$. We can then define a choice function on $\powerset(A)\setminus \emptyset$ by returning the $\leq$-least member of each subset.
\end{itemize}
\end{proof}

\begin{lemma} \label{surjectiveInverse}
Every surjective function has a right inverse \textup{if and only if} the axiom of choice holds.
\end{lemma}

\begin{definition}
A family of sets $\mathcal{E}$ is of \udef{finite character} if
\[ X\in \mathcal{E} \qquad \iff \qquad \text{every finite subset of $X$ belongs to $\mathcal{E}$.} \]
\end{definition}
An immediate property of families of finite character: for each $X\in \mathcal{E}$, every (finite or infinite) subset of $X$ belongs to $\mathcal{E}$.

\begin{example}
Let $X$ be a set. Then $\powerset(X)$ is a collection of finite character.
\end{example}

\begin{lemma}
Let $\mathcal{E}, \mathcal{E}'$ be collections of finite character. Then $\mathcal{E}\cap \mathcal{E}'$ is of finite character.
\end{lemma}
\begin{proof}
First take $X\in \mathcal{E}\cap \mathcal{E}'$. Then $X$ belongs to $\mathcal{E}$, so every finite subset of $X$ belongs to $\mathcal{E}$. Similarly, $X$ belongs to $\mathcal{E}'$, so every finite subset of $X$ belongs to $\mathcal{E}'$. Thus a finite subset of $X$ belongs to $\mathcal{E}\cap \mathcal{E}'$.

Now suppose every finite subset of $X$ belongs to $\mathcal{E}\cap \mathcal{E}'$. Then every finite subset of $X$ belongs to $\mathcal{E}$ and $X$ belongs to $\mathcal{E}$, since it is of finite character. Similarly $X\in \mathcal{E}'$ and thus $X\in \mathcal{E}\cap\mathcal{E}'$.
\end{proof}

\begin{lemma} \label{finiteCharacterInductive}
Any family of sets $\mathcal{E}$ of finite character ordered by inclusion is inductive.
\end{lemma}
\begin{proof}
Let $S$ be a chain in $\mathcal{E}$, then we claim $\bigcup S \in \mathcal{E}$. Indeed every (finite) subset of $\bigcup S$ is a subset of an element of $S$ and so $\bigcup S\in \mathcal{E}$.
\end{proof}

Some more principles reminiscent of (and equivalent to) Zorn's lemma:
\begin{theorem} \label{ZornEquivalents}
The following results are equivalent to the axiom of choice:
\begin{enumerate}
\item \undline{Teichmller-Tukey lemma}: Every non-empty collection of finite character has a maximal element with respect to inclusion.
\item \undline{Hausdorff maximal principle}: Let $P$ be a poset. Every chain in $P$ is contained in a maximal chain in $P$.
\item \undline{Maximal chain principle}: Every non-empty poset has a maximal chain.
\end{enumerate}
\end{theorem}
The Hausdorff maximal principle is also known as the ``Kuratowski lemma''. The name ``Hausdorff maximal principle'' may be reserved for the specific case where $P$ is a family of sets ordered by inclusion. These formulations are equivalent, by \ref{posetPowerset}.
\begin{proof}
We prove equivalence with Zorn's lemma round-robin-style:
\begin{itemize}[leftmargin=2cm]
\item[$\boxed{(\text{Zorn}) \Rightarrow (1)}$] Assume Zorn's lemma. Let $\mathcal{E}$ be a non-empty collection of finite character, which is partially ordered by inclusion. Because $\mathcal{E}$ is inductive, by lemma \ref{finiteCharacterInductive}, each chain has an upper bound and thus $\mathcal{E}$ has a maximal element.
\item[$\boxed{(1) \Rightarrow (2)}$] Being a chain is a property of finite character. Let $C$ be a chain in $P$. Then the family of all chains in $P$ containing $C$ is a family of finite character and $P$ is contained in the maximal element.
\item[$\boxed{(2) \Rightarrow (3)}$] Take one element in the poset. The set of this element is a chain. By (2) it can be extended to a maximal chain.
\item[$\boxed{(3) \Rightarrow (\text{Zorn})}$] Assume there is a maximal chain and every chain has an upper bound. Any upper bound of a maximal chain is a maximal element.
\end{itemize}
\end{proof}
\begin{corollary} \label{maximalSubsetOfDisjointSets}
Let $\mathcal{E}$ be a set of sets. Then there exists a maximal subset of pairwise disjoint sets. 
\end{corollary}
\begin{proof}
The set of subsets of $\mathcal{E}$ that consist of pairwise disjoint sets is a family of finite character.
\end{proof}

\subsection{Weaker axioms}
\subsubsection{Countable choice}
It is in general clear we can make a finite number of choices, by the definition of the existence quantifier (TODO). The axiom of choice says we can make an arbitrary number of choices. The axiom of countable choice is weaker, it says we can make a countable number of choices. Compare also to point 4. of \ref{proposition:choiceEquivalents}.
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item[(VII')] \textbf{Axiom of countable choice ($\text{AC}_{\N}$)}: for any set $B$ and binary relation $P\subseteq \N\times B$,
\[ [\forall n\in \N: \exists y\in B: P(n,y)] \implies [\exists f\in (\N\to B): \forall n \in \N: P(n,f(n))]. \]
\end{enumerate}

\begin{theorem}[Knig's lemma]
Let $T$ be a finitely branching tree. Then $T$ is locally finite \textup{if and only if} $T$ is terminating.
\end{theorem}
\begin{proof}
TODO safari method (cfr Bolzano-Weierstrass)
\end{proof}

\subsubsection{Dependent choice}
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item[(VII'')] \textbf{Axiom of dependent choice ($\text{DC}$)}: for any left-total binary relation $R$ on a non-empty \emph{set} $A$, there exists a sequence $\seq{a_n}_{n\in \N}$ in $A$ such that
\[ \forall n\in \N: \quad a_n\mathrel{R}a_{n+1}. \]
\end{enumerate}

\begin{definition}
We call such a sequence $\seq{a_n}_{n\in \N}$ an \udef{$R$-linked} sequence.
\end{definition}

TODO: relate to $R$-linked strings.

\begin{lemma} \label{choiceSequenceMonotone}
Let $\sSet{A, R}$ be a relational structure. Every $R$-linked sequence is a monotone function in $\sSet{\N, <} \to \sSet{A, R^+}$.
\end{lemma}
\begin{proof}
TODO \ref{transitiveClosureSequenceLemma}.
\end{proof}

\begin{lemma} \label{freedomFirstElementChoiceSequence}
Over NBG, the following are equivalent:
\begin{enumerate}
\item the axiom of dependent choice;
\item for any left-total binary relation $R$ on a set $A$ and $a\in A$, there exists an $R$-linked sequence starting at $a$.
\end{enumerate}
\end{lemma}
\begin{proof}
$\boxed{(1)\Rightarrow (2)}$ Take $a\in A$. Define $B = aR^+$, i.e.\ the image under the transitive closure.

We have that $R|^B_B$ is left-total on $B$. By the axiom of dependent choice we can find some sequence $\seq{b_n}_{n\in \N}$ in $B$. Now $b_0\in aR^+$, so there exists some finite sequence $u\seq{a, a_1, \ldots, a_n, b_0}$ such that $aRa_1$,  $a_{j}Ra_{j+1}$ for all $j\in 1:n$ and $a_nRb_0$.

Now $u\concat \seq{b_n}_{n\in \N}$ is an $R$-linked sequence starting at $a$.

$\boxed{(2)\Rightarrow (1)}$ Let $A$ be a non-empty set. Then there exists $a\in A$. By assumption there exists an $R$-linked sequence in $A$ starting at $a$, so there exists an $R$-linked sequence in $A$.
\end{proof}

\begin{proposition} \label{ZornEquivalentsDC}
Over NBG, the following are equivalent:
\begin{enumerate}
\item dependent choice;
\item if every chain in a non-empty poset $P$ is finite, then $P$ contains a maximal element;
\item every non-empty pruned tree has an infinite branch;
\item for every tree $T$: if $[T] = \emptyset$, then $\sSet{T,\sqsubseteq}$ is converse well-founded.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ We prove the contrapositive: if $\sSet{P, \leq}$ is a poset without a maximal element, then $P$ contains an infinite chain.

Assume DC and that $P$ has no maximal element. Define ${<} \defeq {\leq} \setminus\id_P$, which is antisymmetric and irreflexive, and thus asymmetric by \ref{asymmetricIrreflexive}. Then $<$ is left total by \ref{maximalElementNotLeftTotal}, and we can find a $<$-linked sequence by DC. The $<$-linked sequence is injective by \ref{choiceSequenceMonotone} and \ref{relationPreservingFunctionFromSemiConnexStructure}. Thus the image of the $<$-linked sequence is an infinite chain.

$(2) \Rightarrow (3)$ Let $T$ be a non-empty pruned tree. Then (2) gives that $T$ contains an infinite chain $C$ by modus tollens. Then closure of $C$ under $\sqsubseteq$ is an infinite branch by \ref{treeOrderingLemma}.

$(3) \Rightarrow (1)$ Let $R$ be a left-total binary relation on a non-empty set $A$. Construct the tree $T_R$ associated to the binary relation. It is pruned by \ref{relationalTreeLemma} and thus $T_R$ has an infinite branch. The infinite branch is well-founded (because $T_R$ is well-founded, \ref{treeOrderingLemma}) and thus a well-ordering, as it is connex \ref{wellOrderedCondition}. As the branch is infinite, we can find an initial segment which is similar to $\N$. Call this similarity $f: \N \to T_R$. Consider the function $n\mapsto f(n+1)_{n}$. This is an $R$-linked sequence.

$(3) \Rightarrow (4)$ We prove the contrapositive of (4). Assume $\sSet{T,\sqsubseteq}$ is not converse well-founded. Then $T$ has a subset $S$ without maximal elements. Then $\downset S$ is a pruned subtree. It contains an infinite branch by (3) and thus so does $T$.

$(4) \Rightarrow (3)$ A non-empty pruned tree is not converse well-founded.
\end{proof}
In light of \ref{treeOrderingLemma}, for any tree $T$ we have that
\[ [T] = \emptyset \qquad\iff\qquad \text{$\sSet{T,\sqsubseteq}$ is converse well-founded.} \]

\url{https://www.cambridge.org/core/journals/canadian-mathematical-bulletin/article/on-the-principle-of-dependent-choices-and-some-forms-of-zorns-lemma/074006AB7FF8461CD119DE504D7AB1A7}
\url{https://math.stackexchange.com/questions/373854/dependent-choice-and-zorns-lemma}

\begin{proposition}
Over NBG, the following are equivalent:
\begin{enumerate}
\item if every well-ordered chain in a poset $P$ is finite and upper bounded, then $P$ has a maximal element;
\item the Lwenheim-Skolem theorem;
\item the Baire category theorem for complete metric spaces.
\end{enumerate}
\end{proposition}


\section{Nets and sequences}
\begin{definition}
Let $(I,\leq)$ be a directed set and $X$ a set. Then a \udef{net} in $X$ is a function $I\to X$. The directed set $I$ is called the \udef{index set}.

A \udef{sequence} is a net with index set $\sSet{\N, \leq}$.
\end{definition}
Note we do \emph{not} require $I$ to be a partial order.

\subsection{Filters and nets}
\subsubsection{From nets to filters}
\begin{lemma} \label{tailsDownwardsDirected}
Let $X$ be a set, $I$ a directed index set and $\seq{x_i}_{i\in I}$ a net in $X$. Then
\[ \Tails(\seq{x_i}_{i\in I}) \defeq \setbuilder[\big]{\setbuilder{x_i}{i \Yright j}}{j\in I} \]
is a downwards directed subset of $\powerset(X)$ that does not contain $\emptyset$.
\end{lemma}
This implies that $\upset \Tails(\seq{x_i}_{i\in I})$ is a proper filter. (TODO ref directed set to filter)
\begin{proof}
Take $A,B\in \Tails(\seq{x_i}_{i\in I})$. If $A = \setbuilder{x_i}{i \Yright a}$ and $B = \setbuilder{x_i}{i \Yright b}$, then we can find some $k\in I$ such that $k \Yright a$ and $k\Yright b$. Then $\setbuilder{x_i}{i \Yright k}$ is a subset of both $A$ and $B$ by transitivity.

By construction it is clear that $\emptyset \notin \Tails(\seq{x_i}_{i\in I})$.
\end{proof}

\begin{definition}
Let $X$ be a set, $I$ a directed index set and $\seq{x_i}_{i\in I}$ a net in $X$. We call
\begin{itemize}
\item $\Tails(\seq{x_i}_{i\in I})$ the \udef{filter base} of $\seq{x_i}_{i\in I}$;
\item the filter generated by $\Tails(\seq{x_i}_{i\in I})$ in $\powerset(X)$ the \udef{associated filter} of $\seq{x_i}_{i\in I}$, which we denote $\TailsFilter(\seq{x_i}_{i\in I})$;
\item the \udef{kernel} of the net the kernel of the associated filter.
\end{itemize}
We have 
\[ \TailsFilter(\seq{x_i}_{i\in I}) = \upset \Tails(\seq{x_i}_{i\in I}). \]
Let $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$ be nets. Then we say that $\seq{x_i}$ and $\seq{y_j}$ are \udef{equivalent nets} if $\TailsFilter\seq{x_i} = \TailsFilter\seq{y_j}$.
\end{definition}

\begin{lemma} \label{imageTailsFilter}
Let $X$ be a set, $I$ a directed index set, $\seq{x_i}_{i\in I}$ a net in $X$ and $f:X\to Y$ a function. Then
\[ \upset f^{\imf\imf}\big(\TailsFilter(\seq{x_i})\big) = \TailsFilter\big(\seq{f(x_i)}\big). \]
\end{lemma}
\begin{proof}
Since $f^{\imf\imf}\big(\Tails(\seq{x_i})\big) = \Tails\big(\seq{f(x_i)}\big)$, the result follows from 
\ref{imageFilterSubbasis} and \ref{tailsDownwardsDirected}.
\end{proof}

\begin{lemma} \label{directednessEquivalentToDownsetsFilter}
Let $I$ be an ordered set and $x: I\to X$ a function. Then
\begin{enumerate}
\item $I$ is directed \textup{if and only if} $\upset\setbuilder[\big]{\upset\{i\}}{i\in I}$ is a filter;
\item if $I$ is directed, then $\id_I$ is a net and $\TailsFilter(\id_I) = \upset\setbuilder[\big]{\upset\{i\}}{i\in I}$;
\item $\TailsFilter(x) = \upset x^{\imf\imf}\Big(\setbuilder[\big]{\upset\{i\}}{i\in I}\Big)$.
\end{enumerate}
\end{lemma}
If $I$ is a proset, (1) follows from \ref{principalDownSetEmbedding}.
\begin{proof}
(1) First assume $I$ is directed. Now take $i,i'\in I$. Then there exists $i^{\prime\prime}\Yright i,i'$, so $i^{\prime\prime} \in \upset\{i\}\cap \upset \{i'\}$ and $\upset\{i^{\prime\prime}\} \subseteq \upset\{i\}\cap \upset \{i'\}$ by transitivity.

Now assume $\upset\setbuilder[\big]{\upset\{i\}}{i\in I}$ is a filter. Take $i,i'\in I$. Then there exists $i^{\prime\prime}$ such that $\upset\{i^{\prime\prime}\} \subseteq \upset\{i\}\cap \upset\{i'\}$. Thus $i^{\prime\prime} \in \upset\{i\}$ and $i^{\prime\prime} \in \upset\{i'\}$, so $i^{\prime\prime} \Yright i,i'$.

(2,3) This follows form the calculation
\begin{align*}
\Tails\seq{x_i} &= \setbuilder[\big]{\setbuilder{\varphi(j')}{j' \Yright j}}{j\in J} \\
&= \setbuilder[\big]{\varphi^\imf\setbuilder{j'}{j \Yright j}}{j\in J} \\
&= \setbuilder[\big]{\varphi^\imf\big(\upset\{j\}\big)}{j\in J} \\
&= \varphi^{\imf\imf}\setbuilder[\big]{\upset\{j\}}{j\in J},
\end{align*}
\end{proof}

\subsubsection{From filters to nets}
\begin{lemma} \label{filterIndex}
Let $X$ be a set and $F\in\powerfilters(X)$ a proper filter. Then
\begin{enumerate}
\item $I_F \defeq \setbuilder{(A,x)\in F\times X}{x\in A}$
is a directed proset when ordered by $(A,x)\precsim (B,y) \iff B\subseteq A$;
\item $I_{A,F} \defeq I_F \times \N$ is a directed poset when ordered by $\big((A,x), k\big) < \big((B,y), l\big) \iff (B\subsetneq A)\lor \Big((B = A) \land (k < l)\Big)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Transitivity and reflexivity follow from the properties of $\subseteq$.

Take $(A,x)$ and $(B,y)$ in $I_F$. Then $A\cap B\in F$ and $A\cap B \neq \emptyset$ because $F$ is proper. So we can find $z\in A\cap B$. Then $(A,x) \precsim (A\cap B,z)$ and $(B,y) \precsim (A\cap B, z)$.

(2) Since $<$ is asymmetric, $\leq$ is antisymmetric and reflexive by construction. Transitivity is straightforward.

Take $\big((A,x), k\big)$ and $\big((B,y), l\big)$ in $I_{A,F}$.
First suppose $A\neq B$. Then $A\cap B\in F$, $A\cap B \neq \emptyset$ because $F$ is proper and $A\cap B \subsetneq A, B$. So we can find $z\in A\cap B$. Then $\big((A,x), k\big) \leq \big((A\cap B,z), 0 \big)$ and $\big((B,y), l\big) \leq \big((A\cap B,z), 0 \big)$.

Now suppose $A = B$. Then set $m \defeq \max\{k,l\}+1$ and we have $\big((A,x), k\big) \geq \big((A,x), m \big)$ and $\big((B,y), l\big) \geq \big((A,x), m \big)$.
\end{proof}

\begin{definition}
Let $X$ be a set, $F\in\powerfilters(X)\setminus\powerset(X)$ and $I_F$ the directed set of $F$ as in \ref{filterIndex}. Then
\begin{itemize}
\item $I_F \to X: (A,x) \mapsto x$ is the \udef{associated net} of $F$;
\item $I_{A,F} \to X: \big((A,x),m\big) \mapsto x$ is the \udef{associated antisymmetric net} of $F$.
\end{itemize}
\end{definition}
We usually opt to work with the associated net, not the associated antisymmetric net, since the construction is easier.

\begin{lemma} \label{tailsFilterIndex}
Let $X$ be a set, $F\in\powerfilters(X)\setminus\powerset(X)$ and $I_F, I_{A,F}$ the directed sets of $F$ as in \ref{filterIndex}. Then
\begin{enumerate}
\item $A = \setbuilder{y}{(B,y) \succsim (A,x)}$ for any $(A,x)\in I_F$;
\item $A = \setbuilder{y}{\big((B,y), n\big) \geq \big((A,x), m\big)}$ for any $\big((A,x), m\big)\in I_{A,F}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) $\boxed{\subseteq}$ For all $a\in A$ we have $(A,a)\succsim (A,x)$.

$\boxed{\supseteq}$ For any $(B,y) \succsim (A,x)$, we have $y\in B\subseteq A$, so $y\in A$.

(2) $\boxed{\subseteq}$ For all $a\in A$ we have $\big((A,a), m+1\big) \geq \big((A,x), m\big)$.

$\boxed{\supseteq}$ Suppose $\big((A,y), n\big) \geq \big((A,x), m\big)$. If $A = B$, then $y\in A$ since $y\in B$. If $A\neq B$, then $B\subsetneq A$, so $y\in B \subsetneq A$.
\end{proof}
\begin{corollary}
Let $X$ be a set and $F\in\powerfilters(X)$. Then $F$ equals
\begin{enumerate}
\item the filter associated to its associated net;
\item the filter associated to its associated antisymmetric net.
\end{enumerate}
\end{corollary}

\subsection{Frequent and eventual sets}
\begin{definition}
Let $\seq{x_i}_{i\in I}$ be a net in a set $X$. Let $S\subseteq X$ be a subset. We say that $S$ is
\begin{itemize}
\item \udef{$\seq{x_i}$-eventual} if $S$ contains some tail set of $\seq{x_i}$;
\item \udef{$\seq{x_i}$-frequent} if $S$ meshes with every tail set of $\seq{x_i}$.
\end{itemize}
Let $K\subseteq I$ be a subset. We call
\begin{itemize}
\item $K$ \udef{eventual} if it is $\id_I$-eventual;
\item $K$ \udef{frequent} if it is $\id_I$-frequent.
\end{itemize}
\end{definition}

\begin{lemma} \label{eventualFrequentInTermsOfFilters}
Let $\seq{x_i}_{i\in I}$ be a net in a set $X$, $S\subseteq X$ a subset and $K\subseteq I$ a subset. Then
\begin{enumerate}
\item $S$ is $\seq{x_i}$-eventual \textup{if and only if} $S\in \TailsFilter\big(\seq{x_i}\big)$;
\item $S$ is $\seq{x_i}$-frequent \textup{if and only if} $S\in \TailsFilter\big(\seq{x_i}\big)^\mesh$;
\item $K$ is eventual \textup{if and only if} $\upset\{i\}\subseteq K$ for some $i\in I$;
\item $K$ is frequent \textup{if and only if} $K\mesh \upset\{i\}$ for all $i\in I$.
\end{enumerate}
\end{lemma}
\begin{proof}
This follows from the definitions and \ref{directednessEquivalentToDownsetsFilter}.
\end{proof}

\begin{lemma} \label{frequentImpliesDirected}
Let $I$ be a directed set and $K\subseteq I$ a subset. If $K$ is frequent, then it is directed. 
\end{lemma}
\begin{proof}
Suppose $K$ is frequent. Take $i,j\in K$. Then there exists $k \Yright i,j$ in $I$. Since $K$ is frequent, we have $K\mesh \upset\{k\}$, so we can find $k'\in K \cap \upset\{k\}$. By transitivity, $k'$ is an upper bound of $i,j$.
\end{proof}

\begin{lemma} \label{eventualComplementNotFrequent}
Let $\seq{x_i}_{i\in I}$ be a net in a set $X$ and $S\subseteq X$ a subset. Then $S$ is $\seq{x_i}$-eventual \textup{if and only if} $S^c$ is not $\seq{x_i}$-frequent.
\end{lemma}
\begin{proof}
Restatement of \ref{complementInIsotoneGrill}, by \ref{eventualFrequentInTermsOfFilters}.
\end{proof}

\begin{lemma} \label{sequenceInfrequentImpliesFinite}
Let $X$ be a set, $\seq{x_n}_{n\in \N}$ a sequence in $X$ and $A\subseteq X$ a subset. If $A$ is not $\seq{x_n}$-frequent, then $A\cap \im(x)$ is finite.
\end{lemma}
\begin{proof}
Suppose $A$ is not $\seq{x_n}$-frequent. Then there exists a tail $\setbuilder{x_k}{k\geq n}$ that is disjoint with $A$. Since $\im(x) = \setbuilder{x_k}{k < n} \cup \setbuilder{x_k}{k\geq n}$, we have
\begin{align*}
A\cap \im(x) &= \big(A \cap \setbuilder{x_k}{k < n}\big) \cup \big(A \cap \setbuilder{x_k}{k \leq n}\big) \\
&= \big(A \cap \setbuilder{x_k}{k < n}\big) \cup \emptyset \\
&= \big(A \cap \setbuilder{x_k}{k < n}\big),
\end{align*}
which is finite.
\end{proof}

\subsection{Subnets}
\subsubsection{AA subnets}
\begin{definition}
Let $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$ be nets. We say $\seq{y_j}$ is an \udef{Aarnes-Andens subnet} or \udef{AA subnet} if $\TailsFilter\seq{x_i} \subseteq \TailsFilter\seq{y_j}$.
\end{definition}

\begin{lemma} \label{AAsubnetEquivalents}
Let $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$ be nets. The following are equivalent:
\begin{enumerate}
\item $\seq{y_j}$ is an AA subnet of $\seq{x_i}$;
\item $\upset x^{\imf\imf}\Big(\upset\setbuilder[\big]{\upset\{i\}}{i\in I}\Big) \subseteq \upset y^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big)$;
\item every $\seq{y_j}$-frequent subset of $X$ is also $\seq{x_i}$-frequent;
\item every $\seq{x_i}$-eventual subset of $X$ is also $\seq{y_j}$-eventual;
\item $y^{\preimf}\big(x^\imf(K)\big)$ is eventual in $J$ for all eventual $K\subseteq I$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Leftrightarrow (2)$ Immediate from \ref{directednessEquivalentToDownsetsFilter}.

$(1) \Leftrightarrow (3)$ Immediate from \ref{eventualFrequentInTermsOfFilters}.

$(3) \Leftrightarrow (4)$  Immediate from \ref{eventualFrequentInTermsOfFilters} and \ref{upwardClosureGrill}:
\begin{align*}
(3) \quad&\iff \TailsFilter(\seq{y_j})^\mesh \subseteq \TailsFilter(\seq{x_i})^\mesh \\
&\iff \TailsFilter(\seq{x_i}) \subseteq \TailsFilter(\seq{y_j}) \\
&\iff\quad (4).
\end{align*}

$(2) \Leftrightarrow (5)$ Immediate from \ref{eventualFrequentInTermsOfFilters} and \ref{upsetPreimageImageGaloisConnection}.
\end{proof}

\subsubsection{Kelley, Willard and frequent subnets}
\begin{definition}
Let $X$ be a set, $\seq{x_i}_{i\in I}$ a net and $J$ a directed set. Let $\varphi: J\to I$ be a function and set $\seq{y_j}_{j\in J} \defeq \seq{(x\circ \varphi)(j)}_{j\in J}$. Then we call $\seq{y_j}_{j\in J}$
\begin{itemize}
\item a \udef{frequent subnet} if $\varphi$ is an embedding and $\varphi$ is an AA subnet of $\id_I$;
\item a \udef{Willard subnet} if $\varphi$ is order-preserving and $\varphi$ is an AA subnet of $\id_I$;
\item a \udef{Kelley subnet} if $\varphi$ is an AA subnet of $\id_I$.
\end{itemize}
\end{definition}

\begin{lemma} \label{indexMappingSubnet}
Let $I,J$ be directed sets and $\varphi: J\to I$ a function. Then the following are equivalent:
\begin{enumerate}
\item $\varphi$ is an AA subnet of $\id_I$;
\item $\upset\setbuilder[\big]{\upset\{i\}}{i\in I} \subseteq \upset \varphi^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big)$;
\item $\upset\varphi^{\preimf\imf}\Big(\setbuilder[\big]{\upset\{i\}}{i\in I}\Big) \subseteq \upset \setbuilder[\big]{\upset\{j\}}{j\in J}$;
\item $\varphi^\preimf(K)$ is eventual for all eventual $K\subseteq I$.
\end{enumerate}
Any of these implies that $\im(\varphi)$ is frequent. If $\varphi$ is order-preserving, then the converse also holds.
\end{lemma}
In all these cases $\im(\varphi)$ is directed, by \ref{frequentImpliesDirected}.
\begin{proof}
(1-4) Straightforward application of \ref{AAsubnetEquivalents} (with \ref{upsetPreimageImageGaloisConnection} for (3)).

(Frequency of $\im(\varphi)$) Since $\im(\varphi) \in \upset \varphi^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big)$, we have $\im(\varphi) \in \setbuilder[\big]{\upset\{i\}}{i\in I}$ from (2). This implies $\im(\varphi)$ is frequent, by \ref{eventualFrequentInTermsOfFilters}.

Now assume $\varphi$ is order-preserving. We will prove point (2). To that end, take $i\in I$. Since $\im(\varphi)$ is frequent, we can take $i'\in \im(\varphi)\cap \upset\{i\}$. Then there exists $j\in J$ such that $\varphi(j) = i'$. Since $\varphi$ is order-preserving, we have
\[ \varphi\big(\upset \{j\}\big) \subseteq \upset \big\{\varphi(j)\big\} = \upset \big\{i'\big\} \subseteq \upset \big\{i\big\}. \]
This proves (2).
\end{proof}


\begin{lemma} \label{subnetImplications}
Let $X$ be a set and $\seq{x_i}_{i\in I}, \seq{y_j}_{j\in J}$ nets. Then each of the following statements implies the next:
\begin{enumerate}
\item $\seq{y_j}$ is a frequent subnet of $\seq{x_i}$;
\item $\seq{y_j}$ is a Willard subnet of $\seq{x_i}$;
\item $\seq{y_j}$ is a Kelley subnet of $\seq{x_i}$;
\item $\seq{y_j}$ is an AA subnet of $\seq{x_i}$.
\end{enumerate} 
\end{lemma}
\begin{proof}
The only implication that requires proof is the last one. Suppose $\seq{y_j}$ is a Kelley subnet of $\seq{x_i}$. Then we can find an AA subnet $\varphi: J\to I$ of $\id_I$. Using \ref{directednessEquivalentToDownsetsFilter}, we calculate
\begin{align*}
\upset\setbuilder[\big]{\upset\{i\}}{i\in I} \subseteq \upset \varphi^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big) \implies& \upset x \Big(\upset\setbuilder[\big]{\upset\{i\}}{i\in I}\Big) \subseteq \upset (x\circ \varphi)^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big) \\
\iff& \upset x \Big(\upset\setbuilder[\big]{\upset\{i\}}{i\in I}\Big) \subseteq \upset y^{\imf\imf}\Big(\setbuilder[\big]{\upset\{j\}}{j\in J}\Big) \\
\iff& \TailsFilter\seq{x_i} \subseteq \TailsFilter\seq{y_j}.
\end{align*}
\end{proof}


\begin{example}
All these notions of subnet are distinct, even with tame index sets:
\begin{itemize}
\item $1,1,2,2,3,3,4,4,\ldots$ is a Willard subnet of $1,2,3,4,\ldots$, but not a frequent subnet;
\item $1,2,3,4,\ldots$ and $2,1,3,4,\ldots$ are Kelley subnets of each other, but neither is a Willard subnet of the other;
\item $1,2,3,4,\ldots$ and $0,2,3,4,\ldots$ are AA subnets of each other, but neither is a Kelley subnet of the other.
\end{itemize}
\end{example}

\begin{example}
The cardinality of the index set of a subnet may be larger than the cardinality of the original index set. For instance, $\R\to \N: x\mapsto \floor{x}$ is a Willard subnet of $\id_\N$.
\end{example}

\begin{proposition} \label{WillardSubnetMeshingNets}
Let $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$ be on a set $X$. If $\TailsFilter\seq{x_i} \amesh \TailsFilter\seq{y_j}$, then there exists a net $\seq{z_k}_{k\in K}$ such that
\begin{enumerate}
\item $\seq{z_k}_{k\in K}$ is a Willard subnet of both $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$;
\item $\TailsFilter\seq{z_k} = \TailsFilter\seq{x_i}\vee \TailsFilter\seq{y_k}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $I\times J$ have the pointwise ordering (i.e.\ $(i,j) \Yleft (i', j')$ iff $i\Yleft i'$ and $j \Yleft j'$). Consider the subset $K = \setbuilder{(i,j)}{x_i = y_j}$ and the function $z: K\to X: (i,j) \mapsto x_i = y_j$. We claim that $\seq{z_k}_{k\in K}$ is a common Willard subnet of $\seq{x_i}$ and $\seq{y_j}$.

First we observe that $K$ is frequent and thus directed by \ref{frequentImpliesDirected}. Indeed, take $(i,j)\in I\times J$. Then there exists $z\in \setbuilder{x_{i'}}{i'\Yright i} \cap \setbuilder{y_{j'}}{j'\Yright j}$. Then there exist $i'\Yright i$ and $j'\Yright j$ such that $x_{i'} = z = y_{j'}$, so $(i',j')\in K \cap \upset\{(i,j)\}$.

To show that $\seq{z_k}$ is a Willard subnet of $\seq{x_i}$, we need to find a suitable $\varphi$. We claim we can take $\proj_1$. Indeed, $z(i,j) = x(i) = (x\circ \proj_1)(i,j)$ and $\proj_1$ is relation preserving. Finally we show that $\proj_1$ is an AA subnet of $\id_I$. By \ref{indexMappingSubnet}, it is enough to prove that $\proj_1^{\imf}(K)$ is frequent, for which we use \ref{eventualFrequentInTermsOfFilters}. Take arbitrary $i\in I$. Now take arbitrary $j\in J$. Since $K$ is frequent, there exists $(i',j')\Yright (i,j)$ in $K$. Then $i'\in \proj_1^\imf(K)\cap \upset \{i\}$.

Showing that $\seq{z_k}$ is a Willard subnet of $\seq{y_j}$ is similar.

(2) By \ref{subnetImplications}, $\seq{z_k}$ is an AA subnet of both $\seq{x_i}$ and $\seq{y_j}$, so $\TailsFilter\seq{x_i} \subseteq \TailsFilter\seq{z_k}$, $\TailsFilter\seq{y_j} = \TailsFilter\seq{z_k}$ and thus $\TailsFilter\seq{x_i}\vee \TailsFilter\seq{y_k}\subseteq \TailsFilter\seq{z_k}$.

Conversely, take arbitrary $(i,j)\in K$ and consider $\setbuilder{x_{i'}}{(i',j')\Yright (i,j)}\in \Tails\seq{z_k}$. Then
\[ \setbuilder{x_{i'}}{i'\Yright i}\cap \setbuilder{y_{j'}}{j'\Yright j} = \setbuilder{x_{i'}}{(i',j')\Yright (i,j)}, \]
so the other inclusion follows from \ref{baseMeetJoinFilters}.
\end{proof}

\begin{proposition} \label{commonSubnetExistence}
Let $\seq{x_i}_{i\in I}$ and $\seq{y_j}_{j\in J}$ be on a set $X$. The following are equivalent:
\begin{enumerate}
\item $\TailsFilter\seq{x_i} \amesh \TailsFilter\seq{y_j}$;
\item $\seq{x_i}$ and $\seq{y_j}$ have a common Willard subnet;
\item $\seq{x_i}$ and $\seq{y_j}$ have a common Kelley subnet;
\item $\seq{x_i}$ and $\seq{y_j}$ have a common AA subnet;
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ By \ref{WillardSubnetMeshingNets}.

$(2) \Rightarrow (3) \Rightarrow (4)$ Immediate from \ref{subnetImplications}.

$(4) \Rightarrow (1)$ Let $\seq{z_k}_{k\in K}$ be an AA subnet of both $\seq{x_i}$ and $\seq{y_j}$. Then $\TailsFilter\seq{x_i} \subseteq \TailsFilter\seq{z_k}$ and $\TailsFilter\seq{y_j} \subseteq \TailsFilter\seq{z_k}$. Thus $\TailsFilter\seq{x_i}\vee \TailsFilter\seq{y_j} \subseteq \TailsFilter\seq{z_k} \subsetneq \powerset(X)$, so $\TailsFilter\seq{x_i} \amesh \TailsFilter\seq{y_j}$ by \ref{joinProperFilter}.
\end{proof}

\begin{proposition}
Let $\seq{x_i}_{i\in I}$ be a net and $\seq{y_j}_{j\in J}$ an AA subnet of $\seq{x_i}$. Then $\seq{y_j}_{j\in J}$ is equivalent to a Willard subnet of $\seq{x_i}$.
\end{proposition}
\begin{proof}
By \ref{commonSubnetExistence} we have $\TailsFilter\seq{x_i} \amesh \TailsFilter\seq{y_j}$, so we can use \ref{WillardSubnetMeshingNets} to construct a Willard subnet $\seq{z_k}_{k\in K}$ of $\seq{x_i}$ with tails filter $\TailsFilter\seq{x_i}\vee \TailsFilter\seq{y_k}$. Since $\TailsFilter\seq{x_i}\subseteq \TailsFilter\seq{y_k}$, we have that $\TailsFilter\seq{z_k} = \TailsFilter\seq{y_k}$ and thus that it is equivalent to $\seq{y_j}$.
\end{proof}

\subsubsection{Subsequences}
\begin{definition}
Let $\seq{x_n}_{n\in \N}$ and $\seq{y_n}_{n\in \N}$ be sequences then $\seq{y_n}$ is called a \udef{subsequence} of $\seq{x_n}$ if it is a frequent subnet. 
\end{definition}

\begin{lemma} \label{subsequenceLemma}
Let $\seq{x_n}_{n\in \N}$ and $\seq{y_n}_{n\in \N}$ be sequences. Then $\seq{y_n}$ is a subsequence \textup{if and only if} there exists a strictly increasing function $\varphi: \N\to \N$ such that $y = x\circ \varphi$.
\end{lemma}
\begin{proof}
By \ref{relationPreservingFunctionFromSemiConnexStructure}, $\varphi$ is strictly increasing iff it is an embedding.
\end{proof}

\begin{lemma} \label{sequenceAAsubnet}
Let $\seq{x_n}_{n\in \N}$ and $\seq{y_n}_{n\in \N}$ be sequences then $\seq{y_n}$ is an AA subnet of $\seq{x_n}$ \textup{if and only if}
\begin{enumerate}
\item $\im(y)\setminus \im(x)$ is finite; and
\item for all $a\in X$, if $x^\preimf(\{a\})$ is finite, then $y^\preimf(\{a\})$ is finite.
\end{enumerate}
\end{lemma}
TODO: extract some lemmas from the proof.
\begin{proof}
$\boxed{\Rightarrow}$ We have $\im(x)\in \TailsFilter\seq{x_n} \subseteq \TailsFilter\seq{y_n}$. Thus there exists $k\in \N$ such that $\setbuilder{y_n}{n\geq k} \subseteq \im(x)$. Then
\begin{align*}
\im(y)\setminus \im(x) &= \big(\setbuilder{y_n}{n < k}\cup\setbuilder{y_n}{n\geq k}\big)\setminus\im(x) \\
&= \big(\setbuilder{y_n}{n < k}\setminus\im(x)\big)\cup\big(\setbuilder{y_n}{n\geq k}\setminus\im(x)\big) \\
&= \setbuilder{y_n}{n\geq k}\setminus\im(x) \\
&\subseteq \setbuilder{y_n}{n\geq k},
\end{align*}
which is finite.

Now suppose $x^\preimf(\{a\})$ is finite. Then we can set $k\defeq \max\big(x^\preimf(\{a\})\big)$ if $x^\preimf(\{a\})$ is non-empty and $k = 0$ otherwise. We have $a\notin \setbuilder{x_n}{n>k}$, so $X\setminus \{a\} \in \TailsFilter\seq{x_n}\subseteq \TailsFilter\seq{y_n}$. Then there exists $k'\in \N$ such that $y^\imf\big(\upset \{k\}\big) = \setbuilder{y_n}{n\geq k'}\subseteq X\setminus \{a\}$, so, by \ref{imagePreimageUniqueness},
\[ \upset\{k\} \subseteq y^\preimf\big(X\setminus \{a\}\big) = \N \setminus y^\preimf(\{a\}). \]
Taking complements yields $y^\preimf(\{a\}) \subseteq \big(\upset\{k\}\big)^c = \setbuilder{n\in \N}{n < k'}$, which is finite.

$\boxed{\Leftarrow}$ Take arbitrary $k\in \N$. We need to show that $\setbuilder{x_n}{n\geq k}\in \TailsFilter\seq{y_n}$. By \ref{differenceProperties}, we have
\begin{align*}
\im(y)\setminus \setbuilder{x_n}{n\geq k} &= \Big(\big(\im(y)\cap \im(x)\big)\setminus \setbuilder{x_n}{n\geq k}\Big) \cup \Big(\im(y)\setminus \big(\im(x) \cup \setbuilder{x_n}{n\geq k}\big)\Big) \\
&\subseteq \big(\im(x)\setminus \setbuilder{x_n}{n\geq k}\big) \cup \big(\im(y)\setminus \im(x)\big),
\end{align*}
which is finite.

For all $a\in \im(x)\setminus \setbuilder{x_n}{n\geq k} \subseteq X\setminus \setbuilder{x_n}{n\geq k}$, we have $\setbuilder{x_n}{n\geq k} \subseteq X\setminus \{a\}$. Thus $\upset\{k\} \subseteq x^\preimf(X\setminus \{a\}) = \N\setminus x^\preimf(\{a\})$ and so $x^\preimf(\{a\}) \subseteq \big(\upset\{k\}\big) = \downset\{k-1\}$, which is finite.

For all $a\in \im(y)\setminus \im(x)$, we have $a\in \im(x)^c$ and so $x^\preimf(\{a\}) = \emptyset$, which is finite. Thus
\begin{align*}
y^\preimf\big(\im(y)\setminus \setbuilder{x_n}{n\geq k}\big) &= \bigcup_{a\in \im(y)\setminus \setbuilder{x_n}{n\geq k}}y^{\preimf}(\{a\}) \\
&\subseteq \bigcup_{a\in \big(\im(x)\setminus \setbuilder{x_n}{n\geq k}\big) \cup \big(\im(y)\setminus \im(x)\big)}y^{\preimf}(\{a\})
\end{align*}
is finite.
Set $k'\defeq \max\Big(y^\preimf\big(\im(y)\setminus \setbuilder{x_n}{n\geq k}\big)\Big)$. Then $\upset \{k'+1\} \subseteq y^\preimf\big(\im(y)\setminus \setbuilder{x_n}{n\geq k}\big)^c$, so
\[ \setbuilder{y_n}{n>k'} = y^\imf\big(\upset\{k+1\}\big) \subseteq \im(y)^c \cup \setbuilder{x_n}{n\geq k}. \]
Since $\setbuilder{y_n}{n>k'} \subseteq \im(y)$, we have $\setbuilder{y_n}{n>k'} \subseteq \setbuilder{x_n}{n\geq k}$ and thus $\setbuilder{x_n}{n\geq k} \in \TailsFilter\seq{y_n}$.
\end{proof}

\begin{proposition} \label{sequenceAAsubnetEquivalentToSubsequence}
Let $\seq{x_n}_{n\in \N}$ and $\seq{y_n}_{n\in \N}$ be sequences such that $\seq{y_n}$ is an AA subnet of $\seq{x_n}$. Then $\seq{y_n}$ is equivalent to some subsequence $\seq{z_n}$ of $\seq{x_n}$.
\end{proposition}
\begin{proof}
By \ref{sequenceAAsubnet}, $\im(y)\setminus \im(x)$ is finite and. Since $x^\preimf\big(\im(y)\setminus \im(x)\big) = \emptyset$, we have that $y^\preimf(\{a\})$ is finite for all $a\in \im(y)\setminus \im(x)$. Thus
\[ y^{\preimf}\big(\im(y)\setminus \im(x)\big) = \bigcup_{a\in \im(y)\setminus \im(x)} y^\preimf(\{a\}) \]
is finite. Set $k \defeq \max\Big(y^{\preimf}\big(\im(y)\setminus \im(x)\big)\Big) + 1$ if $y^{\preimf}\big(\im(y)\setminus \im(x)\big)$ is non-empty and $k\defeq 0$ otherwise.

For all $a\in \setbuilder{y_n}{n\geq k}$, we construct $S_a\subseteq \N$ as follows:
\begin{itemize}
\item if $y^\preimf(\{a\})$ is infinite, then $x^\preimf(\{a\})$ is infinite by \ref{sequenceAAsubnet} and set $S_a \defeq x^\preimf(\{a\})$;
\item if $y^\preimf(\{a\})$ is finite, then $x^\preimf(\{a\})$ is non-empty and we can set $S_a = \big\{\min\big(x^\preimf(\{a\})\big)\big\}$.
\end{itemize}
Now set $S \defeq \bigcup_{a\in \setbuilder{y_n}{n\geq k}}S_a$. We have that $S$ is infinite: suppose, towards a contradiction that $S$ is finite. Then $y^\preimf(\{a\})$ cannot be infinite for any $a\in \setbuilder{y_n}{n\geq k}$. Since no $S_a$ is empty and all $S_a$ are disjoint, we must have that $\setbuilder{y_n}{n\geq k}$ is finite. Set $N \defeq \max_{a\in \setbuilder{y_n}{n\geq k}}\#(y^\preimf(\{a\}))$. Then $\upset\{k\} \subseteq y^\preimf\big(\setbuilder{y_n}{n\geq k}\big)$, so
\[ \upset\{k\} \leq_c y^\preimf\big(\setbuilder{y_n}{n\geq k}\big) = \bigcup_{a\in \setbuilder{y_n}{n\geq k}}y^\preimf(\{a\}) \leq_c \#\big(\setbuilder{y_n}{n\geq k}\big)\cdot N <_c \infty, \]
which is a contradiction. By \ref{increasingEnumeration} we have a strictly increasing enumeration $\varphi: \N\to S$ of $S$. Then $z \defeq x\circ\varphi$ is a subsequence of $\seq{x_n}$. Since $\im(z) = \setbuilder{y_n}{n\geq k}$ and $y^\preimf(\{a\})$ is infinite iff $z^\preimf(\{a\})$ is infinite, we have that $\seq{y_n}$ and $\seq{z_n}$ are AA subnets of each other by 
\ref{sequenceAAsubnet}.
\end{proof}

\begin{proposition} \label{existenceMonotoneSubsequenceConnexRelation}
Let $\sSet{X,R}$ be a connex ordered set. Every sequence $\seq{x_n}$ in $X$ has a monotone subsequence.
\end{proposition}
TODO: we may remove the ordered requirement. Monotone sequence then becomes $R$-linked or $R^\transp$-linked sequence.

TODO: clean up proof.
\begin{proof}
Consider the set $S\defeq \setbuilder{n\in \N}{\forall m > n: \; x_n \Yleft x_m}$.

First suppose $S$ is infinite. Then, by \ref{increasingEnumeration}, there exists an order similarity $\varphi: \N \to S \subseteq \N$. Then $x\circ \varphi$ is a monotone subsequence of $\seq{x_n}$.

Now suppose $S$ is finite. Then $S$ has a maximal element $n_0$. By construction, for all $n>n_0$, we have $\exists m > n: x_n \overline{\Yleft} x_m$. By connexity, this implies $\forall n>n_0: \exists m > n: x_n \Yright x_m$.

Define the function $\varphi$ recursively by $\varphi(0) = n_0$ and $\varphi(n+1) = \min\setbuilder{m>n}{x_n \Yright x_m}$, which exists since $\N$ is well-founded. This $\varphi$ determines a monotone subsequence.
\end{proof}

\begin{proposition} \label{RlinkedSequenceHasStrictSubsequence}
Let $\sSet{X,R}$ be a relational structure and $\seq{x_n}$ an $R$-linked sequence. If $\Tails\seq{x_n}$ does not contain a singleton, then $\seq{x_n}$ has an $R\setminus \id_X$-linked subsequence $\seq{y_n}$ with $\im(x) = \im(y)$.
\end{proposition}
\begin{proof}
The set $\setbuilder{k\in \N}{\big(k > n\big)\land \big(x_k \neq x_{k-1}\big)}$ is non-empty for all $n$. Indeed, suppose it was empty for $n\in \N$, then $x_k = x_{k-1}$ for all $k > n$, so $\seq{x_{n+1+k}}_{k\in \N}$ is $=$-linked. By \ref{TransitiveRlinkedStringSequence}, this implies $x_{n+1+k} = x_{n+1}$ for all $k\in \N$.
Thus $\setbuilder{x_k}{k \geq n+1}$ is a singleton. This is not true by assumption.

We define $\varphi: \N \to \N$ recursively by
\[ \begin{cases}
\varphi(0) = 0 \\
\varphi(n) = \min \setbuilder{k\in \N}{\big(k > \varphi(n-1)\big)\land \big(x_k \neq x_{k-1}\big)}.
\end{cases} \]
By \ref{subsequenceLemma}, this $\varphi$ determines a subsequence $y = x\circ \varphi$, since it is clearly strictly increasing.

We just need to show that $\seq{y_n}$ is $R\setminus \id_X$-linked. Take arbitrary $n\in \N$. For all $k\in \interval[co]{\varphi(n-1), \varphi(n)}$, we have $x_{k} = x_{\varphi(n-1)}$. This is clear for $k = \varphi(n-1)$. For $\varphi(n-1) < k < \varphi(n)$, we have $k\notin \setbuilder{k\in \N}{\big(k > \varphi(n-1)\big)\land \big(x_k \neq x_{k-1}\big)}$, so $x_k = x_{k-1}$. Then \ref{TransitiveRlinkedStringSequence} implies $x_{\varphi(n)-1} = x_{\varphi(n-1)}$. We also have $x_{\varphi(n)-1} \neq x_{\varphi(n)}$ by definition of $\varphi(n)$, so $x_{\varphi(n)-1} \big(R\setminus \id_X\big) x_{\varphi(n)}$. Then we have
\[ y_{n-1} = x_{\varphi(n-1)} = x_{\varphi(n)-1} \mathrel{\big(R\setminus \id_X\big)} x_{\varphi(n)} = y_n.  \]

Finally we show that $\im(x) = \im(y)$. Clearly $\im(y) \subseteq \im(x)$. Now take $x_n \in \im(x)$. Then we can take $n' \defeq \min\setbuilder{k\in\N}{x_k = x_n}$. If $n' = 0$, then $x_n = x_{n'} = x_0 = x_{\varphi(0)} \in \im(y)$. Now suppose $n'\neq 0$.

Clearly $x_{n'-1}\neq x_{n'}$, because otherwise $n'$ would not be minimal. We set $n'' \defeq \max\big(\im(\varphi)\cap \interval{0,n'}\big)$ and we can write $n'' = \varphi(m)$.
It is clear that $n' = \varphi(m+1)$, so $x_n = x_{n'} = x_{\varphi(m+1)} \in \im(y)$.
\end{proof}

\chapter{Fixed points}

\begin{definition}
A monotone mapping $\pi : P \to Q$ on a inductive posets
 is \udef{countably continuous} if for every non-empty, countable chain $S\subseteq P$:
 \[ \pi(\sup S) = \sup\pi[S]. \]
\end{definition}

\begin{definition}
Let $(P,\leq)$ be a poset and $f: P\to P$ a function from $P$ to $P$.
\begin{itemize}
\item A \udef{fixed point} is an element $x^*\in P$ such that
\[ f(x^*) = x^*. \]
\item A \udef{strongly least fixed point} is a fixed point such that
\[ \forall y\in P: f(y)\leq y \implies x^* \leq y. \]
\item The \udef{orbit} of an element $p$ of $P$ is a sequence $\N\to P$ defined recursively:
\begin{align*}
p_0 &= p \\
p_{n+1} &= f(p).
\end{align*}
Sometimes we use orbit to mean the set $\{p_n\in P\;|\; n\in \N\}$.
\end{itemize}
\end{definition}

\begin{theorem}[Continuous least fixed point theorem]
Let $\pi:P\to P$ be a countably continuous, monotone mapping on an inductive poset $(P,\leq)$. Then $\pi$ has a unique strongly least fixed point $x^*\in P$.
\end{theorem}
\begin{proof}
As $P$ is inductive, it has a least element $\bot$. The orbit $\{x_n\in P\;|\; n\in \N\}$ of $\bot$ is a chain: $\bot \leq \pi(\bot)$ and the rest follows by induction on $n$, using the monotonicity of $\pi$. Thus the orbit has a supremum. Let $x^*$ be this supremum.

Then, by countable continuity,
\[ \pi(x^*) = \pi(\sup\{x_n\in P\;|\; n\in \N\}) = \sup\pi[\{x_n\in P\;|\; n\in \N\}] = \sup\{x_{n+1}\in P\;|\; n\in \N\} = x^*. \]

To prove $x^*$ is a strongly least fixed point, let $y\in P$ assume $\pi(y)\leq y$. Then we apply induction on $n$:
\begin{itemize}[leftmargin=3cm]
\item[Basis step] $x_0 = \bot \leq y$.
\item[Induction step] $x_n \leq y \implies x_{n+1} = \pi(x_n)\leq \pi(y) \leq y$.
\end{itemize}
\end{proof}

Iteration lemma.

Fixed point theorem.

Least fixed point theorem.

Hitchhiker's guide:
Knaster-Tarski fixed point; Tarksi fixed point

