\chapter{Ordered sets}
\section{Order relations}
\begin{definition}
All types of orders are transitive.
\begin{itemize}
\item A \udef{preorder} or \udef{quasiorder} $\precsim$ is also reflexive.
\item A \udef{total preorder} is also connex.
\item A \udef{partial order} $\preceq$ is also reflexive and anti-symmetric.
\item A \udef{strict partial order} $\prec$ is also irreflexive (or, equivalently, asymmetric).
\item A \udef{total order} $\leq$ is also reflexive, anti-symmetric and connex. Connex means all elements are comparable.
\item A \udef{strict total order} $<$ is also trichotomous.
\end{itemize}
An \udef{ordered set} is a pair $\sSet{P,\Yleft}$ such that $P$ is a set and $\Yleft$ is an order on $P$. We call this ordered set
\begin{itemize}
\item a \udef{proset} if $\Yleft$ is a preorder;
\item a \udef{poset} if $\Yleft$ is a partial order;
\end{itemize}
\end{definition}

A total preorder is necessarily also reflexive by \ref{connexityConsequences}.

A strict partial order is necessarily also anti-symmetric by \ref{asymmetricIrreflexive} and \ref{asymmetryAntisymmetry} (which is why there is no separate notion of ``strict preorder'').

A strict total order is like a total order that is strict (i.e.\ irreflexive instead of reflexive).  However by \ref{connexityConsequences}, no irreflexive relation can be connex, so we relax the requirement to semi-connexity:
\[ \begin{cases}
\text{transitive} \\ \text{trichotomous}
\end{cases} \iff \begin{cases}
\text{transitive} \\ \text{irreflexive} \\ \text{\textit{semi}-connex}
\end{cases}. \]

If we say $\sSet{P,\Yleft}$ is an ordered set without any other qualifiers, we only assume $\Yleft$ is transitive.

\begin{example}
\begin{itemize}
\item Every equivalence relation is a preorder. Conversely, symmetric preorders are equivalence relations.
\item Let $X$ be a set. Then $\sSet{\powerset(X), \subseteq}$ is a poset.
\item Let $A$ be a set and $\id_A$ the identity relation on $A$. Then $\sSet{A,\id_A}$ is a poset. Such posets are called \udef{discrete posets}. Two elements $x,y\in A$ are comparable if and only if $x=y$.
\item Let $B$ be a set and $\bot\in B$. Then the order $\preceq$ defined by
\[ x \preceq y \defequiv (x=\bot) \lor (x = y) \]
is a partial order. Such posets are called \udef{flat posets}.
\end{itemize}
\end{example}

\begin{lemma}
For any binary homogeneous relation $R$,
\begin{enumerate}
\item the reflexive transitive closure, $R^{+=}$, is a preorder;
\item the left residual, $R\backslash R = \overline{R^\transp;\overline{R}}$ is a preorder.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{orderQuasiEquivalence}
Let $\sSet{X,\Yleft}$ be an ordered set. Then $\Yleft \cap \Yleft^\transp$ is a quasi-equivalence relation.
\end{lemma}

\begin{definition}
We call the quasi-equivalence of \ref{orderQuasiEquivalence} the \udef{associated quasi-equivalence} of $\Yleft$. We denote it $\sim_\Yleft$.
\end{definition}

\begin{lemma} \label{preorderEquivalence}
Let $(P, \precsim)$ be a proset. Then $\precsim \cap \precsim^\transp$ is an equivalence relation.
\end{lemma}

Let $\sSet{P,\Yleft}$ be an ordered set. We can decompose $\Yleft = \Yleft_S \cup \Yleft_A$, as in \ref{symmetricAsymmetricDecomposition}, into a symmetric and asymmetric part.
\begin{itemize}
\item By \ref{asymmetricIrreflexive} an order is strict (i.e.\ irreflexive) if and only if it is asymmetric: $\Yleft_S = E_P$ and $\Yleft_A = \Yleft$.
\item For non-strict partial and total orders we have $\Yleft_S = \id_P$.
\end{itemize}

So we can turn a partial / total order into a strict partial / total order by removing $\id_P$. Conversely, we can turn a strict partial / total order into a partial / total order by adding $\id_P$.

\begin{proposition}
\mbox{}
\begin{enumerate}
\item Let $(P, \precsim)$ be a proset. The relation $\precsim \cap\; \overline{\precsim}^\transp$
is a strict partial order.
\item Let $(P, \preceq)$ be a poset. The relation $\preceq \cap \;\overline{\preceq}^\transp = \preceq \cap\; \overline{\id}_P$
is a strict partial order.
\item Let $(P, \prec)$ be a strict partial order. Then $\prec \cup \id_P$ is a partial order.
\item Let $(P, \leq)$ be a totally ordered set. The relation $\leq \cap\; \overline{\leq}^\transp = \leq \cap\; \overline{\id}_P = \overline{\leq}^\transp$
is a strict total order.
\item Let $(P, <)$ be a strict total order. Then $< \cup \id_P$ is a total order.
\end{enumerate}
Multiple different preorders are associated to the same strict partial orders. For partial and total orders the association is one-to-one.
\end{proposition}

\section{Covering relations}
\begin{definition}
Let $(P,\Yleft)$ be a an order relation and $x,y\in P$. We say $y$ \udef{covers} $x$ if
\begin{itemize}
\item $x\Yleft y$;
\item $x\neq y$
\item $\nexists z\in P\setminus\{x,y\}: x\Yleft z \Yleft y$).
\end{itemize}
We write $x\lessdot y$.
\end{definition}

\begin{lemma}
Let $(P,\Yleft)$ be an ordered set. Let $\Yleft_A$ be the asymmetric part of $\Yleft$. Then $\lessdot = \Yleft_A \cap \overline{\Yleft_A^2}$.
\end{lemma}

\begin{lemma}
Let $P$ be a preordered set. Then $y$ covers $x$ \textup{if and only if} $x\neq y$ and $[x,y] = \{x,y\}$.
\end{lemma}

\subsection{Hasse diagrams}
A \udef{Hasse diagram} is a graphical depiction of an order relation. Each element of the ordered set is a point and points are connected such that:
\begin{enumerate}
\item if $x \Yleft y$, then the point for $x$ is drawn lower than the point for $y$;
\item two elements $x,y$ are connected if $y$ covers $x$ or $x$ covers $y$.
\end{enumerate}

TODO is transitive (reflective) reduction! (+ link Galois)

\begin{lemma}
The Hasse diagrams of partial orders are acyclic due to anti-symmetry.
\end{lemma}

\begin{example}
The power set $\powerset\{a,b,c\}$ can be ordered by the inclusion relation $\subseteq$. The following is a Hasse diagram for this ordered set:
\begin{center}
\begin{tikzcd}
 & \{a,b,c\} & \\
\{a,b\}\ar[ru, dash] & \{a,c\}\ar[u,dash] & \{b,c\}\ar[lu,dash] \\
\{a\} \ar[u,dash] \ar[ru, dash] & \{b\} \ar[lu, dash] \ar[ru, dash] & \{c\} \ar[lu,dash] \ar[u, dash] \\
 & \emptyset \ar[lu, dash] \ar[u, dash] \ar[ru, dash] &
\end{tikzcd}
\end{center}
\end{example}

\section{The dual of an ordered set}
\begin{definition}
For any ordered set $(P, \Yleft)$ the \udef{dual} of $P$ is the ordered set $(P^o, \Yleft^o)$, where $P^o \defeq P$ and $\Yleft^o \defeq \Yleft^\transp = \Yright$.
\end{definition}
This means $\forall a,b\in P: a\Yleft b \iff b\Yleft^o a$.

\begin{lemma}
The dual of an ordered set of a particular type is an ordered set of the same type.
\end{lemma}
\begin{corollary}
All statements about all ordered sets also hold for all duals of ordered sets.
\end{corollary}

\section{Functions on ordered sets}
TODO define for all relations
\begin{definition}
Let $(P, \Yleft_P)$ and $(Q, \Yleft_Q)$ be ordered sets and $f: P\to Q$ a function.
\begin{itemize}
\item $f$ is \udef{order-preserving}, \udef{isotone}, \udef{monotonically increasing} or just \udef{increasing} if $f$ is relation-preserving;
\item $f$ is \udef{order-reversing}, \udef{antitone}, \udef{monotonically decreasing} or just \udef{decreasing} if $f: P\to Q^o$ is relation-preserving;
\item $f$ is \udef{monotone} or \udef{monotonic} if $f$ is relation-preserving as either a function $P\to Q$ or $P\to Q^o$.
\end{itemize}
Similarly we say $f$ is (reverse) order-reflecting or a (reverse) order embedding if $f$ is relation-reflecting or a relation embedding as a function $P\to Q$ (resp. $P\to Q^o$).

The adjectives ``strict'' and ``weak'' can be added to any of these cases to identify whether the (weak, i.e.\ reflexive) order or the associated strict order is meant.
\end{definition}
The concept of order isomorphism (or \udef{similarity}) is similarly inherited. Let $U,V$ be ordered sets. We write $U =_o V$ if $U$ and $V$ are order isomorphic and $U \neq_o V$ if not.

\begin{lemma} \label{antisymmetricOrderPreservationInjective}
Let $P,Q$ be antisymmetric ordered sets and $f: P\to Q$. The following are sufficient conditions for $f$ to be injective:
\begin{enumerate}
\item $f$ is order-reflecting;
\item $f$ is order-preserving, $P$ is semi-connex and $Q$ irreflexive.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) If $f(x) = f(y)$, then $x\preceq y$ and $y\preceq x$, so $x=y$ by anti-symmetry.

(2) Let $f$ be the strict order-preserving function and $x,y\in P$. Assume $f(x)=f(y)$. Assume, towards a contradiction, that $x\neq y$, then either (by semi-connexity) $x<y$ and $f(x) < f(y)$ or $y < x$ and $f(y)<f(x)$. Both cases contradict $f(x)=f(y)$ by irreflexivity.
\end{proof}

\begin{lemma}
Let $f:P\to Q$ be a function between posets. Then
\begin{enumerate}
\item If $f$ preserves strict order, then it is order-preserving.
\item If $f$ is order-reflecting, then it reflects strict order.
\end{enumerate}
If $f$ is injective, the opposite implications also hold.
\end{lemma}
\begin{corollary}
Let $f: P\to Q$ be a function between posets.
\begin{enumerate}
\item If $f$ is an order embedding, then it is a strict order embedding.
\item If $P$ is totally ordered, the converse implication holds as well.
\end{enumerate}
\end{corollary}
\begin{proof}
Use \ref{antisymmetricOrderPreservationInjective}.
\end{proof}

The converse does not hold in general if $P$ is a poset because a strict order embedding between posets is not necessarily injective. A counterexample is
\[
\begin{tikzcd}
& \top & \\
x \ar[ur, dash] & & y \ar[ul, dash] \\
& \bot \ar[ul, dash] \ar[ur, dash] &
\end{tikzcd} \qquad \begin{tikzcd} {} \arrow[rr, "f"] & {}& {}\end{tikzcd} \qquad \begin{tikzcd}
f(\top) \\ f(x) = f(y) \ar[u,dash] \\ f(\bot) \ar[u,dash]
\end{tikzcd}.
\]

\begin{lemma} \label{equivalenceOrderPreservingReflecting}
Let $f:P\to Q$ be a function between totally ordered sets. Then
\begin{enumerate}
\item If $f$ preserves strict order, then it is order-preserving.
\item If $f$ is order-reflecting, then it reflects strict order.
\end{enumerate}
If $f$ is injective, the opposite implications also hold.
\end{lemma}
\begin{proof}
(1) Assume $f$ order-reflecting. Assume $x\leq y$. Either $f(x)\leq f(y)$ or $f(y)\leq f(x)$. If $f(y)\leq f(x)$, then
\[ y\leq x \implies x=y \implies f(x)=f(y) \implies f(x)\leq f(y). \]
So in both cases $f(x)\leq f(y)$.

(2) Assume $f$ preserves strict order. Assume $f(x) < f(y)$. Either $x<y, y<x$ or $x=y$. If either $y<x$ or $x=y$ hold, preservation of strict order yields a contradiction. So $x<y$.

(1') Assume $f$ order-preserving and injective. Assume $f(x)\leq f(y)$. Either $x\leq y$ or $y\leq x$. If $y\leq x$, then
\[ f(y)\leq f(x) \implies f(x)=f(y) \implies x= y \implies x\leq y. \]
So in both cases $x\leq y$.

(2') Assume $f$ is injective reflects strict order. Assume $x < y$. Either $f(x)<f(y), f(y)<f(x)$ or $f(x)=f(y)$. If $f(y)<f(x)$, preservation of strict order yields a contradiction. If $f(x)=f(y)$, injectivity yields a contradiction. So $f(x)<f(y)$.
\end{proof}


\begin{proposition} \label{monotonicityOrderClosure}
Let $\sSet{P,R}$ and $\sSet{Q,\Yleft}$ be relational structures and $f:P\to Q$ a function. Assume $\Yleft$ is a preorder. Then the following are equivalent:
\begin{enumerate}
\item $f$ is relation-preserving;
\item $R;f;\Yleft \subseteq f;\Yleft$;
\item the inverse image of every principal down-set is closed under $R^\transp$;
\item $\Yleft;f^\transp; R \subseteq \Yleft;f^\transp$
\item the inverse image of every principal up-set is closed under $R$.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1 \Rightarrow 2)$ By \ref{relationPreserving} we have $R;f \subseteq f;\Yleft$. Then $R;f;\Yleft \subseteq f;\Yleft^2 \subseteq f;\Yleft$ by transitivity.

$(2 \Rightarrow 1)$ By reflexivity we have $\id_Q \subseteq \Yleft$ and so $R;f \subseteq R;f;\Yleft \subseteq f;\Yleft$. Thus $f$ is relation-preserving by \ref{relationPreserving}.

$(3)$ Is simply a translation of $\forall x: R;f;Sx \subseteq f;Sx$.

$(4)$ Equivalent to (2) by taking transposed and using that $f$ is $\Yleft$-preserving iff $f$ is $\Yleft^\transp$-preserving.

$(3)$ Is simply a translation of $\forall x: xS;f^\transp; R \subseteq xS;f^\transp;f^\transp$.
\end{proof}
\begin{corollary}
If $R$ is reflexive, then we can replace the inclusions by equalities.

If $R$ is a preorder, we have that the following are equivalent:
\begin{enumerate}
\item $f$ is relation-preserving;
\item $\upset f^\imf(\upset A) = \upset f^\imf(A)$ for all $A\subseteq P$.
\end{enumerate}
\end{corollary}

\begin{proposition}
Let $\sSet{P,\leq_P}$ and $\sSet{Q,\leq_Q}$ be posets and $f:P\to Q$ a function. Then $f$ is residuated \textup{if and only if} the inverse image of every principal down-set is a principal down set.
\end{proposition}
Clearly we can replace ``down-set'' with ``up-set'' by considering the dual order.
\begin{proof}
This follows directly from \ref{preimagesGaloisIdentity} and \ref{preorderGaloisIdentity}.
\end{proof}

\begin{definition}
A function $f: P\to P$ on an ordered set $(P,\Yleft)$ into itself is
\begin{itemize}
\item \udef{expansive} if $\forall x\in P: x\Yleft f(x)$;
\item \udef{contractive} if $\forall x\in P: f(x)\Yleft x$.
\end{itemize}
\end{definition}

\begin{lemma}
Let $f:P\to P$ be a function on an ordered set $(P,\Yleft)$. Consider $(P\to P)$ to be ordered by pointwise order. Then the following are equivalent:
\begin{enumerate}
\item $f$ is expansive;
\item $\id_P \Yleft f$;
\item $\graph(f) \subseteq \graph(\Yleft)$.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $f$ is contractive;
\item $f \Yleft \id_P$;
\item $\graph(f) \subseteq \graph(\Yleft^\transp)$.
\end{enumerate}
\end{lemma}

\subsection{Preservation of principal joins and meets}

\begin{proposition} \label{monotonicPreservationPrincipalJoinsMeets}
Let $P, Q$ be ordered sets and $f: P\to Q$ a function. Then the following are equivalent:
\begin{enumerate}
\item $f$ is monotonic;
\item $f$ preserves principal joins:
\[ \forall x\in P: \quad f(x) = f\Big(\bigvee \downset x\Big) = \bigvee f^\imf(\downset x); \]
\item $f$ preserves principal meets:
\[ \forall x\in P: \quad f(x) = f\Big(\bigwedge \upset x\Big) = \bigwedge f^\imf(\upset x). \]
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $x\in P$. We first show that $f(x)$ is an upper bound of $f^\imf(\downset x)$. Indeed, take $y\in \downset x$. Then $y\Yleft x$, so $f(y)\Yleft f(x)$ by monotonicity.

Now it is easy to see that $f(x)$ is a least upper bound: take some other upper bound $z$ of $f^\imf(\downset x)$, then in particular we have $f(x) \Yleft z$.

$(1) \Leftarrow (2)$ Take $x\Yleft y \in P$, so $x\in\downset y$. Then $f(y) = \bigvee f^\imf(\downset y)$, so in particular $f(x) \Yleft f(y)$.

$(1) \Leftrightarrow (3)$ This is dual to $(1) \Leftrightarrow (2)$.
\end{proof}

\subsection{Closure}

\subsubsection{Moore closure}
\begin{definition}
Let $A$ be a set.
\begin{itemize}
\item A \udef{(Moore) closure} is a monad on the poset $\sSet{\powerset(A), \subseteq}$.
\item A \udef{(Moore) dual closure} is a comonad on the poset $\sSet{\powerset(A), \subseteq}$.
\end{itemize}
\end{definition}

\begin{example}
Let $\sSet{A,R}$ be a relational structure. Then
\[ \Closure_R: \powerset(A) \to \powerset(A): X \mapsto (X^{R})^{R^\transp} \]
is a closure due to \ref{polarsGaloisConnection}.
\end{example}


\begin{proposition}
Let $A$ be a set and $f: \powerset(A) \to \powerset(A)$ a function. Then $f$ is a closure \textup{if and only if} $f$ is
\begin{itemize}
\item extensive: $\forall X\subseteq A: X \subseteq f(X)$;
\item isotone: $\forall X,Y\subseteq A: $ if $X \subseteq Y$, then $f(X) \subseteq f(Y)$;
\item idempotent: $\forall X\subseteq A:  f(f(X)) = f(X)$.
\end{itemize}
And $f$ is a dual closure \textup{if and only if} $f$ is
\begin{itemize}
\item contractive: $\forall X\subseteq A: X \supseteq f(X)$;
\item isotone: $\forall X,Y\subseteq A: $ if $X \subseteq Y$, then $f(X) \subseteq f(Y)$;
\item idempotent: $\forall X\subseteq A:  f(f(X)) = f(X)$.
\end{itemize}
\end{proposition}
The contents of this proposition is often given as the definition of a (Moore) closure.
\begin{proof}
Sufficiency $\Rightarrow$ is clear. In particular extensivity/contractivity follows from \ref{preorderGaloisCondition}.

Upper adjoint can be taken to be $\id_{\im(f)}$.
\end{proof}



The family of saturated sets is a Moore family. The For any $x\in P$, the downset $\downset x$ is saturated.

\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set and let $f:P \to P$ be a function. We say $f$ is a \udef{(Moore) closure} on $P$ if it is
\begin{itemize}
\item extensive: $x \Yleft f(x)$;
\item monotone: if $A \Yleft B$, then $\Closure(A) \Yleft \Closure(B)$;
\item idempotent: $\Closure(\Closure(A)) = \Closure(A)$.
\end{itemize}
We say $f$ is a \udef{dual closure} if it is
\begin{itemize}
\item contractive: $f \leq \id$
\item monotone
\item idempotent
\end{itemize}
\end{definition}

\begin{definition}
Let $A$ be a subset of an ordered set $P$. If $A = (A^u)^l$, the $A$ is called \udef{saturated}.
\end{definition}

\begin{definition}
Let $\sSet{A, R}$ be a relational structure. We say a set $X\subseteq A$ is \udef{$R$-closed} if $X_R \subseteq X$.
\end{definition}

\begin{lemma}
Let $\sSet{A, R}$ be a relational structure. A set $X\subseteq A$ is $R$-closed \textup{if and only if} $X^c \subseteq X^{\overline{R}}$.
\end{lemma}
\begin{proof}
We have $X_R \subseteq X \iff X^c \subseteq (X_R)^c = X^{\overline{R}}$.
\end{proof}

\begin{proposition}
Let $\sSet{A,R}$ be a relational structure.
\begin{enumerate}
\item For all $X\subseteq A$, the $R$-closure $\Closure_R(X)$ is $R$-closed.
\item The closure function $\Closure_R$ is identical to the function
\[ \powerset(A) \to \powerset(A): X\mapsto \bigcap \setbuilder{Y}{X \subseteq Y \subseteq A \;\text{and $Y$ is $R$-closed}}. \]
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have $\Closure_R(X)_R = X_R$ due to the generalised inverses of \ref{imagePreimageGaloisConnection}.

(2) 
\end{proof}
\begin{lemma}
Every Moore closure is an $R$-closure for some homogeneous relation $R$.
\end{lemma}

\begin{proposition}
Let $L$ be a lattice and $f$ a closure. Then $f[L]$ is a lattice with lattice operations given by
\[ a\wedge b = a\wedge_L b, \qquad a\vee b = f(a\vee_L b). \]
\end{proposition}
\begin{proof}
Take $a,b\in f[L]$. Because $f$ is extensive, we have $a\wedge_L b \leq f(a\wedge_L b)$ and because $f$ is monotone, we have $f(a\wedge_L b)\leq f(a)\wedge_L f(b)$ by \ref{orderPreservingFunctionLatticeOperations}, so
\[ f(a)\wedge_L f(b) = a\wedge_L b \leq f(a\wedge_L b) \leq f(a)\wedge_L f(b), \]
meaning that $a\wedge_L b \in f[L]$ and thus $f[L]$ is a $\wedge$-subsemilattice.

From $a\vee_L b \leq f(a\vee_L b)$, it is clear that $f(a\vee_L b)$ is an upper bound of $\{a,b\}$. Let $c$ be any other upper bound in $f[L]$. Clearly $a\vee_L b \leq c$, so $f(a\vee_L b) \leq f(c) = c$, meaning $f(a\vee_L b)$ is the least upper bound in $f[L]$.
\end{proof}
\begin{proposition} \label{completeLatticeOperationsUnderClosure}
Let $L$ be a complete lattice and $f$ a closure. Then $f[L]$ is a complete lattice with lattice operations given by
\[ \bigwedge A = {\bigwedge}_L A, \qquad \bigvee A = f({\bigvee}_L A). \]
\end{proposition}
\begin{proof}
TODO
\end{proof}

\begin{theorem}[Dedekind-MacNeille]
Every ordered set $E$ can be embedded in a Dedekind complete lattice $L$ such that meets and joins that exist in $E$ are preserved in $L$.
\end{theorem}
\begin{proof}
We use the closure $f: \powerset(E) \to \powerset(E): A\mapsto A^{ul}$.
\end{proof}

\subsubsection{Closure under a relation}

\begin{proposition}
Let $\sSet{P, \leq}$ be a partially ordered set and $\sSet{Q, \leq}$ a complete meet semi-sublattice. Then $\upset: P \to \powerset(Q)$ and $\bigwedge: \powerset(Q) \to P$ are antitone generalised inverses. 
\end{proposition}


\begin{definition}
Let $R$ be a homogeneous binary relation on a set $X$. Let $A\subseteq X$ be a subset.
\begin{itemize}
\item We call $A$ \udef{$R$-closed} if $AR \subseteq A$.
\item We define the \udef{$R$-closure} of $A$ in $X$ as
\[ \Closure_R(A) \defeq \bigcap \setbuilder{B}{A \subseteq B \subseteq X \land \;\text{$B$ is $R$-closed}}. \]
\end{itemize}
\end{definition}

\begin{proposition} \label{RclosureIsClosure}
Let $R$ be a homogeneous binary relation on a set $X$ and $A\subseteq X$ a subset. Then $\Closure_R$ is a proper closure operator:
\begin{enumerate}
\item $A \subseteq \Closure_R(A)$;
\item if $A\subseteq B$, then $\Closure_R(A) \subseteq \Closure_R(B)$;
\item $\Closure(\Closure(A)) = \Closure(A)$;
\end{enumerate}
and
\begin{enumerate} \setcounter{enumi}{3}
\item $\Closure_R(A)$ is $R$-closed;
\item $\Closure_R(A)$ is the smallest $R$-closed superset of $A$ in the poset $\sSet{\powerset(X),\subseteq}$;
\item $A$ is $R$-closed \textup{if and only if} $A = \Closure_R(A)$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) This is clear.

(2) This follows because $\setbuilder{C}{A \subseteq C \subseteq X \land \;\text{$C$ is $R$-closed}} \supseteq \setbuilder{C}{B \subseteq C \subseteq X \land \;\text{$C$ is $R$-closed}}$.

(3) This follows because $\Closure_R(A) \in \setbuilder{C}{\Closure_R(A) \subseteq C \subseteq X \land \;\text{$C$ is $R$-closed}}$.

(4) We calculate
\begin{align*}
\Closure_R(A)R &= \left(\bigcap \setbuilder{B}{A \subseteq B \subseteq X \land \;\text{$B$ is $R$-closed}}\right)R \\
&\subseteq \bigcap \setbuilder{BR}{A \subseteq B \subseteq X \land \;\text{$B$ is $R$-closed}} \\
&\subseteq \bigcap \setbuilder{B}{A \subseteq B \subseteq X \land \;\text{$B$ is $R$-closed}} = \Closure_R(A).
\end{align*}

(5) Intersection is infimum in $\sSet{\powerset(X),\subseteq}$. (TODO terminology higher??)

(6) The direction $\Leftarrow$ is clear because $\Closure_R(A)$ is $R$-closed. The converse follows from (5).
\end{proof}

\begin{lemma}
Let $R$ be a homogeneous binary relation on a set $X$ and $A\subseteq X$ a subset. Then
\begin{enumerate}
\item $\Closure_R(AR) \subseteq \Closure_R(A)$;
\item $\Closure_R(A) = A \cup \Closure_R(AR)$;
\item $\Closure_R(AR) = \Closure_R(A)R$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We calculate $AR \subset \Closure_R(A)R \subseteq \Closure_R(A)$, using \ref{monotonicityImage} and the fact that $\Closure_R(A)$ is $R$-closed.

(2) The inclusion $\Closure_R(A) \supseteq A \cup \Closure_R(AR)$ is given by \ref{RclosureIsClosure} and point (1).

For the converse it is enough to see that $A \cup \Closure_R(AR)$ is $R$-closed:
\[ \big(A \cup \Closure_R(AR)\big)R = AR \cup \Closure_R(AR)R \subseteq \Closure_R(AR) \subseteq A \cup \Closure_R(AR), \]
where we have used that $\Closure_R(AR)$ is $R$-closed.

(3) First we calculate
\[ \Closure_R(A)R = \big(A \cup \Closure_R(AR)\big)R = AR \cup \Closure_R(AR)R \subseteq \Closure_R(AR)R \subseteq \Closure_R(AR) \]
where we have used point (2) and the fact that $\Closure_R(AR)$ is closed.

For the converse it is enough to prove that $AR \subseteq \Closure_R(A)R$ and $\Closure_R(A)R$ is $R$-closed. The first follows from \ref{monotonicityImage} as does the second, with
\[ \Closure_R(A)R \subseteq \Closure_R(A) \implies \big(\Closure_R(A)R\big)R \subseteq \Closure_R(A)R. \]
\end{proof}

\begin{lemma}
Let $R$ be a homogeneous binary relation on a set $X$. Let $\im_R$ denote the function $\powerset(X) \to \powerset(X): A \mapsto AR$. Then for all $A\subseteq X$:
\[ \Closure_R(A) = \bigcup \Closure_{\im_R}(\powerset(A)). \]
IS THIS TRUE?
\end{lemma}


\subsubsection{Closure under a function}

\begin{lemma}
$\Closure_f(A) = \setbuilder{f(a)}{a\in A}$.

$\Closure_g(A) = \setbuilder{g(a,b)}{a,b\in A}$.
\end{lemma}

TODO $\im$ and $\Closure$.

\section{Subsets of ordered sets}
\subsection{Up and down sets}
\begin{lemma} \label{imageClosureTransitiveRelations}
Let $\sSet{P, \Yleft}$ be an ordered set. Then the closure function $\Closure_{\Yleft}$ equals the image function $\im_{\Yleft^=}$ of the reflexive closure $\Yleft^=$.
\end{lemma}

\begin{definition}
Let $\sSet{P, \Yleft}$ be an ordered set and $Q\subseteq P$. We denote
\begin{itemize}
\item the \udef{upward closure} of $Q$ as $\upset Q \defeq \Closure_{\Yleft}(Q) = Q_{\Yleft} \cup Q$;
\item the \udef{downward closure} of $Q$ as $\downset Q \defeq \Closure_{\Yleft^\transp}(Q) = Q_{\Yleft^\transp} \cup Q$.
\end{itemize}
We call $Q$
\begin{itemize}
\item \udef{upwards closed} or an \udef{up set} if $\upset Q = Q$;
\item \udef{downwards closed} or a \udef{down set} if $\downset Q = Q$.
\end{itemize}
For $x\in P$,
\begin{itemize}
\item $\upset x \defeq \upset\{x\}$ is the \udef{principal up set} generated by $x$;
\item $\downset x \defeq \downset\{x\}$ is the \udef{principal down set} generated by $x$.
\end{itemize}
\end{definition}

\begin{lemma} \label{upwardDownwardClosure}
Let $\sSet{P, \Yleft}$ be an ordered set and $Q\subseteq P$. Then
\begin{enumerate}
\item $Q$ is upwards closed \textup{if and only if} $Q_\Yleft \subseteq Q$;
\item $Q$ is downwards closed \textup{if and only if} $Q_{\Yright} \subseteq Q$;
\end{enumerate}
also
\begin{enumerate} \setcounter{enumi}{2}
\item if $\Yleft$ is a preorder, then $Q_\Yleft = \upset Q$ and $Q_{\Yright} = \downset Q$.
\end{enumerate}
\end{lemma}
\begin{proof}
This follows directly from \ref{imageClosureTransitiveRelations}.
\end{proof}


\begin{lemma} \label{intersectionUpwardsClosedIsUpwardsClosed}
Let $\sSet{P, \precsim}$ be a preordered space and $A,B\subseteq P$. Then $\upset A \cap \upset B$ is upwards closed.
\end{lemma}
\begin{proof}
Take $x\in \upset(\upset A \cap \upset B)$. Then there exists $a\in \upset A$ and $b\in \upset B$ such that $a\precsim x$ and $b\precsim x$. Then $x\in \upset A$ and $x\in \upset B$, so $x\in \upset A \cap \upset B$.
\end{proof}

\begin{lemma} \label{GaloisConnectionOrderClosure}
Let $\sSet{P, \Yleft}$ be an ordered set and $A,B \subset P$. Then
\[ \upset A \mesh B \quad\iff\quad A\mesh \downset B. \]
\end{lemma}
\begin{proof}
Assume $\upset A \mesh B$, then there exists $x\in \upset A \cap B$, which means there exists $y\in A$ and $x\in B$ such that $y\Yleft x$. So $y\in A\cap \downset B$ and thus $A\mesh \downset B$.

The opposite implication is dual.
\end{proof}

\subsection{Upper and lower bounds}

\begin{lemma} \label{upperBoundUpsetLowerBoundDownset}
Let $(P,\Yleft)$ be an ordered set and $S$ a non-empty subset of $P$, then
\begin{enumerate}
\item $\upset S^u \subseteq S^u$ and $(\downset S)^u \subseteq S^u$;
\item $\upset S^u \subseteq S^u$ and $(\upset S)^l \subseteq S^l$.
\end{enumerate}
\end{lemma}
In particular $S^u$ is an up set and $S^l$ a down set.
\begin{corollary} \label{minMaxUpsetDownset}
Let $(P,\Yleft)$ be an ordered set, $x\in P$ and $S$ a non-empty subset of $P$, then
\begin{enumerate}
\item $x \in \max(\downset x)$;
\item $x \in \min(\upset x)$;
\item if $\max(S)\neq \emptyset$, then $\downset S = \downset \max(S)$;
\item if $\min(S)\neq \emptyset$, then $\upset S = \upset \min(S)$.
\end{enumerate}
\end{corollary}


\begin{proposition} \label{supInfPreserveOrder}
Let $(P,\Yleft)$ be an ordered set and $A\subseteq P$. Then
\begin{enumerate}
\item $A^\Yleft \subseteq \sup(A)^\Yleft$;
\item $A^{\Yleft^\transp} \subseteq \inf(A)^{\Yleft^\transp}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We calculate, using the fact that $(-)^\Yleft$ and $(-)^{\Yleft^\transp}$ are generalised inverses and \ref{orderPreservingFunctionLatticeOperations}
\[ A^\Yleft = ((A^\Yleft)^{\Yleft^\transp})^\Yleft \subseteq (A^{\Yleft})^\Yleft \cup ((A^\Yleft)^{\Yleft^\transp})^\Yleft \subseteq \big(A^{\Yleft} \cap (A^\Yleft)^{\Yleft^\transp}\big)^\Yleft = \sup(A)^\Yleft. \]
(2) Dual.
\end{proof}
The proposition is more familiar in the following form:
\begin{corollary}
Let $P$ be a poset and $x\in P$, then
\begin{enumerate}
\item if $a \leq x$ for all $a\in A$, then $\sup(A) \leq x$;
\item if $x \leq a$ for all $a\in A$, then $x\leq \inf(A)$.
\end{enumerate}
\end{corollary}

\subsection{Chains}
\begin{definition}
Let $(PX,\Yleft)$ be an ordered set. A \udef{chain} in $X$ is a linearly ordered (i.e.\ connex) subset $S$ of $X$, i.e.\
\[ \forall x,y\in S: x\Yleft y \lor y\Yleft x. \]

An \udef{antichain} is a subset $A$ such that no two elements of $A$ are comparable.
\end{definition}

\begin{example}
For every $n\in \N$ there exists a chain $\mathbb{n}$ of $n$ elements and an antichain $\overline{\mathbb{n}}$ of $n$ elements:
\[ \mathbb{1}: \begin{tikzcd}
\circ
\end{tikzcd} \qquad \mathbb{2}: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \mathbb{3}: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \hdots \]
\[ \overline{\mathbb{1}}: \begin{tikzcd}
\circ
\end{tikzcd} \qquad \overline{\mathbb{2}}: \begin{tikzcd}
\circ & \circ
\end{tikzcd} \qquad \overline{\mathbb{3}}: \begin{tikzcd}
\circ & \circ & \circ
\end{tikzcd} \qquad \hdots \]
\end{example}

\begin{lemma} \label{boundsFiniteChain}
Let $X$ be an ordered set. If $C$ is a non-empty, finite chain in $X$, then
\begin{enumerate}
\item $\sup(C) \supseteq \max(C) \neq \emptyset$;
\item $\inf(C) \supseteq \min(C) \neq \emptyset$.
\end{enumerate}
\end{lemma}
\begin{proof}
The $\supseteq$-relation is due to \ref{maxSupMinInf}.

The proof that $\max(C)$ is non-empty is by induction on the cardinality of $C$. For the base case, assume $C$ has one element $x$. Then $x \leq x$, so $x\in \max(C)$.

Now assume all chains with one fewer element than $C$ have a maximal element. Pick some $x_0\in C$, then $y = \max(C\setminus \{x_0\})$ exists. We can compare $x_0$ and $y$ because $C$ is a chain. If $x_0 \leq y$, then $\max(C) = y$. If $y \leq x_0$, then $\max(C) = x_0$. This exhausts the possibilities.
\end{proof}

\begin{definition}
An ordered set $X$ is \udef{chain-complete} or \udef{inductive} if every chain in $X$ has a least upper bound.

For any cardinal $\kappa$, we say $X$ is \udef{$\kappa$-chain-complete} or \udef{$\kappa$-inductive} if every chain in $X$ of at most cardinality $\kappa$ has a least upper bound.
\end{definition}

\begin{lemma}
Every inductive poset has a least element.
\end{lemma}
\begin{proof}
The empty set $\emptyset$ is a chain in any poset $P$. Then $\sup(\emptyset) = \min(\emptyset^u) = \min(P)$.
\end{proof}

\begin{example}
The set $\N$ is not inductive, because $\N$ itself does not have a least upper bound.
\end{example}

\begin{proposition} \label{inductive}
Let $A,B$ be sets and $X$ an ordered set. Then the following posets are inductive:
\begin{enumerate}
\item $\powerset(A)$, ordered by inclusion;
\item $(A \not\to B)$, ordered by inclusion;
\item the set of chains in $X$, ordered by inclusion.
\end{enumerate}
\end{proposition}
\begin{proof}
In all cases the least upper bound of a chain $S$ is given by $\bigcup S$.
\end{proof}

\subsection{Intervals}
\begin{definition}
Let $(P,\Yleft)$ be an ordered set and $m,n\in P$. We define
\begin{itemize}
\item the \udef{closed interval} $\interval[c]{m,n} \defeq \setbuilder{k\in P}{m\Yleft k \land k\Yleft n}$;
\item the \udef{open interval} $\interval[o]{m,n} \defeq [m,n]\setminus\{m,n\}$;
\item the \udef{half-open intervals}
\begin{align*}
\interval[co]{m,n} &\defeq \interval{m,n}\setminus\{n\}; \\
\interval[oc]{m,n} &\defeq \interval{m,n}\setminus\{m\}.
\end{align*}
\end{itemize}
We also write $m:n \defeq \interval[co]{m,n}$.
\end{definition}

\begin{lemma} \label{emptyInterval}
Let $(P,\Yleft)$ be an ordered set and $m,n\in P$.
\begin{enumerate}
\item If $m \cancel\Yleft n$, then $[m,n] = \emptyset$.
\item If $\Yleft$ is a preorder, then
\begin{enumerate}
\item $m \cancel\Yleft n$ \textup{if and only if} $[m,n] = \emptyset$;
\item either $[m,n] = \emptyset$ or $\{m,n\} \subseteq [m,n]$.
\end{enumerate}
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We prove by contraposition. Assume $k\in [m,n]$, then $m\Yleft k$ and $k\Yleft n$, so $m\Yleft n$ by transitivity.

(2) (a) The direction $\Rightarrow$ is given by \ref{emptyInterval}. Now assume $m \Yleft n$. Also $m\Yleft m$ and $n \Yleft n$ by reflexivity. So $m,n\in [m,n]$ by definition. This also gives point (b).
\end{proof}


\section{Completeness}
\begin{definition}
An ordered set $P$ is 
\begin{itemize}
\item \udef{order complete} (or simply \udef{complete}) if each subset has a supremum and an infimum;
\item \udef{order $\sigma$-complete} if each countable subset has a supremum and an infimum;
\item \udef{finitely order complete} if each finite subset has a supremum and an infimum;
\item \udef{Dedekind complete} if
\begin{itemize}
\item each non-empty subset that is bounded above has a supremum; and
\item each non-empty subset that is bounded below has an infimum;
\end{itemize}
\item \udef{Dedekind $\sigma$-complete} if
\begin{itemize}
\item each non-empty countable subset that is bounded above has a supremum; and
\item each non-empty countable subset that is bounded below has an infimum.
\end{itemize}
\item \udef{finitely Dedekind complete} if
\begin{itemize}
\item each non-empty finite subset that is bounded above has a supremum; and
\item each non-empty finite subset that is bounded below has an infimum.
\end{itemize}
\end{itemize}
\end{definition}
Some authors use ``order completeness'' to mean what we have called Dedekind completeness.

\begin{example}
The closed unit disk in $\R^2$ with coordinatewise ordering is Dedekind complete, but not order complete and is not a lattice.
\end{example}

\begin{lemma}
Let $P$ be an ordered set that contains a least and a greatest element. Then $P$ is order complete \textup{if and only if} $P$ is Dedekind complete.
\end{lemma}
\begin{proof}
Every set is bounded (by the least and greatest elements).
\end{proof}

\begin{proposition} \label{existenceSupremaInfima}
Let $(P,\precsim)$ be an ordered set. Then the following are equivalent:
\begin{enumerate}
\item $P$ is order complete;
\item each subset of $P$ has a supremum;
\item each subset of $P$ has an infimum;
\item each non-empty subset of $P$ has a supremum and $P$ has a least element;
\item each non-empty subset of $P$ has an infimum and $P$ has a greatest element.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $P$ is Dedekind complete
\item each non-empty set that is bounded above has a supremum;
\item each non-empty set that is bounded below has an infimum.
\end{enumerate}
\end{proposition}
\begin{proof}
We show that (2) and (3) are equivalent. The other assertions then follow simply.

Suppose each subset has a supremum and let $S$ be a subset. Then in particular $S^l$ has a supremum. This supremum of $S^l$ is an infimum of $S$:
\[ \sup(S^l) = (S^l)^u\cap((S^l)^u)^l = (S^l)^u\cap S^l = \inf(S).  \]

The converse is similar.

For equivalence with (3) and (4), we just need to remark that $\sup(\emptyset) = \min(P)$ and $\inf(\emptyset) = \max(P)$.

For Dedekind completeness the argument is similar, we just need to remark that if $S$ is non-empty and bounded below, then $S^l$ is non-empty and bounded above.
\end{proof}
\begin{corollary}
Every complete ordered set has a greatest and least element.
\end{corollary}


\begin{lemma}
The ordered natural numbers $\sSet{\N,\leq}$ are complete.
\end{lemma}
\begin{proof}
Any set of natural numbers has a least element by \ref{proposition:wellOrderingN}. Any non-empty set $S$ of natural numbers that is bounded above, we can take $\max(S) = \min(\N\setminus S)-1$.
\end{proof}

\section{Directed sets}
\begin{definition}
An ordered set $\sSet{D,\Yleft}$ is called
\begin{itemize}
\item \udef{(upwards) directed} if every finite subset has an upper bound;
\item \udef{downwards directed} if every finite subset has a lower bound.
\end{itemize}
Let $(D,\Yleft)$ be a directed set. We call
\begin{itemize}
\item the relation $\Yleft$ a \udef{direction};
\item $D$ \udef{progressive} if $D$ does not contain a maximum.
\end{itemize}

Let $\sSet{P,\Yleft}$ be an ordered set. The set of directed subsets of $P$ is denoted $\directed(P)$.


\end{definition}
Note that directed sets are nonempty: they must contain an upper (or lower) bound of the empty set.

TODO: use $\Closure_\vee$ and $\Closure_\wedge$.

TODO: important note: $\Closure_\vee$ only implies closure under finite $\vee$

\begin{example}
\begin{itemize}
\item Any non-empty chain is directed.
\item An antichain is directed iff it is a singleton.
\end{itemize}
\end{example}

TODO: move:
\begin{proposition}
Let $\{(D_i,\Yleft_i)\}_{i\in I}$ be a family of directed sets. Then $D= \prod_{i\in I}D_i$ is a directed set with direction defined by
\[ (a_i)_{i\in I} \Yleft (b_i)_{i\in I} \iff \forall i\in I: a_i\Yleft_i b_i. \]
The directed set $(D,\Yleft)$ is called a \udef{product direction}.
\end{proposition}

\begin{proposition}
Let $\sSet{D, \Yleft}$ a directed set. Every maximal element in $D$ is a greatest element.
\end{proposition}
\begin{proof}
Let $a\in D$ be a maximal element. Take an arbitrary $x\in D$. By directedness, $\{a,x\}$ has an upper bound, say $c$. Because $a$ is maximal, $a\leq c$ implies $c\leq a$. So $x\leq c\leq a$, which means $a$ is a greatest element.
\end{proof}

\begin{proposition} \label{imageDirectedSet}
Let $\sSet{D,\Yleft_D}, \sSet{P,\Yleft_P}$ be ordered sets and $f: D\to P$ an isotone function. If $D$ is upwards / downwards directed, then $f^{\imf}(D)$ is upwards / downwards directed.
\end{proposition}
\begin{proof}
Assume $D$ upwards directed.

Take some finite subset $S\subseteq f^\imf(D)$. Then there exists a finite subset $S'$ such that $f^\imf(S') = S$. We can find $b\in D$ such that $b$ is an upper bound. By isotonicity, $f(b)$ is an upper bound of $S$.

The proof in the case that $D$ is downwards directed is dual.
\end{proof}

\subsection{Directed-completeness}
\begin{definition}
An ordered set $P$ is called \udef{directed-complete} if every directed subset has a supremum.
\begin{itemize}
\item If $P$ is a poset, then it is called a directed-complete partially ordered set, or \udef{DCPO}.
\item If $A \subseteq P$ is directed, then we may denote $\sup(A)$ as $\dirvee A$.
\item For any cardinal $\kappa$, we say $P$ is \udef{$\kappa$-directed complete} (or a \udef{$\kappa$-DCPO} if $P$ is partially ordered) if every directed subset of at most cardinality $\kappa$ has a supremum.
\end{itemize}
\end{definition}

\begin{proposition}
Let $P$ be a poset and $\kappa$ a cardinal. Then $P$ is a $\kappa$-DCPO \textup{if and only if} $P$ is $\kappa$-inductive.
\end{proposition}
This result uses choice.
\begin{proof}
The direction $\Rightarrow$ is immediate.

Consider the other direction. Let $D$ be a directed set of cardinality $\gamma \leq \kappa$. 
If $\gamma$ is finite, then the result is immediate: the only finite directed sets are principal ideals.

Now suppose $\gamma$ is infinite. Then take an ordinal assignement and derive a cardinal assignment using \ref{cardinalsFromOrdinals}. Then $\gamma$ corresponds to a limit ordinal and so
\[ \gamma = \bigcup_{\alpha < \gamma} \alpha \]
by \ref{supLesserElementsOfLimitPoint}. (TODO rewrite without using cardinal assigment?? Maximal chain of subsets of strictly smaller cardinality?) Now there exists a bijection $f: \gamma \to D$ by assumption and set $D_\alpha \defeq f^\imf(\alpha)$. The family $\{D_\alpha\}_{\alpha\leq\gamma}$ is a familty of subsets of $D$ such that $|D_\alpha| = \alpha < \gamma$ and $\bigcup_{\alpha < \gamma}D_\alpha = D$.


Now by choice we can find an ``upper bound function'' $u$ that maps finite subsets of $D$ to some upper bound of the subset in $D$. WLOG we may assume singletons are mapped to their contents and that $u$ is monotone.

We define $D_\alpha'$ by adding the image of all finite subsets of $D_\alpha$ under $u$. This adds at most a distinct point for each finite subset, so $|D_\alpha'| =_c 2\cdot|D_\alpha| = |D_\alpha|$ by \ref{cardinalityStringsFiniteSubsets}. We claim $D_\alpha'$ is directed. Indeed, take $x,y\in D_\alpha'$. 
We can find finite subsets $F,F'\subseteq D_\alpha$ such that $x = u(F)$ and $y = u(F')$ (if $x\in F_\alpha$, we can take $F = \{x\}$ and if $y\in D_\alpha$, we can take $F'= \{y\}$). Now $u(F\cup F')$ is an upper bound of both $x$ and $y$.

We can now prove the claim by induction on the cardinality $\gamma$. By the induction hypothesis, each $D_\alpha'$ has a supremum $s_\alpha$. These suprema form a chain and $\sup_{\alpha<\gamma}s_\alpha$ exists by $\kappa$-inductivity and is a supremum of $D$.
\end{proof}
TODO: clean up the flow of this proof.

\subsubsection{The way-below relation}
\begin{definition}
Let $P$ be a directed-complete poset and $x,y\in P$. We say $x$ is \udef{way below} $y$, denoted $x \ll y$, if for all directed subsets $D\subseteq P$ such that $y\leq \dirvee D$, there exists $d\in D$ such that $x\leq d$.
\end{definition}

\begin{proposition}
Let $P$ be a directed-complete poset and $x,y,z\in P$. Then
\begin{enumerate}
\item $x \ll y$ implies $x\leq y$;
\item $x\leq y \ll z$ implies $x \ll z$;
\item $x \ll y \leq z$ implies $x\ll z$;
\item $x \ll z$ and $y\ll z$ imply $x\vee y \ll z$, if $x\vee y$ exists;
\item $\bot \ll x$ if $\bot$ exists.
\end{enumerate}
In particular, $\ll$ is transitive.
\end{proposition}
\begin{proof}
(1) This follows by taking $D = \{y\}$, which is directed. 
\end{proof}

\subsubsection{Finite elements}
\begin{definition}
Let $P$ be a dcpo and $x\in P$. Then $x$ is called \udef{finite} if for all directed subsets $S\subseteq P$, we have
\[ x = \dirvee S \quad\implies \quad x\in S. \] 
\end{definition}

\subsection{Preservation of directed joins}
\begin{definition}
Let $B,D$ be ordered sets and $f:B\to D$ a function. Then $f$ is \udef{preserves directed joins} or is \udef{Scott-continuous} if for all directed sets $S$ such that $\dirvee S$ exists, we have
\[ f\big(\dirvee S\big) \;=\; \bigvee f^\imf(S). \]
\end{definition}

\begin{lemma} \label{monotonicDirectedness}
Let $B,D$ be ordered sets, $S\subseteq B$ a directed subset and $f:B\to D$ a function. 
\begin{enumerate}
\item If $f$ preserves directed joins, then $f$ is monotonic.
\item If $f$ is monotonic, then $f^\imf(S)$ is directed.
\end{enumerate}
\end{lemma}
This means that $f$ preserves directed joins iff for all directed sets $S$ such that $\dirvee S$ exists, we have
\[ f\big(\dirvee S\big) \;=\; \dirvee f^\imf(S). \]
\begin{proof}
(1) Instance of \ref{monotonicPreservationPrincipalJoinsMeets}.

(2) Take $x,y\in f^\imf(S)$. Then there exist $a,b\in S$ such that $f(a) = x$ and $f(b) = y$. By directedness of $S$, we can find a $c\in S$ such that $a\leq c$ and $b\leq c$. Then $x \leq f(c)$ and $y \leq f(c)$ by monotonicity.
\end{proof}

\section{Ordered sets of subsets}
\subsection{Refinement}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set and $A,B \subseteq P$. We say $A$ \udef{refines} $B$ (or $A$ is a \udef{refinement} of $B$) if $A\subseteq \upset B$. We write $A \preceq B$.

If $A$ refines $B$ and $B$ refines $A$, we write $A \approx B$ and say $A$ and $B$ are \udef{equally fine}.
\end{definition}

Alternatively, we say $A$ refines $B$ iff
\[ \forall a\in A: \exists b\in B: \; b \Yleft a. \]

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $A,B,C \subseteq P$. Then
\begin{enumerate}
\item if $A$ refines $B$ and $B$ refines $C$, then $A$ refines $C$;
\item if $\Yleft$ is a preorder, then $A$ refines $A$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $A$ refines $B$ and $B$ refines $C$. Then $A \subseteq \upset B$ and $B\subseteq \upset C$, so $\upset B \subseteq \upset\upset C$ and thus $A \subseteq \upset\upset C \subseteq \upset C$.

(2) from  ref TODO.
\end{proof}
\begin{corollary}
Let $\sSet{P,\Yleft}$ be a preordered set.
\begin{enumerate}
\item The relation $\preceq$ is a preorder on $\powerset(P)$.
\item The relation $\approx$ is an equivalence relation.
\end{enumerate}
\end{corollary}
The equivalence relation is the equivalence from \ref{preorderEquivalence}.

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $A \subseteq P$. Then
\begin{enumerate}
\item $A$ is a refinement of $\upset A$;
\item if $\Yleft$ is a preorder, then $A \approx \upset A$;
\item $A \approx B$ implies $\upset A = \upset B$;
\item if $\Yleft$ is a preorder, then $A \approx B$ \textup{if and only if} $\upset A = \upset B$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) is equivalent to $\upset A \subseteq \upset A$.

(2) We need to show that $\upset A$ is refines $A$, i.e.\ $A\subseteq \upset\upset A$. This follows from ref TODO.

(3) Assume $A \approx B$. Then $A \subseteq \upset B$ and $B \subseteq \upset A$. This implies $\upset A \subseteq \upset\upset B \subseteq \upset B$ and $\upset B \subseteq \upset\upset A \subseteq \upset A$.

(4) Assume $\upset A = \upset B$. Then $A$ refines $\upset B$ and $B$ is refines $\upset A$. The result then follows using (2).
\end{proof}

\subsection{Initial segments}
\begin{definition}
Let $(X,\Yleft)$ be an ordered set. An \udef{initial segment} $I$ of $X$ is a downward closed subset.

We write $I \sqsubseteq J$ if $I$ and $J$ are downward closed and $I\subseteq J$.

A \udef{principal initial segment} is a principal down set, i.e.\ an initial segment of the form $\downset\{x\}$ for some $x\in X$.
\end{definition}

\begin{lemma} \label{orderingInitialSegments}
Let $\sSet{X,\Yleft}$ be an ordered set and $x,y\in X$, then
\[ \downset\{x\} \sqsubseteq \downset\{y\} \qquad\iff\qquad x \Yleft y \lor x=y. \]
\end{lemma}
\begin{proof}
$\boxed{\Rightarrow}$ Assume $\downset\{x\} \sqsubseteq \downset\{y\}$, then $x\in \downset\{x\} \subseteq \downset\{y\}$, so $x\Yleft y$ or $x=y$.

$\boxed{\Leftarrow}$ Assume $x \Yleft y$ and $z\in \downset\{x\}$. Then either $z=x$ and thus $z\Yleft y$ or $z\Yleft x$ and $z\Yleft y$ by transitivity. In both cases $z\in \downset\{y\}$. 
\end{proof}
\begin{corollary}
If the order is antisymmetric, then
\[ \downset\{x\} = \downset\{y\} \qquad\iff\qquad x = y. \]
\end{corollary}


\begin{proposition} \label{orderedSetPowerset}
Let $\sSet{X,\Yleft}$ be an ordered set. Then $x\mapsto \downset\{x\}$ is an order embedding of the reflexive closure of $X$ in the principal down sets of $X$ (ordered by $\sqsubseteq$).

If $P$ is a partial order, then the map is bijective and thus an order isomorphism.
\end{proposition}
\begin{proof}
The first part is just \ref{orderingInitialSegments}.

For the second part, $x\mapsto \downset x$ is surjective by definition. For injectivity: the inverse map is given by $Q\mapsto \max(Q)$. This is a function by \ref{minMaxSingletons} and an inverse by \ref{minMaxUpsetDownset}.
\end{proof}

\section{Atoms, density and irreducibility}
\subsection{Join- and meet-density}
\begin{definition}
Let $P$ be a poset and let $Q\subset P$ be a subset. Then $Q$ is called \udef{join-dense} in $P$ if for every $x\in P$, there exists a subset $S\subset Q$ such that $x= \bigvee_P S$.

The dual of join-dense is \udef{meet-dense}.
\end{definition}

\begin{lemma}
Let $P$ be a poset, $Q\subset P$ a subset and $x\in P$. Then
\begin{enumerate}
\item if $Q$ is join-dense, then $x = \bigvee Q\cap \downset\{x\}$;
\item if $Q$ is meet-dense, then $x = \bigwedge Q\cap \upset\{x\}$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By join-density, there exists $S\subseteq Q$ such that $x = \bigvee S$. Now $x$ is an upper bound of $Q\cap \downset\{x\}$, because it is a subset of $\downset\{x\}$. Also $S\subseteq Q\cap \downset\{x\}$, so any upper bound of $Q\cap \downset\{x\}$ is an upper bound of $S$ and thus greater than $x$. This means that $x$ is the least upper bound of $Q\cap \downset\{x\}$.

(2) Dual.
\end{proof}

\subsection{Join- and meet-irreducible elements}
\begin{definition}
Let $P$ be a poset. We call $x\in P$ \udef{join-irreducible} if
\begin{itemize}
\item $x$ is not a least element of $P$,
\item for all $a,b\in P$: $x= a\vee b$ implies $x=a$ or $x=b$.
\end{itemize}
The definition of \udef{meet-irreducible} is dual.

We denote the set of join-irreducible elements in $P$ as $\joinIr(P)$ and the set of meet-irreducible elements in $P$ as $\meetIr(P)$.
\end{definition}

\begin{lemma} \label{joinIrreducibleLemma}
Let $P$ be a poset and $x\in P$ not a least element. Then the following are equivalent:
\begin{enumerate}
\item $x$ is join-irreducible;
\item for all $a,b\in P$: $x= a\vee b$ implies $x \leq a$ or $x \leq b$;
\item for all $a,b\in P$: $x > a$ and $x > b$ implies $x > a\vee b$;
\item for all finite $F\subseteq P$: $x = \bigvee F$ implies $x\in F$.
\end{enumerate}
\end{lemma}

\begin{lemma}
In a finite lattice $L$, an element is join-irreducible if and only if it
has exactly one lower cover.
\end{lemma}

\begin{example}
Consider the lattice $\seq{\N,\lcm, \gcd}$. A non-zero element of $\N$ is join irreducible if and only if it is of the form $p^r$ for some prime $p$ and $r\in\N$.
\end{example}

\begin{proposition}
$x$ is join-irreducible iff $\downset x$ is linearly ordered.
\end{proposition}

TODO: isolated points
link with boundary

\url{http://www.m-hikari.com/ijcms-password2008/9-12-2008/xuluoshanIJCMS9-12-2008.pdf}

\url{http://imar.ro/journals/Revue_Mathematique/pdfs/2015/2/5.pdf}

\url{https://link.springer.com/content/pdf/10.1007/BF01349957.pdf}


\subsection{Atoms}
\subsubsection{Atomic elements}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset.
\begin{itemize}
\item An element $a\in P$ is called an \udef{atom} if $a$ is minimal in $P\setminus\min(P)$.
\item An element $a\in P$ is called a \udef{coatom} if $a$ is maximal in $P\setminus\max(P)$.
\end{itemize}
We denote the set of atoms of $P$ as $\atoms(P)$. The set of coatoms is denoted $\coatoms(P)$.
\end{definition}
If $P$ has a least element $\bot$, then $a$ is an atom if and only if it covers $\bot$.

\begin{lemma} \label{atomsJoinIrriducible}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{enumerate}
\item $\atoms(P) \subseteq \joinIr(P)$;
\item $\coatoms(P) \subseteq \meetIr(P)$;
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $a\in \atoms(P)$. Then $a$ is not a least element of $P$. Assume there exist $x,y\in P$ such that $a = x\vee y$. Then $x,y\in \downset a \subseteq \{\bot, a\}$. If $x= \bot = y$, then $a = \bot$, which is not an atom. So either $x = a$ or $y = a$.

(2) Dual.
\end{proof}


\subsubsection{Atomic and atomistic posets}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{itemize}
\item $P$ is \udef{atomic} if $\forall x\in P\setminus\min(P): \atoms(P)\mesh \downset\{x\}$;
\item $P$ is \udef{coatomic} if $\forall x\in P\setminus\max(P): \coatoms(P)\mesh \upset\{x\}$;
\end{itemize}
also
\begin{itemize}
\item $P$ is \udef{strongly atomic} if $\forall x,y\in P$ the poset $\interval{x,y}$ is atomic;
\item $P$ is \udef{strongly coatomic} if $\forall x,y \in P$ the poset $\interval{x,y}$ is coatomic;
\end{itemize}
and
\begin{itemize}
\item $P$ is \udef{atomistic} if $\atoms(P)$ is join-dense in $L$;
\item $P$ is \udef{coatomistic} if $\coatoms(P)$ is meet-dense in $L$.
\end{itemize}
\end{definition}
Thus ``atomic'' means that every element has an atom under it and ``coatomic'' means that every element has a coatom above it.

\url{https://www.emis.de/journals/PM/51f4/pm51f409.pdf}

\begin{lemma}
Let $\sSet{P,\leq}$ be a poset. Then
\begin{enumerate}
\item if $P$ is atomistic, then $P$ is atomic;
\item if $P$ is strongly atomic and $P$ has a bottom, then $P$ is atomic;
\item if $P$ is coatomistic, then $P$ is coatomic;
\item if $P$ is strongly coatomic and $P$ has a top, then $P$ is coatomic.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Assume $P$ is atomistic and take arbitrary $x\in P\setminus\min(P)$. Then $x = \bigvee \atoms(P)\cap \downset\{x\}$. If $\atoms(P)\cap \downset\{x\}$ were empty, then $x = \bigvee \atoms(P)\cap \downset\{x\}$ would be equal to $\min(P)$, which is not the case. So $\atoms(P)\mesh \downset\{x\}$.

(2) Take arbitrary $x\in P\setminus\min(P)$. Then $\interval{\min(P), x} = \downset\{x\}$ is atomic and thus contains atoms, which are also atoms in $P$.

(3) Dual to (1).

(4) Dual to (2).
\end{proof}

\begin{example}
An atomistic poset is not necessarily strongly atomic. Consider
\[ \begin{tikzcd}[column sep=small, row sep=small]
&&&& {\top} \ar[dddd, dash] \\
&&& {\bullet} \ar[ur, dash] \ar[ddd, dash] & \\
&& {\bullet} \ar[ur, dash] \ar[dd, dash] && \\
& {x} \ar[ur, dotted, no head] \ar[d, dash] &&& \\
{\bullet} \ar[ur, dash] & {\bullet} \ar[r, dotted, no head] & {\bullet} & {\bullet} & {\bullet}
\end{tikzcd} \]
such that there is no element immediately above $x$. Then $\interval{x,\top}$ is not atomic, even though the poset is atomistic.
\end{example}

\section{Combining ordered sets}
\begin{definition}
Let $P,Q$ be ordered sets. Then
\begin{itemize}
\item the \udef{disjoint union} $P\sqcup Q$ is ordered by
\[ x\precsim y \iff \begin{cases}
x,y\in P \;\text{and}\; x\precsim y \\
x,y\in Q \;\text{and}\; x\precsim y
\end{cases} \]
\item the \udef{linear sum} $P\oplus Q$ is the disjoint union ordered by
\[ x\precsim y \iff \begin{cases}
x,y\in P \;\text{and}\; x\precsim y \\
x,y\in Q \;\text{and}\; x\precsim y \\
x\in P \;\text{and}\; y\in Q
\end{cases} \]
\end{itemize}
\end{definition}

\begin{example}
We define $\mathbf{M}_n \defeq \mathbb{1}\oplus \overline{\mathbb{n}} \oplus \mathbb{1}$:
\[ \mathbf{M}_1: \begin{tikzcd}
\circ \ar[d, dash] \\ \circ \ar[d, dash] \\ \circ
\end{tikzcd} \qquad \mathbf{M}_2: \begin{tikzcd}
&\circ \ar[ld, dash] \ar[rd, dash] & \\ \circ \ar[rd, dash] && \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd} \qquad \mathbf{M}_3: \begin{tikzcd}
&\circ \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ \circ \ar[rd, dash]& \circ \ar[d, dash] & \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd} \qquad \hdots \]
\end{example}

\begin{lemma}
For ordered sets taking the disjoint union or linear sum is associative.
\end{lemma}

\begin{lemma}
Let $m,n\in \N$. If $p = m+n$, then $\mathbb{m}\oplus\mathbb{n} = \mathbb{p}$.
\end{lemma}

\begin{definition}
Let $P,Q$ be ordered sets. Then
\begin{itemize}
\item  the standard order on $P\times Q$ is defined by
\[ (x_1,x_2) \precsim (y_1,y_2) \iff x_1\precsim y_1 \;\text{and}\; x_2\precsim y_2 \]
\item the \udef{lexicographic order} on $P\times Q$ is defined by
\[ (x_1,x_2) \precsim (y_1,y_2) \iff (x_1\precsim y_1) \;\text{or}\; (x_1=y_1 \;\text{and}\; x_2\precsim y_2). \]
\end{itemize}
\end{definition}


\chapter{Lattices}
\section{Semilattice}
\begin{definition}
A \udef{semilattice} is an algebraic structure $\sSet{S,\star}$ where $\star$ is a binary operation on the set $S$ satisfying
\begin{itemize}[leftmargin=2.5cm]
\item[\textbf{Associativity}] $x\star (y\star z) = (x\star y) \star z$;
\item[\textbf{Commutativity}] $x \star y = y \star x$;
\item[\textbf{Idempotency}] $x\star x = x$.
\end{itemize}
We call a semilattice \udef{bounded} if it contains an identity $e$ for $\star$. We write $\sSet{S, \star, e}$.
\end{definition}
In other words a semilattice is a commutative idempotent semigroup or commutative band.

\begin{lemma}
Let $(P,\leq)$ be a poset and let $\{x,y,z\}\subseteq P$ be such that each subset has a supremum. Then
\[ \sup\{\sup\{x,y\},z\} = \sup\{x,y,z\} = \sup\{x,\sup\{y,z\}\} \]
and, dually,
\[ \inf\{\inf\{x,y\},z\} = \inf\{x,y,z\} = \inf\{x,\inf\{y,z\}\}. \]
\end{lemma}
\begin{corollary}
Let $(P,\leq)$ be a poset.
\begin{enumerate}
\item If $\sup\{x,y\}$ exists for all $x,y\in P$, then $\sSet{P,\sup}$ is a semilattice.
\item If $\inf\{x,y\}$ exists for all $x,y\in P$, then $\sSet{P,\inf}$ is a semilattice.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{orderSemilattice}
Let $\sSet{S,\star}$ be a semilattice. Define the relations $\leq_1, \leq_2$ on $S$ by
\[ \forall x,y\in S:\qquad x\leq_1 y \; \iff \; x = x\star y \;\iff\; y\leq_2 x. \] 
Then
\begin{enumerate}
\item $\sSet{S,\leq_1}$ is a poset such that $\forall x,y\in S:\; x\star y = \inf_{\leq_1}\{x,y\}$;
\item $\sSet{S,\leq_2}$ is a poset such that $\forall x,y\in S:\; x\star y = \sup_{\leq_2}\{x,y\}$;
\item $\sSet{S,\leq_1}$ and $\sSet{S,\leq_2}$ are dual order structures, i.e.\ $\leq_1 = \leq_2^\transp$.
\end{enumerate}
Also,
\begin{enumerate} \setcounter{enumi}{3}
\item if $S$ has an identity, then it is a greatest element in $S$ w.r.t.\ $\leq_1$ (and a least element in $S$ w.r.t.\ $\leq_2$);
\item if $S$ has an absorbing element, then it is a least element in $S$ w.r.t.\ $\leq_1$ (and a greatest element in $S$ w.r.t.\ $\leq_2$).
\end{enumerate}
\end{proposition}
\begin{proof}
(1) First we prove $\sSet{S,\leq_1}$ is a poset:
\begin{itemize}
\item Reflexivity follows from idempotency.
\item Antisymmetry follows from commutativity:
\[ x\leq_1 y, y\leq_1 x \quad\implies\quad x = x\star y = y \star x = y. \]
\item For transitivity: assume $x\leq_1 y$ and $y\leq_1 z$. This implies $x = x\star y$ and $y = y\star z$, and so $x = x\star (y\star z) = (x\star y) \star z = x\star z$. This implies $x\leq_1 z$.
\end{itemize}
Next we prove that $\forall x,y\in S:\; x\star y = \inf_{\leq_1}\{x,y\}$.

First we note that $x \star y$ is a lower bound of $\{x,y\}$: we have $(x\star y) \leq_1 x$ because $x\star(x\star y) = (x\star x)\star y = x\star y$. Let $u$ be any other lower bound of $\{x,y\}$. Then $u = x\star u = x\star (y\star u) = (x\star y)\star u$. So $u \leq_1 x\star y$, meaning $x\star y$ is the infimum.

(2) Similar to (1).

(3) Immediate.

(4) Let $e\in S$ be an identity. For all $x\in S$, we have $x = x\star e$, so $x\leq_1 e$. This means that $e$ is a $\leq_1$-greatest element.

(5) Let $a$ be an absorbing element. For all $x\in S$, we have $a = a\star x$, so $a\leq_1 x$. This means that $a$ is a $\leq_1$-least element.
\end{proof}

Often we will want to interpret a semilattice as a partially ordered set. This means we need to choose $\leq_1$ or $\leq_2$.
\begin{definition}
Let $\sSet{S,\star}$ be a semilattice. We call $S$
\begin{itemize}
\item a \udef{meet-semilattice} or \udef{$\wedge$-semilattice} if we consider it ordered by $\leq_1$, i.e.\ $x\star y = \inf\{x,y\}$;
\item a \udef{join-semilattice} or \udef{$\vee$-semilattice} if we consider it ordered by $\leq_2$, i.e.\ $x\star y = \sup\{x,y\}$.
\end{itemize}
By convention, we represent the semilattice operation $\star$ of a $\wedge$-semilattice by $\wedge$ and of a $\vee$-semilattice by $\vee$.

We usually denote the identity of a $\wedge$-semilattice by $\top$ and the identity of a $\vee$-semilattice by $\bot$.
\end{definition}

We call a poset $\sSet{P,\leq}$
\begin{itemize}
\item a $\wedge$-semilattice if $\inf\{x,y\}$ exists for all $x,y\in P$;
\item a $\vee$-semilattice if $\sup\{x,y\}$ exists for all $x,y\in P$.
\end{itemize}

\begin{example}
Let $X,Y$ be sets then the set of partial functions $(X\not\to Y)$ ordered by inclusion is a $\wedge$-semilattice.

Take $f,g\in (X\not\to X)$, then
\[ f\wedge g = \setbuilder{(x,y)\in X\times Y}{x\in \dom(f)\cap \dom(g), f(x)=y=g(x)}. \]
Note that $\dom(f\wedge g) \subseteq \dom(f)\cap \dom(g)$.
\end{example}

\subsection{Semilattice homomorphisms}
\begin{proposition} \label{orderPreservingFunctionLatticeOperations}
Let $\sSet{P,\leq}$, $\sSet{Q,\leq}$ be posets and $f: P\to Q$ an order-preserving function.
\begin{enumerate}
\item If $P,Q$ are $\wedge$-semilattices, then
\[  \forall x,y\in P: f(x\wedge y) \leq f(x)\wedge f(y) \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are complete $\wedge$-semilattices, then
\[  \forall D\subseteq P: f(\bigwedge D) \leq \bigwedge f[D] \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are $\vee$-semilattices, then
\[  \forall x,y\in P: f(x\vee y) \geq f(x)\vee f(y) \quad\iff\quad \text{$f$ is order-preserving}. \]
\item If $P,Q$ are complete $\vee$-semilattices, then
\[  \forall D\subseteq P: f(\bigvee D) \geq \bigvee f[D] \quad\iff\quad \text{$f$ is order-preserving}. \]
\end{enumerate} 
\end{proposition}
\begin{proof}
(1) Assume $f(x\wedge y) \leq f(x)\wedge f(y)$. Then $x\leq y$ implies $x = x\wedge y$, which implies $f(x) = f(x\wedge y) \leq f(x)\wedge f(y) \leq f(y)$.

For the converse: From $x\wedge y \leq x$ we get $f(x\wedge y) \leq f(x)$. Similarly $f(x\wedge y) \leq f(y)$. Together this gives $f(x\wedge y) \leq f(x)\wedge f(y)$.

(2) The direction $\Rightarrow$ follows from (1). Assume $f$ order-preserving. Take arbitrary $D\subseteq P$. For all $x\in D$ we have $\bigwedge D \leq x$, so $f(\bigwedge D) \leq f(x)$. This means $f(\bigwedge D)$ is a lower bound of $f[D]$, so $f(\bigwedge D) \leq \bigwedge f[D]$.

(3,4) Similar.
\end{proof}
\begin{corollary}
Let $\sSet{S,\wedge}, \sSet{T, \wedge}$ be a semilattices and $f: S\to T$ a function. If $f$ is a semilattice homomorphism, then it is order-preserving. The converse does not hold in general.
\end{corollary}
\begin{proof}
We just need to show the converse does not hold. TODO
\end{proof}

\begin{lemma}
Let $\sSet{P,\leq}$, $\sSet{Q,\leq}$ be posets and $f: P\to Q$ a bijective order-embedding.
Then $f$ preserves all meets and joins, i.e.\ $\forall D\subseteq P$:
\[ f(\bigwedge D) = \bigwedge f[D] \qquad\text{and}\qquad f(\bigvee D) = \bigvee f[D] \]
if the relevant meets and joins exist.
\end{lemma}
TODO does existence of one side of an equals mean existence of the other???
\begin{proof}
We have already proved an inequality in both cases. By bijectivity we can find a $c\in P$ such that $f(c) = \bigwedge f[D]$. By order-reflection, we have that $c$ is a lower bound of $D$, so $c\leq \bigwedge D$. By order-preservation we have $\bigwedge f[D] = f(c) \leq f(\bigwedge D)$.

The other equality is dual.
\end{proof}
\begin{corollary} \label{orderReversingSimilarityLatticeOperations}
Let $\sSet{P,\leq}$, $\sSet{Q,\leq}$ be posets and $f: P\to Q$ a reverse bijective order-embedding. Then $\forall D\subseteq P$
\[ f(\bigwedge D) = \bigvee f[D] \qquad\text{and}\qquad f(\bigvee D) = \bigwedge f[D] \]
if the relevant meets and joins exist.
\end{corollary}

\begin{proposition}
Let $\sSet{S,\wedge}$ be a semilattice and $X$ a set. Then the pointwise ordering of $(X\to S)$ makes it a semilattice. For all $f,g\in (X\to S)$, the function $f\wedge g$ is defined by
\[ f\wedge g: X\to S: x\mapsto (f\wedge g)(x) = f(x) \wedge g(x). \]
If $S$ is a complete semilattice, then so is $(X\to S)$.
\end{proposition}

\begin{proposition} \label{semilatticeOfSemilatticeHomomorphisms}
Let $\sSet{S,\wedge}, \sSet{T, \wedge}$ be (complete) semilattices. The set of (complete) semilattice homomorphisms is a (complete) subsemilattice of $(S\to T)$.
\end{proposition}
\begin{proof}
We calculate for all $x,y\in S$:
\begin{align*}
(f\wedge g)(x\wedge y) &= f(x\wedge y)\wedge g(x\wedge y) = f(x)\wedge f(y) \wedge g(x) \wedge g(y) \\
&= (f(x)\wedge g(x))\wedge(f(y)\wedge g(y)) = (f\wedge g)(x) \wedge (f\wedge g)(y).
\end{align*}
TODO complete notation.
\end{proof}
TODO link universal algebra.

\subsection{Complete semilattices}
\begin{lemma}
Let $\sSet{S,\wedge}$ be a semilattice. For every finite set $D\subset S$, $\inf(D)$ exists.
\end{lemma}
\begin{definition}
Let $\sSet{S,\wedge}$ be a semilattice. We call $S$ a \udef{complete semilattice} if each subset $D\subseteq S$ has a supremum. We write
\[ \sup(D) = \bigvee D. \]
If we want to emphasise that the supremum of $D$ is taken as a subset of $S$, we write $\bigvee_S D$.
\end{definition}

We of course have dual definitions for $\vee$-semilattices. In this case we consider suprema and write $\sup(D) = \bigvee D$.

\begin{lemma} \label{supInfFiniteSubsetsLattice}
Let $\sSet{S,\wedge}$ be a semilattice and $F\subseteq S$ a finite subset. Then $\bigvee S$ exists. 
\end{lemma}
In particular every finite semilattice is complete.


\begin{theorem}[Knaster-Tarski fixed-point theorem for semilattices] \label{KnasterTarskiSemilattice}
Let $\sSet{S,\wedge}$ be a complete semilattice and $f:S\to S$ an order-preserving map. Then 
\[ \bigwedge \setbuilder{x\in S}{f(x) \leq x} \]
is the least fixed point of $f$.
\end{theorem}
\begin{proof}
Let $P$ be the set of fixed points of $f$. Set $H = \setbuilder{x\in L}{f(x)\leq x}$ and $\alpha = \bigwedge H$. It is clear that $\alpha$ is a lower bound of $P$ because $P \subset H$. So we just need to show that $\alpha$ is a fixed point.

Now $f(\alpha)$ is a lower bound of $H$ due to $f$ being order preserving: for all $x\in H$ we have $\alpha\leq x$, so $f(\alpha) \leq f(x)$ and also $f(\alpha) \leq f(x) \leq x$. So $f(\alpha)\leq \alpha$ because $\alpha$ is the greatest lower bound.

Conversely, $f(f(\alpha)) \leq f(\alpha)$ because $f$ is order preserving. This means $f(\alpha)\in H$, so $f(\alpha)\leq \alpha$. We have thus shown that $\alpha = f(\alpha)$.
\end{proof}


\subsection{Subsets of semilattices}
\subsubsection{Disjoint elements and meshing elements}
TODO compare with set-theoretical definitions.
\begin{definition}
Let $S$ be a $\wedge$-semilattice with absorbing element $\bot$.

We say $x,y\in S$
\begin{itemize}
\item are \udef{disjoint}, denoted $x \perp y$, if $x\wedge y = \bot$;
\item \udef{mesh}, denoted $x\mesh y$, if $x\wedge y \neq \bot$.
\end{itemize}

Let $D, E \subset S$. Then
\begin{itemize}
\item the polar $D^\perp$ is called the \udef{disjoint complement} of $D$;
\item the polar $D^{\mesh}$ is called the \udef{grill} of $D$.
\end{itemize}
\end{definition}

\subsection{Subsemilattices}
\subsubsection{Proper subsemilattices}
\begin{definition}
Let $S$ be a semilattice. A subsemilattice is called \udef{proper} if it does not contain an absorbing element.
\end{definition}

\begin{lemma} \label{properSubsemilatticeLemma}
Let $S$ be a $\wedge$-semilattice with bottom $\bot$ and $D$ a subsemilattice. Then the following are equivalent:
\begin{enumerate}
\item $D$ is proper;
\item $D\amesh D$;
\item $D\subseteq D^\mesh$;
\item $D^\mesh$ is not empty;
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Take arbitrary $a,b\in D$. Then $a\wedge b\in D$ because $D$ is a subsemilattive. Thus $a\wedge b \neq \bot$ because $\bot\notin D$, so $a\mesh b$.

$(2) \Rightarrow (3)$ By \ref{polarsSetRelation}.

$(3) \Rightarrow (4)$ If $D$ is empty, then $D^\mesh = S$, which is not empty (because it contains at least $\bot$). 

If $D$ is not empty, then $D\subseteq D^\mesh$ implies that $D^\mesh$ is not empty.

$(4) \Rightarrow (1)$ Assume $\bot\in D$. Then $D^\mesh \subseteq \{\bot\}^\mesh$ by \ref{antitonicityPolars}. Now $\{\bot\}^\mesh = \emptyset$, which implies that $D^\mesh$ is empty. This contradicts our assumption and we conclude that $D$ is proper.
\end{proof}

\subsubsection{Ordering proper subsemilattices}
\begin{definition}
Let $S$ be a semilattice and $D,E$ subsemilattices. Then we write $D\lhd E$ if $D\subseteq E$ and $E$ is proper.
\end{definition}

\begin{lemma} \label{properGrills}
Let $S$ be a $\wedge$-semilattice and $A\subseteq S$ a subset. Then the following are equivalent:
\begin{enumerate}
\item $A = \emptyset$;
\item $A^\mesh = S$;
\item $\bot \in A^\mesh$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1) \Rightarrow (2)$ Immediate by definition.

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (1)$ Assume $A$ is not empty and $\bot\in A^\mesh$. Then $a\in A$ and we have $a \mesh \bot$, i.e.\ $a\wedge \bot \neq \bot$. This is impossible, so $A$ is empty.
\end{proof}

\begin{proposition}
Let $S$ be a $\wedge$-semilattice and $D,E$ subsemilattices. Assume that $D$ is not empty. Then
\[ D \lhd E \qquad\iff\qquad D\subseteq E \subseteq D^\mesh. \]
\end{proposition}
\begin{proof}
First assume $D \lhd E$. Then $E\subseteq E^\mesh$ by \ref{properSubsemilatticeLemma}. Also $E^\mesh \subseteq D^\mesh$ by \ref{antitonicityPolars}, so $E\subseteq E^\mesh \subseteq D^\mesh$ by transitivity.

Now assume $D\subseteq E \subseteq D^\mesh$. We need to prove that $\bot\notin E$. It is enough to prove that $\bot \notin D^\mesh$. This is given by \ref{properGrills}.
\end{proof}

\subsubsection{Complete sublattices}
TODO: move to subsemilattices??
\begin{proposition} \label{completeSubsemilatticeClosure}
Let $L$ be a complete lattice and $S\subseteq L$ a subset.
\begin{enumerate}
\item If $S$ is closed under arbitrary meets, then
\begin{enumerate}
\item $\iota: S\hookrightarrow L$ is an upper adjoint;
\item its lower adjoint is given by $L\to S: x\mapsto \bigwedge (\upset \{x\} \cap S)$;
\item $S$ with the subset ordering is a complete lattice.
\end{enumerate}
\item If $S$ is closed under arbitrary joins, then
\begin{enumerate}
\item $\iota: S\hookrightarrow L$ is a lower adjoint;
\item its upper adjoint is given by $L\to S: x\mapsto \bigvee (\downset \{x\} \cap S)$;
\item $S$ with the subset ordering is a complete lattice.
\end{enumerate}
\end{enumerate}
\end{proposition}
\begin{proof}
TODO

note: $\iota^{\preimf}(A) = A\cap S$ and compare \ref{GaloisConnectionLatticePreservation}.
\end{proof}

Note: closure under arbitrary meets means having the same top and closure under arbitrary joins means habing the same bottom!! This is because $\bigwedge \emptyset = \top$ and $\bigvee \emptyset = \bot$.

\subsection{Generalised inverse of inf}
\begin{proposition}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset such that $\sSet{S,\leq}$ is a complete $\wedge$-semilattice. Then
\[ f: P \to \powerset(S)^o: x\mapsto \upset x \cap S \qquad\text{and}\qquad g: \powerset(S)^o\to P: D\mapsto \bigwedge_S D \]
are order-preserving generalised inverses. Additionally, they form a Galois connection \textup{if and only if} for all $D\subseteq S$: $\bigwedge_P D$ exists and is equal to $\bigwedge_S D$.
\end{proposition}
\begin{proof}
TODO first part.

Assume for all $D\subseteq S$: $\bigwedge_P D$ exists and $\bigwedge_S D = \bigwedge_P D$. It is enough to verify, for all $x\in P$ and $B\subseteq S$
\[ (\upset x)\cap S \supseteq B \iff x\leq \bigwedge_S B. \]
Assume $(\upset x)\cap S \supseteq B$. Then $\upset x \supseteq B$, so $x \bigwedge_P \leq \bigwedge_P B = \bigwedge_S B$. Conversely, assume $x\leq \bigwedge_S B$. Then $B\subseteq \upset_S\bigwedge_S B \subseteq \upset_S x = \upset x\cap S$.

Assume these functions form a Galois connection. In order to obtain a contradiction, assume there exists a $D\subseteq S$ such that $\bigwedge_P D$ does not exist or is larger than $\bigwedge_S D$ (it can never be smaller). In both cases this means there exists a lower bound $y$ of $D$ in $P$ that is larger than $\bigwedge_S D$.

Then $(\upset y)\cap S \supseteq (\upset \bigwedge_S D)\cap S \supseteq D$, but $y\geq \bigwedge_S D$.
\end{proof}

\subsubsection{Projection onto a complete subsemilattice}
\begin{definition}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset such that $\sSet{S,\leq}$ is a complete $\wedge$-semilattice. Then the \udef{(upper) order projection} on $S$ is the function
\[ P_S^u: P \to S: x\mapsto \bigwedge(\upset x\cap S). \]
\end{definition}

\begin{lemma}
Let $\sSet{P,\leq}$ be a poset and $S\subseteq P$ a subset that is a complete $\wedge$-semilattice. The upper order projection $P_S^u$ is
\begin{enumerate}
\item idempotent;
\item order-preserving.
\end{enumerate}
Also $P_S^u$ is expansive \textup{if and only if} for all $D\subseteq S$: $\bigwedge_S D = \bigwedge_P D$.
\end{lemma}
\begin{proof}
(1) Assume $x\in S$. Then $x\in (\upset x \cap S)$ and $x$ is a lower bound of $(\upset x \cap S)$, so $P_S^u(x) = x$.

(2) Assume $x \leq y$. Then $\upset x \supseteq \upset y$, so $\upset x\cap S \supseteq \upset y\cap S$ and $\bigwedge(\upset x\cap S) \subseteq \bigwedge(\upset y\cap S)$.


\end{proof}



\section{Lattices}
\url{file:///C:/Users/user/Downloads/Gr%C3%A4tzer,%20George%20-%20General%20lattice%20theory-Birkh%C3%A4user%20(2007).pdf}
\url{file:///C:/Users/user/Downloads/R.%20Padmanabhan,%20S.%20Rudeanu%20-%20Axioms%20for%20lattices%20and%20Boolean%20algebras-World%20Scientific%20(2008).pdf}
\begin{definition}
A \udef{lattice} is an algebraic structure $\seq{L,\vee, \wedge}$, where $\vee, \wedge$ are binary operations on the set $L$ such that $\seq{L,\vee}$ and $\seq{L,\wedge}$ are semilattices and $\vee,\wedge$ are linked by the absorption law:
\[ \forall a,b\in L: \; a \vee (a \wedge b) = a = a \wedge (a\vee b). \]
We call
\begin{itemize}
\item $\sSet{L,\vee}$ the \udef{join-semilattice} and $a\vee b$ the \udef{join} of $a$ and $b$;
\item $\sSet{L,\wedge}$ the \udef{meet-semilattice} and $a\wedge b$ the \udef{meet} of $a$ and $b$.
\end{itemize}
We call a lattice \udef{bounded} if both the join- and the meet-semilattice are bounded. We denote
\begin{itemize}
\item the identity of the join-semilattice by $\bot$;
\item the identity of the meet-semilattice by $\top$.
\end{itemize}
We denote the bounded lattice $\sSet{L, \vee, \wedge, \bot, \top}$.
\end{definition}
By \ref{absorptionIdempotency} the absortion law renders the axiom of  idempotency of the semilattices redundant. So we just need that $\seq{L,\vee}$ and $\seq{L,\wedge}$ are commutative semigroups that are linked by the absorption law.

\begin{proposition}
Observations from universal algebra:
\begin{enumerate}
\item Subset closed under $\vee,\wedge$ is sublattice.
\item Product lattices
\item Inverse of homomorphism is homomorphism
\end{enumerate}
\end{proposition}

\begin{example}
\begin{itemize}
\item Let $X$ be a set. Then $\mathcal{P}(X)$ ordered by inclusion is a lattice and $\cup, \cap$ are the corresponding join and meet operations.

In particular, for all $A,B\in \mathcal{P}(X)$:
\begin{enumerate}
\item $\inf\{A,B\} = A\cap B$;
\item $\sup\{A,B\} = A\cup B$.
\end{enumerate}
\item The natural numbers forms a lattice if ordered by division. The meet and join are given by
\[ m\vee n = \lcm\{m,n\} \qquad \text{and}\qquad m\wedge n = \gcd\{m,n\}. \]
\end{itemize}
\end{example}

\subsection{Lattices and order}
As for semilattices, we can equivalently characterise lattices as posets with certain conditions.
\begin{proposition}
Let $L$ be a set.
\begin{enumerate}
\item If $\seq{L,\vee, \wedge}$ is a lattice, then $\seq{L,\leq}$ is a poset such that every two element set has a supremum and an infimum, where
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\vee y = y \]
or, equivalently,
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\wedge y = x. \]
\item If $\seq{L,\leq}$ is a poset such that every two element set has a supremum and an infimum, then $\seq{L,\vee, \wedge}$ is a lattice, where
\[ \forall x,y\in L: \; x\vee y = \sup\{x,y\} \quad \text{and} \quad x\wedge y = \inf\{x,y\}. \]
\end{enumerate}
The order can also be defined by
\[ \forall x,y\in L:\; x\leq y \qquad \iff \qquad x\wedge y = x. \]
\end{proposition}
\begin{proof}
Mostly this follows from \ref{orderSemilattice}. We just need to show the two definitions of order are equivalent. This follows from the absorption law:
\begin{align*}
x\vee y &= y \implies x\wedge y = x\wedge (x\vee y) = x \\
x\wedge y &= x \implies x\vee y = (x\wedge y) \vee y = y.
\end{align*}
\end{proof}

\begin{lemma} \label{orderLatticeLemma}
Let $L$ be a lattice and $a,b,c,d\in L$. If $a\leq b$ and $c\leq d$, then
\[ a\vee c\leq b\vee d \qquad\text{and}\qquad a\wedge c \leq b\wedge d. \]
\end{lemma}
\begin{proof}
If $a\leq b$ and $c\leq d$, then we have
\[ \begin{cases}
a = a\wedge b \\ c = c\wedge d
\end{cases} \quad \text{and} \quad \begin{cases}
b = a\vee b \\ d = c\vee d.
\end{cases}\]
We calculate
\[ (a\vee c)\wedge (b\vee d) = (a\vee c)\wedge (a\vee b\vee c\vee d) = (a\vee c)\wedge ((a\vee c)\vee (b\vee d)) = a\vee c, \]
so $a\vee c\leq b\vee d$.
Similarly
\[ (a\wedge c)\vee (b\wedge d) = (a\wedge b\wedge c\wedge d)\vee (b\wedge d) = ((a\wedge c)\wedge (b\wedge d))\vee (b\wedge d) = b\wedge d, \]
so $a\wedge c \leq b\wedge d$.
\end{proof}
\begin{corollary} \label{orderLatticeCorollary}
Let $L$ be a lattice and $a,b,c,d\in L$. Then
\begin{enumerate}
\item if $a\leq b$ then $a\vee c \leq b \vee c$ and $a\wedge c \leq b\wedge c$;
\item if $a\leq c$ and $b\leq c$, then $a\vee b \leq c$;
\item if $a\leq b$ and $a\leq c$, then $a\leq b\wedge c$.
\end{enumerate}
\end{corollary}

\begin{lemma} \label{cancellationGeneralLattices}
Let $L$ be a lattice and $a,b\in L$. If for all $x\in L$: $a\vee x = b\vee x$ and $a\wedge x = b\wedge x$, then $a = b$.
\end{lemma}
\begin{proof}
Setting $x = a$ gives $a = a\vee b$ and $a = a\wedge b$. Thus $a \leq b$ and $b \leq a$, meaning $a = b$.
\end{proof}

\begin{proposition}[Mini-max theorem]
Let $L$ be a lattice and let $\seq{a_{i,j}}\subset L$ be indexed by $i,j\in \N$. Then
\[ \bigvee_{j=1}^n \left(\bigwedge_{i=1}^m a_{i,j}\right) \leq \bigwedge_{i=1}^m \left(\bigvee_{j=1}^n a_{i,j}\right). \]
\end{proposition}
\begin{proof}
For all $k,l$ we have $a_{k,l}\leq \bigvee_{j=1}^n a_{k,j}$. This implies $\bigwedge_{i=1}^m a_{i,l} \leq \bigwedge_{i=1}^m \left(\bigvee_{j=1}^n a_{i,j}\right)$ for all $l$. Taking the supremum over $l$ gives the result.
\end{proof}
\begin{corollary}[Median inequality]
Let $L$ be a lattice and $a,b,c \in L$, then
\[ (a\wedge b) \vee (b\wedge c) \vee (c\wedge a) \leq (a\vee b)\wedge (b\vee c) \wedge (c\vee a). \]
\end{corollary}
\begin{proof}
Use $a_{i,j} = \begin{pmatrix}
a & b & a \\ b & b & c \\ a & c & c
\end{pmatrix}$.
\end{proof}
\begin{corollary}[Distributive inequalities] \label{distributiveInequality}
Let $L$ be a lattice and $a,b,c \in L$, then
\begin{align*}
(a\wedge b)\vee (a\wedge c) &\leq a\wedge (b \vee c); \\
(a\vee b)\wedge (a\vee c) &\geq a\vee (b \wedge c).
\end{align*}
In particular this also means
\[ c \leq a \implies (a\wedge b)\vee c \leq a\wedge (b\vee c).  \]
\end{corollary}
\begin{proof}
Use $a_{i,j} = \begin{pmatrix}
a & a \\ b & c 
\end{pmatrix}$ and $a_{i,j} = \begin{pmatrix}
a & b \\ a & c 
\end{pmatrix}$. The particular cases follow because in this case $a\wedge c = c$. This statement is self-dual.
\end{proof}
The distributive inequalities are fairly elementary and do not need to be derived from mini-max theorem. 
In fact they are corollary to the following lemma which can be obtained by more elementary means:
\begin{lemma} \label{UpperLowerBoundsMeetJoin}
Let $L$ be a lattice $x\in L$ and $S\subseteq L$ a subset. Then
\begin{enumerate}
\item $S^u\vee x \subseteq (S\vee x)^u$ and $S^l\vee x \subseteq (S\vee x)^l$;
\item $S^u\wedge x \subseteq (S\wedge x)^u$ and $S^l\wedge x \subseteq (S\wedge x)^l$.
\end{enumerate}
\end{lemma}
\begin{proof}
The maps $y\mapsto y\vee x$ and $y\mapsto y \wedge x$ are order-preserving, so we can use \ref{imagePolars}.
\end{proof}
\begin{corollary}[Infinite distributive inequalities] \label{infiniteDistributiveInequalities}
Let $L$ be a lattice $x\in L$ and $S\subseteq L$ a subset. Assume all relevant suprema exist, then
\begin{enumerate}
\item $\sup(S)\wedge x \geq \sup(S \wedge x)$;
\item $\inf(S)\vee x \leq \inf(S \vee x)$.
\end{enumerate}
\end{corollary}
\begin{proof}
Because $\sup(S)\in S^u$, we have $\sup(S)\wedge x \in S^u\wedge x$, so $\sup(S)\wedge x \in (S\wedge x)^u$ and $\sup(S)\wedge x \geq \min((S\wedge x)^u) = \sup(S\wedge x)$. The second part is dual.
\end{proof}
In particular if $S$ has two elements, we recover the distributive inequalities.

\begin{proposition} \label{latticeIntervalIntersection}
Let $L$ be a lattice and $a,b,c,d\in L$. Then
\[ \interval{a,b} \cap \interval{c,d} = \interval{a\vee c, b\wedge d}. \]
\end{proposition}
\begin{proof}
First take $x\in \interval{a,b} \cap \interval{c,d}$. Then $a\leq x$ and $c\leq x$, so $a\vee c \leq x$ by \ref{orderLatticeCorollary}. Similarly $x\leq b\wedge d$, so $x\in\interval{a\vee c, b\wedge d}$.

Now take $x\in\interval{a\vee c, b\wedge d}$. We have
\begin{align*}
a\leq a\vee c &\leq x &  x&\leq b\wedge d \leq b \\
c\leq a\vee c &\leq x &  x&\leq b\wedge d \leq d,
\end{align*}
so $x\in \interval{a,b} \cap \interval{c,d}$.
\end{proof}
\begin{corollary}
Let $L$ be a lattice. Then the set of intervals in $L$ is a $\cap$-subsemilattice of $\sSet{\powerset(L), \subseteq}$.
\end{corollary}

\subsection{Complete lattices}
\begin{lemma}
Let $L$ be a lattice. For every finite set $S\subset L$, $\sup(S)$ and $\inf(S)$ exist.
\end{lemma}
\begin{definition}
Let $L$ be a lattice. We call $L$ a \udef{complete lattice} if each subset $S\subseteq L$ has both a supremum and an infimum. We write
\[ \sup(S) = \bigvee S \qquad \inf(S) = \bigwedge S. \]
If we want to emphasise that the supremum/infimum of $S$ is taken as a subset of $L$, we write $\bigvee_L S$ and $\bigwedge_L S$.
\end{definition}
Clearly every finite lattice is complete.

\begin{lemma} \label{supInfFiniteSubsetsLattice}
Let $L$ be a lattice and $F\subseteq L$ a finite subset. Then $\bigvee F$ and $\bigwedge F$ exist. 
\end{lemma}

\begin{example}
For any set $X$, $\powerset(X)$ is a complete lattice.
\end{example}

\begin{lemma}
Let $P$ be an ordered set such that all relevant suprema and infima exist and $S,T\subseteq P$. Then
\begin{enumerate}
\item $\bigvee S \leq \bigwedge T$ if and only if $s\leq t$ for all $s\in S,t\in T$;
\item if $S\subseteq T$, then $\bigvee S \leq \bigvee T$ and $\bigwedge S \geq \bigwedge T$;
\item $\bigvee(S\cup T) = \left(\bigvee S\right)\vee \left(\bigvee T\right)$ and $\bigwedge(S\cup T) = \left(\bigwedge S\right)\wedge \left(\bigwedge T\right)$.
\end{enumerate}
\end{lemma}

\begin{proposition}[Mini-max theorem for complete lattices]
Let $L$ be a complete lattice, $I,J$ index sets and $\setbuilder{a_{i,j}\in L}{i\in I, j\in J}$. Then
\[ \bigvee_{j\in J}\bigwedge_{i\in I}a_{i,j} \leq \bigwedge_{i\in I}\bigvee_{j\in J} a_{i,j}. \]
\end{proposition}
\begin{proof}
For all $k,l$ we have $a_{k,l}\leq \bigvee_{j\in J} a_{k,j}$. This implies $\bigwedge_{i\in I} a_{i,l} \leq \bigwedge_{i\in I}\bigvee_{j\in J} a_{i,j}$ for all $l$. Taking the supremum over $l$ gives the result.
\end{proof}

\begin{proposition} \label{completeLatticeBasic}
Let $P$ be a non-empty ordered set. Then the following are equivalent:
\begin{enumerate}
\item $P$ is a complete lattice;
\item $\bigvee S$ exists for all subsets $S\subseteq P$;
\item $\bigwedge S$ exists for all subsets $S\subseteq P$;
\item $P$ has a bottom element $\bot$ and $\bigvee S$ exists for all non-empty $S\subseteq P$;
\item $P$ has a top element $\top$ and $\bigwedge S$ exists for all non-empty $S\subseteq P$;
\item for all $x\in P$ both $\upset x$ and $\downset x$ are complete lattices.
\end{enumerate}
\end{proposition}
\begin{proof}
The only difficult implication is $(5)\Rightarrow (1)$. All infima exist because $\inf(\emptyset) = \top \in P$. New each non-empty set $S$ in $P$ has an upper bound, $\top$, so $\bigvee S$ exists in $P$ by \ref{existenceSupremaInfima}. Finally $\bigvee \emptyset = \bot = \bigwedge P \in P$.
\end{proof}

\begin{theorem}[Knaster-Tarski fixed-point theorem]
Let $L$ be a complete lattice and $f:L\to L$ an order-preserving map. Then 
\[ \bigvee \setbuilder{x\in L}{x\leq f(x)} \qquad\text{and}\qquad \bigwedge \setbuilder{x\in L}{x\geq f(x)} \]
are, resp., the greatest and the least fixed point of $f$.
\end{theorem}
\begin{proof}
This is just two applications of the semilattice formulation of the Knaster-Tarski theorem, \ref{KnasterTarskiSemilattice}, once for the join-semilattice and once for the meet-semilattice.
\end{proof}
\begin{corollary}
The set of fixed points of $f$ forms a complete lattice.
\end{corollary}
\begin{proof}
Let $P$ be the set of fixed points. To show $P$ is a complete lattice, take any subset $S\subset P$.
Set $w = \bigvee S$, where $S$ is considered as a subset of $L$. For all $x\in W$: $x\leq w$, which implies $x=f(x)\leq f(w)$. As $w$ is the least upper bound, we have $w\leq f(w)$. This implies $f[\upset w]\subseteq \upset w$, meaning we can view $f$ as a function on the complete lattice $\upset w$. In particular $f|_{\upset w}$ has a least fixed point by the theorem, so $S$ has a supremum in $P$. The existence of the infimum is dual.
\end{proof}
\begin{corollary}[Banach decomposition theorem]
Let $X,Y$ be sets and $f:X\to Y$ and $g:Y\to X$ functions. There exist partitions $X_1,X_2$ and $Y_1,Y_2$ of $X$ and $Y$ such that
\[ f^\imf(X_1) = Y_1 \qquad\text{and}\qquad g^\imf(Y_2) = X_2. \]
\end{corollary}
\begin{proof}
Consider the map $F: \powerset(X)\to\powerset(X): S\mapsto X\setminus g^\imf\big(Y\setminus f^\imf(S)\big)$. By the theorem this map has a fixed point, which we call $X_1$. We then need to set $Y_1 = f^\imf(X_1), X_2 = X\setminus X_1$ and $Y_2 = Y\setminus Y_1$. The fact $X_1$ is a fixed point means that $X_1 = X\setminus g^\imf\big(Y\setminus f^\imf(X_1)\big) = g^\imf(Y\setminus Y_1) = g^\imf(Y_2)$.
\end{proof}
\begin{corollary}[Schröder-Bernstein]
Let $X,Y$ be sets and $f:X\rightarrowtail Y$ and $g:Y\rightarrowtail X$ injective functions. Then there exists a bijective function $h: X\twoheadrightarrowtail Y$.
\end{corollary}
\begin{proof}
Use the Banach decomposition theorem to obtain partitions $X_1,X_2$ and $Y_1,Y_2$. Then $f|_{X_1}: X_1\twoheadrightarrowtail Y_1$ and $g|_{Y_2}: Y_2 \twoheadrightarrowtail X_2$ are bijective, so we can construct
\[ h: X\twoheadrightarrowtail Y: x \mapsto \begin{cases}
f(x) & x\in X_1 \\ (g|_{Y_2})^{-1}(x) & x\in X_2
\end{cases}. \]
\end{proof}
The Schröder-Bernstein theorem was already proven in \ref{SchroederBernstein}.



\subsubsection{Chain conditions}
TODO: move!

The following requires dependent choice:
\begin{proposition} \label{ascendingDescendingChainLattice}
Let $L$ be a lattice. Then
\begin{enumerate}
\item if $L$ satisfies the ascending chain condition, then for all non-empty subsets $S\subset L$ there exists a finite set $F\subset L$ such that $\bigvee S = \bigvee F$;
\item if $L$ satisfies the descending chain condition, then for all non-empty subsets $S\subset L$ there exists a finite set $F\subset L$ such that $\bigwedge S = \bigwedge F$;
\item if $L$ has a bottom element and satisfies the ascending chain condition, then $L$ is complete;
\item if $L$ has a top element and satisfies the descending chain condition, then $L$ is complete;
\item if $L$ has no infinite chains, then $L$ is complete.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Assume $L$ satisfies the ascending chain condition and let $S\subset L$ be non-empty. Define
\[ B = \setbuilder{\bigvee G}{\text{$G$ is a finite, non-empty subset of $S$}}. \]
This is well-defined by \ref{supInfFiniteSubsetsLattice}. Then $B$ has a maximal element $m = \bigvee F$ for some finite $F$ by \ref{welfoundedACC}.

Now $m$ is an upper bound of $S$. Indeed, let $x\in S$. Then $m= \bigvee F \leq \bigvee (F\cup\{x\})$ because $F\subseteq (F\cup \{x\})$. Since $m$ is maximal in $B$, we have $m = \bigvee (F\cup\{x\}) \geq x$. It is clearly also the least upper bound, otherwise it was not the least upper bound of $F$.

(2) Dual of 1.

(3) This follows from 1. and \ref{completeLatticeBasic}.

(4) Dual of 3.

(5) A lattice with no infinite chains satisfies the ascending chain condition. Also a lattice
with no infinite chains has a bottom element. (TODO: need dependent/countable choice?)
\end{proof}

\begin{proposition} \label{joinIrreducibilityDescendingChainLattice}
Let $L$ be a lattice satisfing the descending chain condition. Then
\begin{enumerate}
\item $\forall a,b\in L:\; a\nleq b \implies \exists x\in \joinIr(L): \; x\leq a$ and $x\nleq b$;
\item $\forall a\in L:\; a = \bigvee\setbuilder{x\in\joinIr(L)}{x\leq a}$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Set $S = \setbuilder{x\in L}{\text{$x\leq a$ and $x\nleq b$}}$, which is non-empty and thus contains a minimal element $m$ by \ref{welfoundedACC}. We claim $m$ is join-irreducible. Assume, towards a contradiction, $x = c\vee d$ and $c < x > d$. By minimality of $x$, $c,d\notin S$. As $c,d< x \leq a$, we must have $c,d\leq b$. But this means $x\leq b$, so $x\notin S$ which is a contradiction.

(2) Set $T = \setbuilder{x\in\joinIr(L)}{x\leq a}$. Clearly $a$ is an upper bound of $T$. To see that it is the least upper bound, take a different upper bound $c$. Assume, towards a contradiction, that $a\nleq c$. Then $a\nleq a\wedge c$. By point 1. there exists an $x\in\joinIr(L)$ such that $x\leq a$ (meaning $x\in T$) and $x\nleq a\wedge c$. But if $c$ were an upper bound of $T$, then $x\leq a\wedge c$, which is a contradiction.
\end{proof}

\begin{proposition}
Let $L$ be a lattice.
\begin{enumerate}
\item If $L$ satisfies the descending chain condition, then any subset $Q\supseteq \joinIr(L)$ is join-dense in $L$.
\item If $L$ satisfies the ascending chain condition and $Q$ is join-dense in $L$, then for all $a\in L$ there exists a finite subset $F$ of $Q$ such that $a = \bigvee F$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) is a corollary of \ref{joinIrreducibilityDescendingChainLattice}. (2) is a corollary of \ref{ascendingDescendingChainLattice}.
\end{proof}
\begin{corollary}
Let $L$ be a lattice with no infinite chains. Then
\begin{enumerate}
\item for each $a \in L$, there exists a finite subset $F$ of $\joinIr(L)$ such that $a = F$.
\item $Q\subseteq L$ is join-dense in $L$ if and only if $Q \supseteq \joinIr(L)$.
\end{enumerate}
\end{corollary}
\begin{proof}
If $L$ has no finite chains, then it satisfies the ascending and descending chain conditions.

Only the $\Rightarrow$ direction of (2) is not immediately obvious. Assume $Q$ is join-dense and let $x\in \joinIr(L)$. By the proposition there exists a finite $F\subseteq Q$ such that $x = \bigvee F$. Since $x$ is join-irreducible, we have $x \in F$ and hence $x \in Q$. Thus, $\joinIr(L) \subseteq Q$.
\end{proof}


\subsection{Distributive and modular lattices}
\subsubsection{Distributive lattices}
For all lattices $L$ the distributive inequalities, \ref{distributiveInequality}, hold: $\forall a,b,c \in L$:
\begin{align*}
a \vee (b\wedge c) &\leq (a\vee b) \wedge (a\vee c); \\
a\wedge (b \vee c) &\geq (a\wedge b)\vee (a\wedge c).
\end{align*}

The two corresponding equalities are equivalent:
\begin{proposition} \label{equivalenceDistributiveLaws}
Let $L$ be a lattice. Then the following are equivalent:
\begin{enumerate}
\item $\forall a,b,c \in L: \; a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c)$;
\item $\forall a,b,c \in L: \; a\wedge (b \vee c) = (a\wedge b)\vee (a\wedge c)$.
\end{enumerate}
\end{proposition}
These equivalent equalities are known as the \udef{distributive laws}.
\begin{proof}
We show $(1)\Rightarrow (2)$. Then other implication follows by duality.

Assume (1). Then, for all $a,b,c \in L$:
\begin{align*}
(a\wedge b)\vee (a\wedge c) &= ((a\wedge b)\vee a) \wedge ((a\wedge b)\vee c) & \text{by (1)}\\
&= (a\wedge (c\vee (a\wedge b))  & \text{by the absorption law}\\
&= (a \wedge ((c\vee b) \wedge (c\vee a))  & \text{by (1)}\\
&= a\wedge (b\vee c) & \text{by the absorption law.}
\end{align*}
\end{proof}
Note that it is \emph{not} true that
\[ \forall a,b,c \in L: \; a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c) \iff a\wedge (b \vee c) = (a\wedge b)\vee (a\wedge c). \]

\begin{definition}
A lattice $L$ is called \udef{distributive} if it satisfies the distributive laws.
\end{definition}

\begin{lemma}
A lattice is distributive \textup{if and only if} its dual is distributive.
\end{lemma}

\begin{example}
\begin{itemize}
\item Any totally ordered set is a distributive lattice.
\item For any set $X$, the poset $\sSet{\powerset(X), \subseteq}$ is a distributive lattice.
\end{itemize}
\end{example}

\begin{lemma}
Let $L$ be a lattice. The following are equivalent:
\begin{enumerate}
\item $L$ is distributive;
\item for all $x,y,z,w\in L: \quad x\wedge y \leq w \;\text{and}\; x\wedge z\leq w \implies x\wedge (y\vee z) \leq w;$
\item for all $x,y,z,w\in L: \quad x\vee y \geq w \;\text{and}\; x\vee z\geq w \implies x\vee (y\wedge z) \geq w$.
\end{enumerate}
\end{lemma}
\begin{proof}
Point (1) is self-dual and points (2) and (3) are dual, so it is enough to show that (1) and (2) are equivalent.

Assume $L$ distributive. By \ref{orderLatticeCorollary}, $ x\vee y \geq w$ and $x\vee z\geq w$ imply $(x\wedge y)\vee (x\wedge z) \leq w$. By distributivity, we get (2).

Conversely, we can take $w = (x\wedge y)\vee (x\wedge z)$. Then (2) gives $x\wedge (y\vee z) \leq (x\wedge y)\vee (x\wedge z)$ and the distributive inequality \ref{distributiveInequality} gives the other inequality. 
\end{proof}

\begin{proposition}[Cancellation law for distributive lattices] \label{cancellationDistributiveLattices}
Let $L$ be a distributive lattice and $a,b,c\in L$. Then
\[ \text{$a\vee c = b \vee c$ and $a\wedge c = b \wedge c$ implies $a = b$.} \]
\end{proposition}
Note that we only assume the equalities hold for some $c$, not all $c$. If these equalities hold for all $c$, then we have cancellation in all lattices, not just distributive ones. See \ref{cancellationGeneralLattices}.
\begin{proof}
We calculate, using the absorption law and distributivity,
\[ a = a\vee (a\wedge c) = a \vee (b\wedge c) = (a\vee b)\wedge (a\vee c) = (a\vee b) \wedge (b\vee c) = b \vee (a \wedge c) = b \vee (b\wedge c) = b. \]
\end{proof}

\begin{lemma} \label{disjointComplementIdeal}
Let $L$ be a distributive lattice with a bottom $\bot$ and $S\subset L$. Then $S^\perp$ is an ideal.
\end{lemma}
\begin{proof}
Let $a,b\in S^\perp$. Then for all $x\in S$, we have
\[ (a\vee b)\wedge x = (a\wedge x)\vee (b\wedge x) = \bot\vee \bot = \bot, \]
so $a\vee b\in S^\perp$.

It is also clear $S^\perp$ must be a down set by \ref{orderLatticeCorollary}.
\end{proof}

\subsubsection{Modular lattices}
For all lattices $L$ the modular inequality holds: $\forall a,b,c \in L$:
\[ a\leq c \implies a \vee (b\wedge c) \leq (a\vee b) \wedge c. \]
See \ref{distributiveInequality}.

\begin{proposition} \label{modularEquivalences}
Let $L$ be a lattice. Then the following are equivalent:
\begin{enumerate}
\item $\forall a,b,c\in L$: $a \vee (b\wedge c) = (a\vee b) \wedge c$ if $a\leq c$;
\item $\forall a,b,c\in L$: $a \vee (b\wedge c) = (a\vee b) \wedge (a\vee c)$ if $a\leq b$ or $a\leq c$; the dual of (2);
\item $\forall a,b,c\in L$: $a\vee (b\wedge (a\vee c)) = (a\vee b)\wedge (a\vee c)$; the dual of (3);
\item \textup{Shearing identity}: $\forall a,b,c\in L$: $(a\vee b) \wedge c = (a\vee (b\wedge (a\vee c)))\wedge c$; the dual of the shearing identity.
\end{enumerate}
\end{proposition}
The first of these is referred to as the \udef{modular law}. Notice that it is self-dual.
\begin{proof}
(1) is equivalent to its dual by replacing $a\leftrightarrow c$. This will imply all statements are equivalent to their duals once the equivalence with (1) has been established. 

$\boxed{(1)\Rightarrow (2)}$ Assume (1). Assume $a\leq b$ or $a\leq c$. By relabelling we can assume $a\leq c$.  Then $a\vee c = c$ and (2) clearly follows from (1).


$\boxed{(2)\Rightarrow (3)}$ Apply (2) to $a\leq a\vee c$.

$\boxed{(3)\Rightarrow (1)}$ Assume $a\leq c$. Then $a\vee c = c$ and $a\vee (b\wedge (a\vee c)) = (a\vee b)\wedge (a\vee c)$ reduces to $a \vee (b\wedge c) = (a\vee b) \wedge c$.

$\boxed{(3)\Rightarrow (4)}$ We calculate, using (3),
\[ (a\vee (b\wedge (a\vee c)))\wedge c = ((a\vee b)\wedge (a\vee c))\wedge c = (a\vee b) \wedge (a\vee c) \wedge c = (a\vee b) \wedge c. \]

$\boxed{(4)\Rightarrow (3)}$ TODO????
\end{proof}

\begin{definition}
A lattice $L$ is called \udef{modular} if it satisfies the modular law.
\end{definition}

\begin{lemma}
If a lattice is distributive, it is also modular.
\end{lemma}
\begin{proof}
If the lattice is distributive, point (2) of \ref{modularEquivalences} holds unconditionally, and so in particular also conditionally.
\end{proof}

\subsubsection{Semimodular lattices}


\subsubsection{Derived lattices}

\begin{proposition}
(i) If L is a modular (distributive) lattice, then every sublattice of L
is modular (distributive).

(ii) If L and K are modular (distributive) lattices, then L × K is
modular (distributive).

(iii) If L is modular (distributive) and K is the image of L under a
homomorphism, then K is modular (distributive).
\end{proposition}
\begin{corollary}
If a lattice is isomorphic to a sublattice of a product
of distributive (modular) lattices,then it is distributive (modular).
\end{corollary}

\begin{theorem}[$\mathbf{M}_3-\mathbf{N}_5$ theorem]
Let $L$ be a lattice.
\begin{enumerate}
\item $L$ is non-modular \textup{if and only if} $\mathbf{N}_5 \rightarrowtail L$;
\item $L$ is non-distributive \textup{if and only if} $\mathbf{N}_5 \rightarrowtail L$ or $\mathbf{M}_3 \rightarrowtail L$.
\end{enumerate}
\end{theorem}
\begin{proof}
TODO!
\end{proof}

\subsubsection{Infinitely distributive lattices}
\begin{definition}
Let $L$ be a lattice. We call $L$
\begin{itemize}
\item \udef{join-infinitely distributive} if $L$ is complete as a $\vee$-semilattice and
\[ \forall x\in L, \forall D\subseteq L: \qquad x\wedge \bigvee D = \bigvee\setbuilder{x\wedge y}{y\in D}; \]
\item \udef{meet-infinitely distributive} if $L$ is complete as a $\wedge$-semilattice and
\[ \forall x\in L, \forall D\subseteq L: \qquad x\vee \bigwedge D = \bigwedge\setbuilder{x\vee y}{y\in D}; \]
\item \udef{infinitely distributive} if $L$ is both join-infinitely distributive and meet-infinitely distributive.
\end{itemize}
\end{definition}
TODO cfr Heyting algebras

The inequalities $x\wedge \bigvee D \geq \bigvee x\wedge D$ and $x\vee \bigwedge D \leq \bigwedge x\vee D$ hold in any lattice, see \ref{infiniteDistributiveInequalities}.



\subsubsection{Completely distributive lattices}

\section{Complementation}
\subsection{Complementation}
\begin{definition}
Let $L$ be a bounded lattice and $x\in L$. We call $y$ a \udef{complement} of $x$ if
\[ x \vee y = \top \qquad \text{and} \qquad x\wedge y = \bot. \]
\end{definition}

\begin{proposition} \label{distributiveComplementUnique}
Let $L$ be a bounded lattice. If $L$ is distributive, then any $x\in L$ has at most one complement.
\end{proposition}
\begin{proof}
This follows from the cancellation law \ref{cancellationDistributiveLattices}. Let $y,y'$ be complements of $x$. Then $y\vee x = \top = y'\vee x$ and $y\wedge x = \bot = y'\wedge x$, so $y=y'$.
\end{proof}

A lattice element may also have no complements.
\begin{example}
The only elements with a complement in a bounded chain are $\top$ and $\bot$.
\end{example}

\subsubsection{Complemented lattices}
\begin{definition}
A \udef{complemented lattice} is a bounded lattice with a function $c:L\to L$, called the \udef{complementation}, such that $c(x)$ is a complement of $x$ for all $x\in L$.

A lattice in which every element has exactly one complement is called a \udef{uniquely complemented lattice}.

A lattice with the property that every interval (viewed as a sublattice) is complemented is called a \udef{relatively complemented lattice}.
\end{definition}
A distributive complemented lattice is uniquely complemented.

\begin{lemma}
Let $L$ be a complemented lattice with complementation $c:L\to L$. Then $c(\top) = \bot$ and $c(\bot) = \top$.
\end{lemma}
\begin{proof}
For $c(\top)$ to be a complement of $\top$, we need $\top \wedge c(\top) = \bot$. But for all $x\in L$ we have $x\leq \top$, so $\top\wedge x = x$. This means we have $c(\top) = \bot$.
\end{proof}

\begin{lemma} \label{uniqueComplementInvolution}
Let $L$ be a uniquely complemented lattice. Then the complementation $c:L\to L$ is an involution.
\end{lemma}
\begin{proof}
Clearly if $c(x)$ is a complement of $x$, then $x$ is a complement of $c(x)$. By uniqueness $c(c(x)) = x$.
\end{proof}

\subsubsection{Orthocomplemented lattices}
\begin{definition}
Let $L$ be a bounded lattice. An \udef{orthocomplementation} is a function $L \to L: x \to \overline{x}$ that maps each element $x\in L$ to an \udef{orthocomplement} $\overline{x}$ such that
\begin{itemize}
\item $x$ and $\overline{x}$ are complements;
\item $x\mapsto \overline{x}$ is an involution: $\overline{\overline{x}} = x$;
\item $x\mapsto \overline{x}$ is order-reversing: $x\leq y \implies \overline{y} \leq \overline{x}$.
\end{itemize}
An \udef{orthocomplemented lattice} or \udef{ortholattice} is a bounded lattice equipped with an orthocomplementation.
\end{definition}
An orthocomplemented lattice is not necessarily uniquely complemented.

\begin{lemma}
Let $L$ be an ortholattice with completement $c$. Then $c: L \to L$ is a reverse order-isomorphism.
\end{lemma}
\begin{corollary}
The dual lattice of an ortholattice is an ortholattice. We can view an orthocomplementation as an isomorphism between an ortholattice and its dual.
\end{corollary}
\begin{corollary}
Let $A\subseteq L$. Then
\begin{enumerate}
\item $c\left[\bigvee A\right] = \bigwedge c[A]$;
\item $c\left[\bigwedge A\right] = \bigvee c[A]$.
\end{enumerate}
\end{corollary}
\begin{proof}
See \ref{orderReversingSimilarityLatticeOperations}.
\end{proof}

\begin{proposition}
The cardinality of any finite ortholattice is either even or $1$.
\end{proposition}
\begin{proof}
Let $L$ be a finite ortholattice.
The orthocomplementation pairs elements $x,y$ such that $\overline{x} = y$ and $\overline{y} = x$. If for all such pairs we have $x\neq y$, then the cardinality of $L$ is even. Now assume there exists an $x\in L$ such that $\overline{x} = x$. Then 
\[ \bot = x\wedge \overline{x} = x\wedge x = x = x\vee x = x\vee \overline{x} = \top. \]
So $\bot = \top$, which is only possible if $L = \{\bot\}$.
\end{proof}

\begin{example}
\begin{itemize}
\item The lattice $\mathbf{M}_2 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\circ \ar[ld, dash] \ar[rd, dash] & \\ \circ \ar[rd, dash] && \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd}$ admits a unique orthocomplementation.
\item The lattice $\mathbf{M}_3 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\circ \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ \circ \ar[rd, dash]& \circ \ar[d, dash] & \circ \ar[ld, dash] \\ &\circ &
\end{tikzcd}$ admits no orthocomplementations.
\item The lattice $\mathbf{M}_4 = \begin{tikzcd}[column sep={1em,between origins},row sep={2em,between origins}]
&&&\circ \ar[llld, dash] \ar[ld,dash] \ar[rd, dash] \ar[rrrd, dash] &&&\\ \circ \ar[rrrd, dash]&& \circ \ar[rd, dash] && \circ \ar[ld, dash] && \circ \ar[llld, dash] \\ &&&\circ &&&
\end{tikzcd}$ admits three orthocomplementations.
\item The hexagon lattice $\begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] & & b \ar[d, dash] \\
c \ar[rd, dash] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ admits a unique orthocomplementation, but it is not uniquely complemented. Indeed both of the functions $f: \begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] \ar[rr, leftrightarrow] & & b \ar[d, dash] \\
c \ar[rd, dash] \ar[rr, leftrightarrow] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ and $g: \begin{tikzcd}[column sep={1.5em,between origins},row sep={1.7em,between origins}]
& \circ \ar[ld, dash] \ar[rd, dash] & \\
a \ar[d, dash] \ar[rrd, leftrightarrow] & & b \ar[d, dash] \\
c \ar[rd, dash] \ar[rru, leftrightarrow] & & d \ar[ld, dash] \\
& \circ &
\end{tikzcd}$ are complementations. Only $g$ is an orthocomplementation, because $f$ does not reverse order: $a \geq c$  and $f(a) = b \geq d = f(c)$.
\end{itemize}
\end{example}

\begin{theorem}[De Morgan's laws] \label{deMorganLaws}
Let $L$ be an ortholattice, then for all $x,y\in L$
\begin{enumerate}
\item $\overline{(x\vee y)} = \overline{x} \wedge \overline{y}$;
\item $\overline{(x\wedge y)} = \overline{x} \vee \overline{y}$.
\end{enumerate}
\end{theorem}
\begin{proof}
From $x\leq x\vee y$ and $y\leq x\vee b$, we have $\overline{(x\vee b)} \leq \overline{x}$ and $\overline{(x\vee b)} \leq \overline{y}$. By \ref{orderLatticeCorollary} we have $\overline{(x\vee y)}\leq \overline{x} \wedge \overline{y}$. For the other inequality we start with $\overline{x} \geq \overline{x} \wedge \overline{y}$ and $\overline{y} \geq \overline{x} \wedge \overline{y}$ to obtain $x\vee y \leq \overline{(\overline{x} \wedge \overline{y})}$, which implies $\overline{x} \wedge \overline{y} \leq \overline{(x\vee y)}$.
\end{proof}

\begin{proposition}
Let $L$ be a complemented lattice.

If the complement is an involution and satisfies either of the de Morgan laws, then $L$ is an ortholattice.
\end{proposition}
\begin{proof}
Assume the de Morgan law $\overline{(x\vee y)} = \overline{x} \wedge \overline{y}$ holds. Assume $x\leq y$. Then $x\vee y = y$, so
\[ \overline{y} = \overline{(x\vee y)} = \overline{x} \wedge \overline{y} \]
meaning $\overline{y} \leq \overline{x}$.
\end{proof}

The requirement that the complement be an involution is important. There are lattices in which the de Morgan laws hold that are not ortholattices.

\begin{example}
The lattice $\mathbf{M}_3 = \begin{tikzcd}[column sep={2em,between origins},row sep={2em,between origins}]
&\top \ar[ld, dash] \ar[d,dash] \ar[rd, dash] &\\ a \ar[rd, dash]& b \ar[d, dash] & c \ar[ld, dash] \\ &\bot &
\end{tikzcd}$ admits a complementation $'$ such that $a' = b$, $b' = c$ and $c' = a$ that is clearly not an orthocomplementation, but does satisfy the de Morgan laws.
\end{example}

TODO Ockham algebras, De Morgan algebras, Kleene algebras, Stone algebras.

\subsection{Heyting algebras}
\subsubsection{Pseudocomplementation}
\begin{definition}
Let $S$ be a bounded $\wedge$-semilattice and $x\in S$. The \udef{pseudocomplement} of $x$ in $S$ is defined as
\[ x^* \defeq \max\setbuilder{y\in S}{x\wedge y = \bot}, \]
if the maximum exists.

If for all $x\in S$ the pseudocomplement exists, we say $S$ is \udef{pseudocomplemented}.
\end{definition}

\begin{lemma}

\end{lemma}

\subsection{Boolean lattices}
\begin{definition}
A distributive complemented lattice is called a \udef{Boolean lattice} or \udef{Boolean algebra}.
\end{definition}
We will use $\overline{x}$ to denote the (necessarily unique, \ref{distributiveComplementUnique}) completement of $x$.

\begin{lemma} \label{BooleanComplementLargestDisjoint}
Let $L$ be a Boolean lattice and $x\in L$. Then $\{x\}^\perp = \downset \{\overline{x}\}$.
\end{lemma}
\begin{proof}
From the requirement $x\wedge \overline{x} = \bot$, we see that $\overline{x}\in \{x\}^\perp$. Now $\{\overline{x}\} \subseteq \{x\}^\perp$ implies $\downset \{\overline{x}\} \subseteq \downset\{x\}^\perp = \{x\}^\perp$. For the last equality we have used the fact that $\{x\}^\perp$ is downwards closed (in fact even an ideal), see \ref{disjointComplementIdeal}.

Now we prove the other inclusion: $\{x\}^\perp \subseteq \downset \{\overline{x}\}$.
Take $y\in \{x\}^\perp$. We just need to show that $y\leq \overline{x}$, or, equivalently, $y = y\wedge \overline{x}$. Indeed
\[ y = y \wedge \top = y\wedge (x\vee \overline{x}) = (y\wedge x)\vee (y\wedge \overline{x}) = \bot \vee (y\wedge \overline{x}) = y\wedge \overline{x}. \]
\end{proof}
\begin{corollary}
Every Boolean lattice is an ortholattice.
\end{corollary}
\begin{proof}
By \ref{distributiveComplementUnique} we know that a Boolean lattice is uniquely complemented, so its complement is an involution by \ref{uniqueComplementInvolution}. We just need to check the complementation reverses order.

Let $x\leq y$. Then $\overline{y} \wedge x \leq \overline{y} \wedge y = \bot$, so $\overline{y} \wedge x = \bot$ and thus $\overline{y}$ is disjoint from $x$. Then $\overline{y} \leq \overline{x}$ follows from \ref{BooleanComplementLargestDisjoint}.
\end{proof}
\begin{corollary}
The laws of de Morgan hold in Boolean lattices.
\end{corollary}
\begin{corollary} \label{BooleanInequalities}
Let $L$ be a Boolean lattice and $x,y\in L$. Then the following are equivalent:
\begin{enumerate}
\item $x \leq y$;
\item $x\wedge \overline{y} = \bot$;
\item $\overline{x} \vee y = \top$.
\end{enumerate}
This can also be expressed as $x\leq y \iff x\perp \overline{y}$.
\end{corollary}
\begin{proof}
We calculate
\[ x \leq y \iff x\in\downset\{y\} \iff x\in\{\overline{y}\}^\perp \iff x\wedge \overline{y} = \bot. \]
For the equivalence $(2) \Leftrightarrow (3)$ we use a law of de Morgan.
\end{proof}

\begin{lemma} \label{BooleanLatticesLemma}
Let $L$ be a Boolean lattice and $x,y\in L$. Then
\begin{enumerate}
\item $y = (x\vee y) \wedge (\overline{x}\vee y)$;
\item $y = (x\wedge y) \vee (\overline{x}\wedge y)$;
\item $x \wedge y = x\wedge (\overline{x}\vee y)$;
\item $x \vee y = x\vee (\overline{x}\wedge y)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1, 2) We calculate
\[ y = y \wedge \top = y \wedge (x\vee \overline{x}) = (x\vee y) \wedge (\overline{x}\vee y). \]
The second statement is dual.

(3, 4) We calculate $x\wedge (\overline{x}\vee y) = (x\wedge \overline{x})\vee (x\wedge y) = \bot \vee (x\wedge y) = x\wedge y$. The fourth statement is dual.
\end{proof}

\begin{lemma} \label{atomsJoinIrriducibleBoolean}
Let $L$ be a Boolean lattice. Then
\begin{enumerate}
\item $\atoms(L) = \joinIr(L)$;
\item $\coatoms(L) = \meetIr(L)$;
\end{enumerate}
\end{lemma}
\begin{proof}
We have the inclusion $\subseteq$ from \ref{atomsJoinIrriducible}. Assume $x$ is an atom. Take $y\in \downset x\setminus\{x\}$, which is non-empty due to the existence of $\bot \neq x$. In fact we need to prove $y = \bot$. By \ref{BooleanLatticesLemma} we have $x = x\vee y = (x\wedge \overline{y})\vee y$. By join-irreducibility this means that $x = x\wedge \overline{y}$ (because $x\neq y$ by assumption). So $x\leq \overline{y}$, meaning $y = x\wedge y \leq \overline{y}\wedge y = \bot$.
\end{proof}

\begin{lemma}
Let $L$ be a Boolean lattice, $x\in L$ and $A\subseteq L$. Then
\begin{enumerate}
\item $\upset x\wedge A^u = (x\wedge A)^u$;
\item $\downset x\vee A^l = (x\vee A)^l$.
\end{enumerate}
\end{lemma}
In any lattice we have the inclusions $x\wedge A^u \subseteq (x\wedge A)^u, \;x\wedge A^l \subseteq (x\wedge A)^l, \;x\vee A^u \subseteq (x\vee A)^u$ and $x\vee A^l \subseteq (x\vee A)^l$. See \ref{UpperLowerBoundsMeetJoin}.
\begin{proof}
Because of \ref{UpperLowerBoundsMeetJoin}, we have $x\wedge A^u \subseteq (x\wedge A)^u$, so $\upset x\wedge A^u \subseteq \upset(x\wedge A)^u = (x\wedge A)^u$.

We just need to prove $\upset x\wedge A^u \supseteq (x\wedge A)^u$. Take some $z\in (x\wedge A)^u$, we need to find a $y\in x\wedge A^u$ such that $y \leq z$. We claim that $y = x\wedge (\overline{x}\vee z)$ is such a $y$. We just need to verify that $y \leq z$ and $\overline{x}\vee z \in A^u$.

The first claim is immediate from $y = x\wedge (\overline{x}\vee z) = x\wedge z$, using \ref{BooleanLatticesLemma}.

For the second claim, take an arbitrary $a\in A$. Then $x\wedge a \leq z$ by definition and so $\overline{x}\vee z \geq \overline{x}\vee (x\wedge a) = \overline{x}\vee a \geq a$.
\end{proof}
\begin{corollary}[Infinite distributive laws] \label{infiniteDistributiveLawsBooleanLattices}
Let $L$ be a Boolean lattice. Then for all $x\in L$ and all $A\subseteq L$:
\begin{enumerate}
\item if $\bigvee A$ exists, then $x\wedge \bigvee A = \bigvee x\wedge A$;
\item if $\bigwedge A$ exists, then $x\vee \bigwedge A = \bigwedge x\vee A$.
\end{enumerate}
Thus any complete Boolean lattice is infinitely distributive.
\end{corollary}
The inequalities $x\wedge \bigvee A \geq \bigvee x\wedge A$ and $x\vee \bigwedge A \leq \bigwedge x\vee A$ hold in any lattice, see \ref{infiniteDistributiveInequalities}. Note that this still does not mean that $L$ is complete.
\begin{proof}
We calculate
\begin{align*}
x\wedge \sup(A) &= x\wedge (A^u\cap A^{ul}) \\
&\subseteq (x\wedge A^u)\cap (x\wedge A^{ul}) \\
&\subseteq (x\wedge A)^u\cap (x\wedge A^{u})^l = (x\wedge A)^u\cap (\upset(x\wedge A^{u}))^l = (x\wedge A)^u\cap (x\wedge A))^{ul} = \sup(x\wedge A).
\end{align*}
We have used that $x\wedge (A^\cap A^{ul})$ is an image of the function $y\mapsto x\wedge y$ for the first inclusion and \ref{UpperLowerBoundsMeetJoin} for the second. We have also used \ref{upperBoundUpsetLowerBoundDownset} for $(x\wedge A^{u})^l = (\upset(x\wedge A^{u}))^l$.

The left-hand set is a singleton. The right is either a singleton or empty. Thus both sets are singletons with the same content.

Point (2) is dual.
\end{proof}

\begin{proposition}
Let $L$ be a Boolean lattice with complement and $a,b\in L$. Then $[a,b]$ is a Boolean lattice with complementation $x\mapsto \widetilde{x} = (\overline{x} \wedge b)\vee a$. 
\end{proposition}
\begin{proof}
Clearly $[a,b]$ inherits distributivity from $L$. All we need to show is that for all $x\in [a,b]$ the complement of $x$ in $[a,b]$ is $\widetilde{x}$. We calculate
\begin{align*}
x \wedge \widetilde{x} &= x\wedge ((\overline{x} \wedge b)\vee a) = (x\wedge(\overline{x} \wedge b))\vee (x\wedge a) = (( x\wedge \overline{x}) \wedge b)\vee (x\wedge a) = (\bot \wedge b)\vee a = \bot \vee a = a \\
x \vee \widetilde{x} &= x\vee ((\overline{x} \wedge b)\vee a) = ((x\vee \overline{x}) \wedge (x\vee b))\vee a = (\top \wedge b) \vee a = b\vee a = b.
\end{align*}
\end{proof}

\begin{proposition}
An algebra of sets is a Boolean algebra with as top the unit $\Omega$, as bottom the empty set $\emptyset$ and as complement $A\mapsto A^c = \Omega\setminus A$.
\end{proposition}

\subsubsection{Duality and complementation}
TODO: dual expression can be obtained by taking the complement? Dual statement of equality is equality of complements?

TODO: general for ortholattices?

\subsubsection{Boolean rings}
TODO: define ring above!
\begin{definition}
Let $\sSet{R,+,\cdot, 0, 1}$ be a ring. We call $R$ a \udef{Boolean ring} if each $x\in R$ is idempotent: $x^2 = x$.
\end{definition}

\begin{lemma}
Let $\sSet{R,+,\cdot, 0, 1}$ be a Boolean ring. Then
\begin{enumerate}
\item $x = -x$ for all $x\in R$;
\item $R$ is commutative.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We calculate
\[ x+x = (x+x)^2 = x^2 + x^2 + x^2 + x^2 = x+x+x+x. \]
Subtracting $x+x$ from both sides gives $x+x = 0$.

(2) Let $x,y\in R$. We then have
\[ x+y = (x+y)^2 = x^2 + xy + yx + y^2 = x + xy + yx + y. \]
So $xy = -yx = yx$, using point (1).
\end{proof}

\begin{lemma}
Every subring of a Boolean ring is a Boolean ring.
\end{lemma}

\begin{proposition}
Let $R$ be a set and $0,1\in R$.
\begin{enumerate}
\item If $\sSet{R, \vee, \wedge, 0, 1, c}$ is a Boolean algebra, then $\sSet{R, +, \cdot, 0 , 1}$ is a Boolean ring with operations defined by
\begin{align*}
&+: (x,y) \mapsto (x\wedge y^c)\vee (x^c \wedge y) \\
&\cdot: (x,y) \mapsto x \wedge y.
\end{align*}
\item If $\sSet{R, +, \cdot, 0 , 1}$ is a Boolean ring, then $\sSet{R, \vee, \wedge, 0, 1, c}$ is a Boolean algebra with operations defined by
\begin{align*}
&\vee: (x,y) \mapsto x+y - x\cdot y \\
&\wedge: (x,y) \mapsto x \cdot y \\
&c: x\mapsto x^c = 1 + x
\end{align*}
\end{enumerate}
\end{proposition}
Note we need the existence of $1$ to define the complement.
\begin{proof}
TODO
\end{proof}

TODO: \url{https://en.wikipedia.org/wiki/Boolean_ring} (Maybe later in ring section?)

\subsubsection{Identities in Boolean algebras}
TODO rewrite!!!!

Given any set $U$ we can form the family $\powerset(U)$ for which $U$ is a universe set.

The set theoretic operations of union, intersection, difference, symmetric difference and complementation can be restricted to $\powerset(U)$. In other words $\powerset(U)$ is closed w.r.t. these operations.

\begin{proposition} \label{setBooleanAlgebra}
Given a set $U$, the operations $\cap, \cup, ^c$ form a Boolean algebra with bottom $\emptyset$ and top $U$: $\forall A,B,C\subset U$: $\powerset(U)$ is closed under $\cap, \cup, ^c$ and
\[ \begin{array}{l c c}
\text{\textbf{Commutativity}} & A\cup B= B\cup A & A\cap B = B\cap A \\
\text{\textbf{Identity}} & A\cup\emptyset = A & A\cap U = A \\
\text{\textbf{Distributivity}} & A\cup(B\cap C) = (A\cup B)\cap(A\cup C) & A\cap(B\cup C) = (A\cap B)\cup(A\cap C) \\
\text{\textbf{Complements}} & A\cup A^c = U & A\cap A^c = \emptyset
\end{array} \]
\end{proposition}
The two columns are duals of each other.

TODO: distributivity for arbitrary union and intersection.

\begin{corollary} \label{BooleanConsequences}
Let $A,B\subseteq U$ be sets. Then
\[ \begin{array}{l c c}
\text{\textbf{Idempotency}} & A\cup A = A & A\cap A = A \\
\text{\textbf{Domination}} & A\cup U = U & A\cap \emptyset = \emptyset \\
\text{\textbf{Absorption}} & A\cup(A\cap B) = A & A\cap(A\cup B) = A \\
\text{\textbf{Associativity}} & A\cup(B\cup C) = (A\cup B)\cup C & A\cap(B\cap C) = (A\cap B)\cap C
\end{array} \]
\end{corollary}
\begin{proof}
Using set theory the proof of these statements is simple. It is also possible to prove the equalities using only the properties of Boolean algebras listed in lemma \ref{setBooleanAlgebra} and the properties derived here. We only prove the first column. The proof of the second column can be obtained easily by duality.

(1) $A = A\cup(A\cap A^c) = (A\cup A)\cap (A\cup A^c) = (A\cup A)\cap U = A\cup A$.

(2) $U = U\cup (U\cap A) = (U\cup U)\cap (U\cup A) = U\cap (U\cup A) = (A\cup U)\cap U = (A\cup U)$.

(3) $A\cup(A\cap B) = (A\cap U)\cup(A\cap B) = A\cap(U\cup B) = A\cap U = A$.

(4) TODO \url{https://proofwiki.org/wiki/Operations_of_Boolean_Algebra_are_Associative}
\end{proof}

\begin{definition}
\udef{Sheffer stroke} $|$
\end{definition}

\begin{proposition}
Let $B$ be a Boolean lattice.
\begin{enumerate}
\item $\overline{x} = x|x$;
\item $x\wedge y = (x|y)|(x|y)$;
\item $x\vee y = (x|x)|(y|y)$;
\item $x\to y = x|(y|y)$;
\item $x\leftrightarrow y = ((x|(y|y))|(y|(x|x)))|((x|(y|y))|(y|(x|x)))$.
\end{enumerate}
\end{proposition}

\subsubsection{Grills}
\begin{definition}
Let $L$ be a Boolean lattice. Let $A \subseteq L$ be a subset. The \udef{grill} of $A$ is defined as the polar $A^{\mesh}$.
\end{definition}

\begin{proposition} \label{complementInIsotoneGrill}
Let $L$ be a Boolean lattice. Let $A \subseteq L$ be upwards closed. Then
\[ a \notin A \quad\iff\quad \overline{a} \in A^\mesh. \]
In this case we also have $A = A^{\mesh\mesh}$.
\end{proposition}
\begin{proof}
First assume $\overline{a} \in A^\mesh$. If $a$ were and element of $A$, then $a\mesh \overline{a}$ and so $\neg(a\leq a)$ by \ref{BooleanInequalities}, which is a contradiction.

Now assume $a \notin A$. Take arbitrary $b\in A$. Now $a\wedge b \notin A$ (if $a\wedge b\in A$, then $a\in A$ by upwards closure and this was assumed not the case).

Then we have the implications, using \ref{BooleanInequalities},
\begin{align*}
a\wedge b\notin A &\implies a\wedge b \neq b \\
&\iff \neg(a\wedge b = b) \\
&\iff \neg(b\leq a) \\
&\iff \neg(\overline{a}\perp b) \\
&\iff \overline{a}\mesh b.
\end{align*}

To show $A = A^{\mesh\mesh}$, we observe the equivalences
\[ a\in A \quad\iff\quad \overline{a} \notin A^\mesh \quad\iff\quad a = \overline{\overline{a}} \in A^{\mesh\mesh}. \]
\end{proof}


\begin{lemma} \label{upwardClosureGrill}
Let $L$ be a Boolean lattice and $A \subseteq L$ a subset. Then
\begin{enumerate}
\item $A^\mesh$ is upwards closed;
\item $A^{\mesh\mesh} = \upset A$.
\end{enumerate}
In particular, $A^\mesh = A^{\mesh\mesh\mesh} = (\upset A)^\mesh$.
\end{lemma}
\begin{proof}
(1) Take $b\in A^\mesh$ and $c\geq b$. Then for all $a\in A$, $a\wedge c \geq a\wedge b > \bot$. So $c\in A^\mesh$, which means that $A^\mesh$ is upwards closed.

(2) Because $\big((-)^\mesh, (-)^\mesh\big)$ is a Galois connection (\ref{polarsGaloisConnection}), we have $A \subseteq A^{\mesh\mesh}$ by \ref{preorderGaloisCondition}. As $A^{\mesh\mesh}$ is upwards closed (by point 1), we have $\upset A \subseteq A^{\mesh\mesh}$.

Now we use the fact that $(-)^{\mesh\mesh}$ is monotone to observe $A^{\mesh\mesh} \subseteq (\upset A)^{\mesh\mesh}$. Also $(\upset A)^{\mesh\mesh} = \upset A$ by
\ref{complementInIsotoneGrill}. So $A^{\mesh\mesh} \subseteq \upset A$.
\end{proof}
\begin{corollary} \label{grillUpsetOrderSimilarity}
Let $L$ be a Boolean lattice.
Then $(-)^\mesh$ is an antitone bijection between upwards closed sets of subsets of $L$ and its inverse is itself.
\end{corollary}
\begin{proof}
We use \ref{relationPreservingGeneralisedInversesEmbeddings}. It is enough to note that $\im\big((-)^\mesh\big)$ is the set of upwards closed sets, which follows straight from the lemma. (The first point shows that $\im\big((-)^\mesh\big)$ consists of upwards closed sets. The second shows that every upwards closed set is in $\im\big((-)^\mesh\big)$.)
\end{proof}
\begin{corollary} \label{grillIntersectionUnion}
Let $L$ be a Boolean lattice and $\mathcal{E}\subseteq\powerset(L)$ such that each element of $\mathcal{E}$ is upwards closed. Then
\[ \Big(\bigcap\mathcal{E}\Big)^\mesh = \bigcup_{G\in\mathcal{E}}G^\mesh \qquad\text{and}\qquad \Big(\bigcup\mathcal{E}\Big)^\mesh = \bigcap_{G\in\mathcal{E}}G^\mesh. \]
\end{corollary}
\begin{proof}
It is enough to note that the intersection of upwards closed sets is closed and the union of upwards closed sets is closed, so the meet and join in the lattice of upwards closed sets are just the intersection and union.
\end{proof}
\begin{corollary} \label{ameshUpwardClosure}
Let $L$ be a Boolean lattice and $A, B \subseteq L$. Then $A \amesh B$ \textup{if and only if} $(\upset A) \amesh B$.
\end{corollary}
\begin{proof}
We have
\[ A\amesh B \iff A\subseteq B^\mesh \iff \upset A\subseteq B^\mesh \iff (\upset A)\amesh B. \]
\end{proof}




\section{Residuated lattices}


\section{Completions}
TODO: Dedekind-MacNeille completion.

\section{Formal concept analysis}
\url{file:///C:/Users/user/Downloads/978-3-540-31881-1.pdf}
\url{file:///C:/Users/user/Downloads/978-3-662-49291-8.pdf}

\begin{definition}
A \udef{context} is a triple $\seq{G,M,I}$ where $G$ is a set of \udef{objects}, $M$ is a set of \udef{attributes} and $I\subseteq G\times M$ is a binary relation.

For $g\in G, m\in M$ we interpret $gIm$ as ``the object $g$ has the attribute $m$''.



A \udef{concept} is a pair $\seq{A,B}$ where $A\subset G$ is a set of objects and $B\subset M$ is a set of attributes such that
\begin{itemize}
\item $A = \setbuilder{g\in G}{\forall m\in B: gIm}$;
\item $B = \setbuilder{m\in M}{\forall g\in A: gIm}$
\end{itemize}
\end{definition}
The letters $G$ and $M$ come from the German: Gegenstände and Merkmale. The $I$ is for ``incidence relation'' (I think).

\section{Filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set. A subset $A\subseteq P$ is called
\begin{itemize}
\item an \udef{order filter} if
\begin{itemize}
\item $A$ is downward directed;
\item $A$ is an up set in $P$;
\end{itemize}
\item an \udef{order ideal} if
\begin{itemize}
\item $A$ is upward directed;
\item $A$ is a down set in $P$.
\end{itemize}
\end{itemize}
The set of ideals on $P$ is denoted $\ideals(P)$ and the set of filters on $P$ is denoted $\filters(P)$.
\end{definition}
Many authors also require filters and ideals to be non-empty.

\begin{lemma}
Let $P$ be an ordered set and $x\in P$.
\begin{enumerate}
\item The principal up set $\upset \{x\}$ is an order filter.
\item The principal down set $\downset \{x\}$ is an order ideal.
\end{enumerate}
\end{lemma}
If the order is not a preorder, then a principal filter/ideal may be empty.

\begin{example}
Let $X$ be a set.
\begin{itemize}
\item The set of finite subsets of $X$ is an ideal.
\item The set of countable subsets $X$ is an ideal.
\item A subset $A$ of $X$ is called \udef{cofinite} if $X\setminus A$ is finite. The set of cofinite subsets of $X$ is a filter.
\item A subset $A$ of $X$ is called \udef{cocountable} if $X\setminus A$ is countable. The set of cocountable subsets of $X$ is a filter.
\end{itemize}
\end{example}

\begin{lemma}
Let $P$ be an ordered set.
\begin{enumerate}
\item If $P$ has a least element $l$, then a filter $F$ is proper \textup{if and only if} $F\neq P$.
\item If $P$ has a greatest element $g$, then an ideal $I$ is proper \textup{if and only if} $F\neq P$.
\end{enumerate}
\end{lemma}


\begin{lemma}
Let $\sSet{S,\leq}$ be a poset $J\subseteq S$ a subset.
\begin{enumerate}
\item If $S$ is a $\wedge$-semilattice, then the following are equivalent:
\begin{enumerate}
\item $J$ is a filter;
\item \begin{enumerate}
\item $J$ is an up set;
\item $J$ is a $\wedge$-subsemilattice;
\end{enumerate}
\item $\forall a,b\in S: a\wedge b\in J \iff a,b\in J$;
\end{enumerate}
\item If $S$ is a $\vee$-semilattice, then the following are equivalent:
\begin{enumerate}
\item $J$ is an ideal;
\item \begin{enumerate}
\item $J$ is a down set;
\item $J$ is a $\vee$-subsemilattice.
\end{enumerate}
\item $\forall a,b\in S: a\vee b\in J \iff a,b\in J$.
\end{enumerate}
\end{enumerate}
\end{lemma}
\begin{proof}
TODO
\end{proof}

TODO compare (c) with filter-grill.

\begin{lemma}
Let $S$ be a $\wedge$-semilattice. If $D\subseteq S$ is a $\wedge$-subsemilattice, then $D$ is downward directed.
\end{lemma}
The converse is not true!



\begin{lemma}
Let $L$ be a lattice and $J\subseteq L$ a subset. Then
\begin{enumerate}
\item $J$ is a filter \textup{if and only if}
\begin{enumerate}
\item $\forall a,b\in J: \qquad a\wedge b\in J$;
\item $\forall x\in L, \forall b\in J: \quad x\vee b \in J$;
\end{enumerate}
\item $J$ is an ideal \textup{if and only if}
\begin{enumerate}
\item $\forall a,b\in J: \qquad a\vee b\in J$;
\item $\forall x\in L, \forall b\in J: \quad x\wedge b \in J$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{lemma} \label{properFiltersSelfMesh}
Let $S$ be a bounded $\wedge$-semilattice and $F\in\filters(S)$. Then the following are equivalent:
\begin{enumerate}
\item $F$ is proper;
\item $F\amesh F$;
\item $F\subseteq F^\mesh$.
\end{enumerate}
\end{lemma}
\begin{proof}
$(1)\Rightarrow (2)$ Assume $F$ is proper and take $a, b\in F$. If $a\wedge b = \bot$, then $\bot\in F$, which is a contradiction, so $a\mesh b$.

$(2) \Rightarrow (1)$ Now assume $F \amesh F$. Then $\bot \notin F$ (as $\bot$ does not mesh with any element of $F$), so $F$ is proper.

$(2) \Leftrightarrow (3)$ Immediate.
\end{proof}



\subsection{Frink ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set. A subset $A\subseteq P$ is called\footnote{TODO: Frink, Orrin (1954), "Ideals In Partially Ordered Sets", Am. Math. Mon., 61: 223-234, doi:10.1080/00029890.1954.11988449}
\begin{itemize}
\item a \udef{Frink filter} if $F^{\Yright\Yleft} \subseteq A$ for all finite $F\subseteq A$;
\item a \udef{Frink ideal} if $F^{\Yleft\Yright} \subseteq A$ for all finite $F\subseteq A$.
\end{itemize}
\end{definition}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set. Every order filter is a Frink filter and every order ideal is a Frink ideal.
\end{proposition}
\begin{proof}
First assume $A$ is an order filter and take arbitrary finite $F\subseteq A$. In order to prove $F^{\Yright\Yleft} \subseteq A$, we take an arbitrary $x\in F^{\Yright\Yleft}$. Then
\[ x\in F^{\Yright\Yleft} \;\iff\; \{x\}\subseteq (F^\Yright)^\Yleft \;\iff\; F^\Yright \subseteq \{x\}^\Yright = x{\Yright}. \]
As $A$ is an order filter, there exists $y\in F^\Yright \cap A$. By the calculation this means $y\Yleft x$ and so $x\in A$ by upwards closure.

The case for ideals is dual.
\end{proof}


\subsection{Filter bases and subbases}

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set and $\{F_i\}_{i\in I}$ a family of subsets.
\begin{enumerate}
\item If $F_i$ is a filter for all $i\in I$, then $\bigcap_{i\in I}F_i$ is a filter;
\item If $F_i$ is an ideal for all $i\in I$, then $\bigcap_{i\in I}F_i$ is an ideal.
\end{enumerate}
\end{lemma}

\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set and $B\subseteq P$ a subset. Then
\begin{itemize}
\item the \emph{filter generated by $B$} is
\[ \mathfrak{F}\{B\} \defeq \bigcap\setbuilder{B \subseteq S\subseteq P}{\text{$S$ is a filter}} \]
we call $B$ a \udef{filter subbasis} of $\mathfrak{F}\{B\}$. If $B$ is downward directed, it is called a \udef{filter base} of $\mathfrak{F}\{B\}$;
\item the \emph{filter base generated by $B$} as
\[ \mathfrak{FB}\{B\} \defeq \bigcap\setbuilder{B \subseteq S\subseteq P}{\text{$S$ is downward directed}}. \]
\end{itemize}
Let $E\subseteq P$ be some set and $F\in \filters(P)$. If $F$ has a base $B$ that is a subset of $E$, then $F$ is said to be \udef{based in} $E$.  
\end{definition}

If $P$ is not downward directed, there may not exists any $S \supseteq B$ that is downward directed, in which case $\mathfrak{FB}\{B\} =$ TODO.

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set and $B\subseteq P$ a subset. Then
\begin{enumerate}
\item if $P$ is downward directed, then $\mathfrak{FB}\{B\}$ is a filter base;
\item $\mathfrak{F}\{B\} = \upset\mathfrak{FB}\{B\}$.
\end{enumerate}
\end{proposition}
In particular, if $S$ is a filter base, then $\upset S$ is a filter.

\begin{lemma}
Let $\sSet{P,\Yleft}$ be an ordered set.

If $P$ is downward directed and $\exists \bot \in \min(P)$ and $B \subseteq P$ a filter base, then $\mathfrak{F}\{B\}$ is a proper filter \textup{if and only if} $\bot \notin B$; 
\end{lemma}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set. Then for all filter bases $B,C$ in $P$: $B$ is finer than $C$ \textup{if and only if} $\mathfrak{F}\{B\} \supseteq \mathfrak{F}\{C\}$.
\end{proposition}

\begin{proposition} \label{filterGenerationSemilattice}
Let $S$ be a $\wedge$-semilattice and $B\subseteq S$ a subset. Then
\begin{enumerate}
\item $\mathfrak{FB}\{B\} = \Closure_\wedge(B)$;
\item $\mathfrak{F}\{B\} = \upset\Closure_\wedge(B)$.
\end{enumerate}
\end{proposition}

\begin{lemma} \label{decreasingCountableBaseFilter}
Let $S$ be a $\wedge$-semilattice and $F\subseteq S$ a countably based filter. Then we can find a decreasing sequence $\seq{b_n}$ in $S$ such that $\setbuilder{b_n}{n\in \N}$ is a base of $F$.
\end{lemma}
\begin{proof}
By assumption, we can find an enumeration $f: \N\to S$ of a base of $F$. Now we define the sequence $\seq{b_n}$ recursively by
\[ b_n = \begin{cases}
f(0) & (n = 0) \\
f(n) \wedge b_{n-1} & (\text{otherwise}).
\end{cases} \]
It is clear that $b$ is decreasing (TODO recursion invariant).

To see that $b$ is a base, first note that each $b_n$ is in $F$ (as $F$ is a $\wedge$-subsemilattice and all meets are finite). Also $b_n \leq f(n)$ for all $n\in\N$.
\end{proof}

\subsection{Ordering filters and ideals}

\begin{proposition}[The lattices of filters and ideals] \label{latticeFiltersIdeals}
Let $P$ be an ordered set and $I$ an index set.
\begin{enumerate}
\item If $P$ is a $\wedge$-semilattice, the set $\filters(P)$ of filters on $P$ is a complete bounded sublattice of $\sSet{\powerset(P), \subseteq}$, with top $P$ and bottom $\{\top\}$. Let $\{F_i\}_{i\in I} \in \filters(L)^I$ be a set of filters. Then
\[ \bigwedge \{F_i\}_{i\in I} = \bigcap_{i\in I}F_i \qquad\text{and}\qquad
\bigvee \{F_i\}_{i\in I} = \upset \Closure_\wedge\left(\bigcup_{i\in I}F_i\right). \]
\item If $P$ is a $\vee$-semilattice, the set $\ideals(P)$ of ideals on $P$ is a complete bounded sublattice of $\sSet{\powerset(P), \subseteq}$, with top $P$ and bottom $\{\bot\}$. Let $\{J_i\}_{i\in I} \in \filters(L)^I$ be a set of ideals. Then
\[ \bigwedge \{J_i\}_{i\in I} = \bigcap_{i\in I}J_i \qquad\text{and}\qquad
\bigvee \{J_i\}_{i\in I} = \downset \Closure_\vee\left(\bigcup_{i\in I}J_i\right). \]
\end{enumerate}
\end{proposition}
\begin{proof}
This is an application of \ref{completeSublattice} to \ref{filterGenerationSemilattice} (TODO show this is the correct residual). We just need to prove that $\upset\Closure_\wedge \left(\bigcup_{i\in I}F_i\right) = \Closure_\wedge \left(\bigcup_{i\in I}F_i\right)$ TODO is distributive
\end{proof}
\url{https://ncatlab.org/nlab/show/filter}

\begin{lemma} \label{baseMeetJoinFilters}
Let $L$ be a lattice and $F,G$ filters in $\filters(L)$. If $\mathcal{A}$ is a base of $F$ and $\mathcal{B}$ a base of $G$, then
\begin{enumerate}
\item $\setbuilder{A\vee B}{A\in \mathcal{A}, B\in \mathcal{B}}$ is a base of $F\wedge G$;
\item $\setbuilder{A\wedge B}{A\in \mathcal{A}, B\in \mathcal{B}}$ is a base of $F\vee G$.
\end{enumerate}
\end{lemma}
Note that the analogue result does \emph{not} hold for infinite meets and joins of filters.

\begin{proposition} \label{joinProperFilter}
Let $S$ be a $\wedge$-semilattice and $\{F_i\}_{i\in I} \in \filters(S)^I$ be set of filters. Then $\bigvee \{F_i\}_{i\in I}$ is a proper filter \textup{if and only if} $\Big(\bigcup_{i\in I}F_i\Big)\amesh \Big(\bigcup_{i\in I}F_i\Big)$.
\end{proposition}
\begin{proof}
TODO.

Use \ref{properSubsemilatticeLemma}????
\end{proof}
In particular, for $F, G\in\filters(L)$, we have that $F\vee G$ is a proper filter if and only if $F\amesh G$.

\begin{lemma}
Let $L$ be a lattice and $a,b\in L$. Then
\begin{enumerate}
\item $\upset\{a\} \vee \upset\{b\} = \upset\{a\wedge b\}$;
\item $\upset\{a\} \wedge \upset\{b\} = \upset\{a\vee b\}$.
\end{enumerate}
\end{lemma}

\subsubsection{Maximal filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{itemize}
\item A \udef{maximal filter} or \udef{ultrafilter} is a coatom in $\filters(P)$.
\item A \udef{maximal ideal} is a coatom in $\ideals(P)$.
\end{itemize}
We denote the set of ultrafilters on $P$ as $\ultrafilters(P)$.
\end{definition}

\begin{proposition} \label{ultrafilterCriteria}
Let $S$ be a bounded $\wedge$-semilattice and $F\in \filters(S)$. The following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item $\forall x\in S: x\notin F \iff \exists y\in F: x\wedge y = \bot$;
\item $F = F^\mesh$;
\item $F$ is proper and $F^\mesh \subseteq F$.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO

$(1)\Rightarrow (2)$ Assume $F$ is an ultrafilter. Then for all $x\in F$, the filter $\mathfrak{F}\big\{F\cup \{x\}\big\}$ is either $F$ or $S$. In other words, $x\notin F$ is equivalent to $\mathfrak{F}\big\{F\cup \{x\}\big\} = S$. Now a filter is equal to $S$ iff $\bot$ is an element and, by \ref{filterGenerationSemilattice} we have that $\bot \in \mathfrak{F}\big\{F\cup \{x\}\big\}$ iff it is the intersection of $x$ and some $y\in F$. This concludes the forward direction.

$(2)\Rightarrow (1)$ Take some filter $F$ satisfying the condition. Then $F$ is automatically proper ($\bot$ is not in $F$). Assume $G\supseteq F$ is another proper filter. Assume, towards a contradiction, that $G\setminus F \neq \emptyset$. Then take $x\in G\setminus F$. By hypothesis there exists a $y\in F$ (and thus also in $G$) such that $x\wedge y = \bot$, meaning $\bot \in G$ by $\wedge$-closure. Thus $G$ is not proper.

$(3) \Leftrightarrow (4)$ By \ref{properSubsemilatticeLemma}.
\end{proof}
\begin{corollary} \label{BooleanUltrafilterDisjunction}
Let $B$ be a Boolean lattice and $F\in \filters(B)$. The following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item either $x\in F$ or $\overline{x}\in F$ for all $x\in B$.
\end{enumerate}
\end{corollary}
\begin{proof}
It is enough to prove that $\exists y\in F: x\wedge y = \bot$ is equivalent to $\overline{x}\in F$. Indeed it is equivalent to $\exists y\in F: y \leq \overline{x}$ by \ref{BooleanInequalities} and thus equivalent to $\overline{x}\in F$ by upwards closure.
\end{proof}

\begin{proposition}[Ultrafilter lemma] \label{ultrafilterLemma}
Every proper filter is contained in an ultrafilter.
\end{proposition}
In other words, the lattice of ultrafilters on a poset is coatomic. (TODO do we need to assume Boolean? In which case this remark is redundant.)
\begin{corollary} \label{filtersCoatomistic}
Let $B$ be a Boolean lattice. Then $\filters(B)$ is a coatomistic lattice.
\end{corollary}
In other words, for every $F\in \filters(B)$: we have
\[ F = \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U. \]
\begin{proof}
We clearly have
\[ F \subseteq \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U. \]
We need to show the opposite inclusion. Assume, towards a contradiction, that to opposite inclusion does not hold. Then there exists $a\in \bigcap_{\substack{U\in \ultrafilters(B) \\ U\geq F}} U$ such that $a\notin F$. Then for all $b\in F$ we have $b\not\leq a$, which implies $b\wedge \overline{a} \neq \bot$ by \ref{BooleanInequalities}. Thus $\overline{a} \in F^\mesh$, so $F\vee \upset\{\overline{a}\}$ is a proper filter by \ref{joinProperFilter}. It is contained in an ultrafilter $U$ that also contains $F$. By hypothesis $U$ must contain $a$, which means it is not proper because $a\perp \overline{a}$. This is a contradiction.
\end{proof}
The hypothesis of Booleanness is necessary.
\begin{example}
Consider the lattice $\sSet{\{0,1,2,3\},\leq}$. It contains only one ultrafilter: $\{1,2,3\}$. The filter $\{3,4\}$ is clearly not the intersection of its containing ultrafilters.
\end{example}

\begin{lemma} \label{finiteUltrafilterFactorisation}
Let $S$ be a bounded $\wedge$-semilattice, $F, G\in \filters(S)$ and $U\in\ultrafilters(S)$. Then $F\cap G \subseteq U$ \textup{if and only if} $F\subseteq U$ or $G\subseteq U$.
\end{lemma}
\begin{proof}
The direction $\Leftarrow$ is immediate.

For the direction $\Rightarrow$, assume $F\cap G \subseteq U$. Then
\[ U = U\vee U \supseteq U\vee (F\cap G) = (U\vee F)\cap (U\vee G) \supseteq U \]
by distributivity in \ref{latticeFiltersIdeals}. Then either $U = U\vee F$ or $U = U\vee G$, because $U$ is meet-irriducible by \ref{atomsJoinIrriducible}. Thus either $F\subseteq U$ or $G\subseteq U$.
\end{proof}
Note this does not work for arbitrary intersections!

\subsubsection{Prime filters and ideals}
\begin{definition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{itemize}
\item A \udef{prime filter} is a meet-irreducible element in $\filters(L)$.
\item A \udef{prime ideal} is a meet-irreducible element in $\ideals(L)$.
\end{itemize}
\end{definition}

\begin{proposition}
Let $\sSet{P,\Yleft}$ be an ordered set.
\begin{enumerate}
\item A filter $F$ is prime \textup{if and only if} $F^c$ is an ideal.
\item An ideal $I$ is prime \textup{if and only if} $I^c$ is a filter.
\end{enumerate}
\end{proposition}
\begin{proof}

\end{proof}

\begin{lemma} \label{maximalPrimeFiltersIdeals}
Every maximal is prime. If Boolean, then every prime is maximal.
\end{lemma}
\begin{proof}
TODO \ref{atomsJoinIrriducible}
\end{proof}


\begin{proposition}
Let $L$ be a lattice.
\begin{enumerate}
\item A filter $F\in \filters(L)$ is prime \textup{if and only if}
\begin{enumerate}
\item $F$ is proper;
\item $\forall x,y\in L$: $x\vee y \in F \implies x\in F$ or $y\in F$.
\end{enumerate}
\item An ideal $I\in \ideals(L)$ is prime \textup{if and only if}
\begin{enumerate}
\item $I$ is proper;
\item $\forall x,y\in L$: $x\wedge y \in I \implies x\in I$ or $y\in I$.
\end{enumerate}
\end{enumerate}
\end{proposition}
If $L$ is only a $\wedge$-semilattice (resp. $\vee$-semilattice), then only the direction $\Rightarrow$ holds in general.
\begin{proof}
(1) Assume $F$ is a prime filter. Then $F \neq \top = \powerset(L)$, so it is proper. Now assume $x\vee y\in F$, meaning $\upset x\vee y \subseteq F$. Thus
\[ F = \Closure_\wedge (F\cup \upset(x\vee y)) = (F\vee \upset x) \cap (F\vee \upset y). \]
Because $F$ is prime, we have $F = F\vee \upset x$ or $F\vee \upset y$.

Now assume TODO \url{http://www.ascent-journals.com/IJPEM/Vol3No3/1-sagi.pdf} using \ref{joinIrreducibleLemma}.
\end{proof}

\subsection{Image filters}
\begin{lemma} \label{imageFilter}
Let $\sSet{P,\Yleft_P}$, $\sSet{Q, \Yleft_Q}$ be ordered sets, $f: P\to Q$ an order-preserving function and $F\subseteq P$ a filter. Then $\upset f^{\imf}(F)$ is a filter.
\end{lemma}
\begin{proof}
The set $\upset f^{\imf}(F)$ is downwards directed by \ref{imageDirectedSet}. It is upwards closed by construction.
\end{proof}
\begin{definition}
We call $\upset f^\imf[F]$ the \udef{image filter} of $F$ under $f$.
\end{definition}


\begin{proposition} \label{filterResiduatedImageGaloisConnection}
Let $P,Q$ be posets and $f: P\to Q$ a residuated function with residual $g: Q\to P$. Then
\[ \upset\circ g^{\imf}: \filters(Q) \to \filters(P) \qquad\text{and}\qquad \upset\circ f^{\imf}: \filters(P) \to \filters(Q) \]
form a Galois connection $(\upset\circ g^{\imf}, \upset\circ f^{\imf})$.
\end{proposition}
TODO works for upwards closed sets.
\begin{proof}
We verify the Galois identity \ref{preorderGaloisIdentity}: take arbitrary $F\in \filters(Q), G\in \filters(P)$ and calculate (using \ref{functionImagePreimageGaloisConnection})
\begin{align*}
\upset g^{\imf}(F) \subseteq G &\iff g^\imf(F) \subseteq G \\
&\iff \forall a\in F: \; g(a) \in G \\
&\iff \forall a\in F: \exists b\in G: \; b \leq g(a) \\
&\iff \forall a\in F: \exists b\in G: \; f(b) \leq a \\
&\iff F \subseteq \upset f^{\imf}(G).
\end{align*}
\end{proof}
\begin{corollary} \label{filterPreimageImageGaloisConnection}
Let $X, Y$ be sets and $f: X\to Y$. Then
\[ f^{\preimf\imf}: \powerfilters(Y) \to \powerfilters(X) \qquad\text{and}\qquad \upset\circ f^{\imf\imf}: \powerfilters(X) \to \powerfilters(Y) \]
form a Galois connection $(\upset\circ f^{\preimf\imf}, \upset\circ f^{\imf\imf})$.
\end{corollary}
TODO works for upwards closed sets.
\begin{corollary} \label{imageFiltersPreservesIntersection}
Let $X, Y$ be sets and $\mathcal{F}\subseteq\powerfilters(X)$. Let $f:X\to Y$ be a function. Then
\[ \upset f^{\imf\imf}\Big[\bigcap \mathcal{F}\Big] = \bigcap (\upset\circ f^{\imf\imf})^{\imf}[\mathcal{F}]. \]
In particular for $F,G\in \powerfilters(X)$, we have $\upset f^{\imf\imf}[F\cap G] = \upset f^{\imf\imf}[F] \cap \upset f^{\imf\imf}[G]$.
\end{corollary}
TODO works for upwards closed sets.
\begin{proof}
Immediate from the proposition and \ref{GaloisConnectionLatticePreservation}.
\end{proof}
\begin{proof}[Alternate proof.]
The inequality $\subseteq$ is given by \ref{orderPreservingFunctionLatticeOperations}.

For the other inequality, take $A\in \bigcap (\upset\circ f^{\imf\imf})^{\imf}[\mathcal{F}]$. Then, for all $F\in\mathcal{F}$, there exists $B_F\in F$ such that $f^{\imf}[B_F] \subseteq A$. Now $f^{\imf}\left[\bigcup_{F\in\mathcal{F}}B_F\right] = \bigcup_{F\in\mathcal{F}}f^{\imf}[B_F] \subseteq A$. Also $\bigcup_{F\in\mathcal{F}}B_F \in \bigcap \mathcal{F}$ by upwards closure of each filter. Thus $A\in \upset f^{\imf\imf}[\bigcap \mathcal{F}]$.
\end{proof}


\subsection{Filters and ideals on a Boolean algebra}
\begin{proposition} \label{booleanMaximalFiltersIdeals}
Let $L$ be a Boolean lattice and $F\subseteq L$ an upwards closed subset. Then the following are equivalent:
\begin{enumerate}
\item $F$ is an ultrafilter;
\item $F$ is a prime filter;
\item for all $x\in L$, exactly one of either $x\in F$ or $\overline{x}\in F$ holds.
\end{enumerate}
\end{proposition}
\begin{proof}
TODO \ref{atomsJoinIrriducible} and \ref{BooleanUltrafilterDisjunction}. TODO: is upwards closure enough?
\end{proof}

TODO: compare with \ref{complementInIsotoneGrill}!


\begin{proposition}\label{filterGrillIsPrime}
Let $L$ be a Boolean lattice, $a,b\in L$ and $F \in \filters(L)$ a filter. If $a\vee b\in F^\mesh$, then either $a\in F^\mesh$ or $b\in F^\mesh$.
\end{proposition}
TODO: cfr. ultrafilters.
\begin{proof}
We have the implications, by \ref{deMorganLaws} and \ref{complementInIsotoneGrill},
\begin{align*}
a \vee b\in F^\mesh \iff& \overline{a\vee b} = \overline{a}\wedge\overline{b} \notin F \\
\implies& \big(\overline{a} \notin F\big)\lor \big(\overline{b} \notin F\big) \\
\iff& \big(a \in F^\mesh\big)\lor \big(b \in F^\mesh\big).
\end{align*}
\end{proof}

\subsubsection{Filter ideal duality}
\begin{proposition} \label{filterIdealDuality}
Let $L$ be a Boolean lattice and $F,I\subseteq L$. Then
\begin{enumerate}
\item if $F$ is a (proper) filter, then $I_F \defeq \setbuilder{\overline{x}}{x\in F}$ is a (proper) ideal;
\item if $I$ is a (proper) ideal, then $F_I \defeq \setbuilder{\overline{x}}{x\in I}$ is a (proper) filter;
\item the folowing are equivalent:
\begin{enumerate}
\item $I \mesh F$;
\item $F_I \vee F = L$;
\item $I_F \vee I = L$.
\end{enumerate}
\end{enumerate}
\end{proposition}

\begin{lemma}
Let $L$ be a Boolean lattice and $U\subseteq L$ an ultrafilter. Then
\[ U^c = \setbuilder{\overline{x}}{x\in U} \]
and this is an ideal.
\end{lemma}

\begin{lemma} \label{idealFromUltrafilter}
Let $L$ be a Boolean lattice, $F\in \filters(L)$ and $I\in \ideals(L)$. Then
\[ I \subseteq F^c \quad\iff\quad \exists U\in \ultrafilters(L): \; I \subseteq U^c \subseteq F^c. \]
\end{lemma}
\begin{proof}
The direction $\Leftarrow$ is immediate by transitivity of the inclusion.

Now assume $I \subseteq F^c$, then for all $a\in I$ we have $a\notin F$, which is equivalent to $\overline{a}\in F^\mesh$ by \ref{complementInIsotoneGrill}. Thus, setting $F_I \defeq \setbuilder{\overline{a}}{a\in I}$, which is a filter by \ref{filterIdealDuality}, we have $F \amesh F_I$. Thus $F\vee F_I$ is proper by \ref{joinProperFilter} and contained in an ultrafilter $U$ by \ref{ultrafilterLemma}.

Now this $U$ satisfies the requirements. Clearly $U^c\subseteq F^c$ and $I \subseteq \setbuilder{\overline{b}}{b\in U} = U^c$ by \ref{idealFromUltrafilter}.
\end{proof}

\begin{proposition} \label{ChoquetModificationFilterSet}
Let $L$ be a Boolean lattice and $\mathcal{F}$ an upwards closed set of filters and $F\in \filters(L)$. Then the following are equivalent:
\begin{enumerate}
\item $U\in \mathcal{F}$ for all ultrafilters $U\supseteq F$;
\item $F\in \mathfrak{I}^\imf(\mathcal{F}^\mesh)^\mesh$;
\item for all $C\in \mathcal{F}^\mesh$, there exist finitely many $c_0,\ldots, c_n \in C$ such that $c_0 \vee \ldots \vee c_n \in F$.
\end{enumerate}
\end{proposition}
\begin{proof}
By \ref{complementInIsotoneGrill}, we have $F\in \mathfrak{I}^\imf(\mathcal{F}^\mesh)^\mesh = \big(\upset \mathfrak{I}^\imf(\mathcal{F}^\mesh)\big)^\mesh$ iff $F^c \notin \upset \mathfrak{I}^\imf(\mathcal{F}^\mesh)$ iff there exist no ideals $I$ that are subsets of $F^c$ in $\mathfrak{I}^\imf(\mathcal{F}^\mesh)$.

By \ref{idealFromUltrafilter}, this is equivalent to requiring that there are no ideals in $\mathfrak{I}^\imf(\mathcal{F}^\mesh)$ that are subsets of $F^c$ and of the form $U^c$ for some ultrafilter $U$. In other words, all ultrafilters larger than $F$ are not elements of $\mathcal{F}^\mesh$. Again by \ref{complementInIsotoneGrill}, this is equivalent to requiring that all ultrafilters larger than $F$ are elements of $\mathcal{F}$.
\end{proof}

\subsubsection{Image filters and ideals}
Cfr. \ref{imageFilter}.

\begin{proposition} \label{imageFilterProperties}
Let $X, Y$ be sets, $f: X\to Y$ a function, $F\in\powerfilters(X)$ and $G\in\powerfilters(Y)$. Then
\begin{enumerate}
\item if $F$ is proper, then $\upset f^{\imf\imf}[F]$ is proper;
\item if $F$ is an ultrafilter, then $\upset f^{\imf\imf}[F]$ is also an ultrafilter;
\item if $G$ is an ultrafilter, $\im(f)\in G^\mesh$ and $f$ is injective, then $\upset f^{\preimf\imf}[G]$ is also an ultrafilter.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) We have
\[ \emptyset \in \upset f^{\imf\imf}[F] \iff \emptyset\in f^{\imf\imf}[F] \iff \emptyset\in F. \]

(2) We verify $\upset f^{\imf\imf}[F]$ is an ultrafilter with \ref{ultrafilterCriteria}. As $F$ is proper, $\upset f^{\imf\imf}[F]$ is proper by the first point. Now take $B\subseteq Y$ and assume $B\in \upset f^{\imf\imf}[F]^\mesh$. Then, by \ref{meshConnectionSetsOfSets},
\[ B\in \upset f^{\imf\imf}[F]^\mesh \iff \upset f^{\imf\imf}[F] \amesh \{B\} \iff f^{\imf\imf}[F] \amesh \{B\} \iff F \amesh f^{\preimf\imf}[\{B\}] = \{f^\preimf(B)\}. \]
As $F$ is an ultrafilter, we have $f^\preimf(B) \in F$ by \ref{ultrafilterCriteria}. Then $f^{\imf\imf}[F] \ni f^\imf(f^\preimf)(B) \subseteq B$, so $B\in \upset f^{\imf\imf}[F]$.

(3) As before, we verify $\upset f^{\preimf\imf}[G]$ is an ultrafilter with \ref{ultrafilterCriteria}. If $\im(f)\in G^\mesh$, then $\upset f^{\preimf\imf}[G]$ is proper. Now take $A\subseteq X$ and assume $A\in (\upset f^{\preimf\imf}[G])^\mesh$. Then, by \ref{meshConnectionSetsOfSets},
\[ A\in (\upset f^{\preimf\imf}[G])^\mesh \iff \upset f^{\preimf\imf}[G] \amesh \{A\} \iff f^{\preimf\imf}[G] \amesh \{A\} \iff G \amesh f^{\imf\imf}[\{A\}] = \{f^\imf(A)\}. \]
As $G$ is an ultrafilter, we have $f^\imf(A) \in G$ by \ref{ultrafilterCriteria}. As $f$ is injective, we have $A = f^{\preimf}\big(f^\imf(A)\big) \in f^{\preimf\imf}(G)$.
\end{proof}
\begin{corollary}
Let $X, Y$ be sets, $f: X\to Y$ an injective function and $F\in\powerfilters(X)$. Then $\upset f^{\imf\imf}[F]$ is an ultrafilter \textup{if and only if} $F$ is an ultrafilter.
\end{corollary}
\begin{proof}
One direction was shown in (2) of the proposition. For the other, assume $\upset f^{\imf\imf}[F]$ is an ultrafilter. Then $F$ is proper by point (1) and $\upset f^{\preimf\imf}\big[\upset f^{\imf\imf}[F]\big]$ is ultra by point (3) of the proposition and because $f^{\preimf\imf}\big[\upset f^{\imf\imf}[F]\big] \subseteq F$ by \ref{filterPreimageImageGaloisConnection}, $F$ must also be ultra.  
\end{proof}

\begin{lemma}
Let $X, Y$ be sets, $f: X\to Y$ a function and $G\in\powerfilters(Y)$. If $f$ is injective and $\im(f)\in G$, then $f^{\preimf\imf}(G)$ is upwards closed. In particular $f^{\preimf\imf}(G)$ is a filter.
\end{lemma}
\begin{proof}
Take $B\in G$ ans suppose $A\subseteq X$ is such that $f^\preimf(B)\subseteq A$, then we need to show that $A\in f^{\preimf\imf}(G)$. Then
\[ f^\preimf(B)\subseteq A = f^{\preimf}\big(f^\imf(A)\big) \iff f^\imf\big(f^\preimf(B)\big) \subseteq f^\imf(A) \iff B\cap \im(f) \subseteq f^\imf(A).  \]
As $\im(f)\in G$, we have $B\cap \im(f)\in G$ and thus $f^{\imf}(A)\in G$ by upwards closure. Then $A = f^{\preimf}\big(f^\imf(A)\big) \in G^{\preimf\imf}$.
\end{proof}

\begin{lemma} \label{mappingUltrafiltersLemma}
Let $X,Y$ be sets, $f: X\to Y$ a function, $F\in\powerfilters(X)$, $V\in \powerultrafilters(Y)$ and $A\subseteq X$. Then
\begin{enumerate}
\item $V = \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big)$;
\item if $\upset f^{\imf\imf}(F)\subseteq V$, then there exists $U\in \powerultrafilters(X)$ such that $\upset f^{\imf\imf}(U) = V$ and $F\subseteq U$;
\item if $f^{\imf}(A)\in V$, then there exists $U\in \powerultrafilters(X)$ such that $\upset f^{\imf\imf}(U) = V$ and $A\in U$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We have that $V \subseteq \upset f^{\imf\imf}\big(f^{\preimf\imf}V\big)$ by \ref{filterPreimageImageGaloisConnection} and $\upset f^{\imf\imf}\big(f^{\preimf\imf}V\big)$ is proper, so the equality follows because $V$ is ultra.

(2) By \ref{ultrafilterCriteria}, we have $\upset f^{\imf\imf}(F)\subseteq V = V^\mesh$, so by \ref{meshConnectionSetsOfSets}
\[ f^{\imf\imf}(F) \amesh V \iff F\amesh f^{\preimf\imf}(V). \]
Thus $F\vee f^{\preimf\imf}(V)$ is proper by \ref{joinProperFilter}.

Now we can find an ultrafilter $U$ larger than $F\vee f^{\preimf\imf}(V)$ by \ref{ultrafilterLemma}. Clearly $F\subseteq U$. Also $V \subseteq \upset f^{\imf\imf}\big(f^{\preimf\imf}(V)\big) \subseteq \upset f^{\imf\imf}(U)$. As the last filter is still proper, we have $V = \upset f^{\imf\imf}(U)$.

(3) An application of (2) where $F = \upset \{A\}$.
\end{proof}



\subsection{Free and principal filters}
\begin{definition}
Let $L$ be a complete lattice and $F\subseteq L$ a filter.
\begin{itemize}
\item The \udef{kernel} of the filter $F$ is $\ker F \defeq \bigwedge F$.
\item A filter is called \udef{principal} if $\ker F \in F$;
\item A filter is called \udef{free} if $\ker F = \bot$.
\end{itemize}
The set of principal filters in $P$ is denoted $\filters_*(P)$ and the set of free filters in $P$ is denoted $\filters_0(P)$.
\end{definition}
The only filter that is both principal and free is $L$. A proper filter cannot be both principal and free.

\begin{lemma}
Let $L$ be a lattice and $F$ a filter in $L$. Then $F$ is principal \textup{if and only if} $F = \upset \{\ker F\}$.
\end{lemma}
\begin{proof}
First assume $F$ is principal. Then $\upset \{\ker F\}\subseteq F$ by upwards closure. To show the other inclusion, take $a\in F$. Then $\ker(F)\leq a$ by definition, so $F = \upset \{\ker F\}$.

The other direction is immediate.
\end{proof}

\begin{lemma} \label{kernelFilterBase}
Let $L$ be a complete lattice, $F\in\filters(L)$ and $\mathcal{B}$ a base of $F$. Then $\ker(F) = \bigwedge \mathcal{B}$.
\end{lemma}

\begin{proposition} \label{principalUltrafilters}
Let $L$ be a complete lattice and $a\in L$ an atom. Then
\begin{enumerate}
\item $\upset\{a\}$ is a principal ultrafilter;
\item every principal ultrafilter is of this form.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) The filter $\upset\{a\}$ is principal by construction. To show it is an ultrafilter, assume, towards a contradiction, that there exists a strictly larger proper filter $F$ and take $x\in F\setminus \upset\{a\}$. Then $x\wedge a\in F$. Because $x\wedge a \in L$ is smaller than $a$, we have $x\wedge a = \bot$ by atomicity. Thus $\bot \in F$, so $F$ is not proper, which is a contradiction.

(2) Let $\upset\{b\}$ be a principal ultrafilter. Assume, towards a contradiction, that there exists $c\in L$ such that $\bot < c < b$. Then $\upset\{c\}$ is a larger proper filter and thus $\upset\{b\}$ is not an ultrafilter. This is a contradiction.
\end{proof}

\begin{lemma}
Let $L$ be a lattice and $F$ a free filter in $L$. Then
\begin{enumerate}
\item if $G\supseteq F$, then $G$ is also free.
\end{enumerate}
\end{lemma}

\begin{lemma} \label{finiteFiltersPrincipal}
Let $L$ be a lattice. If $L$ is finite, then every filter in $L$ is principal.
\end{lemma}
In particular, every ultrafilter is a principal ultrafilter.
\begin{proof}
Every filter $F$ in a finite lattice is finite, so $\bigwedge F$ is a finite meet, and thus must be in $F$.
\end{proof}

\begin{proposition}
Let $L$ be a lattice and $\mathcal{F}$ a set of filters. Then
\begin{enumerate}
\item $\ker\Big(\bigcap\mathcal{F}\Big) \geq \bigvee_{F\in\mathcal{F}} \ker(F)$;
\end{enumerate}
\end{proposition}
\begin{proof}
(1) As $\ker$ is order-reversing, we can apply \ref{orderPreservingFunctionLatticeOperations}. 
\end{proof}

\begin{proposition} \label{freePrincipalDecomposition}
Let $L$ be a complete Boolean lattice and $F\subseteq L$ a filter. Then there exists a unique pair of filters $F_*$ and $F_0$ such that $F_*$ is principal, $F_0$ is free and
\[ F = F_* \wedge F_0 \qquad L = F_* \vee F_0. \]
These filters are given by
\[ F_* = \upset\left\{\ker(F)\right\} \quad\text{and}\quad F_0 = F\vee \upset\left\{\overline{\ker(F)}\right\}.  \]
\end{proposition}
We call $F_*$ the \udef{principal part} and $F_0$ the \udef{free part} of the filter.
\begin{proof}
We first verify that the given $F_*$ and $F_0$ satisfy the requirements of the decomposition.

We have that $F_0$ is free, because by \ref{kernelFilterBase} and \ref{baseMeetJoinFilters}, we have
\[ \ker(F_0) = \bigwedge_{a\in F} \overline{\ker(F)}\wedge a = \overline{\ker(F)}\wedge \bigwedge_{a\in F} A = \overline{\ker(F)}\wedge \ker(F) = \bot. \]
It is clear that $F_*$ and $F_0$ do not mesh, so $L = F_* \vee F_0$.

Now $F_* \wedge F_0$ has a base $\setbuilder{\left(a\wedge \overline{\ker(F)}\right)\vee \ker(F)}{a\in F}$ by \ref{baseMeetJoinFilters}. We have
\begin{align*}
\left(a\wedge \overline{\ker(F)}\right)\vee \ker(F) &= \left(a\vee \ker(F)\right)\wedge \left(\ker(F) \vee \overline{\ker(F)}\right) \\
&= \left(a\vee \ker(F)\right)\wedge \top = a\vee \ker(F) = a,
\end{align*}
where the last step follows because $\ker(F)\leq a$. Thus $F_* \wedge F_0 = F$ because they have the same base.

Finaly we need to show that the decomposition is unique. We have
\begin{align*}
\ker(F) &= \ker(F_* \wedge F_0) \\
&= \bigwedge_{a\in F_0} \ker(F_*) \vee a \\
&= \ker(F^*) \vee \bigwedge_{a\in F_0}a \\
&= \ker(F_*)\vee \ker(F_0) \\
&= \ker(F_*)\vee \bot = \ker(F_*),
\end{align*}
using \ref{kernelFilterBase}, \ref{baseMeetJoinFilters} and \ref{infiniteDistributiveLawsBooleanLattices}. This uniquely determines the principal filter $F_*$.

In order for $L = F_* \vee F_0$ to hold, we must have some $x\in F_0$ such that $x\wedge \ker(F) = \bot$. This implies $x\leq \overline{\ker(F)}$ by \ref{BooleanComplementLargestDisjoint}, so $F\vee \upset\left\{\overline{\ker(F)}\right\} \subseteq F_0$.

Conversely, take $x\in F_0$. Then $F = F_*\wedge F_0$ implies $x\vee \ker(F) \in F$ and thus
\begin{align*}
x \geq x\wedge \overline{\ker(F)} &= \big(x\wedge \overline{\ker(F)}\big) \vee \bot \\
&= \big(x\wedge \overline{\ker(F)}\big) \vee \big(\ker(F) \wedge \overline{\ker(F)}\big) \\
&= \big(x\vee \ker(F)\big)\wedge \overline{\ker(F)} \in F\vee \upset\left\{\overline{\ker(F)}\right\}.
\end{align*}
This completes the proof of unicity.
\end{proof}
\begin{corollary} \label{ultrafilterPrincipalOrFree}
An ultrafilter is either principal or free.
\end{corollary}
\begin{proof}
Suppose the ultrafilter is neither principal nor free, then is is contained in both its principal and free parts, which are necessarily non-trivial.
\end{proof}


\subsubsection{Trace filters}
\begin{definition}
Let $S$ be a bounded $\wedge$-semilattice, $a\in S$ and $F\in\filters(S)$ such that $a\in F^\mesh$.
Then
\[ F|_a \defeq F\vee \upset\{a\} = \upset\setbuilder{x\wedge a}{x\in F} \]
is a proper filter, called the \udef{trace filter} of $F$ on $a$.
\end{definition}

\begin{lemma} \label{traceFilterLemma}
Let $S$ be a bounded $\wedge$-semilattice, $a\in S$ and $F\in\filters(S)$. Then
\begin{enumerate}
\item $a\in F|_a$;
\item $a\in F$ \textup{if and only if} $F = F|_a$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We have $\top \in F$, so $\top\wedge a = a \in F|_a$.

(2) If $a\in F$, then $\setbuilder{x\wedge a}{x\in F} \subseteq F$ and thus
\[ F \subseteq \upset\setbuilder{x\wedge a}{x\in F} \subseteq F. \]

If $F = F|_a$, then $F$ is a filter on $a$ by point (1).
\end{proof}

\chapter{Domain theory}
\section{Domains}
\begin{definition}
Let $\sSet{P,\Yleft}$ be a poset, $S\subseteq P$ and $x\in P$. Then
\begin{itemize}
\item $S$ is called \udef{consistent} if $S$ has an upper bound;
\item $x$ is called \udef{total} if it is maximal and \udef{partial} if not.
\end{itemize}
\end{definition}


\subsection{Finitary bases and domains}
\begin{definition}
Let $\sSet{B,\leq}$ be a poset. Then $B$ is called a \udef{finitary basis} if
\begin{itemize}
\item $P$ is a countable;
\item every consistent subset has a least upper bound.
\end{itemize}
Elements of $P$ are called \udef{propositions}.

The \udef{domain} $\domain_B$ generated by $B$ is the set of ideals in $B$.
\end{definition}

\begin{lemma}
Let $\sSet{B,\leq}$ be a non-empty finitary basis. Then $B$ has a least element $\bot$.
\end{lemma}
\begin{proof}
The empty set $\emptyset$ is consistent (because every element of $B$ is an upper bound) and thus has a least upper bound (which is exactly a least element in $B$).
\end{proof}

\begin{proposition} \label{directedJoinDomain}
Let $B$ be a finitary basis and $\{A_i\}_{i\in I} \subseteq \domain_B$ be a directed set of ideals of $B$. Then
\[ \dirvee_{i\in I} A_i = \bigcup_{i\in I}A_i \;\in \domain_B. \]
In particular this means that $\sSet{\domain_B, \subseteq}$ is a DCPO.
\end{proposition}
\begin{proof}
It is enough to show that $\bigcup_{i\in I}A_i$ is an ideal. It is downwards closed by \ref{meetJoinRClosedSets}.

Now take $x,y\in \bigcup_{i\in I}A_i$. Then there exists $j,k\in I$ such that $x\in A_j$ and $y\in A_k$. By directedness of $\{A_i\}_{i\in I}$, there exists $m\in I$ such that $A_j\subseteq A_m$ and $A_k \subseteq A_m$. Now by directness of $A_m$, there exists $z\in A_m$ such that $x\leq z$ and $y\leq z$. As $z\in \bigcup_{i\in I}A_i$, we have shown that $\bigcup_{i\in I}A_i$ is directed.
\end{proof}

\begin{proposition}
Let $B$ be a finitary basis. Then an ideal $I\in\domain_B$ is principal \textup{if and only if} it is finite.
\end{proposition}
\begin{proof}
$\boxed{\Rightarrow}$ Assume $I = \downset\{x\}$ is a principal ideal and suppose $I = \dirvee A$ for some directed $A\subseteq \domain_B$. Then, by \ref{directedJoinDomain}, there exists $a\in A$ such that $x\in a$. Then $a = \downset\{x\}$. Indeed, $a \supseteq \downset\{x\}$ by downward closure of $a$ and  $a\subseteq\dirvee A = \downset\{x\}$.

$\boxed{\Leftarrow}$ Assume $I$ is a finite ideal. Then $\setbuilder{\downset\{x\}}{x\in I}$ is a directed set of ideals in $\domain_B$ and $\dirvee\setbuilder{\downset\{x\}}{x\in I} = I$. By finiteness, $I\in \setbuilder{\downset\{x\}}{x\in I}$. In particular, $I$ is principal.
\end{proof}
\begin{corollary} \label{finiteDecompositionIdeal}
Let $B$ be a finitary basis and $I\in\domain_B$ an ideal. Then
\[ I = \dirvee \setbuilder{I'\in \domain_B}{\text{$I'$ is finite and $I'\subseteq I$}}. \]
\end{corollary}

\begin{definition}
In general we call a poset $D$ a \udef{domain} if it is isomorphic to the domain $\domain_B$ generated by some finitary basis $B$.
\end{definition}

\begin{lemma}
Let $D$ be a domain and $\{x_i\}_{i\in I}\subseteq D$. Then
\begin{enumerate}
\item $\bigwedge_{i\in I} x_i$ exists in $D$;
\item if $\{x_i\}_{i\in I}$ is directed, then $\dirvee_{i\in I} x_i$ exists in $D$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Arbitrary intersection of ideals is ideal.

(2) Restatement of \ref{directedJoinDomain}.
\end{proof}

\subsection{Functions on domains}
\subsubsection{Extending functions on bases}
\begin{proposition}
Let $B$ be a finitary basis, $D$ a DCPO and $f: B \to D$ a monotone function. Then there exists a unique Scott-continuous function $f': \domain_B\to D$ such that $f'(\downset x) = f(x)$ for all $x\in B$.
\end{proposition}
\begin{proof}
To show existence, we take
\[ f': \domain_B \to D: \; A \mapsto \dirvee_{x\in A} f(x). \]
Note that directedness is given by \ref{monotonicDirectedness}.

By \ref{monotonicPreservationPrincipalJoinsMeets}, this function satisfies $f'(\downset x) = \dirvee f^\imf(\downset x) = f(x)$ for all $x\in B$.

For Scott-continuity, take a directed set of ideals $\{A_i\}_{i\in I}$ and calculate
\begin{align*}
f'\Big(\dirvee_{i\in I} A_i\Big) &= \dirvee f^\imf\Big(\dirvee_{i\in I}A_i \Big) \\
&= \dirvee f^\imf\Big(\bigcup_{i\in I}A_i \Big) \\
&= \dirvee \bigcup_{i\in I} f^\imf(A_i) \\
&= \dirvee_{i\in I} \dirvee f^\imf(A_i) \\
&= \dirvee_{i\in I} f'(A_i),
\end{align*}
by \ref{joinMeetUnion}.

Uniqueness follows straight from \ref{finiteDecompositionIdeal} and Scott-continuity.
\end{proof}

\subsubsection{Approximable relations}
\begin{definition}
Let $B,C$ be finitary bases. An \udef{approximable relation} is a relation $R$ on $(B,C)$ such that
\begin{itemize}
\item $bR$ is an ideal in $\domain_C$ for all $b\in B$;
\item $Rc$ is upwards closed for all $c\in C$.
\end{itemize}
\end{definition}

\begin{lemma} \label{approximableRelationLemma}
Let $B,C,D$ be finitary bases, $R$ an approximable relation on $(B,C)$ and $S$ an approximable relation on $(C,D)$. Then
\begin{enumerate}
\item $x\leq y \implies xR \subseteq yR$ for all $x,y\in B$;
\item for any ideal $A\in\domain_B$, the set $\{xR\}_{x\in A}$ is directed;
\item $R;S$ is an approximable relation on $(B,D)$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) Take $z\in xR$. Then $x\in Rz$ and so $y\in Rz$ by upwards closure. This means $z\in yR$ and thus $xR \subseteq yR$.

(2) Take $xR, yR \in \{xR\}_{x\in A}$. Then there exists $z\in A$ such that $x\leq z$ and $y\leq z$. Then $xR\subseteq zR$ and $yR \subseteq zR$ by point (1).

(3) Take $b\in B$. Then $b(R;S) = \bigcup _{c\in bR}cS$. This join is directed by point (2) and thus an ideal by \ref{directedJoinDomain}.

Take $d\in D$. Then $(R;S)d = \bigcup_{c\in Sd}Rc$ is a union of downwards closed sets and thus downwards closed.
\end{proof}

\begin{proposition}
Let $B,C$ be finitary bases. Then the set of approximable relations on $(B,C)$, ordered by inclusion, and the set of Scott-continuous functions in $(\domain_B \to \domain_C)$, ordered pointwise, are isomorphic with an isomorphism given by
\[ R\mapsto \big(A\mapsto AR\big) \]
and inverse
\[ f \mapsto \setbuilder{(b,c)\in B\times C}{c \in f(\downset b)}. \]
These maps are functorial (i.e.\ preserve composition).
\end{proposition}
\begin{proof}
We first show that these maps are well-defined. Let $R$ be an approximable relation on $(B,C)$ and $A\in\domain_B$. Then, by \ref{approximableRelationLemma} and \ref{directedJoinDomain}, we have that $AR = \dirvee_{x\in A}xR$ is an ideal in $\domain_C$.

To show Scott continuity, let $\{A_i\}_{i\in I}$ be a directed subset of $\domain_B$. Then Scott continuity follows from
\[ \Big(\dirvee_{i\in I}A_i\Big)R = \Big(\bigcup_{i\in I}A_i\Big)R = \bigcup_{i\in I}A_iR \]
and the fact that $\{A_iR\}_{i\in I}$ is directed (by \ref{monotonicDirectedness}).

Let $f: \domain_B\to\domain_C$ be a Scott-continuous function. Then, for all $x\in B$,
\[ x\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} = \setbuilder{c\in C}{c\in f(\downset x)} = f(\downset x) \]
is clearly an ideal in $\domain_C$.
Now take arbitrary $y\in C$ and $x\in B$ such that
\[ x \in \setbuilder{(b,c)\in B\times C}{c \in f(\downset b)}y \quad \iff\quad y\in f(\downset x). \]
Then, for all $x'\geq x$, we have $\downset x \subseteq \downset x'$, so
\[ y\in f(\downset x) \subseteq f(\downset x') \]
by monotonicity of $f$. This shows that the preimage of $y$ is upwards closed.

To show that the maps are mutual inverses, we observe
\[ \setbuilder{(b,c)\in B\times C}{c \in (\downset b)R} = \setbuilder{(b,c)\in B\times C}{c \in bR} = \setbuilder{(b,c)\in B\times C}{bRc} = R \]
where the first equality is due to \ref{approximableRelationLemma}: if $c\in xR$ for some $x\leq b$, then $c\in bR$ as $xR\subseteq bR$.

Next, we observe that for all $A\in \domain_B$,
\begin{align*}
A\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} &=\dirvee_{x\in A}x\setbuilder{(b,c)\in B\times C}{c \in f(\downset b)} \\
&= \dirvee_{x\in A}\setbuilder{c\in C}{c \in f(\downset x)} \\
&= \dirvee_{x\in A}f(\downset x) \\
&= f\Big(\dirvee_{x\in A}\downset x\Big) = f(A).
\end{align*}

We need to verify that both maps are monotonic. Take $R\subseteq S$ approximable relations on $(B,C)$. Then $AR \subseteq AS$ for all $A\in \domain_B$.

Now take Scott-continuous $f,g: \domain_B\to \domain_C$ such that $f(A)\subseteq g(A)$ for all $A\in \domain_B$. Then
\[ \setbuilder{(b,c)\in B\times C}{c\in f(\downset b)} \subseteq \setbuilder{(b,c)\in B\times C}{c\in g(\downset b)} \]
from $f(\downset b) \subseteq g(\downset b)$.

Finally we prove the maps preserve composition. By \ref{bijectiveHomomorphism} it is enough to show that one of the two maps preserves composition. Indeed $A(R;S) = (AR)S$.
\end{proof}
\begin{corollary}
Let $B$ be a finitary basis. The relation $\geq$ is the approximable relations associated to the identity function.
\end{corollary}
\begin{corollary}
The Scott-continuous functions between domains and approximable relations between finitary bases are isomorphic categories.
\end{corollary}

\subsubsection{Products}
\begin{lemma}
The product of two finitary bases in the category of relational structures (i.e.\ the Cartesian product with pointwise order) is again a finitary basis.
\end{lemma}
\begin{proof}
Let $B,C$ be finitary bases and $S\subseteq B\times C$ a consistent subset bounded by $(b,c)\in B\times C$. Now consider $A_1 = p_1^{\imf}(S)$ and $A_2 = p_1^{\imf}(S)$, which are consistent sets bounded by $b$ and $c$, respectively. Then $x = \bigvee A_1$ and $y = \bigvee A_2$ exist. It is easy to see that $\bigvee S = (x,y)$.
\end{proof}

\begin{lemma} \label{domainProductLemma}
Let $B,C$ be finitary bases. Then $\domain_{B\times C} \cong \domain_B\times\domain_C$ and the isomorphism is given by
\begin{align*}
F&: \domain_B\times\domain_C \to \domain_{B\times C}: & \hspace{-6em} (A_1,A_2) &\mapsto A_1\times A_2 \\
F^{-1}&: \domain_{B\times C} \to \domain_B\times\domain_C: & \hspace{-6em} A&\mapsto \big(p_1^\imf(A), p_2^\imf(A)\big).
\end{align*}
In particular: the product of two domains is again a domain.
\end{lemma}
\begin{proof}
We first verify these maps are mutual inverses. Clearly we have $(A_1, A_2) = \big(p_1^\imf(A_1\times A_2), p_2^\imf(A_1\times A_2)\big)$. Also it is clear that $A \subseteq p_1^\imf(A)\times p_2^\imf(A)$. To show the other inclusion, take $(x,y) \in p_1^\imf(A)\times p_2^\imf(A)$. Then there exist $(x,y')\in A$ and $(x',y)\in A$. By directedness of $A$, we can find $(x^{\prime\prime}, y^{\prime\prime})\in A$ such that
\[ x \leq x^{\prime\prime},\; y' \leq y^{\prime\prime},\; x'\leq x^{\prime\prime} \quad\text{and}\quad y \leq y^{\prime\prime}. \]
Then $(x,y) \leq (x^{\prime\prime}, y^{\prime\prime})$, so $(x,y)\in A$ by downwards closure.

It is easy to see that both maps are monotonic w.r.t. inclusion, so we are done.
\end{proof}

\begin{proposition} \label{productApproximableRelations}
Let $B,C,D$ be finitary bases and $f: \domain_B\to \domain_C$, $g: \domain_B\to \domain_C$ two Scott-continuous functions. Then the functions
\[ p_1: \domain_C\times \domain_D \to \domain_C, \quad p_2: \domain_C\times \domain_D \to \domain_D\,\quad\text{and}\quad (f,g): \domain_B \to \domain_C\times \domain_D \]
are Scott-continuous and
\begin{enumerate}
\item the approximable relation $P_1$ on $(C\times D)\times C$ associated to $p_1: \domain_C\times \domain_D \to \domain_C$ is defined by $(x,y)P_1 z \iff z\leq x$;
\item the approximable relation $P_2$ on $(C\times D)\times D$ associated to $p_2: \domain_C\times \domain_D \to \domain_D$ is defined by $(x,y)P_2 z \iff z\leq y$;
\item the approximable relation $(F,G)$ on $B\times (C\times D)$ associated to $(f,g): \domain_B \to \domain_C\times \domain_D$ is defined by $x \big(F,G\big) (y,z) \iff \big(xFy \land xGz\big)$, where $F$ and $G$ are the approximable relations determined by $f$ and $g$, respectively.
\end{enumerate}
\end{proposition}
In particular this means that the category of Scott-continuous functions between domains (or, equivalently, the category of approximable relations between finitary bases) contains binary products.
\begin{proof}
It is clear (using \ref{domainProductLemma}) that these functions are Scott-continuous.

(1) We calculate $P_1$ as the approximable relation determined by $p_1 \circ \big(p_1^\imf(-), p_2^\imf(-)\big) = p_1^\imf: \domain_{C\times D}\to \domain_C$:
\[ P_1 = \setbuilder{\big((x,y),z\big)\in (C\times D)\times C}{z\in p_1^\imf\big(\downset (x,y)\big)} = \setbuilder{\big((x,y),z\big)\in (C\times D)\times C}{z\leq x}. \]

(2) Similar to (1).

(3) We calculate $(F,G)$ as the approximable relation determined by $(\times)\circ (f,g): \domain_B\to \domain_{C\times D}$:
\begin{align*}
(F,G) &= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{(y,z) \in f(\downset x)\times g(\downset x)} \\
&= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{\big(y \in f(\downset x)\big)\land\big(z\in g(\downset x)\big)} \\
&= \setbuilder{\big(x,(y,z)\big)\in B\times (C\times D)}{xFy\land xGy}.
\end{align*}
\end{proof}

\begin{proposition}
Let $B,C,D$ be finitary bases and $f: \domain_B\times \domain_C\to \domain_D$ a function and $F$ the relation on $(B\times C)\times D$ defined by
\[ (x,y)Fz \;\defequiv\; z\in f\big(\downset (x,y)\big). \]
Then the following are equivalent:
\begin{enumerate}
\item $f$ is Scott-continuous;
\item $f(x,-)$ and $f(-,y)$ are Scott-continuous for all $x\in \domain_B$ and $y\in \domain_C$;
\item $f(\downset b,-)$ and $f(-,\downset c)$ are Scott-continuous for all $b\in B$ and $c\in C$;
\item the relations $F_{b,*}$ and $F_{*,c}$ defined by
\begin{align*}
xF_{b,*}z \quad &\defequiv \quad (b,x)Fz \\
xF_{*,c}z \quad &\defequiv \quad (x,c)Fz
\end{align*}
are approximable.
\end{enumerate}
In this case, $F_{b,*}$ is the approximable relation associated to $f(\downset b,-)$ and $F_{*,c}$ the approximable relation associated to $f(-,\downset c)$.
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ This follows from \ref{productApproximableRelations} and the fact that $\id_{\domain_B}, \id_{\domain_C}, \underline{x}$ and $\underline{y}$ are Scott-continuous:
\[ f(x, -) = f \circ (\underline{x}, \id_{\domain_C}) \qquad\text{and}\qquad f(-, y) = f \circ (\id_{\domain_B}, \underline{y}). \]

$(2) \Rightarrow (3)$ Immediate.

$(3) \Rightarrow (4)$ If $f(\downset b,-)$ is Scott-continuous, then seeing that $F_{b,*}$ is the associated approximable relation is straightforward:
\[ xF_{b,*}z \iff (b,x)Fz \iff z \in f\big(\downset (b,x)\big) = f\big(\downset b \times \downset x\big). \]
The other part is similar.

$(4) \Rightarrow (1)$ It is enough to show that $F$ is approximable, in which case it is the approximable relation associated to the Scott-continuous function $f$.

Take $(x,y)\in B\times C$ and $z\in D$. Clearly $(x,y)F = yF_{x,*}$ is an ideal. Now take $(x',y')\geq (x,y)\in B\times C$, so $x'\geq x$ and $y'\geq y$. Then $y'F_{x,*}z$ by upwards closure of $F_{x,*}$ and we have the implications
\[ y'F_{x,*}z \implies (x,y')Fz \implies xF_{*,y'}z \implies x'F_{*,y'}z \implies (x',y')Fz. \]
We conclude that $Fz$ is upwards closed.
\end{proof}

\chapter{The poset of subsets}
\begin{definition}
Let $U$ be a set. Then $\sSet{\powerset(U), \subseteq}$ is a partially ordered set. We call $U$ the \udef{universe} of this poset.
\end{definition}

Any family of sets $\mathcal{F}$ may be seen as a subset of the poset with universe $\bigcup \mathcal{F}$.


\begin{lemma}
Let $U$ be a set and consider the poset $\sSet{\powerset(U), \subseteq}$. For all $A\subseteq U$ we have $\powerset(A) = \downset\{A\}$.
\end{lemma}
So powersets are principal ideals.

\begin{proposition} \label{posetPowerset}
Let $\mathcal{F}$ be a family of sets. Then $\sSet{\mathcal{F}, \subseteq}$ is a poset.

Conversely, every poset $(P,\preceq)$ is isomorphic to $\sSet{\mathcal{F}, \subseteq}$ for some family of sets $\mathcal{F}$ with universe $P$.
\end{proposition}
\begin{proof}
This is just a reformulation of \ref{orderedSetPowerset}.
\end{proof}
\begin{corollary} \label{MooreFamily}
Let $\mathcal{F}$ be a family of subsets of $U$. If
\begin{itemize}
\item $\mathcal{F}$ is closed under arbitrary intersections; and
\item $U \in \mathcal{F}$;
\end{itemize}
then $\sSet{\mathcal{F},\subseteq}$ is a complete lattice.

Conversely, every complete lattice is isomorphic to such a lattice.
\end{corollary}
Note that in general the join in such a lattice is \emph{not} given by the union, $\bigvee \neq \bigcup$!
\begin{proof}
Such a family of sets is a complete lattice by \ref{completeLatticeBasic}.

For the converse, the isomorphism is given by $x\mapsto \downset x$, as in \ref{orderedSetPowerset}. We just need to show that the meet translates to the intersection, i.e.\ $\downset \bigwedge Q = \bigcap_{x\in Q}\downset x$. We calculate, using \ref{minMaxUpsetDownset} and \ref{boundsFromPrincipalImages}:
\[ \downset \bigwedge Q = \downset \max(Q^l) = \downset Q^l = \downset \bigcap_{x\in Q} \downset x \subseteq \bigcap_{x\in Q} \downset x. \]
For the other inclusion we just note that a lattice order is in particular a  preorder and so we can use \ref{TODO}.
\end{proof}

\begin{definition}
A family of sets $\mathcal{F}$ satisfying the hypothesis of \ref{MooreFamily}, i.e.\
\begin{itemize}
\item $\mathcal{F}$ is closed under arbitrary intersections; and
\item $U \in \mathcal{F}$;
\end{itemize}
is called a \udef{Moore family} or \udef{topped intersection structure}.
\end{definition}

TODO: join is given by union if directed?? (+CPO)??

\section{The complete Boolean lattice of subsets}
\begin{lemma}
Let $U$ be a universe set. Consider the poset $\sSet{\powerset(U), \subseteq}$ and let $\mathcal{F}\subseteq \powerset(U)$. Then
\begin{enumerate}
\item $\sup(\mathcal{F}) = \bigcup \mathcal{F}$;
\item $\inf(\mathcal{F}) = \bigcap \mathcal{F}$.
\end{enumerate}
(Assuming relativised intersection TODO!)
\end{lemma}
\begin{corollary}
Let $U$ be a universe set. Then $\sSet{\powerset(U), \subseteq}$ is a bounded, complete, distributive lattice with top $U$ and bottom $\emptyset$.
\end{corollary}
\begin{proof}
TODO ref distributivity.
\end{proof}

\subsection{Complementation}
\begin{definition}
Let $U$ be a universe and $A\subseteq U$. The \udef{complement} of $A$ w.r.t. $U$ is
\[ A^c \defeq U\setminus A. \]
\end{definition}

\begin{lemma}
The complement $^c$ is a lattice-theoretical complement.
\end{lemma}
\begin{proof}
For all $A\subseteq U$ we have $A\cup A^c = U$ and $A\cap A^c = \emptyset$ from \ref{differenceProperties}.
\end{proof}
\begin{corollary}
Let $U$ be a universe set. Then $\sSet{\powerset(U), \subseteq}$ is a Boolean lattice.
\end{corollary}

In particular de Morgan's laws can be formulated in this context as:
\begin{proposition}
Let $U,A,B$ be sets, then
\begin{align*}
(A\cup B)^c &= (A^c)\cap (B^c); \\
(A\cap B)^c &= (A^c)\cup (B^c).
\end{align*}
Where complementation is with respect to $U$.

This can be extended to arbitrary families of sets:
\begin{align*}
\left(\bigcup \mathcal{E}\right)^c &= \bigcap\setbuilder{A^c}{A\in\mathcal{E}} \\
\left(\bigcap \mathcal{E}\right)^c &= \bigcup\setbuilder{A^c}{A\in\mathcal{E}}
\end{align*}
where $\mathcal{E}$ is a family of sets.
\end{proposition}

\subsection{Expressing set theoretic operations with $\cup,\cap, ^c$}
\begin{proposition}
Let $A,B\subseteq U$ be sets. Then
\begin{enumerate}
\item $A\setminus B = A \cap B^c$;
\item $A\symdiff B = (A\cup B)\cap (A^c\cup B^c)$.
\end{enumerate}
\end{proposition}
\begin{corollary}
Let $A,B \subseteq U$ be sets. Then
\begin{enumerate}
\item $A\setminus B = B^c\setminus A^c$;
\item $A \symdiff B = A^c \symdiff B^c$;
\item $A \symdiff A^c = U$.
\end{enumerate}
\end{corollary}

\subsection{Filters, ideals and grills}

\subsubsection{Mesh Galois connection}
\begin{proposition} \label{meshConnection}
Let $f:X \to Y$ be a function between sets, $A\subseteq X$ and $B\subseteq Y$. Then
\[ f^{\imf}(A)\mesh B \iff A\mesh f^\preimf(B). \]
\end{proposition}
TODO: generalise??
\begin{proof}
We have
\begin{align*}
A\mesh f^\preimf(B) \iff& A\cap f^\preimf(B) \neq \emptyset \\
\implies& f^{\preimf}\big(f^{\imf}(A)\big) \cap f^\preimf(B) \neq \emptyset \\
\iff& f^{\preimf}\big(f^{\imf}(A) \cap B\big) \neq \emptyset \\
\iff& f^{\imf}(A) \cap B \neq \emptyset \\
\iff& f^{\imf}(A)\mesh B.
\end{align*}
For the opposite implication: $f^{\imf}(A) \cap B \neq \emptyset$ implies that there exists $x\in A$ such that $f(x) \in B$. Then $x\in f^\preimf(B)$, so $A\mesh f^\preimf(B)$.
\end{proof}
\begin{corollary} \label{meshConnectionSetsOfSets}
Let $f:X \to Y$ be a function between sets, $F \subseteq \powerset(X)$, $A\subseteq X$ and $G\subseteq \powerset(Y)$. Then
\begin{enumerate}
\item $f^{\imf\imf}(F) \amesh G \iff F \amesh f^{\preimf\imf}(G)$;
\item $f^{\imf\imf}(F)^\mesh = \upset f^{\imf\imf}(F^\mesh)$;
\item if $G$ is a filter, then $f^\imf(A)\in G \implies A \in f^{\preimf\imf}(G)^\mesh$;
\item if $G$ is an ultrafilter, then $f^\imf(A)\in G \iff A \in f^{\preimf\imf}(G)^\mesh$.
\end{enumerate}
\end{corollary}
\begin{proof}
(1) We have
\begin{align*}
f^{\imf\imf}(F) \amesh G &\iff \forall A\in F, B\in G:\; f^{\imf}(A) \mesh B \\
&\iff \forall A\in F, B\in G:\; A \mesh f^\preimf(B) \\
&\iff F \amesh f^{\preimf\imf}(G).
\end{align*}

(2) For any $H\subseteq \powerset(Y)$, we have
\begin{align*}
G\subseteq f^{\imf\imf}(F)^\mesh &\iff G \amesh f^{\imf\imf}(F) \\
&\iff f^{\preimf\imf}(G)\amesh F \\
&\iff f^{\preimf\imf}(G) \subseteq F^\mesh \\
&\iff \upset f^{\preimf\imf}(G) \subseteq F^\mesh \\
&\iff G \subseteq \upset f^{\imf\imf}(F^\mesh),
\end{align*}
where we have used point (1), the fact that $F^\mesh$ is upwards closed (\ref{upwardClosureGrill}) and the Galois connection in \ref{filterPreimageImageGaloisConnection}.

(3) By \ref{properFiltersSelfMesh} and point (1), we have
\begin{align*}
f^\imf(A)\in G \implies& f^\imf(A)\in G^\mesh \\
\iff& f^{\imf\imf}\big(\{A\}\big)\amesh G \\
\iff& \{A\} \mesh f^{\preimf\imf}(G) \\
\iff& A \in f^{\preimf\imf}(G)^\mesh.
\end{align*}

(4) In the previous proof the implication becomes an equivalence by \ref{ultrafilterCriteria}.
\end{proof}

\begin{lemma} \label{meshProductIsotoneSets}
Let $X,Y$ be sets and $F\subseteq \powerset(X), G\subseteq \powerset(Y), H\subseteq \powerset(X\times Y)$ upwards closed. Then
\[ F\otimes G \amesh H \iff \begin{cases}
F \amesh \pi_1^{\imf\imf}(H) \\ G \amesh \pi_2^{\imf\imf}(H)
\end{cases} \]
\end{lemma}
\begin{proof}
First assume $F\otimes G \amesh H$, which is equivalent to $F\otimes G\subseteq H^\mesh$.
By \ref{projectionsOfProductFilter} and \ref{meshConnectionSetsOfSets}, we have
\[ F = \upset\pi_1^{\imf\imf}(F\otimes G) \subseteq \upset\pi_1^{\imf\imf}(H^\mesh) = \pi_1^{\imf\imf}(H)^\mesh. \]
Similarly $G\subseteq \pi_1^{\imf\imf}(H)^\mesh$. Thus $F \amesh \pi_1^{\imf\imf}(H)$ and $G \amesh \pi_2^{\imf\imf}(H)$.

Now assume the right-hand side.
By \ref{meshConnectionSetsOfSets} and \ref{filterFactorisationInequality}, we have
\[ F\otimes G \subseteq \pi_1^{\imf\imf}(H)^\mesh\otimes \pi_2^{\imf\imf}(H)^\mesh = \pi_1^{\imf\imf}(H^\mesh)\otimes \pi_2^{\imf\imf}(H^\mesh) \subseteq H^\mesh, \]
so $F\otimes G \amesh H$.
\end{proof}

\subsubsection{Cofinite filters}
TODO extend to any filter with infinite atoms.
\begin{definition}
Let $X$ be a set and $A\subseteq X$. The \udef{cofinite filter} of $A$ is the filter
\[ (A)_0 \quad\defeq\quad \setbuilder{B\subseteq X}{\text{$A\setminus B$ if finite}}. \]
\end{definition}

\begin{lemma} \label{cofiniteFilterInclusion}
Let $X$ be a set. If $A\subseteq B\subseteq X$, then $(B)_0 \subseteq (A)_0$.
\end{lemma}

\begin{proposition} \label{freeFilterContainsCofiniteFilters}
Let $X$ be a set and $F$ a free filter in $\filters_0(\powerset(X))$. If $A\in F$, then $F$ contains $(A)_0$.
\end{proposition}
\begin{proof}
Take some cofinite subset $C$ of $A$, such that $A\setminus C = \{x_1, \ldots, x_n\}$ is finite. Now for each $x_i$ we can find a set $f_i\in F$ such that $x_i\notin f_i$, because if this was not possible, then $x_i \in \bigcap F$, but $\bigcap F = \emptyset$ due to $F$ being free. Also $\bigcap_{i=1}^n f_i \in F$, because $F$ is closed under finite intersections.

So $(A\setminus C)\cap (\bigcap_{i=1}^n f_i) = \emptyset$, or equivalently $\bigcap_{i=1}^n f_i \subseteq X\setminus (A\setminus C)$, meaning $X\setminus (A\setminus C) \in F$ and thus $C = A\cap (X\setminus (A\setminus C)) \in F$.
\end{proof}
\begin{corollary} \label{filterFreeIFFfinerThanCofinite}
A filter $F\in\powerfilters(X)$ is free \textup{if and only if} it contains $(X)_0$.
\end{corollary}
\begin{proof}
The direction $\Rightarrow$ is immediate from the proposition.

For the other direction, note that for any $x\in X$, we have $X\setminus\{x\} \in (X)_0 \subseteq F$, so $x\notin \ker(F)$. Thus $\ker(F) = \emptyset$.
\end{proof}
\begin{corollary} \label{cofiniteFiltersSameIffDifferenceFinite}
Let $X$ be a set and $A,B\subseteq X$. Then $(A)_0 = (B)_0$ \textup{if and only if} $A\symdiff B$ is finite.
\end{corollary}
\begin{proof}
First assume $(A)_0 = (B)_0$. Then $A$ is an element of the cofinite filter of $B$ and vice versa. Thus there exist finite sets $C, C'\subseteq X$ such that $A\setminus C \subseteq B$ and $B\setminus C' \subseteq A$.
By \ref{residuationSetBooleanLattice} this implies $A\setminus B \subseteq C$ and $B\setminus A \subseteq C'$, so $A\symdiff B \subseteq C\cup C'$, which is finite.

Now assume $A\symdiff B$ is finite. It is enough to show that $(A)_0\subseteq (B)_0$ (the other inclusion follows by symmetry). By the proposition it is enough to show that $A$ is an element of the cofinite filter of $B$. This is immediate from $B\setminus (A\symdiff B) \subseteq A$ (which follows from $B\setminus A\subseteq A\symdiff B$ by \ref{residuationSetBooleanLattice}).
\end{proof}

\begin{lemma} \label{cofiniteFilterNotUltra}
Cofinite filters are never ultrafilters.
\end{lemma}
\begin{proof}
Assume, towards a contradiction, that $(A)_0$ is an ultrafilter.

If $A$ is finite, then $(A)_0$ is not proper and thus not an ultrafilter.

If $A$ is infinite, then we can partition $A$ into two disjoint infinite sets (TODO ref) $A_1$ and $A_2$.

Then $(A)_0 \subseteq (A_1)_0$ by \ref{cofiniteFilterInclusion}, but $(A)_0 \neq (A_1)_0$ by \ref{cofiniteFiltersSameIffDifferenceFinite}, because $A\setminus A_1$ is infinite.
\end{proof}

\begin{proposition} \label{cofiniteBaseFreePart}
Let $X$ be a set, $F\in \powerfilters(X)$ and $\mathcal{B}$ a base of $F$. The free part of $F$, $F_0$, is given by
\[ F_0 = \bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0. \]
\end{proposition}
\begin{proof}
By \ref{freePrincipalDecomposition} the free part $F_0$ has base
\[ \setbuilder{\ker(F)^c\cap B}{B\in \mathcal{B}} = \setbuilder{B\setminus \ker(F)}{B\in \mathcal{B}}. \]

By \ref{freeFilterContainsCofiniteFilters}, we have $\big(B\setminus \ker(F)\big)_0 \subseteq F_0$ for all $B\in\mathcal{B}$, so $\bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0 \subseteq F_0$.

For the other inclusion, we note that each element $A\in F_0$ contains $B\setminus\ker(F)$ for some $B\in\mathcal{B}$, so
\[ A\in \big(B\setminus\ker(F)\big)_0 \subseteq \bigvee_{B\in\mathcal{B}}\big(B\setminus \ker(F)\big)_0. \]
\end{proof}

\subsubsection{Principal ultrafilters}
Let $X$ be a set. The atoms in $\powerset(X)$ are the singletons $\{x\}$ for $x\in X$. By \ref{principalUltrafilters}, the principal ultrafilters in $\powerfilters(X)$ are of the form $\upset\big\{\{x\}\big\}$ for some $x\in X$.

\begin{definition}
Let $X$ be a set and $x\in X$. We denote the principal ultrafilter as
\[ \pfilter{x} \quad \defeq \quad \upset\big\{\{x\}\big\}. \]
\end{definition}


\begin{proposition}
Let $X$ be a set. If $X$ is infinite, then there exists a non-principal ultrafilter in $\powerfilters(X)$.
\end{proposition}
This proposition assumes the ultrafilter lemma \ref{ultrafilterLemma}.
\begin{proof}
Consider the cofinite filter $F = \setbuilder{A\subseteq X}{X\setminus A\;\text{is finite}}$. By the ultrafilter lemma, \ref{ultrafilterLemma}, we can extend $F$ to an ultrafilter $\mathcal{U}$. Now $\mathcal{U}$ does not contain any sets of the form $\{x\}$ with $x\in X$. If it did, then it would contain both $\{x\}$ and $X\setminus\{x\}$, meaning it would also contain $\emptyset$ and thus would not be proper and in particular not an ultrafilter.
\end{proof}

\subsubsection{Covers}
\begin{definition}
Let $X$ be a set. A \udef{cover} of $X$ is a family of filters $\mathcal{F}\subseteq \powerfilters(X)$ such that $\bigcap \mathcal{F} = \{X\}$.
\end{definition}

\begin{lemma} \label{principalUltrafilterInCover}
Let $X$ be a set and $\mathcal{F}$ a cover of $X$. Then for all $x\in X$ there exists $F\in \mathcal{F}$ such that $F\subseteq \pfilter{x}$.
\end{lemma}
\begin{proof}
Because $\{x\}^c \notin \{X\} = \bigcap \mathcal{F}$, there must be $F\in \mathcal{F}$ such that $\{x\}^c \notin F$. Then $\{x\} \in F^\mesh$ by \ref{complementInIsotoneGrill}, so $x$ is in all elements of $F$, i.e. $F\subseteq \pfilter{x}$.
\end{proof}
Similar idea: the meet of a set of free filters is a least the cofinite filter $(X)_0$ by \ref{filterFreeIFFfinerThanCofinite}.

\section{Multisets and annotated sets}
\begin{definition}
Let $U, X$ be sets.
\begin{itemize}
\item An \udef{$X$-annotation} of $U$ is a function $U\to X$.
\item A \udef{multiset} over $U$ is an $\N$-annotation of $U$, i.e.\ a function $M: U\to \N$.
\end{itemize}
\end{definition}

\subsection{Relations and operations with multisets}
\subsubsection{Relations with multisets}
\begin{definition}
Let $U$ be a set, $M,N: U\to \N$ multisets and $x\in U$. We define
\begin{itemize}
\item $x\in M \defequiv m(x) \neq 0$;
\item $M\subseteq N \defequiv M \leq N$.
\end{itemize}
\end{definition}

\subsubsection{Operations on multisets}
\begin{definition}
Let $U$ be a set, $M,N: U\to \N$ multisets and $x\in U$. We define
\begin{itemize}
\item $M\cup N \defeq \max(M,N)$;
\item $M\cap N \defeq \min(M,N)$;
\item $M\uplus N \defeq M+N$;
\item $M\setminus N \defeq x\mapsto\begin{cases}
M(x) - N(x) & \big(M(x) \geq N(x)\big) \\
0 & (\text{otherwise}).
\end{cases}$
\end{itemize}
\end{definition}

\subsection{Dershowitz-Manna ordering}
\begin{definition}
Let $\sSet{U,\Yleft}$ be an ordered set. The TODO
\end{definition}

\subsection{Indicator functions}
\begin{definition}
Let $U$ be a set and $A\subseteq U$. The \udef{indicator function} or \udef{characteristic function} of $A$ as an element of $\powerset(U)$ is defined as
\[ \charFunc{A}: U\to \{0,1\}: x\mapsto \begin{cases}
1 & x\in A \\ 0 & x\notin A.
\end{cases} \]
\end{definition}

\begin{lemma}
Let $U$ be a set. The characteristic function $\chi$ determines a bijection between the subsets of $U$ and the multisets $M$ with $\im(M)\subseteq \{0,1\}$.
\end{lemma}

\begin{lemma}
Let $A,B$ be elements of $\powerset(U)$. Then
\begin{enumerate}
\item $\chi_{A\cap B} = \min\{\chi_A,\chi_B\} = \chi_A\cdot \chi_B$;
\item $\chi_{A\cup B} = \max\{\chi_A,\chi_B\} = \chi_A + \chi_B - \chi_A\cdot \chi_B$;
\item $\chi_{A\uplus B} = \chi_A + \chi_B$;
\item $\chi_{A^c} = \underline{1}-\chi_A$; and thus $\chi_A + \chi_{A^c} = \underline{1}$;
\item $\chi_{A\Delta B} \begin{aligned}[t] &= \chi_A + \chi_B - \underline{2}\cdot\chi_A\cdot \chi_B \\
&= |\chi_A - \chi_B| \\
&= \chi_A + \chi_B \mod 2 \defeq \begin{cases}
1 & (\chi_A + \chi_B = 1) \\
0 & \text{(else)}
\end{cases}
\end{aligned}$.
\end{enumerate}
Where all operations are defined point-wise.
\end{lemma}

\begin{proposition}
The indicator functions define a bijection between $\powerset(U)$ and $(U\to \{0,1\})$.
\end{proposition}

\subsection{Iverson bracket}
\begin{definition}
Let $P$ be some proposition. Then we define the \udef{Iverson bracket} of $P$ as
\[ [P] \;\defeq\; \begin{cases}
0 & (\text{$P$ is false}) \\
1 & (\text{$P$ is true}).
\end{cases} \]
\end{definition}

TODO properties \url{https://en.wikipedia.org/wiki/Iverson_bracket}.

\section{Families of sets}
\subsection{Subset algebraic structures}
\begin{definition}
Let $U$ be a set.
\begin{itemize}
\item A \udef{family of subsets} of $U$ is an element $\mathcal{F}\subseteq\powerset(U)$, i.e.\ $\mathcal{F}\in\powerset^2(U)$.
\item A \udef{type of (partial) subsetalgebra} $\boldsymbol{T}$ is a set of set theoretical operations.
\item A \udef{$\boldsymbol{T}$-subsetalgebra} on $U$ is a family of subsets of $U$ that is closed under all operations of $\boldsymbol{T}$.
\end{itemize}
A \udef{$\boldsymbol{T}$-space} is a pair $\sSet{U,\mathcal{F}}$, where $U$ is a set and $\mathcal{F}$ is a $\boldsymbol{T}$-subsetalgebra on $U$.
\end{definition}
Most commonly we have
\[ \boldsymbol{T} \subseteq \{\cup,\; \cap,\; \bigcup_\omega,\; \bigcap_\omega,\; \bigcup,\; \bigcap,\; \biguplus,\; \dirvee,\; \bigcup_\text{monotone}, \bigcap_\text{monotone}, \setminus,\; ^c,\; \symdiff \} \]

\begin{proposition}
Let $U$ be a set and $\boldsymbol{T}$ a type of (partial) subsetalgebra. Then the $\boldsymbol{T}$-subalgebras of $\powerset(U)$ form a $\wedge$-subsemilattice of $\powerset^2(U)$.
\end{proposition}

\subsubsection{Compatible functions}
\begin{definition}
Let $\sSet{X, \mathcal{X}}$, $\sSet{Y, \mathcal{Y}}$ be $\boldsymbol{T}$-spaces. A function $f: X\to Y$ is called \udef{$\boldsymbol{T}$-compatible} if
\[ f^{\preimf\imf}(\mathcal{Y}) \subseteq \mathcal{X}. \]
\end{definition}

\begin{proposition} \label{compositionCompatibleFunctions}
Composition of compatible functions is compatible.
\end{proposition}
\begin{proof}
Let $f: \sSet{X,\mathcal{X}} \to \sSet{Y,\mathcal{Y}}$ and $g: \sSet{Y,\mathcal{Y}} \to \sSet{Z,\mathcal{Z}}$ be compatable functions. Then
\[ \mathcal{X} \supseteq f^{\preimf\imf}(\mathcal{Y}) \supseteq f^{\preimf\imf}\big(g^{\preimf\imf}(\mathcal{Z})\big) = (f^{\preimf} \circ g^{\preimf})^{\imf}(\mathcal{Z}) = (g\circ f)^{\preimf\imf}(\mathcal{Z}), \]
so $g \circ f$ is compatable.
\end{proof}

\begin{lemma} \label{commutationTclosure}
Let $f: X\to Y$ be a function and $\mathcal{F}\subseteq \powerset(Y)$ some set of subsets. Then $f^{\preimf\imf}\big(\boldsymbol{T}(\mathcal{F})\big) = \boldsymbol{T}\big(f^{\preimf\imf}(\mathcal{F})\big)$.
\end{lemma}
\begin{proof}
TODO
\end{proof}

We want to show $t$ commutes with operations iff $t^{\imf}$ commutes with closure.

TODO $T$-algebras! Monad $\powerset$ + multiple partially defined functions $\powerset(\mathcal{F}) \to \mathcal{F}$.

Then (for $t\in \boldsymbol{T}$):
\[ t(t(A)\cup B) = t(A\cup B). \]

\subsubsection{Initial and final subsetalgebras}
\begin{definition}
Let $Y$ be a set.
\begin{itemize}
\item Given a set of $\boldsymbol{T}$-spaces $\{\sSet{Z_i,\mathcal{Z}_i}\}_{i\in I}$ and a set of functions $\{f_i: Y\to Z_i\}_{i\in I}$, we define the \udef{initial $\boldsymbol{T}$-subsetalgebra} $\mathcal{F}$ on $Y$ w.r.t. $\{f_i: Y\to Z_i\}$ as the greatest $\boldsymbol{T}$-subsetalgebra on $Y$ that makes all functions in $\{f_i: Y\to Z_i\}$ compatible:
\[ \mathcal{F} = \bigvee \setbuilder{\mathcal{Y}}{\forall i\in I: \;\text{$f_i: \sSet{Y,\mathcal{Y}} \to \sSet{Z_i, \mathcal{Z}_i}$ compatible}}. \]
\item Given a set of $\boldsymbol{T}$-spaces $\{\sSet{X_i,\mathcal{X}_i}\}_{i\in I}$ and a set of functions $\{g_i: X_i \to Y\}_{i\in I}$, we define the \udef{final $\boldsymbol{T}$-subsetalgebra} $\mathcal{G}$ on $Y$ w.r.t. $\{g_i: X_i\to Y\}$ as the smallest $\boldsymbol{T}$-subsetalgebra on $Y$ that makes all functions in $\{g_i: X_i \to Y\}$ compatible:
\[ \mathcal{G} = \bigwedge \setbuilder{\mathcal{Y}}{\forall i\in I: \;\text{$g_i: \sSet{X_i,\mathcal{X}_i} \to \sSet{Y, \mathcal{Y}}$ compatible}}. \]
\end{itemize}
\end{definition}

\begin{proposition}
Let $Y$ be a set, $\{\sSet{Z_i,\mathcal{Z}_i}\}_{i\in I}$ a set of $\boldsymbol{T}$-spaces and $\{f_i: Y\to Z_i\}_{i\in I}$ a set of functions. Then the initial $\boldsymbol{T}$-subsetalgebra on $Y$ is given by
\[ \boldsymbol{T}\Big( \bigcup_{i\in I}f_i^{\preimf\imf}(\mathcal{Z}_i). \Big) \]
\end{proposition}
\begin{corollary}
A function $g: \sSet{X,\mathcal{X}}\to Y$ from some $\boldsymbol{T}$-space to $Y$ is compatible \textup{if and only if} $f_i\circ g$ is compatible for all $i\in I$.
\[ \begin{tikzcd}
Y \rar["f_i"] & Z_i \\
X \uar["g"] \arrow[ur, swap, "{f_i\circ g}"]
\end{tikzcd} \]
\end{corollary}
\begin{proof}
The direction $\Rightarrow$ is given by \ref{compositionCompatibleFunctions}.

For the other direction, we note that the compatibility of $g$ is equivalent to
\[ g^{\preimf\imf}\bigg(\boldsymbol{T}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big)\bigg) \subseteq \mathcal{X}. \]
By \ref{commutationTclosure}, this is equivalent to
\[ \boldsymbol{T}\bigg(g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big)\bigg) \subseteq \mathcal{X}. \]
This is equivalent to the $g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big) \subseteq \mathcal{X}$, by $\boldsymbol{T}$-closure of $\mathcal{X}$. Finally we note
\[ g^{\preimf\imf}\Big(\bigcup_{i\in I}f_i^{\preimf \imf}(\mathcal{Z}_i)\Big) = \bigcup_{i\in I}g^{\preimf\imf}\big(f_i^{\preimf \imf}(\mathcal{Z}_i)\big) = \bigcup_{i\in I}(f_{i}\circ g)^{\preimf\imf}(\mathcal{Z}_i). \]
So the compatibility of $g$ is implied by  the compatability of all $f_i\circ g$.
\end{proof}

\subsubsection{Subset subsetalgebras}
\begin{definition}
Let $\sSet{X,\mathcal{X}}$ be a $\boldsymbol{T}$-algebra and $A\subseteq X$ a subset. Then the \udef{subset $\boldsymbol{T}$-algebra} on $A$ is the initial $\boldsymbol{T}$-algebra on $A$ w.r.t. the inclusion map $A\hookrightarrow X$.
\end{definition}

\subsubsection{Product subsetalgebras}
\begin{definition}
Let $\{\sSet{X_i,\mathcal{X}_i}\}_{i\in I}$ be a set of $\boldsymbol{T}$-algebras. Then the \udef{product $\boldsymbol{T}$-algebra} is the initial $\boldsymbol{T}$-algebra on $\bigtimes X_i$ w.r.t. the projection maps $\{p_j: \bigtimes_{i\in I}X_i\to X_j\}_{j\in I}$.
\end{definition}



\subsection{Closure under set operations}
We say a family of sets $\mathcal{F}$ is closed under an operation if the result of this operation acting on sets in $\mathcal{F}$ is again in $\mathcal{F}$.

\begin{definition}
A family of sets $\mathcal{F}\subseteq\powerset(U)$ is called
\begin{itemize}
\item \udef{closed under complementation} if $A^c\in\mathcal{F}$ for all $A\in\mathcal{F}$;
\item \udef{closed under relative complements} if $A\setminus B\in\mathcal{F}$ for all $A \supset B\in\mathcal{F}$;
\item \udef{closed under set difference} if $A\setminus B\in\mathcal{F}$ for all $A, B\in\mathcal{F}$;
\end{itemize}
and
\begin{itemize}
\item \udef{closed under finite unions} if $A\cup B \in\mathcal{F}$ for all $A,B\in\mathcal{F}$;
\item \udef{closed under finite intersections} if $A\cap B \in\mathcal{F}$ for all $A,B\in\mathcal{F}$;
\item \udef{closed under disjoint unions} if $\biguplus_{i\in I}A_i \in\mathcal{F}$ for any indexed family of disjoint sets $\{A_i\}_{i\in I}$;
\item \udef{closed under countable monotone unions} if $\bigcup_{i=1}^\infty A_i \in\mathcal{F}$ for any indexed family of sets $\{A_i\}_{i\in \N}$ such that $i\leq j \implies A_i \subseteq A_j$;
\item \udef{closed under countable monotone intersections} if $\bigcap_{i=1}^\infty A_i \in\mathcal{F}$ for any indexed family of sets $\{A_i\}_{i\in \N}$ such that $i\leq j \implies A_i \supseteq A_j$.
\end{itemize}
Our definition of closure under relative complements is \emph{not} the same as closure under set difference! Our definition is non-standard as they are usually taken to be the same thing.
\end{definition}

For all these set-theoretical operations, ``closed under X'' is the same as ``being X-subalgebra''.

\subsubsection{Complementation, relative complementation and set difference}
In general the notions of closure under complementation, relative complementation and set difference are distinct, the only implication being from set difference to relative complementation.

\begin{lemma} \label{complementTypesUnionClosure}
Let $\mathcal{F}$ be a family of sets that is closed under finite (disjoint) unions. Then
\[ \begin{tikzcd}[row sep=0]
\text{$\mathcal{F}$ is closed under set differences} \arrow[dr, Rightarrow] & \\
\text{$\mathcal{F}$ is closed under complementation} \arrow[r,Rightarrow] & \text{$\mathcal{F}$ is closed under relative complements.}
\end{tikzcd} \]
\end{lemma}
\begin{proof}
Assume $A\supset B$, then $A\setminus B = A^c \uplus B$. This is a disjoint union.
\end{proof}

\begin{lemma}
Let $\mathcal{F}$ be a family of sets that is closed under finite intersections. Then
\[ \text{closure under complements} \quad\implies\quad \text{closure under set difference} \quad\iff\quad \text{closure under relative complements.} \]
All three are equivalent if $\mathcal{F}$ contains the universe set.
\end{lemma}
\begin{proof}
$A\setminus B = A\cap B^c$ and $A\setminus B = A\setminus (B\cap A)$.
\end{proof}

\begin{lemma} \label{closureSetDifference}
Let $\mathcal{F}$ be a family of sets. Then
\[ \text{closure under set differences} \quad\implies\quad \text{closure under finite intersections.} \]
\end{lemma}
\begin{proof}
$A\cap B = A\setminus (A\setminus B)$.
\end{proof}

Any non-empty family of sets that is closed under set differences is also an order-theoretic ring.

\subsubsection{Types of closure for unions and intersections}
\begin{lemma} \label{unionsIntersectionClosureImplications}
Let $\mathcal{F}$ be a family of sets. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=tiny]
&& \text{countable disjoint $\uplus$} \\
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[ur, Rightarrow] \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable monotone $\cup$} \\
&& \text{finite $\cup$}
\end{tikzcd} \]
and for closure under intersections:
\[ \begin{tikzcd}[row sep=0em]
&& \text{countable monotone $\cap$} \\
\text{arbitrary $\cap$} \arrow[r, Rightarrow] & \text{countable $\cap$} \arrow[ur, Rightarrow] \arrow[dr, Rightarrow] &  \\
&& \text{finite $\cap$}
\end{tikzcd} \]
\end{lemma}


The implications in \ref{unionsIntersectionClosureImplications} for unions can be simplified, if $\mathcal{F}$ is closed under relative complementation:
\begin{lemma} \label{typesOfUnionsRelativeComplementation}
Let $\mathcal{F}$ be a family of sets that is closed under relative complementation. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=0em]
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable disjoint $\uplus$} \arrow[r, Rightarrow] & \text{countable monotone $\cup$} \\
&& \text{finite $\cup$} &
\end{tikzcd} \]
\end{lemma}
\begin{proof}
We need to prove that closure under countable disjoint unions implies closure under countable monotone unions.

Assume $\mathcal{F}$ closed under countable disjoint unions. Let $\{A_i\}_{i\in \N}$ be a monotonically increasing family of sets. Then we can recursively define a family $\{D_i\}_{i\in \N}$ by $D_0=\emptyset$ and
\[ D_{i+1} = A_{i+1}\setminus D_i. \]
This is allowed because $A_{i+1}\supset A_i \supset D_i$. By induction we see that $\{D_i\}_{i\in \N}$ is a disjoint family and has the same union as $\{A_i\}_{i\in \N}$.
\end{proof}

These implications can be further simplified, if $\mathcal{F}$ is closed under set differences:
\begin{lemma}
Let $\mathcal{F}$ be a family of sets that is closed under set differences. Then we have the following implications for closure under unions:
\[ \begin{tikzcd}[row sep=0em]
\text{arbitrary $\cup$} \arrow[r, Rightarrow] & \text{countable $\cup$} \arrow[r, Leftrightarrow] & \text{countable disjoint $\uplus$} \arrow[r, Rightarrow] \arrow[dr, Rightarrow] & \text{countable monotone $\cup$} \\
&&& \text{finite $\cup$}
\end{tikzcd} \]
\end{lemma}
\begin{proof}
We just need to prove that closure under countable disjoint unions implies closure under countable unions.

This can be done with the same construction of $\{D_i\}_{i\in \N}$ as before because now the assignment $D_{i+1} = A_{i+1}\setminus D_i$ works for arbitrary families $\{A_i\}_{i\in \N}$, not just monotone ones.
\end{proof}

\subsubsection{Countable unions and intersections: Summe $\sigma$ and Durchsnitt $\delta$}
TODO move?

\begin{definition}
Let $\Omega$ be a set and $\mathcal{F}\subseteq \powerset(\Omega)$ a family of subsets. Then
\begin{itemize}
\item $\mathcal{F}_\sigma$ is the closure of $\mathcal{F}$ under countable unions;
\item $\mathcal{F}_\delta$ is the closure of $\mathcal{F}$ under countable intersections.
\end{itemize}
\end{definition}

TODO Borel hierarchy and Descriptive set theory.

\subsection{Monotone classes}
\begin{definition}
A family of sets $\mathcal{F}$ is called a \udef{monotone class} if it is closed under both countable monotone unions and countable monotone intersections.
\end{definition}

\subsubsection{Dynkin systems}
\begin{definition}
A \udef{Dynkin system} of sets (also known as a \udef{$\lambda$-system} or \udef{d-system}) is a pair of a set $\Omega$ and a collection of sets $D\subset\powerset(\Omega)$ such that
\begin{itemize}
\item $\Omega\in D$;
\item if $A\in D$, then $A^c\in D$;
\item if $(A_i)_{i\in\N}$ is a countable sequence of pairwise disjoint sets in $D$, then $\biguplus_{i=1}^\infty A_i\in D$.
\end{itemize}
\end{definition}

\begin{lemma}
A pair of a set $\Omega$ and a family of subsets $D$ is a Dynkin system \textup{if and only if}
\begin{itemize}
\item $\Omega\in D$;
\item $D$ is closed under relative complements: if $A,B\in D$ and $A\supset B$, then $A\setminus B\in D$;
\item $D$ is closed under countable monotone unions.
\end{itemize}
\end{lemma}
\begin{proof}
Call the original set of axioms Ax1 and this set of axioms Ax2.

$\boxed{\text{Ax1}\implies\text{Ax2}}$ Point (2) follows from \ref{complementTypesUnionClosure} and point (3) follows from \ref{typesOfUnionsRelativeComplementation}.

$\boxed{\text{Ax2}\implies\text{Ax1}}$ Point (2) follows immediately. For point (3): let $A,B$ be disjoint sets. Then $A^c \supset B$ and so $A\cup B = (A^c\setminus B)^c \in D$, meaning $D$ is closed under finite unions of disjoint sets. Now let $(A_i)_{i\in\N}$ be a countable sequence of pairwise disjoint sets. Then
\[ \biguplus_{i=1}^\infty A_i = \bigcup_{i=1}^\infty \left(\biguplus_{j=1}^i A_j\right) \]
which is a countable monotone union.
\end{proof}

\begin{lemma}
A Dynkin system is a monotone class.
\end{lemma}
\begin{proof}
If $\bigcap_{i=1}^\infty A_i$ is a countable monotone intersection, then $\left(\bigcap_{i=1}^\infty A_i\right)^c = \bigcup_{i=1}^\infty A_i^c$ is a countable monotone union.
\end{proof}

\subsection{$\pi$-systems}
TODO: directed set!
\begin{definition}
A \udef{$\pi$-system} is a collection of sets $P$ such that
\begin{itemize}
\item $P$ is not empty;
\item if $A,B\in P$, then $A\cap B\in P$.
\end{itemize}
\end{definition}

TODO $\{\cap\}$-subalgebra of $\powerset(U)$.

\begin{lemma}
Let $\mathcal{F}$ be a collection of sets. If $\mathcal{F}$ is closed under set differences, then it is a $\pi$-system.
\end{lemma}
\begin{proof}
By \ref{closureSetDifference}.
\end{proof}

For $\pi$-systems the intersection implications in \ref{unionsIntersectionClosureImplications} reduce to:
\begin{lemma} \label{piSystemunionsIntersectionClosureImplications}
Let $\mathcal{F}$ be a $\pi$-system. Then we have the following implications for closure under intersections:
\[ \text{arbitrary $\cap$} \quad\implies\quad \text{countable $\cap$} \quad\iff\quad \text{countable monotone $\cap$} \]
\end{lemma}
\begin{proof}
We need to prove that closure under countable monotone intersections implies closure under countable intersections.

Assume $\mathcal{F}$ is a $\pi$-system closed under countable monotone intersections. Let $\{A_i\}_{i\in \N}$ be an indexed family of sets. Then we can define the family $\{B_i\}_{i\in \N}$ recursively by $B_1 = A_1$ and
\[ B_{i+1} = B_i \cap A_{i+1}. \]
By induction we see that $\{B_i\}_{i\in \N}$ is monotone and has the same intersection as $\{A_i\}_{i\in \N}$.
\end{proof}

\subsubsection{Intersections structures}
\begin{definition}
Let $\mathcal{F} \subseteq \powerset(U)$ be a family of sets. We call $\mathcal{F}$ an \udef{intersection structure} if it is closed under arbitrary intersections.

If an intersection structure contains the universe set, it is called a \udef{topped intersection structure} or \udef{closure system}.
\end{definition}

TODO $\{\cap_{\omega}\}$-subalgebra of $\powerset(U)$.

\subsubsection{Rings}
\begin{definition}
Let $U$ be a set. Then
\begin{itemize}
\item an \udef{order-theoretic ring} on $U$ is a $\{\cup,\cap\}$-subalgebra of $\powerset(U)$;
\item a \udef{measure-theoretic ring} on $U$ is a $\{\cap,\setminus\}$-subalgebra of $\powerset(U)$;
\item a \udef{$\sigma$-ring} in $U$ is a $\{\cap, \cup_\omega,\setminus\}$-subalgebra of $\powerset(U)$;
\item a \udef{$\delta$-ring} in $U$ is a $\{\cap_\omega,\setminus\}$-subalgebra of $\powerset(U)$.
\end{itemize}
\end{definition}

\paragraph{Order-theoretic ring}
TODO: sublattice!
\begin{definition}
An \udef{order-theoretic ring} of sets is a non-empty collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{R}$, then $A\cup B\in \mathcal{R}$;
\item if $A,B\in \mathcal{R}$, then $A\cap B\in \mathcal{R}$.
\end{itemize}
\end{definition}

\paragraph{Semi-rings}
\begin{definition}
A \udef{semi-ring} is a non-empty collection of sets $\mathcal{S}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{S}$, then $A\cap B\in \mathcal{S}$;
\item if $A,B\in \mathcal{S}$, then $A\setminus B$ is a finite disjoint union of sets in $\mathcal{S}$.
\end{itemize}
\end{definition}

\begin{lemma} \label{emptysetElementSemiring}
Let $\mathcal{S}$ be a semi-ring. Then $\emptyset \in \mathcal{S}$.
\end{lemma}
\begin{proof}
Because $\mathcal{S}$ is non-empty, we can take $A\in \mathcal{S}$. Then $A\setminus A = \emptyset$ is a finite disjoint union of sets in $\mathcal{S}$, so $\emptyset \in \mathcal{S}$.
\end{proof}

\begin{proposition} \label{productSemiring}
Let $\mathcal{R}$ and $\mathcal{S}$ be semi-rings. Then
\[ \setbuilder{A\times B}{A\in\mathcal{R}, B\in\mathcal{S}} \]
is a semi-ring.
\end{proposition}
\begin{proof}
Closure under intersection follows from
\[ (A_1\times B_1) \cap (A_2\times B_2) = (A_1\cap A_2)\times(B_1\cap B_2). \]
We also have
\[ (A_1\times B_1) \setminus (A_2\times B_2) = \big((A_1\setminus A_2)\times(B_1\setminus B_2)\big) \uplus \big((A_1\setminus A_2)\times(B_1\cap B_2)\big) \uplus \big((A_1\cap A_2)\times(B_1\setminus B_2)\big), \]
which verifies the other requirement.
\end{proof}

\paragraph{Measure-theoretic rings}
\begin{definition}
A \udef{(measure-theoretic) ring} of sets is a non-empty collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item if $A,B\in \mathcal{R}$, then $A\cup B\in \mathcal{R}$;
\item if $A,B\in \mathcal{R}$, then $A\setminus B\in \mathcal{R}$.
\end{itemize}
\end{definition}
By \ref{closureSetDifference} a measure-theoretic ring is in particular a $\pi$-system and an order-theoretic ring.

\begin{lemma}
A non-empty collection of sets $\mathcal{R}$ is a measure-theoretic ring \textup{if and only if}
\begin{itemize}
\item it is closed under finite intersections;
\item it is closed under symmetric differences.
\end{itemize}
\end{lemma}
\begin{proof}
By the identities $A\cup B = (A\symdiff B)\symdiff (A\cap B)$ and $A\setminus B = A\symdiff (A\cap B)$.
\end{proof}

\begin{lemma} \label{ringFromSemiRing}
Let $\mathcal{S}$ be a semi-ring. Then the smallest ring $\mathcal{R}$ containing $\mathcal{S}$ is
\[ \mathfrak{R}\{\mathcal{S}\} = \setbuilder{E_1\uplus\ldots\uplus E_n}{\text{$E_i\in \mathcal{S}$ are pairwise disjoint}}. \]
We call this the ring \udef{generated} by $\mathcal{S}$.
\end{lemma}
\begin{proof}
Every ring containing $\mathcal{S}$ must contain $\mathfrak{R}\{\mathcal{S}\}$, so if it is a ring it is automatically the smallest. We just need to show it is a ring. Let $E,F$ be arbitrary elements of $\mathfrak{R}\{\mathcal{S}\}$. We need to show that both $E\setminus F$ and $E\cup F$ are in $\mathfrak{R}\{\mathcal{S}\}$.

Now $E\cup F = (E\setminus F) \uplus F$ can be written as a disjoint union, so we just need to write $E\setminus F$ as a pairwise disjoint union of elements of $\mathcal{S}$. To that end write $E = \biguplus_{i=0}^nE_i$ and $\biguplus_{j= 0}^mF_j$. Then
\[ E\setminus F = \biguplus_{i=0}^n \left[ \Big(\big((E_j\setminus F_1)\setminus F_2\big)\setminus \ldots\Big)\setminus F_m \right]. \]
By induction and using the semi-ring property we can see that this is expressible as a finite pairwise disjoint union of elements of $\mathcal{S}$, and thus is an element of $\mathfrak{R}\{\mathcal{S}\}$.
\end{proof}

\paragraph{$\sigma$- and $\delta$-rings}
\begin{definition}
A \udef{$\sigma$-ring} of sets is a collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item $\mathcal{R}$ is a measure-theoretic ring;
\item $\mathcal{R}$ is closed under countable unions.
\end{itemize}
A \udef{$\delta$-ring} of sets is a collection of sets $\mathcal{R}$ such that
\begin{itemize}
\item $\mathcal{R}$ is a measure-theoretic ring;
\item $\mathcal{R}$ is closed under countable intersections.
\end{itemize}
\end{definition}

\subsubsection{Algebras of sets}
\begin{definition}
An \udef{algebra of sets} on a set $\Omega$ (also known as a \udef{field of sets}) is a ring that contains $\Omega$.
\end{definition}

In principle we can thus define
\begin{itemize}
\item order-theoretic algebra;
\item semi-algebra;
\item measure-theoretic algebra;
\item $\sigma$-algebra;
\item $\delta$-algebra.
\end{itemize}

Some of these notions coincide.

\begin{lemma} \label{setAlgebraCoincidence}
Let $\mathcal{A}$ be a family of sets. Then
\begin{enumerate}
\item $\mathcal{A}$ is an order-theoretic algebra \textup{if and only if} it is a measure-theoretic algebra;
\item $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} it is a $\delta$-algebra.
\end{enumerate}
\end{lemma}

So we define define \udef{semi-algebra}, \udef{algebra} and \udef{$\sigma$-algebra}.

\begin{lemma} \label{setAlgebraCriteria}
A family of sets $\mathcal{A}$ is a semi-algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A,B\in \mathcal{A}$, then $A\cap B\in \mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c$ is a finite disjoint union of sets in $\mathcal{A}$.
\end{itemize}
A family of sets $\mathcal{A}$ is an algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c\in \mathcal{A}$;
\item if $A,B\in \mathcal{A}$, then $A\cup B\in \mathcal{A}$.
\end{itemize}
A family of sets $\mathcal{A}$ is a $\sigma$-algebra on $\Omega$ \textup{if and only if}
\begin{itemize}
\item $\Omega\in\mathcal{A}$;
\item if $A\in \mathcal{A}$, then $A^c\in \mathcal{A}$;
\item if $(A_i)_{i\in\N}$ is a countable sequence of sets in $\mathcal{A}$, then $\bigcup_{i=1}^\infty A_i\in \mathcal{A}$.
\end{itemize}
\end{lemma}

\begin{example}
Let $\Omega$ be a set.
\begin{itemize}
    \item The power set $\powerset(\Omega)$ is a $\sigma$-algebra on $\Omega$.
    \item The set of finite and cofinite subsets of $\Omega$ is an algebra.
    \item The set of countable and cocountable subsets of $\Omega$ is a $\sigma$-algebra.
\end{itemize}
\end{example}

\begin{lemma} \label{algebraFromSemiAlgebra}
The ring generated by a semi-algebra is an algebra. Thus for a semi-algebra, the following closures coincide:
\begin{enumerate}
\item closure under finite disjoint union;
\item closure in the lattice of algebras;
\item closure in the lattice of rings.
\end{enumerate}
\end{lemma}
\begin{proof}
The ring generated by a semi-ring containing $\Omega$, still contains $\Omega$ and thus is an algebra.

See \ref{ringFromSemiRing} for the coincidence of (1) and (3).

By definition we must have $(3) \subseteq (2)$. By the first statement we have $(2) \subseteq (3)$.
\end{proof}

\begin{lemma} \label{algebraMonotoneClass}
An algebra $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} $\mathcal{A}$ is a monotone class.
\end{lemma}
\begin{lemma} \label{DynkinPiSystem}
A Dynkin system is a $\sigma$-algebra \textup{if and only if} it is a $\pi$-system.
\end{lemma}


\begin{lemma}
\begin{enumerate}
\item The countable monotone union of a sequence of $\sigma$-algebras is an algebra, but not necessarily a $\sigma$-algebra.
\item Any arbitrary intersection of $\sigma$-algebras is a $\sigma$-algebra.
\end{enumerate}
\end{lemma}

\begin{lemma}
Let $\mathcal{A}$ be a $\sigma$-algebra on $\Omega$ and $B\subset \Omega$. Then $B\cap \mathcal{A} = \setbuilder{B\cap A}{A\in\mathcal{A}}$ is a $\sigma$-algebra on $B$.
\end{lemma}

\subsection{Generators}
TODO: $\boldsymbol{T}$-generators, denoted $\boldsymbol{T}\{\mathcal{F}\}$.
\begin{definition}
Let $\mathcal{F}$ be a family of subsets of $\Omega$. Then we define
\begin{itemize}
\item the $\sigma$-algebra generated by $\mathcal{F}$, $\sigma\{\mathcal{F}\}$;
\item the monotone class generated by $\mathcal{F}$, $\mathfrak{M}\{\mathcal{F}\}$; and
\item the Dynkin system generated by $\mathcal{F}$, $\mathfrak{D}\{\mathcal{F}\}$;
\end{itemize}
the intersection of all such families $\subseteq \powerset(\Omega)$ that contain $\mathcal{F}$.

In each case we call $\mathcal{F}$ the \udef{generator} of the system.
\end{definition}
These intersections are again $\sigma$-algebras, monotone classes and Dynkin systems, respectively. So these generated families are the smallest such families containing $\mathcal{F}$.

\begin{example}
\begin{itemize}
\item If $\mathcal{A}$ is a $\sigma$-algebra, then $\sigma\{\mathcal{A}\} = \mathcal{A}$.
\item If $\mathcal{A} = \{A\}$, a single set, then $\sigma\{\mathcal{A}\} = \{\emptyset, A,A^c,\Omega\}$.
\end{itemize}
\end{example}

\begin{lemma} \label{unitGeneratedSets}
A universe set for $\mathcal{F}$ is also a universe set for $\sigma\{\mathcal{F}\}$, $\mathfrak{M}\{\mathcal{F}\}$ and $\mathfrak{D}\{\mathcal{F}\}$.
\end{lemma}

\begin{proposition}[Monotone class theorem] \label{monotoneClassTheorem}
Let $\mathcal{A}$ be an algebra. Then
\[ \mathfrak{M}\{\mathcal{A}\} = \sigma\{\mathcal{A}\}. \]
\end{proposition}
\begin{proof}
Every $\sigma$-algebra is a monotone class, so $\mathfrak{M}\{\mathcal{A}\} \subset \sigma\{\mathcal{A}\}$.

For the other inclusion it is enough to show that $\mathfrak{M}\{\mathcal{A}\}$ is an algebra: using \ref{algebraMonotoneClass} we have
\[ \text{$\mathfrak{M}\{\mathcal{A}\}$ is an algebra} \implies \text{$\mathfrak{M}\{\mathcal{A}\}$ is a $\sigma$-algebra} \implies \sigma\{\mathcal{A}\}\subset\mathfrak{M}\{\mathcal{A}\}. \]
In particular, due to \ref{setAlgebraCriteria}, we verify $\Omega\in \mathfrak{M}\{\mathcal{A}\}$, $B^c \in \mathfrak{M}\{\mathcal{A}\}$ and $B\cup C \in \mathfrak{M}\{\mathcal{A}\}$.

$\boxed{\Omega\in \mathfrak{M}\{\mathcal{A}\}}$ By \ref{unitGeneratedSets}.

$\boxed{B^c \in \mathfrak{M}\{\mathcal{A}\}}$ Define
\[ \mathcal{E}_1 = \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{B^c\in\mathfrak{M}\{\mathcal{A}\}} \]
which is a monotone class by De Morgan's laws:
\[ (B_i)_{i=1}^\infty\subset \mathcal{E}_1 \implies (B_i^c)_{i=1}^\infty\subset \mathfrak{M}\{\mathcal{A}\} \implies \bigcup_{i=1}^\infty B_i^c = \left(\bigcap_{i=1}^\infty B_i\right)^c \in\mathfrak{M}\{\mathcal{A}\} \implies \bigcap_{i=1}^\infty B_i \in \mathcal{E}_1. \]
Also $\mathcal{E}_1\subset \mathfrak{M}\{\mathcal{A}\}$, so $\mathcal{E}_1 = \mathfrak{M}\{\mathcal{A}\}$ by minimality, so
\[ B\in\mathfrak{M}\{\mathcal{A}\} \iff B\in\mathcal{E}_1 \implies B^c\in\mathfrak{M}\{\mathcal{A}\}. \]

$\boxed{B\cup C \in \mathfrak{M}\{\mathcal{A}\}}$ Define
\begin{align*}
\mathcal{E}_2 &= \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{\forall C\in\mathcal{A}: B\cup C \in\mathfrak{M}\{\mathcal{A}\}} \\
\mathcal{E}_3 &= \setbuilder{B\in\mathfrak{M}\{\mathcal{A}\}}{\forall C\in\mathfrak{M}\{\mathcal{A}\}: B\cup C \in\mathfrak{M}\{\mathcal{A}\}}.
\end{align*}
Now $\mathcal{E}_2$ and $\mathcal{E}_3$ are monotone classes: by \ref{setAssociativityCommutativity} and \ref{setDistributivity}, for $k=1,2$
\[ (B_i)_{i=1}^\infty\subset \mathcal{E}_k \implies \forall C: (B_i\cup C)_{i=1}^\infty\subset \mathfrak{M}\{\mathcal{A}\} \implies \forall C: \bigcup_{i=1}^\infty B_i\cup C = \left(\bigcup_{i=1}^\infty B_i\right)\cup C \in\mathfrak{M}\{\mathcal{A}\} \implies \bigcup_{i=1}^\infty B_i \in \mathcal{E}_k. \]
Now clearly $\mathcal{A}\subseteq\mathcal{E}_2$, so by minimality $\mathcal{E}_2 = \mathfrak{M}\{\mathcal{A}\}$. Moreover,
\[ D\in\mathcal{A}\implies \forall C\in \mathcal{E}_2: C\cup D\in \mathfrak{M}\{\mathcal{A}\} \implies \forall C\in \mathfrak{M}\{\mathcal{A}\}: D\cup C\in \mathfrak{M}\{\mathcal{A}\} \implies D\in \mathcal{E}_3. \]
So $\mathcal{A}\subseteq\mathcal{E}_3$ and by minimality $\mathcal{E}_3 = \mathfrak{M}\{\mathcal{A}\}$, which means that
\[ B\in\mathfrak{M}\{\mathcal{A}\} \iff B\in\mathcal{E}_3 \implies \forall C\in\mathfrak{M}\{\mathcal{A}\}: B\cup C\in\mathfrak{M}\{\mathcal{A}\}. \]
\end{proof}
\begin{corollary}
Let $\mathcal{A}$ be an algebra and $M$ a monotone class with $\mathcal{A}\subseteq M$, then $\sigma\{\mathcal{A}\}\subseteq M$.
\end{corollary}

\begin{proposition} \label{generatedDynkinSigma}
If $\mathcal{F}$ is a $\pi$-system on $\Omega$, then
\[ \mathfrak{D}\{\mathcal{F}\} = \sigma\{\mathcal{F}\}. \]
In particular a Dynkin system is a $\sigma$-algebra \textup{if and only if} it is closed under finite intersections.
\end{proposition}
\begin{proof}
Every $\sigma$-algebra is a Dynkin system, so $\mathfrak{D}\{\mathcal{F}\} \subset \sigma\{\mathcal{F}\}$.

For the other inclusion it is enough to show that $\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system: using \ref{DynkinPiSystem}, we have
\[ \text{$\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system} \implies \text{$\mathfrak{D}\{\mathcal{F}\}$ is a $\sigma$-algebra} \implies \sigma\{\mathcal{F}\}\subset\mathfrak{D}\{\mathcal{F}\}. \]

To this end we define
\[ \mathcal{D}_B = \setbuilder{A\subset\Omega}{A\cap B\in\mathfrak{D}\{\mathcal{F}\}} \qquad \text{for some $B\in\mathfrak{D}\{\mathcal{F}\}$,} \]
which we claim is a Dynkin system.
\begin{itemize}[leftmargin=2.5cm]
\item[$\boxed{\Omega\in\mathcal{D}_B}$] Because $\Omega\cap B = B$.
\item[$\boxed{A^c\in\mathcal{D}_B}$] Let $A\in\mathcal{D}_B$. Then
\[ A^c\cap B = (\Omega\setminus A)\cap B = (\Omega\cap B)\setminus(A\cap B) \in \mathfrak{D}\{\mathcal{F}\}, \]
so $A^c\in\mathcal{D}_B$.
\item[$\boxed{\biguplus_{i\in \N}A_i \in \mathcal{D}_B}$] Let $(A_i)_{i=1}^\infty$ be a disjoint family of sets in $\mathcal{D}_B$. Then, using \ref{setDistributivity},
\[ \left(\bigcup_{i=1}^\infty A_i\right)\cap B = \bigcup_{i=1}^\infty (A_i\cap B) \in \mathfrak{D}\{\mathcal{F}\}, \]
so $\bigcup_{i=1}^\infty A_i\in\mathcal{D}_B$.
\end{itemize}
Now because $\mathcal{F}$ is a $\pi$-system, we have $\mathcal{F}\subset\mathcal{D}_B$ and thus $\mathcal{D}_B\subset\mathfrak{D}\{\mathcal{F}\}$.

Now for all $B\in\mathcal{F}$, we have
\[ A\in\mathcal{F}\implies A\cap B\in\mathcal{F}\implies A\cap B\in\mathfrak{D}\{\mathcal{F}\} \implies A\in \mathcal{D}_B. \]
So $\mathcal{F}\subset \mathcal{D}_B$ if $B\in\mathcal{F}$. In this case we then also have $\mathfrak{D}\{\mathcal{F}\}\subset \mathcal{D}_B$.

In fact this holds for all $B\in\mathfrak{D}\{\mathcal{F}\}$:
\[ B\in\mathfrak{D}\{\mathcal{F}\} \implies \forall A\in\mathcal{F}: B\in\mathcal{D}_A \implies  \forall A\in\mathcal{F}: B\cap A \in \mathfrak{D}\{\mathcal{F}\} \implies \mathcal{F}\subset\mathcal{D}_B \implies \mathfrak{D}\{\mathcal{F}\}\subset \mathcal{D}_B. \]
Consequently,
\[ B,C\in\mathfrak{D}\{\mathcal{F}\} \implies C\in\mathcal{D}_B \implies C\cap B\in\mathfrak{D}\{\mathcal{F}\}, \]
meaning $\mathfrak{D}\{\mathcal{F}\}$ is a $\pi$-system.
\end{proof}
\begin{corollary}[$\pi$-$\lambda$ theorem] \label{piLambdaTheorem}
Let $P$ be a $\pi$-system and $D$ a Dynkin system with $P\subseteq D$, then $\sigma\{P\} \subseteq D$.
\end{corollary}
\begin{corollary}
If $\mathcal{A}$ is an algebra, then $\mathfrak{M}\{\mathcal{A}\} = \mathfrak{D}\{\mathcal{A}\} = \sigma\{\mathcal{A}\}$.
\end{corollary}
\begin{corollary} \label{conditionAlgebraIsSigmaAlgebra}
If $\mathcal{A}$ is an algebra, then $\mathcal{A}$ is a $\sigma$-algebra \textup{if and only if} it is closed under either countable monotone unions or countable disjoint unions.
\end{corollary}
\begin{proof}
Either of these conditions makes $\mathcal{A}$ a Dynkin system. The result follows from the previous corollary.
\end{proof}

\subsubsection{Product structures}
\subsubsection{Finite products}
\begin{definition}
Let $X,Y$ be sets, $\mathcal{A}\subseteq \powerset(X), \mathcal{B}\subseteq\powerset(Y)$ and $\boldsymbol{T}$ the signature of a set-theoretical algebra. Then the \udef{product $\boldsymbol{T}$-algebra} of $\mathcal{A}$ and $\mathcal{B}$ is
\[ \mathcal{A}\otimes\mathcal{B} \defeq \boldsymbol{T}\setbuilder{A\times B}{A\in \mathcal{A}, B\in \mathcal{B}}. \]
\end{definition}
Notice that in general for $\boldsymbol{T}$-algebras $\mathcal{A},\mathcal{B}$, the set $\setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$ is not a $\boldsymbol{T}$-algebra. It is necessary to take the closure.

\begin{example}
Take $\Omega = \{a,b,c\}$. Define the $\sigma$-algebras $\mathcal{A},\mathcal{B}$ on $\Omega$ by
\begin{align*}
\mathcal{A} &= \{\emptyset, \{a\}, \{b,c\}, \Omega\} \\
\mathcal{B} &= \{\emptyset, \{a, b\}, \{c\}, \Omega\}.
\end{align*}
Then $\{a\}\times\{a,b\} \in \setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$, but
\[ (\{a\}\times\{a,b\})^c = \Big(\{b,c\}\times \{a,b,c\}\Big) \cup \Big(\{a, b ,c\}\times\{c\}\Big) \]
is not in $\setbuilder{A\times B}{A\in \mathcal{A}, B\in\mathcal{B}}$, so it is not a $\sigma$-algebra.
\end{example}

\begin{lemma}
Let $X,Y$ be sets and $A\subseteq X, B\subseteq Y$ subsets. Then
\[ (A\times B)^c = A^c\times B \uplus A\times B^c \uplus A^c\times B^c = A^c\times Y \cup X\times B^c. \]
\end{lemma}
\begin{proof}
We have $X\times Y = (A\uplus A^c)\times (B\uplus B^c)$ and the lemma follows by \ref{productUnionIntersection}.
\end{proof}

\subsubsection{Infinite products}
\begin{definition}
Let $I$ be an index set, $\{X_i\}_{i\in I}$ a set of sets and $\{\mathcal{A}_i\}_{i\in I}$ a set of $\boldsymbol{T}$-algebras such that for all $i\in I$, $\mathcal{A}_i$ is a $\boldsymbol{T}$-algebra on $X_i$. We define the \udef{product $\boldsymbol{T}$-algebra} $\bigotimes_{i\in I}\mathcal{A}_i$ on $\prod_{i\in I}X_i$ as
\[ \bigotimes_{i\in I}\mathcal{A}_i \defeq \boldsymbol{T}\setbuilder{\prod_{i\in I}A_i}{\forall i\in I: A_i\in\mathcal{A}_i\; \text{and}\; \setbuilder{i\in I}{A_i\neq X_i}\;\text{is finite}}. \]
\end{definition}

\begin{proposition}
We may replace ``is finite'' with ``is countable'' in the definition.
\end{proposition}
\begin{proof}
TODO (can we??)
\end{proof}

\section{Filter-valued functions}
\begin{definition}
Let $X$ be a set and $f: X\to \powerfilters(X) \subseteq \powerset^2(X)$ a filter-valued function. Then the \udef{contour} of $f$ along $A\in \powerset(X)$ is defined as
\[ f(A) \defeq \bigcap_{a\in A} f(a) \]
and the \udef{contour} of $f$ along $\mathcal{A}\in\powerset^2(X)$ is defined as
\[ f(\mathcal{A}) \defeq \bigcup_{A\in\mathcal{A}}\bigcap_{a\in A} f(a). \]
\end{definition}

\begin{lemma}
Let $X$ be a set, $f: X\to \powerfilters(X) \subseteq \powerset^2(X)$ a filter-valued function, $A\subseteq X$ and $\mathcal{A}\in\powerset^2(X)$. Then
\begin{enumerate}
\item $f(\mathcal{A}) = f(\upset\mathcal{A})$;
\item $f(A) = f(\{A\}) = f(\pfilter{A})$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We note that if $A\subseteq B$, then $\bigcap_{a\in A} f(a) \supseteq \bigcap_{b\in B} f(b)$. Thus $f(\{A,B\}) = f(\{A\})$.

(2) $f(A) = \bigcap_{a\in A} f(a) = \bigcup_{A\in\{A\}}\bigcap_{a\in A} f(a)$.
\end{proof}

\begin{proposition}
Let $X$ be a set and $f: X\to \powerfilters(X) \subseteq \powerset^2(X)$ a filter-valued function. If $\mathcal{A}$ is a filter, then $f(\mathcal{A})$ is a filter.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\chapter{Successors and induction}
\section{The successor and predecessor functions}


\begin{definition}
Let $\sSet{X,\Yleft}$ be an ordered set. We define the \udef{successor function}
\[ S_X: X \to \powerset(X): x\mapsto \llmin\big(\upset\{x\}\setminus \downset\{x\}\big). \]
Similarly, we define the \udef{predecessor function}
\[ P_X: X\to \powerset(X): x\mapsto \llmax\big(\downset\{x\}\setminus \upset\{x\}\big). \]
Let $x\in X$. We call
\begin{itemize}
\item $x$ a \udef{successor point} if there exists an $y\in X$ such that $y\in S_X(y)$;
\item $x$ a \udef{predecessor point} if there exists an $y\in X$ such that $y\in P_X(y)$;
\item $x$ a \udef{(forwards) limit point} if it has no predecessor and is not an element of $\min(X)$;
\item $x$ a \udef{backwards limit point} if it has no successor and is not an element of $\max(X)$.
\end{itemize}
\end{definition}

If $\sSet{X,\Yleft}$ is an ordered set, we can always add a point on top of all the rest: We can take, e.g.\ the set
\[ t_X = \setbuilder{x\in X}{x\notin x}. \]
This is guaranteed, by proposition \ref{russelParadox}, not to be in $X$.
The poset $X\cup t_X$ is called the \udef{successor} $\operatorname{Succ}(X)$ of $X$.

\begin{proposition}
Let $\sSet{X,\Yleft}$ be an ordered set and $x,y\in X$. Then
\[ y \in S_X(x) \;\iff\; x\in P_X(y). \]
\end{proposition}
\begin{proof}
We calculate, using \ref{disjointSetDifference} and transitivity (for $\upset\{x\}\setminus \downset\{x\} = xR\setminus Rx$),
\begin{align*}
y \in S_X(x) &\iff y\in \llmin\big(\upset\{x\}\setminus \downset\{x\}\big) \\
&\iff y\in \llmin\big(xR\setminus Rx\big) \\
&\iff Ry \cap \big(xR\setminus Rx\big) \subseteq yR \\
&\iff \big(Ry\setminus yR\big) \perp \big(xR\setminus Rx\big) \\
&\iff xR \cap \big(Ry\setminus yR\big) \subseteq Rx \\
&\iff x\in \llmax\big(Ry\setminus yR\big) \\
&\iff x\in \llmax\big(\downset\{y\}\setminus \upset\{y\}\big) \\
&\iff x \in P_X(y).
\end{align*}
\end{proof}

\begin{lemma}
Let $\sSet{X,\Yleft}$ be an ordered set and $x\in X$. Then for all $y\in \sup\big(\downset\{x\}\setminus \upset\{x\}\big)$ we have either
\begin{itemize}
\item $y\in P_X(x)$; or
\item $y\sim_\Yleft x$.
\end{itemize}
\end{lemma}
\begin{proof}
Take arbitrary $y\in \sup\big(\downset\{x\}\setminus \upset\{x\}\big)$. First suppose $y\in\big(\downset\{x\}\setminus \upset\{x\}\big)$. Then $y\in \max\big(\downset\{x\}\setminus \upset\{x\}\big) \subseteq \llmax\big(\downset\{x\}\setminus \upset\{x\}\big) = P_X(x)$.


Now suppose $y\notin\big(\downset\{x\}\setminus \upset\{x\}\big)$. Then it is enough to show $y\in \downset\{x\}$ because this then implies $y\in \upset\{x\}$. To this end we calculate
\[ x\in \big(\downset\{x\}\setminus \upset\{x\}\big)^\Yleft \subseteq \sup\big(\downset\{x\}\setminus \upset\{x\}\big)^\Yleft \subseteq \{y\}^\Yleft = y{\Yleft}, \]
using \ref{supInfPreserveOrder}. This means that $y \Yleft x$, or $y\in \downset\{x\}$.
\end{proof}
\begin{corollary} \label{supLesserElementsOfLimitPoint}
If $x\in X$ is a limit point, then
\[ \sup\big(\downset\{x\}\setminus \upset\{x\}\big) \subseteq [x]_{\sim_\Yleft}. \]
\end{corollary}


\section{Well-founded and well-ordered sets}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure.
Then $A$ is called
\begin{itemize}
\item \udef{strictly well-founded} if every non-empty subset has a strictly minimal element;
\item \udef{well-founded} if every non-empty subset has a minimal element;
\item \udef{loosely well-founded} if every non-empty subset has a loosely minimal element.
\end{itemize}
Additionally, $A$ is called
\begin{itemize}
\item \udef{well-ordered} if every non-empty subset has a minimum. In this case $R$ is said to be a \udef{well-ordering}.
\end{itemize}
A set is called \udef{well-orderable} if it admits a well-ordering.
\end{definition}
TODO $A$ set? The requirement that $A$ be a set makes it easier to quantify over all subsets.

It turns out well-foundedness is what is needed to do recursion and induction. TODO: equivalence induction principle and well-foundedness!!

Note we do not impose antisymmetry.

\begin{proposition}
A relational structure $\sSet{A,R}$ is (strictly) well-founded \textup{if and only if} $\sSet{A,R^+}$ is (strictly) well-founded.
\end{proposition}
\begin{proof}
Let $S \subseteq A$ be some subset. If $x\in S$ is (strictly) $R^+$-minimal, then $x$ is (strictly) $R$-minimal. Thus (strictly) well-foundedness of $\sSet{A,R^+}$ implies (strictly) well-foundedness of $\sSet{A,R}$.

Now suppose $\sSet{A,R}$ is (strictly) well-founded. Then $\relconvex_R(S)$ has a (strictly) $R$-minimal $x$ and $x\in X$ by \ref{addedElementsRConvexHull}. We have that $x$ is (strictly) $R^+$-minimal in $\relconvex_R(S)$ by \ref{maximalityMinimalityRConvexSets}. It is then also a (strictly) $R^+$-minimal in $X$ by \ref{minimalMaximalSubset}.
\end{proof}

\begin{proposition} \label{wellOrderedCondition}
Let $\sSet{A,R}$ be a relational structure. Then the following are equivalent:
\item $A$ is well-ordered;
\item $A$ is loosely well-founded and connex.
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ Assume $A$ well-ordered. Then every non-empty subset has a minimum, which is also loosely minimal by \ref{maximumIsMaximal}. So $A$ is well-founded.

Now take any $x,y\in A$. We need to show $xRy$ or $yRx$. We have that $\{x,y\}$ has a minimum. If $x$ is a minimum, then $xRy$. If $y$ is a minimum, then $yRx$.

$(2) \Rightarrow (1)$ Now assume $A$ is well-founded and connex and take some non-empty subset $S$ of $A$. Now $S$ is also connex, so each minimal element of $S$ is a minimum by \ref{maximumIsMaximal}.
\end{proof}

\begin{proposition}
Every antisymmetric well-ordering is transitive.
\end{proposition}
\begin{proof}
Let $\sSet{A,R}$ be a well-ordered relational structure and take $x,y,z\in A$ such that $xRy$ and $yRz$. We need to prove that $xRz$.

Consider the set $\{x,y,z\}$. It must have a least element. If the least element is $x$, then $xRz$ and we are done. If the least element is $y$, then $yRx$, so $x=y$ by antisymmetry and $yRz$ is the same as $xRz$. Finally if $z$ is the least element, then by a similar argument, $y=z$ and $xRz$.
\end{proof}

\begin{lemma}
Every well-ordering has a least element.
\end{lemma}
\begin{proof}
Every set is a subset of itself.
\end{proof}

\begin{lemma}
Let $\sSet{X,\leq}$ be a well-ordering and $x\in X$. Then $\downset S(x) = \downset\{x\}\cup S(x)$.
\end{lemma}
\begin{proof}

\end{proof}

\begin{lemma} \label{wellOrderingSubsets}
Let $(U,\leq_U)$ be a well-ordered set and $f: W \rightarrowtail U$ an injection. Then $W$ is well-ordered by
\[ \forall x,y\in W: x\leq_W y \defequiv f(x) \leq_U f(y). \]


In particular, if $W\subseteq U$ is a subset, then $\leq_W$ is the left- and right-restriction of $\leq$ to $W$, $\leq|_W^W$.
\end{lemma}
TODO: initial ordering??



\subsection{Succession in well-ordered sets}
Let $U$ be a well-ordered set with antisymmetric ordering $\leq$. Then the low end of $U$ it looks like $\N$:
\begin{itemize}
\item let $0_U$ denote the (unique) least element of $U$;
\item we can define $S_U(x) \defeq \min\setbuilder{y\in U}{x\leq y \land x\neq y}$.
\end{itemize}
This successor function is defined for all $x\in U$, except the maximum (if it exists).

TODO: picture.

\begin{definition}
The first limit point (i.e.\ the minimum in the set of limit points) is denoted $\omega_U$ or just $\omega$.
\end{definition}
Note that $\omega_U$ exists by definition of well-ordering.

\subsection{Initial segments in well-ordered sets}
\begin{proposition}
Let $\sSet{X,\leq}$ be a well-ordered set and $S$ an upwards closed subset. Then $S = \upset\min(S)$.

Thus every upwards closed set is a principal up set.
\end{proposition}
\begin{proof}
We have $\min(S) \neq\emptyset$, so $S = \upset S = \upset\min(S)$ by \ref{minMaxUpsetDownset}.
\end{proof}

\begin{proposition} \label{injectionsExpansive}
Every order-preserving injection $f: U\rightarrowtail U$ of a well-ordered set into itself is expansive.
\end{proposition}
\begin{proof}
Assume $f: U\rightarrowtail U$ injective but not expansive, i.e.\ $\exists x\in U: f(x)<x$ then let
\[ x^* = \min\{x\in U\;|\;f(x)<x\}. \]
Then $f(x^*)<x^*$ and $f(f(x^*)) < f(x^*)$ by order preservation. Then $f(x^*)$ is a smaller element in the set, yielding a contradiction.
\end{proof}
\begin{corollary} \label{properInitialSegmentNotIsomorphic}
No well-ordered set is isomorphic with one of its proper initial
segments, and hence no two distinct initial segments of a well-ordered set are
isomorphic.
\end{corollary}

\section{Transfinite induction and recursion}
The principles of induction and recursion can be generalised to well-founded sets.

Standard induction and recursion use the predecessor to define / prove a property of the successor. In general well-ordered sets there are limit points that have no predecessor. For this reason it is the principles of proof by \textit{complete
induction} and definition by \textit{complete recursion} that generalise to well-founded sets.

\begin{definition}
Let $\sSet{U, R}$ be a relational structure. We say $U$ satisfies
\begin{itemize}
\item the principle of \udef{well-founded induction} if for all subsets $P\subseteq U$, we have the implication
\[ \text{if}\quad  \forall x\in U: \Big(\big(Rx\setminus\{x\}\subseteq P\big)\implies x\in P\Big), \quad \text{then}\quad P=U; \]
\item the principle of \udef{loosely well-founded induction} if for all subsets $P\subseteq U$, we have the implication
\[ \text{if}\quad  \forall x\in U: \Big(\big(Rx\setminus xR\subseteq P\big)\implies x\in P\Big), \quad \text{then}\quad P=U. \]
\end{itemize}
In both cases the antecedent of the implication is called the \udef{induction step}. The antecedent of the induction step is called the \udef{induction hypothesis}.

We say $U$ satisfies
\begin{itemize}
\item the principle of \udef{well-founded recursion} if for all non-empty sets $E$ and functions $h: (U\not\to E)\to E$, there exists exactly one function $f: U\to E$ that satisfies
\[ \forall x\in U: \quad f(x) = h(f|_{Rx\setminus\{x\}}); \]
\item the principle of \udef{loosely well-founded recursion} if for all non-empty sets $E$ and functions $h: (U\not\to E)\to E$, there exists exactly one function $f: U\to E$ that satisfies
\[ \forall x\in U: \quad f(x) = h(f|_{Rx\setminus xR}). \]
\end{itemize}
In these cases we say $f$ is defined recursively by $h$.
\end{definition}

If $U$ is transitive, we write $\downset\{x\}$ instead of $Rx$.

\begin{proposition}
Let $\sSet{U,R}$ be a well-founded set, $E$ a set, $h:(U\not\to E)\to E$ be some function and $f: U\to E$ the functions defined recursively by $h$.

Let $P \subseteq (U\not\to E)$ be a subset such that $f|_{Rx\setminus\{x\}} \in P$ implies $f|_{Rx}\in P$, then $f\in P$
\end{proposition}
\begin{proof}
\[ F \defeq \setbuilder{f\in (U\not\to E)}{\exists u\in U': \dom(f) = Ru\setminus\{u\} \land \big(\forall x\in Ru: f(x) = h(f|_{Rx\setminus \{x\}}) \big)} \]
$F$ well-founded. 
\end{proof}

\begin{theorem}[Well-founded induction and recursion]
Let $\sSet{U, R}$ be an ordered set. Then the following are equivalent:
\begin{enumerate}
\item $U$ is well-founded;
\item $U$ satisfies the principle of well-founded induction;
\item $U$ satisfies the principle of well-founded recursion.
\end{enumerate}
The following are also equivalent:
\begin{enumerate}
\item $U$ is loosely well-founded;
\item $U$ satisfies the principle of loosely well-founded induction;
\item $U$ satisfies the principle of loosely well-founded recursion.
\end{enumerate}
\end{theorem}
Notice that there is no need for a ``base step'' in the induction principles, as it is 
contained in the induction step: if $x$ is minimal in $U$, then there is no smaller $y$, so the induction hypothesis is trivially true and the induction step gives $x\in P$.
\begin{proof}
We show the first set of equivalences. The proof of the second set is identical, except with $Rx\setminus xR$ instead of $Rx\setminus\{x\}$.

$\boxed{(1) \Rightarrow (2)}$ Assume $U$ satisfies the principle of induction and let $P$ be some subset of $U$. We apply the principle of induction to $P^c$. The induction step is then
\[ \forall x\in U: \Big(\big(Rx\setminus\{x\}\perp P\big)\implies x\notin P\Big), \]
which by \ref{maximalMinimalEquivalents} implies that $P$ has no minimal elements (as any potentially minimal element is not in $P$).

The consequent $P^c = U$ is equivalent to $P=\emptyset$.

Thus the principle of induction gives that any subset without minimal elements is empty, which is exactly well-foundedness.

$\boxed{(2) \Rightarrow (1)}$ Assume, towards a contradiction, the induction step for some $P\subseteq U$ and $\exists x\in U\setminus P$. Then the set $P^c$ is not empty and by well-foundedness we can find a minimal element $x^*\in P^c$. By minimality $\downset\{x^*\}\setminus\{x^*\}\perp P^c$, so $R{x^*}\setminus\{x^*\}\subseteq P$. By the induction hypothesis $x^*\in P$, which is a contradiction.

$\boxed{(2) \Rightarrow (3)}$ Consider $U' \defeq U\cup \{t_U\}$, where $t_U$ is greater than any element in $U$. Then $U'$ is well-founded and $Rt_U\setminus \{t_U\} = U$.

Consider the set $P\subseteq U'$ that contains $u\in U'$ if and only if there exists exactly one function $f_u:Ru\to E$ which satisfies
\[ f_u(x) = h(f_u|_{Rx\setminus\{x\}}) \qquad \forall x\in Ru. \]
If we can prove the corresponding induction step, then in particular $t_U\in P$. This implies the existence and uniqueness of $f:U\to E = f_{t_U}|_U$.

Fix an arbitrary $u\in U'$ and assume the induction hypothesis, which posits that such a unique function $f_v: Rv\cup\{v\}\to E$ exists for all $v\in Ru\setminus\{u\}$. We show the existence and uniqueness of $f_u:Ru\cup \{u\}\to E$.

Note first that for $w\Yleft v\in Ru\setminus\{u\}$ we have $f_w = f_v|_{Rw\cup\{w\}}$, as both functions satisfy the conditions that give the unique definition.

For existence: first define $f_u' \defeq \bigcup_{v\in Ru\setminus\{u\}} f_v$. 
This is a relation; we show that it is functional and has domain $Ru\setminus\{u\}$.
Indeed
\begin{align*}
\dom(f'_u) &= \bigcup_{v\in Ru\setminus\{u\}} \dom(f_v) \\
&= \bigcup_{v\in Ru\setminus\{u\}} Rv\cup\{v\} \\
&= \bigcup_{v\in Ru\setminus\{u\}} \{v\} \\
&= Ru\setminus\{u\}.
\end{align*}
To show that $f'_u$ is functional, take $v\in Ru\setminus\{u\}$ and let $v\mathrel{(f'_u)}w_1$ and $v\mathrel{(f'_u)}w_2$.

Then there exist $v_1, v_2 \Yright v$ such that $f_{v_1}(v) = w_1$ and $f_{v_2}(v) = w_2$. Now
\[ w_1 = f_{v_1}(v) = f_{v_1}|_{Rv\cup \{v\}}(v) = f_v(v) = f_{v_2}|_{Rv\cup\{v\}}(v) = f_{v_1}(v) = w_2. \]
We conclude that $f'_u$ is functional.

Now let $f_u$ be the function $f'_u$ with the domain extended to $Ru$ by adding $f_u(u) = h(f'_u)$.

(In the case of loosely well-founded recursion, we need to add $f_u(w) = h(f'_u)$ for all $w\in (Ru\cap uR)\cup\{u\}$)

To show $f_u$ satisfies the defining property, take $v\in Ru\cup\{u\}$. If $v\neq u$, then
\[ f_u(v) = f_v(v) = h(f_v|_{Rv\setminus\{v\}}) = h(f_u|_{Rv\setminus\{v\}}). \]
Otherwise $v=u$, in which case $(Ru\cap uR)\cup\{u\} = (Rv\cap vR)\cup\{v\}$ and then
\[ f_u(v) = h(f'_u) = h(f_u|_{Ru\setminus\{u\}}) = h(f_u|_{Rv\setminus\{v\}}). \]
This concludes the existence part of the proof.

For uniqueness, assume that another function $g: Ru\cup \{u\}\to E$ satisfies the property. For $v\neq u$, we have $g|_{Ru\setminus\{u\}} = f'_u = f_u|_{Ru\setminus\{u\}}$. For $v=u$, we have
\[ g(u) = h(g|_{Ru\setminus\{u\}}) = h(f'_u) = f_u(u). \]
This proves uniqueness.

$\boxed{(3) \Rightarrow (2)}$ Take an arbitrary subset $P\subseteq U$. Consider the characteristic function $\chi_P: U\to \{0,1\}$ of $P$.

We may take $E = \{0,1\}$ and the $h$ that maps partial functions $p$ to zero iff $0\in\im(p)$. Then the statement
\[ \forall x\in U: \quad\chi_P(x) = h(\chi_P|_{Rx\setminus\{x\}}) \]
is equivalent to the induction hypothesis.

The function $\underline{1}$ satisfies the recursion relation. By the principle of recursion, this is the unique function, so $\chi_P = \underline{1}$ and thus $P = U$.
\end{proof}
\begin{corollary}
Let $\sSet{U,R}$ be a relational structure.
\begin{enumerate}
\item The well-founded principles imply the loosely well-founded principles.
\item If $U$ is antisymmetric, then these principles are equivalent.
\end{enumerate}
\end{corollary}
If $\sSet{U,\Yleft}$ is a poset, then $\downset\{x\}\setminus\upset\{x\} = \downset\{x\}\setminus\{x\} = \setbuilder{y\in U}{y<x}$.

\begin{corollary} \label{WOSetsUniqueSimilarity}
If $U$, $V$ are well-ordered posets and $U =_o V$, then the order similarity is unique.
\end{corollary}
\begin{proof}
Assume $f,g: U\to V$ are order similarities. By antisymmetry, we may consider $\min$ as a function in $\powerset(U)\to U$. Set $P = \setbuilder{y\in U}{f(y) = g(y)}$. To prove the induction step, take arbitrary $x\in U$ and assume the induction hypothesis ($\setbuilder{y\in U}{y<x} \subseteq P$). Then $\setbuilder{f(y)}{y< x} = \setbuilder{g(y)}{y< x}$ and so
\begin{align*}
f(x) &= f\Big(\min\big(\setbuilder{y}{y\geq x}\big)\Big) \\
&= f\Big(\min\big(\setbuilder{y}{y < x}^c\big)\Big) \\
&= \min\big(\setbuilder{f(y)}{y< x}^c\big) \\
&= \min\big(\setbuilder{g(y)}{y< x}^c\big) \\
&= g\Big(\min\big(\setbuilder{y}{y < x}^c\big)\Big) \\
&= g\Big(\min\big(\setbuilder{y}{y\geq x}\big)\Big) = g(x).
\end{align*}
By induction we conclude that $P=U$ and thus $f(x) = g(x)$ for all $x\in U$.
\end{proof}

Note that the hypotheses of connexity and antisymmetry are necessary: without either there may be multiple minimal elements of subsets and different order similarities have the freedom to choose between them.

\subsection{Mutual recursion}
\begin{definition}
Let $U$ be a (loosely) well-founded set and let $E$ be a set of the form $E = E_1\times E_2$. Suppose some function $h:(U\not\to E)\to E$ and let $f$ be defined recursively by $h$. Then we say $p_1\circ f$ and $p_2 \circ f$ are defined by \udef{mutual recursion}.
\end{definition}


\subsection{Recursion invariants}




TODO recursively defining some function with certain property (+usng this property in recursive definition)


\section{Well-ordered posets}
\begin{definition}
Let $U,V$ be well-ordered posets. We say $U$ is \udef{less than or equal to $V$ in length}, $U\leq_o V$ if $U$ is order isomorphic to an initial segment of $V$.
\[ U\leq_o V \defequiv \exists I\sqsubseteq V: U =_o I. \]
We also write
\[ U <_o V \defequiv U\leq_o V \land U\neq_o V. \]
\end{definition}
Every proper initial segment is of the form $\downset\{x\}$, so using corollary \ref{properInitialSegmentNotIsomorphic} gives
\begin{lemma}
Let $U,V$ be well-ordered sets.
\[ U <_o V \quad \iff \quad \exists x\in V: U =_o \downset\{x\}. \]
\end{lemma}

Clearly $=_o$ and $\leq_o$ imply $=_c$ and $\leq_c$.

\begin{lemma} \label{preorderingWosets}
For all well-ordered posets $U,V,W$:
\begin{enumerate}
\item $U \leq_o U$;
\item $[U\leq_o V \land V\leq_o W] \implies U\leq_o W$;
\item $[U \leq_o V \land V \leq_o U] \implies U =_o V$.
\end{enumerate}
\end{lemma}
\begin{proof}
For point 3., if $U \neq_o V$, then composing the order isomorphisms would yield an isomorphism between $U$ and a proper initial segment of $U$. Because such an isomorphism must be expansive we have a contradiction.
\end{proof}

\begin{theorem}[Comparability of well-ordered sets]\label{comparabilityWosets}
For any two well-ordered posets $U,V$: either $U\leq_o V$ or $V\leq_o U$.
\end{theorem}
TODO revamp using $f = \setbuilder{(x,y)\in U\times V}{\downset\{x\} =_o \downset\{y\}}$. Prove 1-1 and either left- or right-completeness.
\begin{proof}
The result is trivial if $V=\emptyset$, so we may assume the minimum $0_V$ exists.

Define, by transfinite recursion the function $f:U\to V$ such that $f(x) = h(f|_{\downset\{x\}})$ where $h$ sends each partial function to the least element of $V$ not in the image:
\[ h: (U\not\to V) \to V: \sigma \mapsto \begin{cases}
\min_V\{v\in V\;|\; v\notin \sigma[U]\} & (\{v\in V\;|\; v\notin \sigma[U]\} \neq \emptyset) \\
0_V  & (\{v\in V\;|\; v\notin \sigma[U]\} = \emptyset).
\end{cases} \]
We immediately note two properties of $f$:
\begin{enumerate}
\item It is order-preserving. Indeed, assume $x\leq_U y$, which implies
\begin{align*}
\downset\{x\} \sqsubseteq \downset\{y\} &\implies f[\downset\{x\}] \subseteq f[\downset\{y\}] \implies f|_{\downset\{x\}}[U] \subseteq f|_{\downset\{y\}}[U] \\
&\implies \{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} \supset \{v\in V\;|\; v\notin f|_{\downset\{y\}}[U]\} \\
&\implies \min\{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} \leq \min\{v\in V\;|\; v\notin f|_{\downset\{y\}}[U]\} \\ &\implies f(x) \leq f(y).
\end{align*}
\item Every point in $V$, other than $0_V$, can only be the image of at most one point in $U$.
\end{enumerate}
We distinguish three cases for $0_V$: it may be the image of zero, one or multiple points in $U$. If $0_V$ is the image of no points in $U$, there must be no points in $U$ and the result is trivial.
\begin{itemize}
\item If $0_V$ is the image of one point in $U$, then $f$ is injective. Then the function $f: U\to f[U]$ is bijective and order-preserving, so an order isomorphism by lemma \ref{equivalenceOrderPreservingReflecting}. We just need to show $f[U]$ is an initial segment of $V$. Take an arbitrary $x\in V$ and $y\in f[U]$ and assume $x\leq y$. There is a $u$ such that $f(u) = y$. If $x$ were not in $f[U]$, then $x\in\{v\in V\;|\; v\notin f|_{\downset\{u\}}[U]\}$, but $x$ is smaller than the minimum yielding a contradiction. In this case $U\leq_o V$.
\item If $0_V$ is the image of multiple points in $U$, there is an $x\in U$ such that
\[ \{v\in V\;|\; v\notin f|_{\downset\{x\}}[U]\} = \emptyset. \]
We take the least such $x$ and then $f|_{\downset\{x\}}$ is bijective. In this case $V \leq_o U$.
\end{itemize}
\end{proof}
\begin{corollary}
For all well-ordered poset $U,V$,
\[ U \leq_o V \quad \iff \quad \exists: \text{order-preserving injection} \;U\rightarrowtail V. \]
\end{corollary}
\begin{proof}
If $U \leq_o V$, then $U$ is order isomorphic to an initial segment of $V$; this order isomorphism is an order-preserving injection into $V$.

Conversely, assume there is an order-preserving injection $f:U\rightarrowtail V$. Assume, towards a contradiction that $U \nleq_o V$; by the theorem this means $V <_o U$. Then $V=_o \downset\{x\}$ for some $x\in U$ and composing $f$ with this isomorphism gives an order-preserving injection $U\rightarrowtail \downset\{x\}$. This is obviously not expansive, so by proposition \ref{injectionsExpansive} we have a contradiction.
\end{proof}
\begin{corollary}[Wellfoundedness of $\leq_o$]\label{wellfoundednessOfWosetComparison}
Every non-empty class $\mathcal{E}$ of well-ordered posets has a $\leq_o$-least member.
\end{corollary}
i.e.\ for some $U_0\in \mathcal{E}$ and all $U\in \mathcal{E}$: $U_0\leq_o U$.
\begin{proof}
Because $\mathcal{E}$ is non-empty, we have a $W\in\mathcal{E}$. If $W$ is $\leq_o$-least in $\mathcal{E}$, we are finished. If $W$ is not $\leq_o$-least, there are sets $U$ in $\mathcal{E}$ such that $U\leq_o W$ and the set
\[ J \defeq \{x\in W\;|\;\exists U\in\mathcal{E}: U =_o \downset\{x\}\} \]
is not empty. Take the least element of $J$; it is easy to prove that the corresponding set $U$ is the $\leq_o$-least member of $\mathcal{E}$.
\end{proof}
\begin{corollary} \label{ordinalInequalitiesLemma}
Let $U,V$ be well-ordered posets. Then
\begin{enumerate}
\item $U\nleq_o V \iff V <_o U$;
\item $U <_c V$ implies $U \leq_o V$.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{ordinalInequalityFromInitialSegments}
Let $U,V$ be well-ordered posets. Then
\[ U \leq_o V \qquad\iff\qquad \forall x\in U:\; \downset\{x\} \leq_o V.   \]
\end{proposition}
\begin{proof}
The direction $\Rightarrow$ is immediate.

For the other direction: we need to find an order-preserving injection $U\to V$. For every $x\in U$ we have an order-preserving injection $\downset\{x\} \to V$. The union of all these injections gives the one we want.
\end{proof}

\subsection{Hartogs number}
The Hartogs number of any set $X$ is a bigger well-ordered set.

A set $X$ may not be well-orderable itself, but it definitely has well-orderable subsets. Some subsets may even have inequivalent well-orderings.
\begin{definition}
Let $X$ be a set. Let $\operatorname{WO}(X)$ be the set
\[ \operatorname{WO}(X) = \{ (U,\leq_U) \in \powerset(X)\times\powerset(X\times X) \;|\; \leq_U\; \text{is a well-ordering of $U$}\;  \}. \]
Then \udef{Hartogs number} of $X$ is the set
\[ \aleph(X) \defeq \operatorname{WO}(X)/=_o. \]
Here $=_o$ is restricted to $\powerset(X)$ and thus is an equivalence relation (see lemma \ref{isomorphismEquivalence}).
\end{definition}
If the natural numbers are viewed as Von Neumann ordinals, we have the following:
\[ \aleph(0) = 1, \quad \aleph(1) = 2, \quad \aleph(2) = 3, \quad \ldots \]
This follows because each finite set can be well-ordered exactly one way, up to order isomorphism and well-ordered finite sets of the same size are order isomorphic.

\begin{lemma} \label{wellorderingHartogsNumber}
Let $X$ be a set and $\aleph(X)$ its Hartogs number. Then $\leq$ defined by
\[ \forall \alpha, \beta \in \aleph(X):\quad \alpha \leq \beta \defequiv \alpha = [U] \land \beta = [V] \land U\leq_o V \]
makes $(\aleph(X), \leq)$ a well-ordered set.
\end{lemma}
\begin{proof}
First we show $\leq$ is well-defined: let $[U] = [U']$ and $[V] = [V']$. Then $U =_o U'$ and thus $U'\leq_o U$; also $U \leq_V$ and $V\leq_o V'$. By point 2 of lemma \ref{preorderingWosets} we have $U' \leq_o V'$, showing the definition is well-defined.

A simple application of lemma \ref{preorderingWosets} shows us $(\aleph(X), \leq)$ is a poset.

The order is total by the comparability of well-ordered sets, theorem \ref{comparabilityWosets}, and well-founded by its corollary, corollary \ref{wellfoundednessOfWosetComparison}.
\end{proof}

\begin{lemma} \label{HartogsNumberAsOrdinal}
Let $X$ be a set and $\alpha = [U] \in \aleph(X)$. Then
\[ \operatorname{seg}_{\aleph(X)}(\alpha) = \{ [\downset\{x\}] \;|\; x\in U \} =_o U. \]
\end{lemma}
\begin{proof}
The identity is clear by the previous lemma \ref{wellorderingHartogsNumber}. The isomorphism follows from proposition \ref{orderedSetPowerset} and the fact that each $[\downset\{x\}]$ contains exactly one initial segment of $U$, by lemma \ref{orderingInitialSegments}.
\end{proof}

\begin{theorem}[Hartogs' lemma] \label{HartogsLemma}
Let $X$ be a set. There is no injection $\aleph(X) \rightarrowtail X$, i.e.\ $\aleph(X) \nleq_c X$.
\end{theorem}
\begin{proof}
Suppose, towards a contradiction, that there exists an injection
\[ f: \aleph(X) \rightarrowtail X \]
and let $Y = f[\aleph(X)] \subseteq X$ be its image. Then $f: \aleph(X) \to Y$ is a bijection, meaning $Y$ is well-ordered by lemma \ref{wellOrderingSubsets}. So $Y =_o \aleph(X)$.
But also $[Y]\in \aleph(X)$, because $Y\subseteq X$, and by lemma \ref{HartogsNumberAsOrdinal} $Y$ is similar to a proper initial segment of $\aleph(X)$.
So $\aleph(X)$ would seem to be similar to a proper initial segment, but this contradicts the expansiveness of order embeddings on well-ordered sets, see corollary \ref{properInitialSegmentNotIsomorphic}.
\end{proof}


\begin{proposition} \label{proposition:HartogsLeast}
Let $X$ be a set. The Hartogs number $\aleph(X)$ is the $\leq_o$-least well-ordered set not smaller than or equal to $X$ in size. i.e.\
\[ \forall \;\text{well-ordered sets $U$}:\quad U \nleq_c X \implies \aleph(X)\leq_o U. \]
\end{proposition}
\begin{proof}
We prove the contrapositive:
\[ W <_o \aleph(X) \implies W \leq_c X. \]
Assume $W <_o \aleph(X)$. Then $W =_o \operatorname{seg}_{\aleph(X)}(\alpha)$ for some $\alpha = [U]\in \aleph(X)$, so $W=_o U$ and thus $W =_c U \subseteq X$. So $W\leq_c X$.
\end{proof}

\subsubsection{Burali-Forti's paradox}
Burali-Forti's paradox is like Cantor's paradox for well-ordered sets. It shows we cannot have a set of well-ordered sets.

One way to put it is as follows: assume we have a set $WO$ of all well ordered sets. Then $\aleph(WO)$, which is a set of well-ordered sets, must be a subset of $WO$, so $\aleph(WO) \leq_c WO$. This contradicts Hartogs' lemma.

A (slightly) more historical\footnote{See \url{https://zenodo.org/record/2362091/files/article.pdf}} approach: let $\Omega \defeq WO/=_o$.
The elements of $\Omega$ are well-ordered by $\leq_o$ (like in lemma \ref{wellorderingHartogsNumber}).
Consider $\Omega+1 \defeq \operatorname{Succ}(\Omega)$. Because $\Omega = \downset\{t_\Omega\}$, we have $[\Omega] < [\Omega +1]$.
On the other hand, by proposition \ref{orderedSetPowerset} we see that $\Omega =_o \downset\{\Omega\}$, so that each element of $\Omega$ is comparable to $\Omega$.
Thus all well-ordered sets are $\leq_o \Omega$ and in particular $[\Omega + 1] \leq [\Omega]$. By $[\Omega] < [\Omega +1]$ and $[\Omega + 1] \leq [\Omega]$ we see that the elements of $\Omega$ are not well-ordered, which is a contradiction.

The paradox is nowadays more commonly stated for (von Neumann) ordinals (see later).




\section{Strings and trees}
ATM we do not define strings using tuples. We could do $\seq{a,b,c,d} = (a, (b,(c,d)))$. But
\begin{itemize}
\item we do not have empty pair or singleton pair, while we should have such sequences;
\item type / ontological status of $(a, (b,(c,d)))$ not as clear;
\item should it be $(a, (b,(c,(d))))$?
\end{itemize}

\subsection{Strings}
\begin{definition}
A \udef{string} in an \udef{alphabet} $A$ is a sequence whose domain is a set of the form $\interval[co]{0,n}$ and whose codomain is the set $A$. The elements of $A$ are called \udef{symbols}.

The size $n$ of the domain is the \udef{length} of the sequence, denoted $\len(x)$. Thus $x: \interval[co]{0,\len(x)}\to A$.


We identify $n$ with the corresponding von Neumann ordinal to get
\begin{align*}
A^{n} &\defeq A^{\interval[co]{0,n}} \\
A^* &\defeq \bigcup\setbuilder{ A^{n}}{n\in \N}.
\end{align*}
We call $A^*$ the \udef{Kleene closure} of $A$.

Let $a_0,\ldots, a_{n-1}\in A$. Then we have the string
\[ \seq{a_0,\ldots, a_{n-1}} \defeq \{(0,a_0),\ldots, (n-1,a_{n-1})\} \in A^{n}. \]

Let $u\in A^*$ be a string. We take all indices modulo $\len(x)$. In particular negative indices can be used to count back from the end of the string.

\begin{itemize}
\item We allow the domain of a string to be $\emptyset = \interval[co]{0,0}$. There is a unique string with this domain, the \udef{empty string} $\seq{}$. We have $\seq{}\in A^*$.
\item Let $u\in A^{n}, v\in A^{m}$ be strings. The \udef{concatenation} of $u$ and $v$ is the string
\[ u\star v \defeq \seq{u_0,\ldots, u_{n-1},v_0,\ldots, v_{m-1}} \in A^{n+m}. \]
\item Let $u\in A^{n}$ be a string. The \udef{reverse} string $\reverse{u}$ is defined by
\[ \reverse{u} \defeq \seq{u_{n-1}, \ldots, u_0}. \]
\item Let $u\in A^*$ be a string. The string $u^k$ is defined recursively by
\[ u^{k} = \begin{cases}
\seq{} & (k=0) \\
u^{k-1}\concat u & (k\geq 1)
\end{cases}. \]
\end{itemize}
We call a subsequence a \udef{substring} if its domain is an interval subset.
\begin{itemize}
\item A string is called \udef{simple} if it is injective.
\end{itemize}
\end{definition}
Notice that we can view tuples as strings of length two (i.e.\ there is a bijection $A\times A \leftrightarrow A^{2}$ for all sets $A$). Similarly an $n$-tuple can be seen as a string of length $n$. So sometimes we write
\[ A^* = \bigcup^\infty_{n=0}A^n = A^{<\omega}\]
where $A^{<\omega}$ is just a notational equivalent.

We can think of $A^*$ as a generalisation of $\N$, with $\seq{}$ instead of $0$ and appending operators
\[ S_a(u) = u\concat \seq{a} \]
for all $a\in A$. In this way $\N \cong \{1\}^*$.


\begin{proposition}[String pigeonhole principle] \label{stringPigeonholePrinciple}
Let $A$ be a finite alphabet and $u\in A^*$. If $\#A < \len(u)$, then $u$ is not simple.
\end{proposition}
In other words: if $\#A < \len(u)$, then $u$ has a repeating character.
\begin{proof}
Assume $\#A < \len(u)$. Then we have the inclusion $\interval[co]{0,\#A} \hookrightarrow \interval[co]{0,\len(u)}$ by \ref{naturalNumbersInequalityInclusion}. Also $A =_c \interval[co]{0,\#A}$ by definition.


We need to show that $u$ is not an injection. Assume, towards a contradiction, that it is injective. 
Then $\begin{tikzcd}
A \ar[r, "{=_c}"] &\interval[co]{0,\#A} \ar[r,hook] & \interval[co]{0,\len(u)} \ar[r, "u"] & A
\end{tikzcd}$
is injective. By the pigeonhole principle \ref{pigeonholePrinciple}, this map is bijective. Thus $u$ is surjective, so $\interval[co]{0,\len(u)} =_c A$, which means that $\len(u) = \#A$ by the unicity in \ref{finiteSetNumberOfElements}. This is a contradiction.
\end{proof}

\begin{theorem}[String recursion theorem] \label{stringRecursion}
Let $A,E$ be sets, $a\in E$, and $h:E\times A\to E$ some function.

There is exactly one function $f: A^*\to E$ which satisfies
\[ \begin{cases}
f(\seq{}) = a, \\
f(\seq{x}\concat u) = h(x, f(u)) & (x\in A, u\in A^*).
\end{cases} \]
\end{theorem}
\begin{proof}
Define a function $\phi: \N \times A^*\to E$ recursively such that it satisfies
\begin{align*}
\phi(0,u) &= a \\
\phi(n+1,u) &= h(\phi(n,u), u(n))
\end{align*}
and set $f(u) = \phi(\len(u), u)$. Proving that $f$ satisfies the second equality and the uniqueness of $f$ goes by induction on $\len(u)$.
\end{proof}
Like before, a version of the theorem can also be stated for recursion with parameters. Also recursion with multiple strings.

\subsubsection{Ordering string}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure. Then
\begin{itemize}
\item the \udef{lexicographic order} $R_l$ on $A^*$ is defined by
\[ u R_l v \quad\defequiv\quad \text{$\exists k \in \min\setbuilder{n\in\N}{n \leq \len(u), n\leq \len(v), u_n \neq v_n}: \; u_k R v_k$}. \]
\item the \udef{shortlex order} or \udef{strong order} $R_{s}$ on $A^*$ is defined by
\[ u R_s v \qquad\defequiv\qquad \begin{cases}
\len(u) < \len(v) & \text{or} \\
\big(\len(u) = \len(v)\big) \land (u R_l v).
\end{cases}\]
\item the \udef{longlex order} or $R_{ll}$ on $A^*$ is defined by
\[ u R_{ll} v \qquad\defequiv\qquad \begin{cases}
\len(u) > \len(v) & \text{or} \\
\big(\len(u) = \len(v)\big) \land (u R_l v).
\end{cases}\]
\end{itemize}
\end{definition}

\begin{lemma}
All lexicographic, shortlex and longlex orders are irreflexive.
\end{lemma}

\begin{proposition}
If $\sSet{A,R}$ is an terminating relational structure. Then $R_{ll}$ is terminating.
\end{proposition}
\begin{proof}
We prove the contraposition. Assume $R_s$ is not terminating. Then we can find an infinite branch $S\subseteq [T_{R_s}]$. Take the first string $u$ in the branch and set $n = \len(u)$. Then all lengths of strings in $S$ are less than or equal to $n$. If we partition the strings by length, we must have at least one infinite partition (by the contraposition of: finite unions of finite sets are finite).

TODO rest!! ALSO TODO: move after definition termination.
\end{proof}

\begin{example}
A terminating relational structure $\sSet{A,R}$ may induce a non-terminating lexicographical order $R_s$ and a non-terminating shortlex order.

For example, consider the set $\{a,b\}$ and the order defined by $a<b$. Then
\[ a,\; ba,\; bba\,; bbba,\; \ldots \]
determines an infinite chain that is monotone in both $R_l$ and $R_s$.
\end{example}

\subsubsection{Slices and substrings}
\begin{definition}
Let $A$ be an alphabet, $u$ a string in $A$ and $S$ some set. Then the $S$-\udef{slice} of $u$ is the string
\[ u[S] \defeq \begin{tikzcd}
\interval[co]{0,\#\big(S\cap\dom(u)\big)} \ar[r, "\cong"] & S\cap\dom(u) \ar[r, "u|_S"] & A,
\end{tikzcd} \]
where $\interval[co]{0,\#\big(S\cap\dom(u)\big)} \cong S\cap\dom(u)$ is the unique order similarity of \ref{WOSetsUniqueSimilarity} (where $S\cap\dom(u)$ has the subspace order).
\end{definition}

In particular note that $\len(u[S]) = \#\big(S\cap\dom(u)\big)$.

\begin{lemma} \label{initialSliceLemma}
Let $A$ be an alphabet, $u\in A^*$ and $m,n\in \N$. Then
\begin{enumerate}
\item $u[0:n] = u|_{(0:n)}$;
\item $u = u[0:\len(u)]$;
\item $\len(u[0:n]) = \min(n,\len(u))$;
\item $u[0:n][0:m] = u[0:\min(m,n)] = u[0:m][0:n]$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) We note that, using \ref{latticeIntervalIntersection},
\begin{align*}
\interval[co]{0,\#\big((0:n)\cap (0:\len(u))\big)} &= \interval[co]{0,\#\big(0:\min(n, \len(u))\big)} \\
&= \interval[co]{0,\min(n,\len(u))} \\
&= \interval[co]{0,n}\cap \interval[co]{0,\len(u)} = (0:n)\cap \dom(u).
\end{align*}
So the order similarity in the definition of $u[0:n]$ is the identity and the result follows.

(2) We have, using point (1), $u = u|_{\dom(u)} = u|_{0:\len(u)} = u[0:\len(u)]$.

(3) We have, using \ref{latticeIntervalIntersection}, that
\[ \len(u[0:n]) = \#\big((0:n)\cap (0:\len(u))\big) = \#\big(0:\min(n,\len(u))\big) = \min(n,\len(u)). \]

(4) We have, using point (1),
\[ u[0:n][0:m] = u|_{0:n}|_{0:m} = u|_{(0:n)\cap(0:m)} = u_{(0:\min(m,n))} = u[0:\min(m,n)]. \]
\end{proof}

TODO: generalise to sequences?? In this case $\len(u[0:n]) = n$.

\subsection{Trees}
\begin{definition}
Let $A$ be an alphabet. We define the \udef{tree order} $\sqsubseteq$ on $A^*$ by
\[ u \sqsubseteq v \qquad\defequiv\qquad \exists n\in \N: \; u = v[0:n]. \]
A \udef{tree} is a downwards closed subset of $\sSet{A^*, \sqsubseteq}$.

We call
\begin{itemize}
\item elements of $T$ \udef{nodes} of the tree;
\item a maximal element of $T$ a \udef{terminal node};
\item a tree without terminal nodes \udef{pruned};
\item a connex subtree of $T$ a \udef{branch} of $T$;
\item the set of all infinite branches of $T$ the \udef{body} of $T$, denoted $[T]$;
\item the tree $T$ is called \udef{terminating} if $[T] = \emptyset$;
\item the tree $T$ is called \udef{simple} if every string in $T$ is simple.
\end{itemize}
\end{definition}

\begin{lemma} \label{treeNodeInequalities}
Let $A$ be an alphabet and $u,v\in A^*$. Then
\begin{enumerate}
\item $u \sqsubseteq v \iff u = v[0:\len(u)]$;
\item $u \sqsubseteq v \implies \len(u) \leq \len(v)$;
\item $u \sqsubseteq v \iff \exists t\in A^*: t\concat u \sqsubseteq t\concat v \iff \forall t\in A^*: t\concat u \sqsubseteq t\concat v$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) The direction $\Leftarrow$ is immediate. For the direction $\Rightarrow$, assume $u \sqsubseteq v$. Then there exists $n\in \N$ such that $u = v[0:n]$. By \ref{initialSliceLemma}, we have
\[ u = u[0:\len(u)] = v[0:n][0:\len(u)] = v[0:\min(n,\len(u))], \]
and so $\len(u) = \len\big(v[0:\min\big(n,\len(u)\big)]\big) = \min\big(n,\len(u), \len(v)\big)$. In particular, this means that $\len(u) = \min\big(n,\len(u)\big)$ and so $u = v[0:\min\big(n,\len(u)\big)] = v[0:\len(u)]$.

(2) We have $u = v[0:\len(u)]$. By \ref{initialSliceLemma}, we have $\len(u) = \len\big(v[0:\len(u)]\big) = \min\big(\len(v), \len(u)\big)$. This implies $\len(u) \leq \len(v)$.

(3) The implication $u \sqsubseteq v \implies \exists t\in A^*: t\concat u \sqsubseteq t\concat v$ clearly holds by taking $t=\seq{}$. Similarly, the implication $\forall t\in A^*: t\concat u \sqsubseteq t\concat v \implies u \sqsubseteq v$, also by taking $t=\seq{}$.

For the last implication, assume there exists $t_0\in A^*$ such that $t_0\concat u \sqsubseteq t_0\concat v$ and pick arbitrary $t_1\in A^*$.
\end{proof}

\begin{lemma}
Let $T$ be a non-empty tree on a set $A$. Then $\seq{}\in T$.
\end{lemma}
\begin{proof}
As $T$ is non-empty, we can find $u\in T$. Now $\seq{} = u[0:0] = u[0:\len(\seq{})]$, so $\seq{}\sqsubseteq u$ by \ref{treeNodeInequalities}. Thus $\seq{}\in T$ by downwards closure.
\end{proof}

\begin{lemma} \label{treeOrderingLemma}
Let $T$ be a tree on an alphabet $A$. Then
\begin{enumerate}
\item $\sqsubseteq$ is a partial order on $T$;
\item $\sSet{T,\sqsubseteq}$ is well-founded;
\item if $\sSet{T,\sqsubseteq}$ is converse well-founded, then $[T] = \emptyset$;
\item if $C\subseteq T$ is a chain, then $\downset C$ is a branch.
\end{enumerate}
\end{lemma}
The converse of (3) requires dependent choice, see \ref{ZornEquivalentsDC}.

Note that (4) implies that if $v\sqsubseteq u$ and $w\sqsubseteq u$, then $v$ and $w$ are comparable.
\begin{proof}
(1) We show that $\sqsubseteq$ is
\begin{itemize}
\item \emph{transitive}: let $u \sqsubseteq v \sqsubseteq w$. Then $u = v[0:m]$ and $v = w[0:n]$, so, by \ref{initialSliceLemma},
\begin{align*}
u &= w[0:n][0:m] = \big(w[0:n]\big)|_{(0:m)} = \big(w|_{(0:n)}\big)|_{(0:m)} \\
&= w|_{(0:n)\cap(0:m)} = w|_{(0:\min\{m,n\})} = w[0:\min\{m,n\}].
\end{align*}
Thus $u \sqsubseteq w$.
\item \emph{reflexive}: $u = u[(0:\len(u))]$, so $u \sqsubseteq u$.
\item \emph{antisymmetric}: assume $u\sqsubseteq v$ and $v\sqsubseteq u$. Then $\len(u) = \len(v)$ by \ref{treeNodeInequalities}. This also gives $u = v[0: \len(u)] = v[0:\len(v)] = v|_{\dom(v)} = v$.
\end{itemize}

(2) Take a non-empty set $S\subseteq T$. We need to show that $S$ has a minimal element. Pick some $u\in S$ and consider the finite set $S' \defeq \setbuilder{u[0:n]}{n\leq \len(u)} \cap S$. Now $S'$ is non-empty and thus contains a minimal element $v$ by \ref{minimalMaximalFiniteSet}. We just need to show that any minimal element of $S'$ is also a minimal element of $S$. 

Assume towards a contradiction, that there exists $w\in S$ such that $w\sqsubsetneq v$. Then $w\in \setbuilder{u[0:n]}{n\leq \len(u)}$, so $w\in S'$. But this would contradict the minimality of $v$ in $S'$.

(3) Assume there exists an infinite branch $B\in [T]$. Then clearly $B$ does not have a maximal element, so $\sSet{T,\sqsubseteq}$ is not converse well-founded.

(4) As $\downset\{u\}$ is downwards closed by definition, we just need to show connexity. Take $v,w\in \downset\{u\}$. Then $v = u[0:n]$ and $w = u[0:m]$. We have either $\interval[co]{0,n} \subseteq \interval[co]{0,m}$ or $\interval[co]{0,n} \supseteq \interval[co]{0,m}$. In the first case $v \sqsubseteq w$ and in the second $w\sqsubseteq v$.

(4) As $\downset C$ is downwards closed by definition, we just need to show connexity. By transitivity and reflexivity, we have $\downset C = {\sqsubseteq}C$. Take $v,w\in \downset C$. Then there exist $u_v, u_w\in C$ such that $v \sqsubseteq u_v$ and $w \sqsubseteq u_w$. By connexity of $C$, we have either $u_v \sqsubseteq u_w$ or $u_w\sqsubseteq u_v$. Set $u = u_w$ in the first case and $u=u_v$ in the second. Thus we have $v\sqsubseteq u$ and $w\sqsubseteq u$ by transitivity.

Now $v = u[0:n]$ and $w = u[0:m]$ for some $m,n\in\N$. We have either $\interval[co]{0,n} \subseteq \interval[co]{0,m}$ or $\interval[co]{0,n} \supseteq \interval[co]{0,m}$. In the first case $v \sqsubseteq w$ and in the second $w\sqsubseteq v$.
\end{proof}

\subsubsection{Branching}
\begin{definition}
Let $T$ be a tree on an alphabet $A$. We say $T$ is
\begin{itemize}
\item \udef{finitely branching} if for all $u\in T\setminus\{\seq{}\}$ the set $\setbuilder{u\concat\seq{a}}{a\in A}$ is finite;
\item \udef{locally finite} if $\setbuilder{u\in T}{\seq{a}\sqsubseteq u}$ is finite for all $a\in A$.
\end{itemize}
\end{definition}

\subsubsection{The tree of a homogeneous binary relation}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure. The tree
\[ T_R \defeq \setbuilder{u\in A^*}{\forall n\in (0:\len(u)): \; u_nRu_{n+1}} \]
is the \udef{associated tree} of $\sSet{A,R}$.
\end{definition}

\begin{lemma} \label{relationalTreeLemma}
Let $\sSet{A,R}$ be a relational structure with associated tree $T_R$. Take $u\in T_R$. Then
\begin{enumerate}
\item $u$ is terminal \textup{if and only if} $u_{-1}R = \emptyset$;
\item $R$ is left-total \textup{if and only if} $T_R$ is pruned.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) If $u_{-1}R = \emptyset$, then there does not exist a string of length $\len(u)+1$ with $u$ as initial segment.

If $u_{-1}R \neq \emptyset$, then we can take $x\in u_{-1}R$, so that $u \sqsubseteq u\concat\seq{x} \in T_R$. This means that $u$ is not terminal.

(2) Follows from (1).
\end{proof}

\begin{lemma} \label{maximalElementNotLeftTotal}
Let $\sSet{A,R}$ be an asymmetric relational structure. Then $A$ contains a maximal element \textup{if and only if} $R$ is not left total.
\end{lemma}
Note that in this case maximality is equivalent to both loose and strict maximality by \ref{symmetricMaximalityMinimality}.
\begin{proof}
We show that the existence of a strictly maximal element in $A$ is equivalent to $R$ not being left total:
\begin{align*}
\exists x\in A: \; \text{$x$ is strictly maximal} \quad&\iff\quad \exists x \in A: \; xR\perp A \\
&\iff\quad \exists x \in A: \; xR = \emptyset \\
&\iff\quad \text{$R$ is not left total}.
\end{align*}
\end{proof}

\begin{lemma} \label{transitiveClosureSequenceLemma}
Let $\sSet{A,R}$ be a relational structure with associated tree $T_R$. Let $a,b\in A$. Then $aR^+b$ \textup{if and only if} exists $u\in T_R$ such that $u_0 = a$ and $u_{-1} = b$.
\end{lemma}
\begin{proof}
TODO!
\end{proof}

\begin{lemma} \label{monotoneFunctionSubAssociatedTree}
Let $\sSet{A,R}$ and $\sSet{B,S}$ be relational structures and $f: A\to B$ a function. Then $f$ is monotone \textup{if and only if} $(\lambda_f)^{\imf}(T_{R})$ is a subtree of $T_S$.
\end{lemma}
\begin{proof}
The set $(\lambda_f)^{\imf}(T_{R})$ is automatically a tree.

$\boxed{\Rightarrow}$ 
Assume $f$ is monotone. We expand
\begin{align*}
(\lambda_f)^{\imf}(T_{R}) \subseteq T_S &\iff T_R \subseteq (\lambda_f)^{\preimf}(T_{R})(T_S) \\
&\iff T_R \subseteq \setbuilder{v \in A^*}{\lambda_f(v) = f\circ v \in T_S} \\ 
&\iff \forall v\in T_R: \forall n\in (0:\len(v)): f(v_n)Sf(v_{n+1}).
\end{align*}
To prove the last statement, take $v\in T_R$ and $n\in (0:\len(v))$. Then $v_nRv_{n+1}$ by definition of $T_R$ and thus $f(v_n)Sf(v_{n+1})$ by monotonicity.

$\boxed{\Leftarrow}$ 
Now assume $(\lambda_f)^{\imf}(T_{R}) \subseteq T_S$ and take $aRb\in A$. Then $\seq{a,b}\in T_R$ and thus $\seq{f(a), f(b)}\in T_S$, which means that $f(a)Sf(b)$ and thus that $f$ is monotone.
\end{proof}

\subsubsection{Branches and sequences}
\begin{proposition}
Let $A$ be an alphabet. Then the following function
\[ \branch: A^\N \to [A^*]: u \mapsto \setbuilder{u[0:n]}{n\in \N}, \]
which maps sequences in $A$ to their initial segments, is a bijection with inverse
\[ \branch^{-1}: [A^*] \to A^\N: S\mapsto \bigcup S. \]
\end{proposition}
\begin{proof}
First we show that both $\branch$ and $\branch^{-1}$ are well-defined.

Take $u\in A^\N$. We need to show that $\branch(u)\in[A^*]$:
\begin{itemize}
\item $\branch(u)$ is a subtree, i.e.\ downwards closed under $\sqsubseteq$: take $s\in \branch(u)$ and $t\sqsubseteq s$. Then 
\[ t = s[0:\len(t)] = u[0:n][0:\len(t)] = u[0:\min(n, \len(t))] \in \branch(u) \]
by (TODO generalisation of \ref{initialSliceLemma}).
\item $\branch(u)$ is connex: take $s,t\in \branch(u)$. Then $s = u[0:m]$ and $t = u[0:n]$ for some $m,n\in \N$. Now either $m\leq n$ or $n\leq m$ by connexity of $\N$. In the first case $m = \min(m,n)$, so
\[ s = u[0:m] = u[0:\min(m,n)] = u[0:n][0:m] = t[0:m], \]
which means that $s\sqsubseteq t$. In the other case $t\sqsubseteq s$.
\item $\branch(u)$ is infinite: the function $\N\to \branch(u): n\mapsto u[0:n]$ is injective, indeed assume $u[0:n] = u[0:m]$, then
\[ n = \len(u[0:n]) = \len(u[0:m]) = m, \]
by TODO ref. Thus $\N\leq_c \branch(u)$ by \ref{injectivityCardinality} and $\branch(u)$ is infinite by \ref{infiniteComparisonWithN}.
\end{itemize}

Take $S\in [A^*]$. We need to show that $\branch^{-1}(S)\in A^\N$:
\begin{itemize}
\item $\branch^{-1}(S)$ is functional: assume $n\in \N$ such that $n\mathrel{\branch^{-1}(S)}a$ and $n\mathrel{\branch^{-1}(S)}b$. Then there exist $v,w\in S$ such that $v_n = a$ and $w_n = b$. Now either $v \sqsubseteq w$ or $w\sqsubseteq v$ by connexity. In the first case we have
\[ a = v(n) = w[0:m](n) = w|_{0:m}(n) = w(n) = b. \]
In the other case we also get $a=b$, by swapping $v$ and $w$.
\item $\branch^{-1}(S)$ is left total. We have that $\len|_S: S\to \N$ is injective: assume there exist $v,w\in S$ such that $\len(v) = \len(w)$. Then either $v\sqsubseteq w$ or $w\sqsubseteq v$. In the first case $v = w[0:\len(v)] = w[0:\len(w)] = w$, using \ref{treeNodeInequalities} and \ref{initialSliceLemma}. In the other case, we also have $v=w$. 

Now take some $n\in \N$. If $\im(\len|_S) \subseteq (0:n)$, then $S \leq_c (0:n)$ and thus $S$ is finite by \ref{finiteComparisonWithInterval}, which is a contradiction. So $\exists m\in \im(\len|_S) \cap \interval[co]{n, \infty}$ and we can find $t \in S$ such that $\len(t) = m$. Then $t_n$ is defined and $\branch^{-1}(S)(n) = t_n$.
\end{itemize}
Finally we show that $\branch$ and $\branch^{-1}$ are mutual inverses.
\begin{itemize}
\item Take $u\in A^\N$ and $n\in \N$. Then
\begin{align*}
\big(n, u(n)\big) &= \big(n, u|_{0:n}(n)\big) = \big(n, u[0:n](n)\big) \\
&\in u[0:n] \subseteq \bigcup_{k\in \N}u[0:k] = (\branch^{-1}\circ\branch)(u).
\end{align*}
Because $(\branch^{-1}\circ\branch)(u)$ is functional, we have $(\branch^{-1}\circ\branch)(u)(n) = u(n)$. 
Because $n$ was chosen arbitrarily, we have $(\branch^{-1}\circ\branch)(u) = u$.
\item Take $S\in [A^*]$ and $v\in S$. Then $v = \left(\bigcup S\right)[0:\len(v)]$. Indeed their domains match (TODO ref) and for all $n\in (0:\len(v))$, we have $\big(n, v(n)\big) \subseteq \bigcup S$. By functionality of $\bigcup S$, we have
\[ v(n) = \left(\bigcup S\right)(n) = \left(\bigcup S\right)|_{(0:\len(v))}(n) = \left(\bigcup S\right)[0:\len(v)](n), \]
for all $n\in (0:\len(v))$, so $v = \left(\bigcup S\right)[0:\len(v)]$. As
\[ (\branch\circ\branch^{-1})(S) = \setbuilder{\left(\bigcup S\right)[0:n]}{n\in \N}, \]
we have that $v\in (\branch\circ\branch^{-1})(S)$. Conversely, take $w\in (\branch\circ\branch^{-1})(S)$. Then $w = \left(\bigcup S\right)[0:k] = \left(\bigcup S\right)[0:\len(w)]$ (TODO ref). 
\end{itemize}
\end{proof}
TODO review with tools for (and generalise to) partial functions.

\begin{corollary} \label{monotoneSequenceBranch}
Let $\sSet{A, R}$ be relational structure and let $M$ be the set of monotone sequences in $A$. Then the following function
\[ \branch: M \to [T_R]: u \mapsto \setbuilder{u[0:n]}{n\in \N}, \]
which maps sequences in $A$ to their initial segments, is a bijection with inverse
\[ \branch^{-1}: [T_R] \to M: S\mapsto \bigcup S. \]
\end{corollary}

\subsubsection{Well-foundedness of $T_R$}
\begin{proposition}
Let $\sSet{A, R}$ be a relational structure. Then $T_R$ is converse well-founded \textup{if and only if} $R$ is strictly converse well-founded.
\end{proposition}
\begin{proof}
$\boxed{\Rightarrow}$ Consider a subset $X\subseteq A$ and the restricted associated tree $T' = T_R\cap{X^*}$. Now $T'$ has a maximal element $u$ by converse-well-foundedness of $T_R$. Then $u\concat\seq{x} \notin T'$ for all $x\in X$. As $u\concat\seq{x} \in X^*$, this must mean $u\concat\seq{x}\notin T_R$ and thus $\neg\big(u_{-1}Rx\big)$. We conclude that $u_{-1}R\cap X = \emptyset$, which means that $u_{-1}$ is strictly maximal in $X$.

$\boxed{\Leftarrow}$ Consider a subset $S\subseteq T_R$ and construct the set $E \defeq \setbuilder{u_n}{u\in S, n<\len(u)}$. This set has a strictly maximal element by assumption and we can thus find a $u\in S$ and $n<\len(u)$ such that $u_{n}$ is maximal in $E$. We claim that $u$ is maximal in $S$. Indeed, take $v\in S$ such that $u\sqsubseteq v$. Then $\len(u) = n = \len(v)$, for if $\len(u) \neq n$, then there exists $u_{n+1}\in E$ such that $u_nRu_{n+1}$, so $u_{n+1}\in u_nR\cap E$, which means that $u_nR\cap E\neq \emptyset$ and $u_n$ is not strictly maximal. The argument for $\len(v) = n$ is similar.

We then have $u = v[0:\len(u)] = v[0:\len(v)] = v$ by \ref{treeNodeInequalities} and \ref{initialSliceLemma}. So $\big(S\cap u{\sqsubseteq}\big) \subseteq \{u\}$, which means that $u$ is maximal in $S$.
\end{proof}
\begin{corollary} \label{welfoundedACC}
Let $\sSet{A, R}$ be a relational structure. Then $T_R$ terminates if $R$ is strictly converse well-founded.

The converse holds under DC.
\end{corollary}
\begin{proof}
By \ref{treeOrderingLemma}. For the converse, see \ref{ZornEquivalentsDC}.
\end{proof}

\subsubsection{Orders on trees}
\begin{definition}
Let $\sSet{A,R}$ be a relational structure and $T\subseteq A^*$ a tree on $A$. We call
\begin{itemize}
\item the lexicographic order on $T$ the \udef{depth-first} ordering of $T$;
\item the shortlex order on $T$ the \udef{breadth-first} ordering of $T$.
\end{itemize}
\end{definition}

\subsection{Functions for string manipulation}
\subsubsection{Functions on strings}
\begin{definition}
Let $A$ be an alphabet.
\begin{itemize}
\item We define the \udef{$\strInterleave$} function $\strInterleave: A^*\times A^* \to A^*$ recursively by
\[ \strInterleave(u,v) = \begin{cases}
\seq{} & (\len(u) = 0 = \len(v)) \\
u & (\len(v) = 0) \\
v & (\len(u) = 0) \\
\seq{u_0}\concat \seq{v_0}\concat \strInterleave(u[1:], v[1:]) & (\len(u) \neq 0 \neq \len(v))
\end{cases} \]
\item We define the \udef{$\strConcat$} function $\strConcat: \big(A^*\big)^* \to A^*$ recursively by
\[ \strConcat(u) = u_0 \concat \big(\strConcat(u[1:])\big). \]
\end{itemize}
\end{definition}
TODO interleave definition works because $\sqsubseteq$ is well-founded on $A^*\times A^*$.

\subsubsection{Functions on sets of strings}
\begin{definition}
Let $A$ be an alphabet.
\begin{itemize}
\item We define the \udef{$\tailsOf$} function
\[ \tailsOf: A^* \times \powerset(A^*) \to A^*: (t, S) \mapsto \setbuilder{u\in A^*}{t\concat u \in S}. \]
\end{itemize}
\end{definition}

\begin{lemma}
Let $T$ be a tree on an alphabet $A$ and $t\in T$, then $\tailsOf(t, T)$ is a tree.
\end{lemma}
\begin{proof}
Take $v \in \tailsOf(t, T)$ and $u\in A^*$ such that $u\sqsubseteq v$. Then we need to prove that $u\in \tailsOf(t, T)$.

We have $t\concat v \in T$ and $t\concat u \sqsubseteq t\concat v$ by 
\end{proof}

\section{Choice}
TODO: Ultrafilter lemma, Szpilrajn extension theorem

\subsection{The axiom and equivalent formulations}
The axiom of choice deals with the following situation: given a family of (non-empty) sets, we want to be able to pick one element from each set. The axiom of choice posits that this is possible.

The function that takes a set in the family and returns our pick is called a choice function:
\begin{definition}
Let $\mathcal{E}$ be a collection of non-empty sets. A \udef{choice function} is any function
\[ f: \mathcal{E} \to \bigcup \mathcal{E} \]
such that $\forall X\in\mathcal{E}: f(X) \in X$.
\end{definition}

If there is a criterion by which to choose the object, then clearly we can find a choice function, without needing to appeal to the axiom of choice.

For example, if all sets in $\mathcal{E}$ are well-ordered, we can choose the least element from each set. The choice function is then
\[ f = \setbuilder{ (X,x)\in \mathcal{E}\times \bigcup \mathcal{E}}{x\in X \land \forall y \in X: x\leq X }. \]
This is a well defined choice function and we did not need the axiom of choice.

For some collections of sets $\mathcal{E}$ we do need the axiom of choice to find a choice function.

There is a well-known analogy due to Russell: if we have a collection $\mathcal{E}$ of pairs of shoes, it is easy to give a choice function, just always take the left shoe for example. If we have a collection $\mathcal{E}'$ of pairs of socks this choice function does not work. We cannot construct a choice function because the socks are indistinguishable. In order to pick one sock from each pair we need to axiom of choice.

We now properly state the axiom:
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item \textbf{Axiom of choice (AC)}: for any non-empty set of sets $\mathcal{E}$ there is a choice function:
\[ \emptyset \notin \mathcal{E} \implies \exists f \in \left(\mathcal{E} \to \bigcup \mathcal{E}\right): \forall X \in \mathcal{E}: f(X)\in X. \]
\end{enumerate}

\begin{definition}
A set $S$ is a \udef{choice set} for a family of sets $\mathcal{E}$ if
\begin{itemize}
\item $S\subseteq \bigcup \mathcal{E}$;
\item $\forall X \in \mathcal{E}: S\cap X$ is a singleton.
\end{itemize}
\end{definition}

\begin{proposition} \label{proposition:choiceEquivalents}
The following statements are equivalent to the axiom of choice:
\begin{enumerate}
\item The Cartesian product of any family of non-empty sets is non-empty.
\item \textup{Zermelo Postulate} Every family $\mathcal{E}$ of non-empty and pairwise disjoint sets admits a choice set.
\item For every set $A$ the family $\powerset(A)\setminus \emptyset$ admits a choice function.
\item For any sets $A,B$ and binary relation $P\subseteq A\times B$,
\[ \left[\forall x\in A: \exists y \in B: P(x,y)\right] \implies \left[ \exists f\in(A\to B): \forall x\in A: P(x,f(x)) \right].  \]
\end{enumerate}
\end{proposition}

\subsection{Some equivalent theorems}

\begin{theorem} \label{choiceEquivalents}
The following results are equivalent to the axiom of choice:
\begin{enumerate}
\item \undline{Zorn's lemma}: If every chain in a poset $P$ has an upper bound, then $P$ has a maximal element.
\item \undline{Zorn's lemma (dual)}: If every chain in a poset $P$ has an lower bound, then $P$ has a minimal element.
\item \undline{Hypothesis of cardinal comparability}: for all sets $A,B$: $A\leq_c B$ or $B\leq_c A$.
\item \undline{Well-ordering theorem}: every set is well-orderable.
\end{enumerate}
\end{theorem}
\begin{proof}
We proceed round-robin-style:
\begin{itemize}[leftmargin=2cm]
\item[$\boxed{(\text{AC}) \Rightarrow (1)}$] Assume every chain in a poset $P$ has an upper bound. Let $f$ be a choice function on $\powerset(P)\setminus \emptyset$. We define a function $g: \aleph(P) \to P$ by transfinite recursion as follows:
\[ g(x) = \begin{cases}
f\left( \{\text{upper bounds of $g[\downset\{x\}]$}  \} \setminus g[\downset\{x\}] \right) & \text{(if defined, i.e.\ we are not choosing from $\emptyset$)} \\
f\left( \{\text{upper bounds of $g[\downset\{x\}]$}  \} \right) & (\text{else}).
\end{cases} \]
This is well defined because $g[\downset\{x\}]$ is a chain in $P$ and thus $\{\text{upper bounds of $g[\downset\{x\}]$}  \}$ cannot be empty by assumption, so the second case always works.

By Hartogs' lemma, theorem \ref{HartogsLemma}, the function $g$ cannot be injective, so there exists an $m\in P$ that is the image of multiple elements $x_1,x_2\in\aleph(P)$. Assume $x_1 < x_2$, then $g(x_2)$ must have been defined by the second case in the recursion, meaning $m$ is a maximal element of $P$.
\item[$\boxed{(1) \Leftrightarrow (2)}$] By duality.
\item[$\boxed{(1) \Rightarrow (3)}$] Every chain in the set $(A \not\rightarrowtail B)$ of injective partial functions from $A$ to $B$, ordered by inclusion, is inductive by proposition \ref{inductive}, and thus has a maximal element. If this maximal element is a total function, then $A\leq_c B$. If it is not a total function, it is surjective and we have a bijection from a subset of $A$ to be, i.e.\ $B\leq_c A$.
\item[$\boxed{(3) \Rightarrow (4)}$] Let $A$ be a set. By Hartogs' lemma, theorem \ref{HartogsLemma}, $\aleph(A) \nleq_c A$. By cardinal comparability this implies $A \leq_c \aleph(A)$. The bijection between $A$ and a subset of $\aleph(A)$ determines a well-ordering on $A$.
\item[$\boxed{(4) \Rightarrow (\text{AC})}$] Let $A$ be a set. Then we can define a well-ordering $\leq$ on $A$. We can then define a choice function on $\powerset(A)\setminus \emptyset$ by returning the $\leq$-least member of each subset.
\end{itemize}
\end{proof}

\begin{lemma} \label{surjectiveInverse}
Every surjective function has a right inverse \textup{if and only if} the axiom of choice holds.
\end{lemma}

\begin{definition}
A family of sets $\mathcal{E}$ is of \udef{finite character} if
\[ X\in \mathcal{E} \qquad \iff \qquad \text{every finite subset of $X$ belongs to $\mathcal{E}$.} \]
\end{definition}
An immediate property of families of finite character: for each $X\in \mathcal{E}$, every (finite or infinite) subset of $X$ belongs to $\mathcal{E}$.

\begin{lemma} \label{finiteCharacterInductive}
Any family of sets $\mathcal{E}$ of finite character ordered by inclusion is inductive.
\end{lemma}
\begin{proof}
Let $S$ be a chain in $\mathcal{E}$, then we claim $\bigcup S \in \mathcal{E}$. Indeed every (finite) subset of $\bigcup S$ is a subset of an element of $S$ and so $\bigcup S\in \mathcal{E}$.
\end{proof}

Some more principles reminiscent of (and equivalent to) Zorn's lemma:
\begin{theorem} \label{ZornEquivalents}
The following results are equivalent to the axiom of choice:
\begin{enumerate}
\item \undline{Teichmüller-Tukey lemma}: Every non-empty collection of finite character has a maximal element with respect to inclusion.
\item \undline{Hausdorff maximal principle}: Let $P$ be a poset. Every chain in $P$ is contained in a maximal chain in $P$.
\item \undline{Maximal chain principle}: Every non-empty poset has a maximal chain.
\end{enumerate}
\end{theorem}
The Hausdorff maximal principle is also known as the ``Kuratowski lemma''. The name ``Hausdorff maximal principle'' may be reserved for the specific case where $P$ is a family of sets ordered by inclusion. These formulations are equivalent, by \ref{posetPowerset}.
\begin{proof}
We prove equivalence with Zorn's lemma round-robin-style:
\begin{itemize}[leftmargin=2cm]
\item[$\boxed{(\text{Zorn}) \Rightarrow (1)}$] Assume Zorn's lemma. Let $\mathcal{E}$ be a non-empty collection of finite character, which is partially ordered by inclusion. Because $\mathcal{E}$ is inductive, by lemma \ref{finiteCharacterInductive}, each chain has an upper bound and thus $\mathcal{E}$ has a maximal element.
\item[$\boxed{(1) \Rightarrow (2)}$] Being a chain is a property of finite character. Let $C$ be a chain in $P$. Then the family of all chains in $P$ containing $C$ is a family of finite character and $P$ is contained in the maximal element.
\item[$\boxed{(2) \Rightarrow (3)}$] Take one element in the poset. The set of this element is a chain.
\item[$\boxed{(3) \Rightarrow (\text{Zorn})}$] Assume there is a maximal chain and every chain has an upper bound. Any upper bound of a maximal chain is a maximal element.
\end{itemize}
\end{proof}
\begin{corollary} \label{maximalSubsetOfDisjointSets}
Let $\mathcal{E}$ be a set of sets. Then there exists a maximal subset of pairwise disjoint sets. 
\end{corollary}
\begin{proof}
The set of subsets of $\mathcal{E}$ that consist of pairwise disjoint sets is a family of finite character.
\end{proof}

\subsection{Weaker axioms}
\subsubsection{Countable choice}
It is in general clear we can make a finite number of choices, by the definition of the existence quantifier (TODO). The axiom of choice says we can make an arbitrary number of choices. The axiom of countable choice is weaker, it says we can make a countable number of choices. Compare also to point 4. of \ref{proposition:choiceEquivalents}.
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item[(VII')] \textbf{Axiom of countable choice ($\text{AC}_{\N}$)}: for any set $B$ and binary relation $P\subseteq \N\times B$,
\[ [\forall n\in \N: \exists y\in B: P(n,y)] \implies [\exists f\in (\N\to B): \forall n \in \N: P(n,f(n))]. \]
\end{enumerate}

\begin{theorem}[Kőnig's lemma]
Let $T$ be a finitely branching tree. Then $T$ is locally finite \textup{if and only if} $T$ is terminating.
\end{theorem}

\subsubsection{Dependent choice}
\begin{enumerate}[(I)]
\setcounter{enumi}{6}
\item[(VII'')] \textbf{Axiom of dependent choice ($\text{DC}$)}: for any left-total binary relation $R$ on a non-empty \emph{set} $A$, there exists a sequence $\seq{a_n}_{n\in \N}$ in $A$ such that
\[ \forall n\in \N: \quad a_n\mathrel{R}a_{n+1}. \]
\end{enumerate}

\begin{definition}
We call such a sequence $\seq{a_n}_{n\in \N}$ a \udef{choice sequence}.
\end{definition}

\begin{lemma} \label{choiceSequenceMonotone}
Let $\sSet{A, R}$ be a relational structure. Every choice sequence in $R$ is a monotone function in $\sSet{\N, <} \to \sSet{A, R^+}$.
\end{lemma}
\begin{proof}
TODO \ref{transitiveClosureSequenceLemma}.
\end{proof}

\begin{lemma} \label{freedomFirstElementChoiceSequence}
Over NBG, the following are equivalent:
\begin{enumerate}
\item the axiom of dependent choice;
\item for any left-total binary relation $R$ on a set $A$ and $a\in A$, there exists a choice sequence starting at $a$.
\end{enumerate}
\end{lemma}
\begin{proof}
$\boxed{(1)\Rightarrow (2)}$ Take $a\in A$. Define $B = aR^+$, i.e.\ the image under the transitive closure.

We have that $R|^B_B$ is left-total on $B$. By the axiom of dependent choice we can find some sequence $\seq{b_n}_{n\in \N}$ in $B$. Now $b_0\in aR^+$, so there exists some finite sequence $u\seq{a, a_1, \ldots, a_n, b_0}$ such that $aRa_1$,  $a_{j}Ra_{j+1}$ for all $j\in 1:n$ and $a_nRb_0$.

Now $u\concat \seq{b_n}_{n\in \N}$ is a choice sequence starting at $a$.

$\boxed{(2)\Rightarrow (1)}$ Let $A$ be a non-empty set. Then there exists $a\in A$. By assumption there exists a choice sequence in $A$ starting at $a$, so there exists a choice sequence in $A$.
\end{proof}

\begin{proposition} \label{ZornEquivalentsDC}
Over NBG, the following are equivalent:
\begin{enumerate}
\item dependent choice;
\item if every chain in a non-empty poset $P$ is finite, then $P$ contains a maximal element;
\item every non-empty pruned tree has an infinite branch;
\item for every tree $T$: if $[T] = \emptyset$, then $\sSet{T,\sqsubseteq}$ is converse well-founded.
\end{enumerate}
\end{proposition}
\begin{proof}
$(1) \Rightarrow (2)$ We prove the contrapositive: if $\sSet{P, \leq}$ is a poset without a maximal element, then $P$ contains an infinite chain.

Assume DC and that $P$ has no maximal element. Define ${<} \defeq {\leq} \setminus\id_P$, which is antisymmetric and irreflexive, and thus asymmetric by \ref{asymmetricIrreflexive}. Then $<$ is left total by \ref{maximalElementNotLeftTotal}, and we can find a choice sequence by DC. The choice sequence is injective by \ref{choiceSequenceMonotone} and \ref{antisymmetricOrderPreservationInjective}. Thus the image of the choice sequence is an infinite chain.

$(2) \Rightarrow (3)$ Let $T$ be a non-empty pruned tree. Then (2) gives that $T$ contains an infinite chain $C$ by modus tollens. Then closure of $C$ under $\sqsubseteq$ is an infinite branch by \ref{treeOrderingLemma}.

$(3) \Rightarrow (1)$ Let $R$ be a left-total binary relation on a non-empty set $A$. Construct the tree $T_R$ associated to the binary relation. It is pruned by \ref{relationalTreeLemma} and thus $T_R$ has an infinite branch. The infinite branch is well-founded (because $T_R$ is well-founded, \ref{treeOrderingLemma}) and thus a well-ordering, as it is connex \ref{wellOrderedCondition}. As the branch is infinite, we can find an initial segment which is similar to $\N$. Call this similarity $f: \N \to T_R$. Consider the function $n\mapsto f(n+1)_{n}$. This is a choice sequence.

$(3) \Rightarrow (4)$ We prove the contrapositive of (4). Assume $\sSet{T,\sqsubseteq}$ is not converse well-founded. Then $T$ has a subset $S$ without maximal elements. Then $\downset S$ is a pruned subtree. It contains an infinite branch by (3) and thus so does $T$.

$(4) \Rightarrow (3)$ A non-empty pruned tree is not converse well-founded.
\end{proof}
In light of \ref{treeOrderingLemma}, for any tree $T$ we have that
\[ [T] = \emptyset \qquad\iff\qquad \text{$\sSet{T,\sqsubseteq}$ is converse well-founded.} \]

\url{https://www.cambridge.org/core/journals/canadian-mathematical-bulletin/article/on-the-principle-of-dependent-choices-and-some-forms-of-zorns-lemma/074006AB7FF8461CD119DE504D7AB1A7}
\url{https://math.stackexchange.com/questions/373854/dependent-choice-and-zorns-lemma}

\begin{proposition}
Over NBG, the following are equivalent:
\begin{enumerate}
\item if every well-ordered chain in a poset $P$ is finite and upper bounded, then $P$ has a maximal element;
\item the Löwenheim-Skolem theorem;
\item the Baire category theorem for complete metric spaces.
\end{enumerate}
\end{proposition}




\chapter{Fixed points}

\begin{definition}
A monotone mapping $\pi : P \to Q$ on a inductive posets
 is \udef{countably continuous} if for every non-empty, countable chain $S\subseteq P$:
 \[ \pi(\sup S) = \sup\pi[S]. \]
\end{definition}

\begin{definition}
Let $(P,\leq)$ be a poset and $f: P\to P$ a function from $P$ to $P$.
\begin{itemize}
\item A \udef{fixed point} is an element $x^*\in P$ such that
\[ f(x^*) = x^*. \]
\item A \udef{strongly least fixed point} is a fixed point such that
\[ \forall y\in P: f(y)\leq y \implies x^* \leq y. \]
\item The \udef{orbit} of an element $p$ of $P$ is a sequence $\N\to P$ defined recursively:
\begin{align*}
p_0 &= p \\
p_{n+1} &= f(p).
\end{align*}
Sometimes we use orbit to mean the set $\{p_n\in P\;|\; n\in \N\}$.
\end{itemize}
\end{definition}

\begin{theorem}[Continuous least fixed point theorem]
Let $\pi:P\to P$ be a countably continuous, monotone mapping on an inductive poset $(P,\leq)$. Then $\pi$ has a unique strongly least fixed point $x^*\in P$.
\end{theorem}
\begin{proof}
As $P$ is inductive, it has a least element $\bot$. The orbit $\{x_n\in P\;|\; n\in \N\}$ of $\bot$ is a chain: $\bot \leq \pi(\bot)$ and the rest follows by induction on $n$, using the monotonicity of $\pi$. Thus the orbit has a supremum. Let $x^*$ be this supremum.

Then, by countable continuity,
\[ \pi(x^*) = \pi(\sup\{x_n\in P\;|\; n\in \N\}) = \sup\pi[\{x_n\in P\;|\; n\in \N\}] = \sup\{x_{n+1}\in P\;|\; n\in \N\} = x^*. \]

To prove $x^*$ is a strongly least fixed point, let $y\in P$ assume $\pi(y)\leq y$. Then we apply induction on $n$:
\begin{itemize}[leftmargin=3cm]
\item[Basis step] $x_0 = \bot \leq y$.
\item[Induction step] $x_n \leq y \implies x_{n+1} = \pi(x_n)\leq \pi(y) \leq y$.
\end{itemize}
\end{proof}

Iteration lemma.

Fixed point theorem.

Least fixed point theorem.

Hitchhiker's guide:
Knaster-Tarski fixed point; Tarksi fixed point

