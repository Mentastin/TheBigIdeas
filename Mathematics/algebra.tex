\chapter{Magmas}
\begin{definition}
A \udef{magma} or \udef{groupoid} is an algebra whose signature contains a single ginary operator.

Let $A$ be the carrier of the algebra and $\boldsymbol{\cdot}$ the interpretation of the operator. We denote the magma as $\sSet{A,\boldsymbol{\cdot}}$. We call $\sSet{A,\boldsymbol{\cdot}}$
\begin{itemize}
\item a \udef{semigroup} if $\boldsymbol{\cdot}$ is associative;
\item a \udef{monoid} if $\boldsymbol{\cdot}$ is associative and has an identity;
\item a \udef{group} if $\boldsymbol{\cdot}$ is associative, has an identity and every $a\in A$ has an inverse.
\end{itemize}
We call a magma \udef{commutative} if its operation is commutative.

If $\sSet{A,\boldsymbol{\cdot}}$ is a monoid or group with identity $e$, we denote the monoid/group as $\sSet{A,\boldsymbol{\cdot}, e}$.
\end{definition}
TODO: change of signature for monoid!

Let $x,y\in A$. We usually write $x\boldsymbol{\cdot} y$ instead of $\boldsymbol{\cdot}(x,y)$. (TODO ref infix notation)

\begin{definition}
We write $x^n$ to abbreviate $\underbrace{x\cdot x\cdot \ldots \cdot x}_{\text{$n$ times}}$.

If $x^2 = x$, we say $x$ is an \udef{idempotent}.
\end{definition}

\begin{lemma}
Let $\sSet{M,\cdot}$ be a magma and $a\in M$. Then $a\cdot M \subseteq M$.
\end{lemma}

\begin{proposition} \label{leftRightInverseMonoid}
Let $(M,\cdot,e)$ be a monoid and $a\in M$. If $a$ has both a left inverse $l$ and a right inverse $r$, then $l=r$.
\end{proposition}
\begin{proof}
We calculate
\[ l = l\cdot e = l\cdot(a\cdot r) = (l\cdot a)\cdot r= e\cdot r = r. \]
\end{proof}

\section{Semigroups}
\begin{lemma}
Let $S$ be a semigroup. If $a\in S$ is idempotent, then $\{a\}$ is a subsemigroup.
\end{lemma}
\begin{corollary}
Let $S$ be a semigroup.
\begin{enumerate}
\item If $S$ contains an identity $e$, then $\{e\}$ is a subsemigroup.
\item If $S$ contains an absorbing element $u$, then $\{u\}$ is a subsemigroup.
\end{enumerate}
\end{corollary}

\begin{proposition} \label{groupCriterion}
Let $S$ be a semigroup. Then $S$ is a group \textup{if and only if} for all $a\in S$
\[ aS = S = Sa. \]
\end{proposition}
\begin{proof}
If $S$ is a group, then we have for all $a\in S$
\[ S \supseteq aS \supseteq aa^{-1}S = S. \]
Similarly we also have $S = Sa$.

For the converse: from $aS = S$, we het that there exists an $x\in S$ such that $ax = a$. We claim $x$ is a right-identity for $S$. Indeed, take arbitrary $b\in S$. Then $b = ya$ for some $y$ and so $bx = yax = ya b$. In the same way we can also find a left-identity. So $S$ contains an identity $e$ by \ref{leftRightIdentity}.

Then for all $a$ we can find $u,v\in S$ such that $au = e = va$. This means $a$ has an inverse by \ref{leftRightInverseMonoid}.
\end{proof}

\subsection{Adjoining identities and absorbing elements}
\subsubsection{Adjoining identity}
\begin{definition}
Let $\sSet{S,\boldsymbol{\cdot}}$ be a semigroup. We define
\[ \widetilde{S} \defeq \begin{cases}
S & \text{if $S$ has an identity} \\
S\uplus \{e\} & \text{if $S$ has no identity.}
\end{cases} \]
and also
\[ \widetilde{\boldsymbol{\cdot}} \quad\defeq\quad \widetilde{S}\times \widetilde{S}\to \widetilde{S}: (a,b) \mapsto \begin{cases}
a\boldsymbol{\cdot} b & a,b\in S \\
b & a = e \\
a & b = e.
\end{cases} \]
\end{definition}


\subsubsection{Adjoining an absorbing element}
\begin{definition}
Let $\sSet{S,\cdot}$ be a semigroup. We define
\[ \widehat{S} \defeq \begin{cases}
S & \text{if $S$ has an absorbing element} \\
S\uplus \{u\} & \text{if $S$ has no absorbing element.}
\end{cases} \]
and also
\[ \widehat{\boldsymbol{\cdot}} \quad\defeq\quad \widehat{S}\times \widehat{S}\to \widehat{S}: (a,b) \mapsto \begin{cases}
a\boldsymbol{\cdot} b & a,b\in S \\
u & (a = u \lor b = u.
\end{cases} \]
\end{definition}

TODO: link with partial semigroup.

\subsection{Subsets and subsemigroups}
\subsubsection{Ideals}
\begin{definition}
Let $S$ be a semigroup and $A\subseteq S$ a non-empty subset. Then $A$ is called
\begin{itemize}
\item a \udef{left ideal} if $SA \subseteq A$;
\item a \udef{right ideal} if $AS \subseteq A$;
\item a \udef{(two-sided) ideal} if $A$ is both a left and a right ideal.
\end{itemize}
Clearly $S$ is an ideal. If $u\in S$ is an absorbing element, then $\{u\}$ is an ideal. If an ideal is neither of these two, it is called \udef{proper}.
\end{definition}

\begin{lemma}
Let $\sSet{S,\cdot}$ be a semigroup and $a\in S$. Then
\begin{enumerate}
\item $\widetilde{S}a = Sa \cup \{a\}$ is a left ideal;
\item $a\widetilde{S} = aS \cup \{a\}$ is a right ideal;
\item $\widetilde{S}a\widetilde{S} = SaS \cup Sa \cup aS \cup \{a\}$ is an ideal.
\end{enumerate}
In particular $\widetilde{S}a \subseteq S$, $a\widetilde{S} \subseteq S$ and $\widetilde{S}a\widetilde{S} \subseteq S$.
\end{lemma}

\begin{definition}
We call
\begin{itemize}
\item $\widetilde{S}a$ the principle left ideal generated by $a$; 
\item $a\widetilde{S}$ the principle right ideal generated by $a$; 
\item $\widetilde{S}a\widetilde{S}$ the principle ideal generated by $a$.
\end{itemize}
\end{definition}

\subsubsection{Generated semigroups}
TODO!

\subsubsection{Periodic semigroups}
Period and index.

\subsection{Homomorphism}

\begin{proposition}
Let $S$ be a semigroup. Then the functions
\begin{align*}
&\lambda: S \to (\widetilde{S} \to \widetilde{S}) : a\mapsto (\lambda_a: x\mapsto ax) \\
&\rho: S \to (\widetilde{S} \to \widetilde{S}): a\mapsto (\rho_a: x\mapsto xa)
\end{align*}
are injective homomorphisms.
\end{proposition}
Note that for all $s\in S$ we view $\lambda_a$ as a function $\widetilde{S} \to \widetilde{S}$. This is necessary for injectivity.
\begin{proof}
The functions $\lambda, \rho$ are homomorphisms by associativity.

For injectivity, let $\lambda_a = \lambda_b$. Then $a = a\cdot e = \lambda_a(e) = \lambda_b(e) b\cdot e = b$.
\end{proof}

\begin{definition}
We call $\lambda$ ($\rho$) the \udef{extended left (right) regular representation} of $S$.
\end{definition}

\subsubsection{Congruences}
\begin{definition}
Let $\sSet{S,\boldsymbol{\cdot}}$ be a semigroup and $R$ a relation on $S$. Then $R$ is called
\begin{itemize}
\item \udef{left compatible} if it is $\Omega$-compatible with $\Omega = \setbuilder{\lambda_a}{a\in S}$;
\item \udef{right compatible} if it is $\Omega$-compatible with $\Omega = \setbuilder{\rho_a}{a\in S}$;
\item \udef{compatible} if it is $\Omega$-compatible with $\Omega = \{\boldsymbol{\cdot}\}$.
\end{itemize}
If the relation $R$ is additionally an equivalence relation, then $R$ is called a \udef{( left / right) congruence}.
\end{definition}

In other words:
\begin{itemize}
\item $R$ is left compatible if $\forall x,y,a\in S: \; xRy \implies (ax)R(ay)$;
\item $R$ is right compatible if $\forall x,y,a\in S: \; xRy \implies (xa)R(ya)$;
\item $R$ is compatible if $\forall x,y,v,w\in S: \; xRy \land vRw \implies (xv)R(yw)$.
\end{itemize}

\begin{proposition}
A relation $R$ on a semigroup $S$ is a congruence \textup{if and only if} it is a left and a right congruence.
\end{proposition}
\begin{proof}
($\Rightarrow$) If $R$ is a congruence, then $aRa$ by reflexivity. So $xRy$ implies $(ax)R(ay)$ and $(xa)R(ya)$, meaning that $R$ is a left and a right congruence.

($\Leftarrow$) Assume $R$ a left and a right congruence. Take $x,y,v,w$ such that $xRy$ and $vRw$. Then $(xv)R(yv)$ and $(yv)R(yw)$ by left and right compatibility. We conclude $(xv)R(yw)$ by transitivity.
\end{proof}

\subsection{Green's relations}
\begin{definition}
Let $\sSet{S,\cdot}$ be a semigroup. Let
\begin{itemize}
\item $\mathcal{L}$ be a relation on $S$ defined by $a\mathcal{L}b \defequiv \widetilde{S}a = \widetilde{S}b$;
\item $\mathcal{R}$ be a relation on $S$ defined by $a\mathcal{R}b \defequiv a\widetilde{S} = b\widetilde{S}$;
\item $\mathcal{H} \defeq \mathcal{L}\cap \mathcal{R}$;
\item $\mathcal{D} \defeq \mathcal{L}\vee \mathcal{R}$; TODO: which lattice?
\item $\mathcal{J}$ be a relation on $S$ defined by $a\mathcal{J}b \defequiv \widetilde{S}a\widetilde{S} = \widetilde{S}b\widetilde{S}$.
\end{itemize}
These five relations are known as \udef{Green's relations}.
\end{definition}

Clearly we have $\mathcal{D} \subseteq \mathcal{J}$.

\begin{lemma}
Let $\sSet{S,\cdot}$ be a semigroup and $a,b\in S$. Then
\begin{enumerate}
\item $a\mathcal{L}b$ \textup{if and only if} $\exists x,y\in \widetilde{S}: (xa = b) \land (yb = a)$;
\item $a\mathcal{R}b$ \textup{if and only if} $\exists x,y\in \widetilde{S}: (ax = b) \land (by = a)$;
\item $a\mathcal{J}b$ \textup{if and only if} $\exists x,y, u,v\in \widetilde{S}: (xay = b) \land (ubv = a)$.
\end{enumerate}
\end{lemma}
\begin{proof}
We prove (1), (2) is analogous.

($\Rightarrow$) $a\in \widetilde{S}a = \widetilde{S}b$, so there exists $y\in \widetilde{S}$ such that $a = yb$. The other equation is similar.

($\Leftarrow$) Because $\widetilde{S}x \subseteq \widetilde{S}$, we have $\widetilde{S}a \subseteq \widetilde{S}xa = \widetilde{S}b$. Similarly $\widetilde{S}b \subseteq \widetilde{S}a$.
\end{proof}
\begin{corollary}
$\mathcal{L}$ is a \emph{right} congruence and $\mathcal{R}$ a \emph{left} congruence.
\end{corollary}

\begin{proposition}
The relations $\mathcal{L}$ and $\mathcal{R}$ commute.
\end{proposition}
\begin{proof}
Assume $a(\mathcal{L};\mathcal{R})b$, meaning $\exists c: a\mathcal{L}c$ and $c\mathcal{R}b$. Then there exist $x,y,u,v\in \widetilde{S}$ such that
\[ (xa = c) \land (yc = a) \;\land\; (cu = b) \land (bv = c). \]
Now define $d = ycu$. Then $a\mathcal{R}d$ because
\[ d = (yc)u = au \;\text{and}\; a = yc = ybv = ycuv = dv \]
and $d\mathcal{L}b$ because
\[ d = ycu = yb \;\text{and}\; b = cu = xau = xycu = xd. \]
So $a(\mathcal{R};\mathcal{L})b$. The other inclusion is similar.
\end{proof}
\begin{corollary}
$\mathcal{D} = \mathcal{L};\mathcal{R} = \mathcal{R};\mathcal{L}$.
\end{corollary}
In other words, $a\mathcal{D}b \iff a\mathcal{L} \mesh \mathcal{R}b \iff a\mathcal{R} \mesh \mathcal{L}b$.

\begin{proposition}
Let $S$ be a periodic semigroup. Then $\mathcal{D} = \mathcal{J}$.
\end{proposition}
\begin{proof}
The inclusion $\mathcal{D} \subseteq \mathcal{J}$ is generally true. We want to prove the other inclusion.

Suppose $a\mathcal{J}b$. Then we can find $x,y,u,v\in \widetilde{S}$ such that
\[ xay = b, \quad ubv = a. \]
We see that $a = (ux)a(yu) = (ux)^2a(yu)^2 = \ldots$. By periodicity (TODO ref) we can find an $m\in \N$ such that $(ux)^m$ is idempotent. Then set $c= xa$, so that
\[ a = (ux)^ma(yu)^m = (ux)^m(ux)^ma(yu)^m = (ux)^ma = (ux)^{m-1}uc, \]
which means that $a\mathcal{L}c$.

Similarly we can choose $n\in \N$ such that $(vy)^n$ is idempotent, so from $b = (xu)b(vy) = (xu)^2b(vy)^2 = \ldots$
we get
\begin{align*}
c &= xa = x(ux)^{n+1}a(yu)^{n+1} = (xu)^{n+1}xay(vy)^nv \\
&= (xu)^{n+1}b(vy)^{2n}v = (xu)^{n+1}b(vy)^{n+1}(vy)^{n-1}v \\
&= b(vy)^{n-1}v.
\end{align*}
This along with $cy = xay = b$, gives $c\mathcal{R}b$. Thus $a\mathcal{L};\mathcal{R}b$, i.e. $a\mathcal{D}b$.
\end{proof}
\begin{corollary}
If the semigroup is finite, then $\mathcal{D} = \mathcal{J}$.
\end{corollary}

\begin{proposition}
Let $S$ be a semigroup. If $\sSet{S/\mathcal{L}, \subseteq}$ and $\sSet{S/\mathcal{R}, \subseteq}$ are well-founded, then $\mathcal{D} = \mathcal{J}$.
\end{proposition}
\begin{proof}
TODO
\end{proof}

\subsubsection{Egg-box diagrams}
\begin{definition}
In an \udef{egg-box diagram} a semigroup $S$ is depicted as a grid. Each element is put in this grid such that
\begin{itemize}
\item the rows are $\mathcal{R}$-classes; and
\item the columns are $\mathcal{L}$-classes.
\end{itemize} 
\end{definition}

Thus for $a,b\in S$, $[a]_\mathcal{L} = [b]_\mathcal{L}$ if and only if $a$ and $b$ are in the same column. Similarly, $[a]_\mathcal{R} = [b]_\mathcal{R}$ if and only if $a$ and $b$ are in the same row.

\begin{lemma}
Let $S$ be a semigroup and $a,b\in S$. Then
\begin{enumerate}
\item the cells in the egg-box diagram are $\mathcal{H}$-equivalence classes;
\item $a\mathcal{D}b$ \textup{if and only if} there is an element in the intersection of the row of $a$ and the column of $b$ or vice versa.
\end{enumerate}
\end{lemma}

\begin{example}
Consider the semigroup $(\{1,2,3\} \to \{1,2,3\})$ with composition $;$. We can represent an element $f$ of this semigroup as $(f(1) f(2) f(3))$. We have
\begin{itemize}
\item $f\mathcal{L}g$ if $f$ and $g$ have the same image;
\item $f\mathcal{R}g$ if $f$ and $g$ have the same kernel.
\end{itemize}
An egg-box diagram can be drawn as follows:
\[ \begin{array}{|c|c|c|c|c|c|c|}
\hline
\mathbf{(1 1 1)} & \mathbf{(2 2 2)} & \mathbf{(3 3 3)} &&& &  \\ \hline
&& & \mathbf{(1 2 2)}, & \mathbf{(1 3 3)}, & (2 3 3), &  \\
&& & (2 1 1)  & (3 1 1)  & (3 2 2)  &  \\ \hline
&& & (2 1 2), & (3 1 3), & \mathbf{(3 2 3)},  &  \\
&& & \mathbf{(1 2 1)}  & (1 3 1)  & (2 3 2)  &  \\ \hline
&& & (2 2 1), & (3 3 1), & (3 3 2),  &  \\
&& & (1 1 2)  & \mathbf{(1 1 3)}  & \mathbf{(2 2 3)}  &  \\ \hline
&& &&& & \mathbf{(1 2 3)}, (2 3 1) (3 1 2)  \\
&& &&& & (1 3 2), (2 1 3) (3 2 1)  \\ \hline
\end{array} \]
The bold elements are idempotents.
\end{example}


\begin{proposition}[Green's lemma] \label{GreensLemma}
Let $S$ be a semigroup and $a,b,x \in S$.
\begin{enumerate}
\item If $ax = b$ and $a\mathcal{R}b$, then
\begin{enumerate}
\item $\rho_x|_{[a]_\mathcal{L}}: [a]_\mathcal{L} \to [b]_\mathcal{L}$ is a bijection;
\item if $by = a$ for some $y\in \widetilde{S}$, then $\rho_y|_{[b]_\mathcal{L}}$ is the inverse;
\item $\rho_x|_{[a]_\mathcal{L}}$ preserves $\mathcal{R}$-classes.
\end{enumerate}
\item If $xa = b$ and $a\mathcal{L}b$, then
\begin{enumerate}
\item $\lambda_x|_{[a]_\mathcal{R}}: [a]_\mathcal{R} \to [b]_\mathcal{R}$ is a bijection with inverse $\lambda_y|_{[b]_\mathcal{R}}$;
\item if $yb = a$ for some $y\in \widetilde{S}$, then $\lambda_y|_{[b]_\mathcal{R}}$ is the inverse;
\item $\lambda_x|_{[a]_\mathcal{R}}$ preserves $\mathcal{L}$-classes.
\end{enumerate} 
\end{enumerate}
In particular
\begin{enumerate}
\item if $a\mathcal{R}b$, then there exists $x\in \widetilde{S}$ such that $ax = b$ and thus $|[a]_\mathcal{L}| = |[b]_\mathcal{L}|$;
\item if $a\mathcal{L}b$, then there exists $x\in \widetilde{S}$ such that $xa = b$ and thus $|[a]_\mathcal{R}| = |[b]_\mathcal{R}|$.
\end{enumerate}
\end{proposition}
\begin{proof}
The function $\rho_x$ is well-defined: let $u\in [a]_\mathcal{L}$ so that $u = va$ for some $v\in \widetilde{S}$. Then $\rho_x(u) = vax = vb \in [b]_\mathcal{L}$.

Because $a\mathcal{R}b$, we can always find a $y\in \widetilde{S}$ such that $by = a$. The function $\rho_y|_{[b]_\mathcal{L}}$ is clearly the inverse: $\rho_y(\rho_x(u)) = \rho_y(vb) = vby = va = u$. This shows that $\rho_x$ is bijective.

It is clear that $\rho_x$ preserves $\mathcal{R}$-classes, because it operates on the right.

The arguments for $\lambda_x$ and $\lambda_y$ are completely analogous.
\end{proof}
\begin{corollary}
Let $S$ be a semigroup and $a,b\in S$ such that $a\mathcal{D}b$, then $|[a]_\mathcal{H}| = |[b]_\mathcal{H}|$.
\end{corollary}
\begin{proof}
If $a(\mathcal{L};\mathcal{R})b$, then there exists a $c\in S$ such that $c = sa$ and $b = ct$. Then $\lambda_s\circ \rho_t$ is the required bijection.
\end{proof}

\begin{theorem}[Green's theorem]
Let $S$ be a semigroup and $H$ an $\mathcal{H}$-class in $S$. Then either
\begin{enumerate}
\item $H^2\perp H$; or
\item $H^2 = H$ and $H$ is a subgroup of $S$.
\end{enumerate}
\end{theorem}
\begin{proof}
Suppose $H^2\cap H \neq \emptyset$, then there exist $a,b\in H$ such that $ab = c\in H$. By the Green's lemma \ref{GreensLemma} we have that $\rho_b:H\to H$ and $\lambda_a: H\to H$ are bijections.

Then for all $h\in H$, $\rho_b(h) = hb \in H$. Again by the Green's lemma, this means that $\lambda_h: H\to H$ is a bijection. Similarly $\rho_h: H\to H$ is a bijection for all $h$. So for all $h\in H$ we have $hH = H = Hh$. This means $H^2 = H$ and $H$ is a group by \ref{groupCriterion}.
\end{proof}
\begin{corollary} \label{GreensTheoremCorollary}
Let $S$ be a semigroup and $H$ an $\mathcal{H}$-class in $S$. Then
\begin{enumerate}
\item if $x$ is an idempotent in $H$, then $H$ is a subgroup of $S$;
\item no $\mathcal{H}$-class can contain more than one idempotent. 
\end{enumerate}
\end{corollary}

\subsubsection{Regular elements $\mathcal{D}$-classes}
\begin{definition}
Let $S$ be a semigroup. An element $a\in S$ is called \udef{regular} if there exists $x\in S$ such that $axa = a$.
\end{definition}

\begin{proposition} 
Let $S$ be a semigroup. If $a\in S$ is regular, then every element in $[a]_{\mathcal{D}}$ is regular.
\end{proposition}
So it makes sense to call a $\mathcal{D}$-class \udef{regular} if it consists of regular elements and \udef{irregular} otherwise.
\begin{corollary}
If there is an idempotent $x\in [a]_{\mathcal{D}}$, then $[a]_{\mathcal{D}}$ is regular.
\end{corollary}
\begin{proof}
An idempotent is regular: $x = xx = x(xx) = xxx$.
\end{proof}

\begin{proposition} \label{idempotentsInGreensClasses}
Let $S$ be a semigroup.
\begin{enumerate}
\item If $x\in S$ is an idempotent, then $x$ is a left identity for $[x]_{\mathcal{R}}$ and $x$ is a right identity for $[x]_{\mathcal{L}}$.
\item If $a$ is regular with $axa = a$, then $xa$ and $ax$ are idempotents.
\item If $a$ is regular with $axa = a$, then $xa\mathcal{L}a$ and $ax\mathcal{R}a$.
\item In a regular $\mathcal{D}$-class each $\mathcal{L}$-class and each $\mathcal{R}$-class contains at least one idempotent.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Let $a\in [x]_\mathcal{R}$. Then there exists a $y\in \widetilde{S}$ such that $a = xy$ and thus $xa = xxy = xy = a$. The claim of right-identity is similar.

(2) We have $(xa)(xa) = x(axa) = xa$ and $(ax)(ax) = (axa)x = ax$.

(3) If $a$ is regular with $axa = a$, then $xa$ is idempotent: $(xa)(xa) = x(axa) = xa$ and $xa \in [a]_{\mathcal{L}}$:
\[ xa = (xa) \qquad a(xa) = a \]
Similarly $ax \in [a]_{\mathcal{R}}$ and is idempotent.

(4) Let $[a]_\mathcal{L}$ be an $\mathcal{L}$-class in a regular $\mathcal{D}$-class. By regularity there exists an $x\in S$ such that $axa = a$. From (2) and (3), we have that $[a]_\mathcal{L}$ contains the idempotent $xa$ and $[a]_\mathcal{R}$ the idempotent $ax$.
\end{proof}

\begin{proposition}
Let $a,b \in S$ such that $a\mathcal{D}b$. Then $ab\in [a]_{\mathcal{R}}\cap [b]_{\mathcal{L}}$ \textup{if and only if} $[b]_{\mathcal{R}}\cap [a]_{\mathcal{L}}$ contains an idempotent.
\end{proposition}
\begin{proof}
Suppose $[b]_{\mathcal{R}}\cap [a]_{\mathcal{L}}$ contains an idempotent $x$. Then $xb = b$ by \ref{idempotentsInGreensClasses}. Then $\rho_b$ maps $[x]_{\mathcal{L}} = [a]_{\mathcal{L}}$ to $[b]_{\mathcal{L}}$ by \ref{GreensLemma}. It preserves $\mathcal{R}$-classes, so in particular it maps $[a]_{\mathcal{H}}$ to $[a]_{\mathcal{R}}\cap [b]_{\mathcal{L}}$. Thus $ab = \rho_b(a) \in [a]_{\mathcal{R}}\cap [b]_{\mathcal{L}}$.

Now assume $ab\in [a]_{\mathcal{R}}\cap [b]_{\mathcal{L}}$. Then there exists a $c\in \widetilde{S}$ such that $abc = a$. By \ref{GreensLemma} this means $\rho_c\in ([ab]_{\mathcal{L}}\to [a]_{\mathcal{L}}) = ([b]_{\mathcal{L}}\to [a]_{\mathcal{L}})$. In particular this restricts to $([b]_{\mathcal{H}}\to [b]_{\mathcal{R}}\cap[a]_{\mathcal{L}})$. Because $ab = (ab)$, $\rho_b$ is the inverse of $\rho_c$ by the same lemma.

So $\rho_c(b) = bc \in [b]_{\mathcal{R}}\cap[a]_{\mathcal{L}}$ and bc is idempotent because
\[ bcbc = (\rho_c\circ\rho_b\circ\rho_c) (b) = \rho_c(b) = bc. \]
\end{proof}

\subsubsection{Generalised inverses}
\begin{definition}
Let $S$ be a semigroup and $a\in S$. We call $a'$ a \udef{(generalised) inverse} of $a$ if
\[ aa'a = a, \qquad a'aa' = a'. \]
\end{definition}

\begin{lemma}
Let $S$ be a semigroup and $a\in S$. Then $a$ has a generalised inverse \textup{if and only if} it is regular.
\end{lemma}
\begin{proof}
Clearly every element with a generalised inverse is regular. Conversely, assume $a$ regular with $axa = a$. Then $a' = xax$ is a generalised inverse of $a$.
\end{proof}

\begin{proposition}
Let $a$ be an element of a regular $\mathcal{D}$-class $D$ in a semigroup $S$.
\begin{enumerate}
\item If $a'$ is a generalised inverse of $a$, then
\begin{enumerate}
\item $a' \in D$;
\item $[aa']_\mathcal{H} = [a]_\mathcal{R}\cap [a']_\mathcal{L}$;
\item $[a'a]_\mathcal{H} = [a']_\mathcal{R}\cap [a]_\mathcal{L}$.
\end{enumerate}
\item If $b\in S$ is such that $[a]_\mathcal{R}\cap [b]_\mathcal{L}$ contains an idempotent $x$ and $[b]_\mathcal{R}\cap [a]_\mathcal{L}$ contains an idempotent $y$, then $[b]_\mathcal{H}$ contains a generalised inverse $a'$ of $a$ such that $aa' = x$ and $a'a = y$.
\item No $\mathcal{H}$-class contains more than one generalised inverse of $a$.
\end{enumerate}
\end{proposition}
\begin{proof}
(1) Firstly notice that $[a]_\mathcal{R}\cap [a']_\mathcal{L}$ is an $\mathcal{H}$-class. Also $a\mathcal{R}aa'$ and $a'\mathcal{L}aa'$ by \ref{idempotentsInGreensClasses}.

(2) From $a\mathcal{R}x$, we deduce that there exists a $u\in\widetilde{S}$ such that $au = x$. 

Set $a' = yux$. Then, using that $x$ is a left-identity on $[a]_\mathcal{R}$ and $y$ a right-identity on $[a]_\mathcal{L}$ by \ref{idempotentsInGreensClasses},
\begin{align*}
aa'a &= a(yux)a = (ay)u(xa) = aua = (au)a = xa = a \\
a'aa' &= (yux)a(yux) = (yu)(xay)(ux) = (yu)a(ux) = (yu)(au)x = yux^2 = yux = a' \\
aa' &= a(yux) = ((ay)u)x = (au)x = x^2 = x.
\end{align*}
For the last equality, we need that $a\mathcal{L}y$ implies the existence of $v\in \widetilde{S}$ such that $va = y$. Then
\[ a'a = (yux)a = (va)u(xa) = (va)(ua) = v(au)a = v(xa) = va = y. \]
We now just need to show that $a' \in [b]_\mathcal{H}$. By \ref{idempotentsInGreensClasses} we have $a'\in [aa']_{\mathcal{L}}$ and $a'\in [a'a]_{\mathcal{R}}$, so
\[ a' \in [aa']_{\mathcal{L}} \cap [a'a]_{\mathcal{R}} = [x]_{\mathcal{L}} \cap [y]_{\mathcal{R}} = [b]_{\mathcal{L}} \cap [b]_{\mathcal{R}} = [b]_\mathcal{H}. \]

(3) Suppose $[b]_\mathcal{H}$ is an $\mathcal{H}$-class containing two generalised inverses $a_1', a_2'$ of $a$. Then $aa'_1 = aa'_2$ and $a'_1a = a'_2a$ by \ref{GreensTheoremCorollary} and thus
\[ a'_1 = a'_1(aa'_1) = a'_1(aa'_2) = (a'_2a)a'_2 = a'_2. \]
\end{proof}
\begin{corollary} \label{corollaryInversesIdempotentsDclass}
Let $S$ be a semigroup and $x,y\in S$ idempotents. Then $x\mathcal{D}y$ \textup{if and only if} we can write $x = aa'$ and $y = a'a$ for some $a\in [x]_\mathcal{R}\cap [y]_\mathcal{L}$ and $a'\in [y]_\mathcal{R}\cap [x]_\mathcal{L}$ that are generalised inverses of each other.
\end{corollary}
\begin{proof}
We have $x\mathcal{D}y$ iff there exist $a,b\in S$ such that $x\mathcal{R}a$, $a\mathcal{L}y$ and $x\mathcal{L}b$, $b\mathcal{R}y$. This means $x\in [a]_\mathcal{R}\cap [b]_\mathcal{L}$ and $y\in [b]_\mathcal{R}\cap [a]_\mathcal{L}$. So by the proposition we can find an $a'\in [b]_\mathcal{H}$ that satisfies the requirements.
\end{proof}

\begin{proposition}
Let $S$ be a semigroup and let $H,K$ be $\mathcal{H}$-classes that are subgroups and members of the same $\mathcal{D}$-class. Then $H$ and $K$ are isomorphic groups.
\end{proposition}
\begin{proof}
Let $e$ be the idempotent (and thus identity) in $H$ and $f$ the identity in $K$. By \ref{corollaryInversesIdempotentsDclass} we have mutually inverse $a\in [x]_\mathcal{R}\cap [y]_\mathcal{L}$ and $a'\in [y]_\mathcal{R}\cap [x]_\mathcal{L}$ such that $x = aa'$ and $y = a'a$.

We claim $\lambda_{a'}\circ\rho_{a}|_H$ is an isomorphism $H\to K$. Indeed it is bijective by \ref{GreensLemma}. We need to show that it is a homomorphism: take $u,v\in H$
\[ (\lambda_{a'}\circ\rho_{a})(u)(\lambda_{a'}\circ\rho_{a})(v) = a'uaa'va = a'uxva = a'uva = (\lambda_{a'}\circ\rho_{a})(uv), \]
where we have used that $x$ is the identity for $H$.
\end{proof}

\subsubsection{Regular semigroups}
\begin{definition}
A regular semigroup is a semigroup where every element is regular.
\end{definition}

\begin{lemma}
Let $S$ be a regular semigroup. Then for all $a\in S$
\[ \widetilde{S}a = Sa, \qquad  a\widetilde{S} = aS \qquad\text{and}\qquad \widetilde{S}a\widetilde{S} = SaS. \]
\end{lemma}
So we can drop all mention of $\widetilde{S}$ when working with ideal. In particular
\begin{itemize}
\item $a\mathcal{L}b$ if and only if $Sa = Sb$;
\item $a\mathcal{R}b$ if and only if $aS = bS$;
\item $a\mathcal{J}b$ if and only if $SaS = SbS$.
\end{itemize}

\subsection{Inverse semigroups}

\section{Monoids}


\begin{lemma}
A locally small category with a single object is a monoid.
\end{lemma}
TODO: \udef{delooping} $\cat{B}M$.


\subsection{Ordered monoids}
\begin{definition}
An \udef{ordered monoid} is a monoid $(M, \cdot, 0)$ on which a partial order $\preceq$ is defined that is compatible, i.e. $\forall x,y,z\in M$
\[ x\preceq y \implies x\cdot z \preceq y \cdot z \land z\cdot x \preceq z \cdot y. \]

Positive: $x > 0$.
\end{definition}

\subsubsection{The Archimedean property}
\begin{definition}
Let $(M,+,\leq)$ be a totally ordered monoid and $x,y\in M$ positive. Then
\begin{itemize}
\item $x$ is \udef{infinitesimal w.r.t.} $y$ or $y$ is \udef{infinite w.r.t.} $x$ if $nx<y$ for all $n\in\N$;
\item $M$ is \udef{Archimedean} if there is no pair $(x,y)$ such that $x$ is infinitesimal w.r.t. $y$.
\end{itemize}
\end{definition}
every submonoid is Archimedean.

abelian??

\section{Divisibility}
$m|n$ order relation.

$\sup\{n,m\} = kgv(n,m)$ and $\inf\{n,m\} = ggd(n,m)$







\chapter{Groups}
\input{groups}


\chapter{Rings}
TODO: signature $\sSet{R,+,\cdot, 0, 1}$.
TODO: addition, multiplication and scalar multiplication of functions: pointwise.

TODO: unital homomorphisms; unital subalgebra.

\begin{lemma}
Let $R$ be a ring and $a\in R$.
\begin{enumerate}
\item If $a$ has a left and a right inverse, they are equal. Thus $a$ has an inverse.
\item The inverse of $a$ is unique, if it exists.
\end{enumerate}
\end{lemma}
\begin{proof}
Let $l$ be a left inverse of $a$ and $r$ a right inverse. Then
\[ l = l(ar) = (la)r = r. \]
The unicity of the inverse is an easy consequence.
\end{proof}

\begin{lemma} \label{productInvertibility}
Let $R$ be a ring and $a,b\in R$. Then $a$ and $b$ are invertible \textup{if and only if} $ab$ and $ba$ are invertible.
\end{lemma}
\begin{proof}
Assume $a,b$ invertible. Then $b^{-1}a^{-1}$ is an inverse for $ab$ and $a^{-1}b^{-1}$ is an inverse for $ba$.

Assume both $ab$ and $ba$ have inverses. Then from
\begin{align*}
a[b(ab)^{-1}] &= \vec{1} & [(ba)^{-1}b]a &= \vec{1} \\
[(ab)^{-1}a]b &= \vec{1} & b[a(ba)^{-1}] &= \vec{1}
\end{align*} 
we see that both $a$ and $b$ have left and right inverses.
\end{proof}

\begin{proposition} \label{everyProperIdealInMaximalIdeal}
Every proper ideal is contained in a maximal ideal.
\end{proposition}

\begin{lemma} \label{nonInvertibleGeneratedIdeals}
Let $R$ be a unital ring. If $a\in R$ is non-invertible, then the generated ideal $(a)$ is not the whole ring.
\end{lemma}
\begin{proof}
If $(a) = R$, then $1\in (a)$, implying $ab=1$ for some $b\in R$. A contradiction.
\end{proof}

\begin{proposition}
Let $f$ be a ring homomorphism. If $f$ is invertible as a function (i.e. bijective), its inverse $f^{-1}$ is also a ring homomorphism.
\end{proposition}

\begin{proposition} \label{kernelIsIdeal}
Kernel of Ring Homomorphism is Ideal
\end{proposition}

\begin{definition}
A $*$-rng is a structured set $(R,+,\cdot, *)$, where $R$ is a rng and $*:R\to R$ is an involutive anti-automorphism. That is, $\forall x,y\in R$:
\begin{itemize}
\item $(xy)^* = y^*x^*$;
\item $(x+y)^* = x^* + y^*$;
\item $(x^*)^* = x$.
\end{itemize}
This is also known as an \udef{involutive rng} or \udef{rng with involution}.
\end{definition}
\begin{lemma}
If $R$ is a unital ring with involution, then $1^* = 1$.
\end{lemma}
\begin{proof}
From $1^*x = (x^*1)^* = (x^*)^* = x$, we see that $1^*$ is a multiplicative identity, which is unique.
\end{proof}
\begin{definition}
An element of a $*$-rng is \udef{self-adjoint} if $x^* = x$.
\end{definition}

\section{Group rings}
\begin{definition}
Let $G$ be a finite group and $R$ a r(i)ng. The \udef{group ring} $RG$ is the set of functions $(G\to R)$ with pointwise addition and the convolution product
\[ (x\star y)(g) = \sum_h x(h)y(h^{-1}g) = \sum_{g=hk}x(h)y(k) \]
for all $x,y\in RG$ and $g\in G$. 
\end{definition}
The a group ring can be seen as a free module generated by $G$. (TODO: this as definition?)



\chapter{Fields}
\section{Totally ordered fields}
\begin{definition}
Let $K$ be a set with binary operations $+,\cdot$ such that $(K,+,\cdot)$ is a field and a binary relation $\leq$ such that $(F,\leq)$ is a total order. Then the structured set $(K,+,\cdot,\leq)$ is a \udef{totally ordered field} if $\forall a,x,y\in K$:
\begin{enumerate}
\item $x\leq y \implies x+a \leq y+a$;
\item $x\leq y \land a\geq 0 \implies ax \leq ay$;
\item $x\leq y \land a\leq 0 \implies ax \geq ay$.
\end{enumerate}
\end{definition}

\begin{lemma}
Let $(K,+,\cdot,\leq)$ be a totally ordered field and $a,b,c,d\in K$. Then
\begin{enumerate}
\item $a\leq b \land c\leq d \implies (a+c) \leq (b+d)$;
\item $a\leq b \implies -b\leq -a$;
\item $a\geq 0 \iff -a\leq 0$;
\item $a\geq 0 \land b\geq 0 \implies ab \geq 0$;
\item $a\geq 0 \implies a^n \geq 0$ for all $n\in\N$;
\item $a\leq 0 \implies (a^{2n} \geq 0 \land a^{2n+1}\leq 0)$ for all $n\in\N$;
\item $a > 0 \iff a^{-1} > 0$ and $a < 0 \iff a^{-1} < 0$;
\item if $b \geq a>0$, then $b^{-1} \leq a^{-1}$;
\item $0<1$.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) By applying point 1. of the definition twice, we get $(a+c)\leq(b+c)\leq(b+d)$.

(2) This is the result of multiplying by $-1$.

(3) Idem, using $-0=0$.

(4) Special case of point 2. of the definition.

(5) By induction on $n$ and point 2. of the definition.

(6) By induction on $n$ and point 3. of the definition.

(7) By multiplying $a \geq 0$ with $(a^{-1})^{2}$, which is positive, we get $a^{-1}\geq 0$. Also $a\neq 0 \iff a^{-1}\neq 0$.

(8) By point 7. and point 4. of the lemma $a^{-1}b^{-1}$ is positive, so multiplying $b\geq a$ by $a^{-1}b^{-1}$ yields $b^{-1} \leq a^{-1}$.

(9) Assume, towards a contradiction, that this is false, so $1\leq 0$. Then $1$ is negative and multiplying the inequality with $1$ yields $1\cdot 1 \geq 1\cdot 0$, or $1\geq 0$. Taking both inequalities gives $1=0$ by anti-symmetry, which is prohibited for fields.
\end{proof}

\begin{definition}
Let $F\subset K$ be totally ordered fields. Then we call $F$ \udef{dense} in $K$ if
\[ \forall a,b\in K: \exists x\in F: a<x<b. \]
\end{definition}
TODO: topology definition?

\chapter{Valuation theory}
Absolute values on integral domains.